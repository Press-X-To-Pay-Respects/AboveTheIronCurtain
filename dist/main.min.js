(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./src/js/main.js":[function(require,module,exports){
'use strict';

var game = new Phaser.Game(800, 800, Phaser.AUTO, 'atic-game');

window.playerState = {
    currentLevel: 'Game'
};

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));

game.state.start('Boot');
},{"./states/boot":"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\states\\boot.js","./states/game":"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\states\\game.js","./states/menu":"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\states\\menu.js","./states/preloader":"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\states\\preloader.js","./states/splash":"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\states\\splash.js"}],"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\entities\\cube.js":[function(require,module,exports){
/*
Defines a cube module for a cubesat.
*/

var Cube = function (game, x, y) {
    Phaser.Sprite.call(this, game, x, y, 'testsprite');
    game.add.existing(this);
    this.north = undefined;
    this.east = undefined;
    this.south = undefined;
    this.west = undefined;
    this.root = false;
    this.DIR = {NORTH: 0, EAST: 1, SOUTH: 2, WEST: 3};
};

Cube.prototype = Object.create(Phaser.Sprite.prototype);
Cube.prototype.constructor = Cube;

/**
 * Automatically called by World.update
 */
Cube.prototype.update = function() {
};

Cube.prototype.addConnection = function(other) {
  var offset = 2;
  var thisSide = this.relativeSide(this.body, other);
  var otherSide = this.relativeSide(other, this.body);
  // console.log(thisSide, otherSide);
  if (this.getSide(thisSide)) {
     return;
  }
  if (other.sprite.getSide(otherSide)) {
     return;
  }
  switch (thisSide) {
     case this.DIR.NORTH:
     this.game.physics.p2.createLockConstraint(this.body, other, [0, this.width + offset]);
     this.north = other.sprite;
     break;
     case this.DIR.EAST:
     this.game.physics.p2.createLockConstraint(this.body, other, [-this.width - offset, 0]);
     this.east = other.sprite;
     break;
     case this.DIR.SOUTH:
     this.game.physics.p2.createLockConstraint(this.body, other, [0, -this.width - offset]);
     this.south = other.sprite;
     break;
     case this.DIR.WEST:
     this.game.physics.p2.createLockConstraint(this.body, other, [this.width + offset, 0]);
     this.west = other.sprite;
     break;
  }
  switch (otherSide) {
     case this.DIR.NORTH:
     other.sprite.north = this;
     break;
     case this.DIR.EAST:
     other.sprite.east = this;
     break;
     case this.DIR.SOUTH:
     other.sprite.south = this;
     break;
     case this.DIR.WEST:
     other.sprite.west = this;
     break;
  }
};

Cube.prototype.relativeSide = function(thisBody, otherBody) {
  var thisPoint = new Phaser.Point(thisBody.x, thisBody.y);
  var otherPoint = new Phaser.Point(otherBody.x, otherBody.y);
  var angleToOther = Phaser.Point.angle(thisPoint, otherPoint);
  if (angleToOther < 0) { // fix dumb part of Phaser.Point.angle()
     angleToOther = 2 * Math.PI + angleToOther;
  }
  angleToOther = (angleToOther + 3/2 * Math.PI) % (2 * Math.PI); // rotate 90 d clockwise
  var diffAngle = angleToOther - thisBody.rotation;
   if (diffAngle < 1 / 4 * Math.PI || diffAngle > 7 / 4 * Math.PI) { // north
     return this.DIR.NORTH;
  } else if (diffAngle >= 1 / 4 * Math.PI && diffAngle < 3 / 4 * Math.PI) { // east
     return this.DIR.EAST;
  } else if (diffAngle >= 3 / 4 * Math.PI && diffAngle < 5 / 4 * Math.PI) { // south
     return this.DIR.SOUTH;
  } else if (diffAngle >= 5 / 4 * Math.PI && diffAngle < 7 / 4 * Math.PI) { // west
     return this.DIR.WEST;
  }
};

Cube.prototype.cubeCollide = function(other) {
   if (other === null || this.prototype !== other.prototype) {
      return;
   }
   // if (this.hasRoot()) {
   if (this.hasRoot() && !other.sprite.hasRoot()) {
      this.addConnection(other);
   }
};

Cube.prototype.hasRoot = function() {
  /*
  if (this.root) {
     return true;
  }
  if (this.hasRootR(this.DIR.NORTH, this)) {
      return true;
  } else if (this.hasRootR(this.DIR.EAST, this)) {
     return true;
  } else if (this.hasRootR(this.DIR.SOUTH, this)) {
      return true;
  } else if (this.hasRootR(this.DIR.WEST, this)) {
     return true;
  }
  return false;
  */
  console.log('new test');
  console.log(this);
  if (this.root) {
     return true;
  }
  var visited = [];
  visited.push(this);
  if (this.north && this.hasRootR(visited, this.north)) {
    return true;  
  }
  if (this.east && this.hasRootR(visited, this.east)) {
    return true;  
  }
  if (this.south && this.hasRootR(visited, this.south)) {
    return true;  
  }
  if (this.west && this.hasRootR(visited, this.west)) {
    return true;
  }
};

Cube.prototype.hasRootR = function(visited, cur) {
   console.log(cur);
   if (cur.root) {
      return true;
   }
   visited.push(cur);
   if (cur.north && !this.contains(visited, cur.north) && this.hasRootR(visited, cur.north)) {
    return true;  
  }
  if (cur.east && !this.contains(visited, cur.east) && this.hasRootR(visited, cur.east)) {
    return true;  
  }
  if (cur.south && !this.contains(visited, cur.south) && this.hasRootR(visited, cur.south)) {
    return true;  
  }
  if (cur.west && !this.contains(visited, cur.west) && this.hasRootR(visited, cur.west)) {
    return true;  
  }
};

Cube.prototype.contains = function (array, obj) {
  for (var i = 0; i < array.length; i++) {
      if (array[i] === obj) {
         return true;
      }
  }  
   return false;
};

/*
Cube.prototype.hasRootR = function(dir, obj) {
   if (obj.root) {
      return true;
   }
   switch (dir) {
      case this.DIR.NORTH:
      if (obj.north && this.hasRootR(this.DIR.NORTH, obj.north)) {
         return true;
      }
      if (obj.east && this.hasRootR(this.DIR.EAST, obj.east)) {
         return true;
      }
      if (obj.west && this.hasRootR(this.DIR.WEST, obj.west)) {
         return true;
      }
      return false;
      case this.DIR.EAST:
      if (obj.north && this.hasRootR(this.DIR.NORTH, obj.north)) {
         return true;
      }
      if (obj.east && this.hasRootR(this.DIR.EAST, obj.east)) {
         return true;
      }
      if (obj.south && this.hasRootR(this.DIR.SOUTH, obj.south)) {
         return true;
      }
      return false;
      case this.DIR.SOUTH:
      if (obj.east && this.hasRootR(this.DIR.EAST, obj.east)) {
         return true;
      }
      if (obj.south && this.hasRootR(this.DIR.SOUTH, obj.south)) {
         return true;
      }
      if (obj.west && this.hasRootR(this.DIR.WEST, obj.west)) {
         return true;
      }
      return false;
      case this.DIR.WEST:
      if (obj.north && this.hasRootR(this.DIR.NORTH, obj.north)) {
         return true;
      }
      if (obj.south && this.hasRootR(this.DIR.SOUTH, obj.south)) {
         return true;
      }
      if (obj.west && this.hasRootR(this.DIR.WEST, obj.west)) {
         return true;
      }
      return false;
   }
   return false;
};
*/

Cube.prototype.getSide = function(side) {
   switch (side) {
     case this.DIR.NORTH:
     return this.north;
     case this.DIR.EAST:
     return this.east;
     case this.DIR.SOUTH:
     return this.south;
     case this.DIR.WEST:
     return this.west;
  }
  return undefined;
};

module.exports = Cube;















},{}],"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\states\\boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.game.scale.minWidth =  480;
      this.game.scale.minHeight = 260;
      this.game.scale.maxWidth = 640;
      this.game.scale.maxHeight = 480;
      this.game.scale.forceLandscape = true;
      this.game.scale.pageAlignHorizontally = true;
      this.game.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\states\\game.js":[function(require,module,exports){
/*
Main testing environment.
*/

var Cube = require('../entities/cube');

var Utils = require('../utils');

var mouseBody; // physics body for mouse

var Game = function () {
  this.testentity = null;
};

module.exports = Game;

Game.prototype = {

  create: function () {
    this.game.physics.startSystem(Phaser.Physics.P2JS);
    this.game.physics.p2.setImpactEvents(true);
    mouseBody = new p2.Body(); // jshint ignore:line
    this.game.physics.p2.world.addBody(mouseBody);
    this.placeKey = this.game.input.keyboard.addKey(Phaser.Keyboard.P);
    this.placeKey.onDown.add(this.placeCube, this);
    
    this.mouseX = 0;
    this.mouseY = 0;
    
    this.input.onDown.add(this.click, this);
    this.input.onUp.add(this.release, this);
    this.input.addMoveCallback(this.move, this);
    this.grabbed = undefined;
    this.line = new Phaser.Line(0, 0, 0, 0);
    
    this.rootSpawned = false;
    
    this.debugNum = 0;
    
     // var thisPoint = new Phaser.Point(10, 10);
     // var otherPoint = new Phaser.Point(10, 11);
     // var angleToOther = Phaser.Point.angle(thisPoint, otherPoint);
     // console.log(angleToOther);
  },

  update: function () {
    if (this.grabbed) {
      var angle = Math.atan2(this.grabbed.sprite.y - this.input.position.y, this.grabbed.sprite.x - this.input.position.x) + Math.PI;
      var dist = Utils.distance(this.grabbed.sprite.x, this.grabbed.sprite.y, this.input.position.x, this.input.position.y);
      var weight = 10;
      this.grabbed.force.x = Math.cos(angle) * dist * weight;
      this.grabbed.force.y = Math.sin(angle) * dist * weight;
      this.line.setTo(this.grabbed.sprite.x, this.grabbed.sprite.y, this.input.position.x, this.input.position.y);
    } else {
       this.line.setTo(0, 0, 0, 0);
    }
  },
  
  render: function () {
    this.game.debug.geom(this.line);
  },

  click: function (pointer) {
    // console.log(this.grabbed);
    var bodies = this.game.physics.p2.hitTest(pointer.position);
    if (bodies.length)
    {
        this.grabbed = bodies[0].parent;
        console.log(this.grabbed.sprite.name, this.grabbed.sprite.north, this.grabbed.sprite.east, this.grabbed.sprite.south, this.grabbed.sprite.west);
    }
  },
  
  release: function () {
     if (this.grabbed) {
        this.grabbed = undefined;
     }
  },
  
  move: function (pointer) {
    // p2 uses different coordinate system, so convert the pointer position to p2's coordinate system
    mouseBody.position[0] = this.game.physics.p2.pxmi(pointer.position.x);
    mouseBody.position[1] = this.game.physics.p2.pxmi(pointer.position.y);
    this.mouseX = pointer.position.x;
    this.mouseY = pointer.position.y;
  },
  
  placeCube: function () {
    var entity = new Cube(this.game, this.mouseX, this.mouseY);
    var scale = 0.5;
    entity.name = this.debugNum++;
    entity.scale.x = scale;
    entity.scale.y = scale;
    entity.anchor.setTo(0.5, 0.5);
    this.game.physics.p2.enable(entity, true);
    entity.body.onBeginContact.add(entity.cubeCollide, entity);
    entity.body.damping = 0.9;
    entity.body.angularDamping = 0.9;
    if (!this.rootSpawned) {
       entity.root = true;
       this.rootSpawned = true;
    }
  }
};




























},{"../entities/cube":"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\entities\\cube.js","../utils":"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\utils.js"}],"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\states\\menu.js":[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    var style = { font: '65px Arial', fill: '#ffffff', align: 'center' };

    this.text = this.add.text(x - 300, y - 200, 'Press to Start', style);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel); // jshint ignore:line
  }
};

},{}],"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\states\\preloader.js":[function(require,module,exports){
var Preloader = function (game) {
  game = null;
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
    this.load.image('testsprite', 'assets/test2.png');
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      // this.game.state.start('Menu');
      this.game.state.start(playerState.currentLevel); // jshint ignore:line
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

},{}],"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\states\\splash.js":[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],"C:\\Users\\mattd_000\\Documents\\GitHub\\AboveTheIronCurtain\\src\\js\\utils.js":[function(require,module,exports){
/*
Collection of utility functions.
*/

var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    },
    distance: function(x1, y1, x2, y2) {
       return Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));
    }
};

module.exports = Utils;
},{}]},{},["./src/js/main.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlc1xcYnJvd3NlcmlmeVxcbm9kZV9tb2R1bGVzXFxicm93c2VyLXBhY2tcXF9wcmVsdWRlLmpzIiwic3JjL2pzL21haW4uanMiLCJzcmMvanMvZW50aXRpZXMvY3ViZS5qcyIsInNyYy9qcy9zdGF0ZXMvYm9vdC5qcyIsInNyYy9qcy9zdGF0ZXMvZ2FtZS5qcyIsInNyYy9qcy9zdGF0ZXMvbWVudS5qcyIsInNyYy9qcy9zdGF0ZXMvcHJlbG9hZGVyLmpzIiwic3JjL2pzL3N0YXRlcy9zcGxhc2guanMiLCJzcmMvanMvdXRpbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDelBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcclxuXHJcbnZhciBnYW1lID0gbmV3IFBoYXNlci5HYW1lKDgwMCwgODAwLCBQaGFzZXIuQVVUTywgJ2F0aWMtZ2FtZScpO1xyXG5cclxud2luZG93LnBsYXllclN0YXRlID0ge1xyXG4gICAgY3VycmVudExldmVsOiAnR2FtZSdcclxufTtcclxuXHJcbmdhbWUuc3RhdGUuYWRkKCdCb290JywgcmVxdWlyZSgnLi9zdGF0ZXMvYm9vdCcpKTtcclxuZ2FtZS5zdGF0ZS5hZGQoJ1NwbGFzaCcsIHJlcXVpcmUoJy4vc3RhdGVzL3NwbGFzaCcpKTtcclxuZ2FtZS5zdGF0ZS5hZGQoJ1ByZWxvYWRlcicsIHJlcXVpcmUoJy4vc3RhdGVzL3ByZWxvYWRlcicpKTtcclxuZ2FtZS5zdGF0ZS5hZGQoJ01lbnUnLCByZXF1aXJlKCcuL3N0YXRlcy9tZW51JykpO1xyXG5nYW1lLnN0YXRlLmFkZCgnR2FtZScsIHJlcXVpcmUoJy4vc3RhdGVzL2dhbWUnKSk7XHJcblxyXG5nYW1lLnN0YXRlLnN0YXJ0KCdCb290Jyk7IiwiLypcclxuRGVmaW5lcyBhIGN1YmUgbW9kdWxlIGZvciBhIGN1YmVzYXQuXHJcbiovXHJcblxyXG52YXIgQ3ViZSA9IGZ1bmN0aW9uIChnYW1lLCB4LCB5KSB7XHJcbiAgICBQaGFzZXIuU3ByaXRlLmNhbGwodGhpcywgZ2FtZSwgeCwgeSwgJ3Rlc3RzcHJpdGUnKTtcclxuICAgIGdhbWUuYWRkLmV4aXN0aW5nKHRoaXMpO1xyXG4gICAgdGhpcy5ub3J0aCA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMuZWFzdCA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMuc291dGggPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLndlc3QgPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLnJvb3QgPSBmYWxzZTtcclxuICAgIHRoaXMuRElSID0ge05PUlRIOiAwLCBFQVNUOiAxLCBTT1VUSDogMiwgV0VTVDogM307XHJcbn07XHJcblxyXG5DdWJlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUGhhc2VyLlNwcml0ZS5wcm90b3R5cGUpO1xyXG5DdWJlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEN1YmU7XHJcblxyXG4vKipcclxuICogQXV0b21hdGljYWxseSBjYWxsZWQgYnkgV29ybGQudXBkYXRlXHJcbiAqL1xyXG5DdWJlLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcclxufTtcclxuXHJcbkN1YmUucHJvdG90eXBlLmFkZENvbm5lY3Rpb24gPSBmdW5jdGlvbihvdGhlcikge1xyXG4gIHZhciBvZmZzZXQgPSAyO1xyXG4gIHZhciB0aGlzU2lkZSA9IHRoaXMucmVsYXRpdmVTaWRlKHRoaXMuYm9keSwgb3RoZXIpO1xyXG4gIHZhciBvdGhlclNpZGUgPSB0aGlzLnJlbGF0aXZlU2lkZShvdGhlciwgdGhpcy5ib2R5KTtcclxuICAvLyBjb25zb2xlLmxvZyh0aGlzU2lkZSwgb3RoZXJTaWRlKTtcclxuICBpZiAodGhpcy5nZXRTaWRlKHRoaXNTaWRlKSkge1xyXG4gICAgIHJldHVybjtcclxuICB9XHJcbiAgaWYgKG90aGVyLnNwcml0ZS5nZXRTaWRlKG90aGVyU2lkZSkpIHtcclxuICAgICByZXR1cm47XHJcbiAgfVxyXG4gIHN3aXRjaCAodGhpc1NpZGUpIHtcclxuICAgICBjYXNlIHRoaXMuRElSLk5PUlRIOlxyXG4gICAgIHRoaXMuZ2FtZS5waHlzaWNzLnAyLmNyZWF0ZUxvY2tDb25zdHJhaW50KHRoaXMuYm9keSwgb3RoZXIsIFswLCB0aGlzLndpZHRoICsgb2Zmc2V0XSk7XHJcbiAgICAgdGhpcy5ub3J0aCA9IG90aGVyLnNwcml0ZTtcclxuICAgICBicmVhaztcclxuICAgICBjYXNlIHRoaXMuRElSLkVBU1Q6XHJcbiAgICAgdGhpcy5nYW1lLnBoeXNpY3MucDIuY3JlYXRlTG9ja0NvbnN0cmFpbnQodGhpcy5ib2R5LCBvdGhlciwgWy10aGlzLndpZHRoIC0gb2Zmc2V0LCAwXSk7XHJcbiAgICAgdGhpcy5lYXN0ID0gb3RoZXIuc3ByaXRlO1xyXG4gICAgIGJyZWFrO1xyXG4gICAgIGNhc2UgdGhpcy5ESVIuU09VVEg6XHJcbiAgICAgdGhpcy5nYW1lLnBoeXNpY3MucDIuY3JlYXRlTG9ja0NvbnN0cmFpbnQodGhpcy5ib2R5LCBvdGhlciwgWzAsIC10aGlzLndpZHRoIC0gb2Zmc2V0XSk7XHJcbiAgICAgdGhpcy5zb3V0aCA9IG90aGVyLnNwcml0ZTtcclxuICAgICBicmVhaztcclxuICAgICBjYXNlIHRoaXMuRElSLldFU1Q6XHJcbiAgICAgdGhpcy5nYW1lLnBoeXNpY3MucDIuY3JlYXRlTG9ja0NvbnN0cmFpbnQodGhpcy5ib2R5LCBvdGhlciwgW3RoaXMud2lkdGggKyBvZmZzZXQsIDBdKTtcclxuICAgICB0aGlzLndlc3QgPSBvdGhlci5zcHJpdGU7XHJcbiAgICAgYnJlYWs7XHJcbiAgfVxyXG4gIHN3aXRjaCAob3RoZXJTaWRlKSB7XHJcbiAgICAgY2FzZSB0aGlzLkRJUi5OT1JUSDpcclxuICAgICBvdGhlci5zcHJpdGUubm9ydGggPSB0aGlzO1xyXG4gICAgIGJyZWFrO1xyXG4gICAgIGNhc2UgdGhpcy5ESVIuRUFTVDpcclxuICAgICBvdGhlci5zcHJpdGUuZWFzdCA9IHRoaXM7XHJcbiAgICAgYnJlYWs7XHJcbiAgICAgY2FzZSB0aGlzLkRJUi5TT1VUSDpcclxuICAgICBvdGhlci5zcHJpdGUuc291dGggPSB0aGlzO1xyXG4gICAgIGJyZWFrO1xyXG4gICAgIGNhc2UgdGhpcy5ESVIuV0VTVDpcclxuICAgICBvdGhlci5zcHJpdGUud2VzdCA9IHRoaXM7XHJcbiAgICAgYnJlYWs7XHJcbiAgfVxyXG59O1xyXG5cclxuQ3ViZS5wcm90b3R5cGUucmVsYXRpdmVTaWRlID0gZnVuY3Rpb24odGhpc0JvZHksIG90aGVyQm9keSkge1xyXG4gIHZhciB0aGlzUG9pbnQgPSBuZXcgUGhhc2VyLlBvaW50KHRoaXNCb2R5LngsIHRoaXNCb2R5LnkpO1xyXG4gIHZhciBvdGhlclBvaW50ID0gbmV3IFBoYXNlci5Qb2ludChvdGhlckJvZHkueCwgb3RoZXJCb2R5LnkpO1xyXG4gIHZhciBhbmdsZVRvT3RoZXIgPSBQaGFzZXIuUG9pbnQuYW5nbGUodGhpc1BvaW50LCBvdGhlclBvaW50KTtcclxuICBpZiAoYW5nbGVUb090aGVyIDwgMCkgeyAvLyBmaXggZHVtYiBwYXJ0IG9mIFBoYXNlci5Qb2ludC5hbmdsZSgpXHJcbiAgICAgYW5nbGVUb090aGVyID0gMiAqIE1hdGguUEkgKyBhbmdsZVRvT3RoZXI7XHJcbiAgfVxyXG4gIGFuZ2xlVG9PdGhlciA9IChhbmdsZVRvT3RoZXIgKyAzLzIgKiBNYXRoLlBJKSAlICgyICogTWF0aC5QSSk7IC8vIHJvdGF0ZSA5MCBkIGNsb2Nrd2lzZVxyXG4gIHZhciBkaWZmQW5nbGUgPSBhbmdsZVRvT3RoZXIgLSB0aGlzQm9keS5yb3RhdGlvbjtcclxuICAgaWYgKGRpZmZBbmdsZSA8IDEgLyA0ICogTWF0aC5QSSB8fCBkaWZmQW5nbGUgPiA3IC8gNCAqIE1hdGguUEkpIHsgLy8gbm9ydGhcclxuICAgICByZXR1cm4gdGhpcy5ESVIuTk9SVEg7XHJcbiAgfSBlbHNlIGlmIChkaWZmQW5nbGUgPj0gMSAvIDQgKiBNYXRoLlBJICYmIGRpZmZBbmdsZSA8IDMgLyA0ICogTWF0aC5QSSkgeyAvLyBlYXN0XHJcbiAgICAgcmV0dXJuIHRoaXMuRElSLkVBU1Q7XHJcbiAgfSBlbHNlIGlmIChkaWZmQW5nbGUgPj0gMyAvIDQgKiBNYXRoLlBJICYmIGRpZmZBbmdsZSA8IDUgLyA0ICogTWF0aC5QSSkgeyAvLyBzb3V0aFxyXG4gICAgIHJldHVybiB0aGlzLkRJUi5TT1VUSDtcclxuICB9IGVsc2UgaWYgKGRpZmZBbmdsZSA+PSA1IC8gNCAqIE1hdGguUEkgJiYgZGlmZkFuZ2xlIDwgNyAvIDQgKiBNYXRoLlBJKSB7IC8vIHdlc3RcclxuICAgICByZXR1cm4gdGhpcy5ESVIuV0VTVDtcclxuICB9XHJcbn07XHJcblxyXG5DdWJlLnByb3RvdHlwZS5jdWJlQ29sbGlkZSA9IGZ1bmN0aW9uKG90aGVyKSB7XHJcbiAgIGlmIChvdGhlciA9PT0gbnVsbCB8fCB0aGlzLnByb3RvdHlwZSAhPT0gb3RoZXIucHJvdG90eXBlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgfVxyXG4gICAvLyBpZiAodGhpcy5oYXNSb290KCkpIHtcclxuICAgaWYgKHRoaXMuaGFzUm9vdCgpICYmICFvdGhlci5zcHJpdGUuaGFzUm9vdCgpKSB7XHJcbiAgICAgIHRoaXMuYWRkQ29ubmVjdGlvbihvdGhlcik7XHJcbiAgIH1cclxufTtcclxuXHJcbkN1YmUucHJvdG90eXBlLmhhc1Jvb3QgPSBmdW5jdGlvbigpIHtcclxuICAvKlxyXG4gIGlmICh0aGlzLnJvb3QpIHtcclxuICAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgaWYgKHRoaXMuaGFzUm9vdFIodGhpcy5ESVIuTk9SVEgsIHRoaXMpKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gIH0gZWxzZSBpZiAodGhpcy5oYXNSb290Uih0aGlzLkRJUi5FQVNULCB0aGlzKSkge1xyXG4gICAgIHJldHVybiB0cnVlO1xyXG4gIH0gZWxzZSBpZiAodGhpcy5oYXNSb290Uih0aGlzLkRJUi5TT1VUSCwgdGhpcykpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgfSBlbHNlIGlmICh0aGlzLmhhc1Jvb3RSKHRoaXMuRElSLldFU1QsIHRoaXMpKSB7XHJcbiAgICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG4gIHJldHVybiBmYWxzZTtcclxuICAqL1xyXG4gIGNvbnNvbGUubG9nKCduZXcgdGVzdCcpO1xyXG4gIGNvbnNvbGUubG9nKHRoaXMpO1xyXG4gIGlmICh0aGlzLnJvb3QpIHtcclxuICAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgdmFyIHZpc2l0ZWQgPSBbXTtcclxuICB2aXNpdGVkLnB1c2godGhpcyk7XHJcbiAgaWYgKHRoaXMubm9ydGggJiYgdGhpcy5oYXNSb290Uih2aXNpdGVkLCB0aGlzLm5vcnRoKSkge1xyXG4gICAgcmV0dXJuIHRydWU7ICBcclxuICB9XHJcbiAgaWYgKHRoaXMuZWFzdCAmJiB0aGlzLmhhc1Jvb3RSKHZpc2l0ZWQsIHRoaXMuZWFzdCkpIHtcclxuICAgIHJldHVybiB0cnVlOyAgXHJcbiAgfVxyXG4gIGlmICh0aGlzLnNvdXRoICYmIHRoaXMuaGFzUm9vdFIodmlzaXRlZCwgdGhpcy5zb3V0aCkpIHtcclxuICAgIHJldHVybiB0cnVlOyAgXHJcbiAgfVxyXG4gIGlmICh0aGlzLndlc3QgJiYgdGhpcy5oYXNSb290Uih2aXNpdGVkLCB0aGlzLndlc3QpKSB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbn07XHJcblxyXG5DdWJlLnByb3RvdHlwZS5oYXNSb290UiA9IGZ1bmN0aW9uKHZpc2l0ZWQsIGN1cikge1xyXG4gICBjb25zb2xlLmxvZyhjdXIpO1xyXG4gICBpZiAoY3VyLnJvb3QpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgIH1cclxuICAgdmlzaXRlZC5wdXNoKGN1cik7XHJcbiAgIGlmIChjdXIubm9ydGggJiYgIXRoaXMuY29udGFpbnModmlzaXRlZCwgY3VyLm5vcnRoKSAmJiB0aGlzLmhhc1Jvb3RSKHZpc2l0ZWQsIGN1ci5ub3J0aCkpIHtcclxuICAgIHJldHVybiB0cnVlOyAgXHJcbiAgfVxyXG4gIGlmIChjdXIuZWFzdCAmJiAhdGhpcy5jb250YWlucyh2aXNpdGVkLCBjdXIuZWFzdCkgJiYgdGhpcy5oYXNSb290Uih2aXNpdGVkLCBjdXIuZWFzdCkpIHtcclxuICAgIHJldHVybiB0cnVlOyAgXHJcbiAgfVxyXG4gIGlmIChjdXIuc291dGggJiYgIXRoaXMuY29udGFpbnModmlzaXRlZCwgY3VyLnNvdXRoKSAmJiB0aGlzLmhhc1Jvb3RSKHZpc2l0ZWQsIGN1ci5zb3V0aCkpIHtcclxuICAgIHJldHVybiB0cnVlOyAgXHJcbiAgfVxyXG4gIGlmIChjdXIud2VzdCAmJiAhdGhpcy5jb250YWlucyh2aXNpdGVkLCBjdXIud2VzdCkgJiYgdGhpcy5oYXNSb290Uih2aXNpdGVkLCBjdXIud2VzdCkpIHtcclxuICAgIHJldHVybiB0cnVlOyAgXHJcbiAgfVxyXG59O1xyXG5cclxuQ3ViZS5wcm90b3R5cGUuY29udGFpbnMgPSBmdW5jdGlvbiAoYXJyYXksIG9iaikge1xyXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgaWYgKGFycmF5W2ldID09PSBvYmopIHtcclxuICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICB9ICBcclxuICAgcmV0dXJuIGZhbHNlO1xyXG59O1xyXG5cclxuLypcclxuQ3ViZS5wcm90b3R5cGUuaGFzUm9vdFIgPSBmdW5jdGlvbihkaXIsIG9iaikge1xyXG4gICBpZiAob2JqLnJvb3QpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgIH1cclxuICAgc3dpdGNoIChkaXIpIHtcclxuICAgICAgY2FzZSB0aGlzLkRJUi5OT1JUSDpcclxuICAgICAgaWYgKG9iai5ub3J0aCAmJiB0aGlzLmhhc1Jvb3RSKHRoaXMuRElSLk5PUlRILCBvYmoubm9ydGgpKSB7XHJcbiAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvYmouZWFzdCAmJiB0aGlzLmhhc1Jvb3RSKHRoaXMuRElSLkVBU1QsIG9iai5lYXN0KSkge1xyXG4gICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob2JqLndlc3QgJiYgdGhpcy5oYXNSb290Uih0aGlzLkRJUi5XRVNULCBvYmoud2VzdCkpIHtcclxuICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICBjYXNlIHRoaXMuRElSLkVBU1Q6XHJcbiAgICAgIGlmIChvYmoubm9ydGggJiYgdGhpcy5oYXNSb290Uih0aGlzLkRJUi5OT1JUSCwgb2JqLm5vcnRoKSkge1xyXG4gICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob2JqLmVhc3QgJiYgdGhpcy5oYXNSb290Uih0aGlzLkRJUi5FQVNULCBvYmouZWFzdCkpIHtcclxuICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9iai5zb3V0aCAmJiB0aGlzLmhhc1Jvb3RSKHRoaXMuRElSLlNPVVRILCBvYmouc291dGgpKSB7XHJcbiAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgY2FzZSB0aGlzLkRJUi5TT1VUSDpcclxuICAgICAgaWYgKG9iai5lYXN0ICYmIHRoaXMuaGFzUm9vdFIodGhpcy5ESVIuRUFTVCwgb2JqLmVhc3QpKSB7XHJcbiAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvYmouc291dGggJiYgdGhpcy5oYXNSb290Uih0aGlzLkRJUi5TT1VUSCwgb2JqLnNvdXRoKSkge1xyXG4gICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob2JqLndlc3QgJiYgdGhpcy5oYXNSb290Uih0aGlzLkRJUi5XRVNULCBvYmoud2VzdCkpIHtcclxuICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICBjYXNlIHRoaXMuRElSLldFU1Q6XHJcbiAgICAgIGlmIChvYmoubm9ydGggJiYgdGhpcy5oYXNSb290Uih0aGlzLkRJUi5OT1JUSCwgb2JqLm5vcnRoKSkge1xyXG4gICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob2JqLnNvdXRoICYmIHRoaXMuaGFzUm9vdFIodGhpcy5ESVIuU09VVEgsIG9iai5zb3V0aCkpIHtcclxuICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9iai53ZXN0ICYmIHRoaXMuaGFzUm9vdFIodGhpcy5ESVIuV0VTVCwgb2JqLndlc3QpKSB7XHJcbiAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgfVxyXG4gICByZXR1cm4gZmFsc2U7XHJcbn07XHJcbiovXHJcblxyXG5DdWJlLnByb3RvdHlwZS5nZXRTaWRlID0gZnVuY3Rpb24oc2lkZSkge1xyXG4gICBzd2l0Y2ggKHNpZGUpIHtcclxuICAgICBjYXNlIHRoaXMuRElSLk5PUlRIOlxyXG4gICAgIHJldHVybiB0aGlzLm5vcnRoO1xyXG4gICAgIGNhc2UgdGhpcy5ESVIuRUFTVDpcclxuICAgICByZXR1cm4gdGhpcy5lYXN0O1xyXG4gICAgIGNhc2UgdGhpcy5ESVIuU09VVEg6XHJcbiAgICAgcmV0dXJuIHRoaXMuc291dGg7XHJcbiAgICAgY2FzZSB0aGlzLkRJUi5XRVNUOlxyXG4gICAgIHJldHVybiB0aGlzLndlc3Q7XHJcbiAgfVxyXG4gIHJldHVybiB1bmRlZmluZWQ7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEN1YmU7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIiwidmFyIEJvb3QgPSBmdW5jdGlvbiAoKSB7fTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gQm9vdDtcclxuXHJcbkJvb3QucHJvdG90eXBlID0ge1xyXG5cclxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ3ByZWxvYWRlcicsICdhc3NldHMvcHJlbG9hZGVyLmdpZicpO1xyXG4gIH0sXHJcblxyXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5nYW1lLmlucHV0Lm1heFBvaW50ZXJzID0gMTtcclxuXHJcbiAgICBpZiAodGhpcy5nYW1lLmRldmljZS5kZXNrdG9wKSB7XHJcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5nYW1lLnNjYWxlLnNjYWxlTW9kZSA9IFBoYXNlci5TY2FsZU1hbmFnZXIuU0hPV19BTEw7XHJcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5taW5XaWR0aCA9ICA0ODA7XHJcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5taW5IZWlnaHQgPSAyNjA7XHJcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5tYXhXaWR0aCA9IDY0MDtcclxuICAgICAgdGhpcy5nYW1lLnNjYWxlLm1heEhlaWdodCA9IDQ4MDtcclxuICAgICAgdGhpcy5nYW1lLnNjYWxlLmZvcmNlTGFuZHNjYXBlID0gdHJ1ZTtcclxuICAgICAgdGhpcy5nYW1lLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XHJcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5zZXRTY3JlZW5TaXplKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnUHJlbG9hZGVyJyk7XHJcbiAgfVxyXG59O1xyXG4iLCIvKlxyXG5NYWluIHRlc3RpbmcgZW52aXJvbm1lbnQuXHJcbiovXHJcblxyXG52YXIgQ3ViZSA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL2N1YmUnKTtcclxuXHJcbnZhciBVdGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzJyk7XHJcblxyXG52YXIgbW91c2VCb2R5OyAvLyBwaHlzaWNzIGJvZHkgZm9yIG1vdXNlXHJcblxyXG52YXIgR2FtZSA9IGZ1bmN0aW9uICgpIHtcclxuICB0aGlzLnRlc3RlbnRpdHkgPSBudWxsO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBHYW1lO1xyXG5cclxuR2FtZS5wcm90b3R5cGUgPSB7XHJcblxyXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5nYW1lLnBoeXNpY3Muc3RhcnRTeXN0ZW0oUGhhc2VyLlBoeXNpY3MuUDJKUyk7XHJcbiAgICB0aGlzLmdhbWUucGh5c2ljcy5wMi5zZXRJbXBhY3RFdmVudHModHJ1ZSk7XHJcbiAgICBtb3VzZUJvZHkgPSBuZXcgcDIuQm9keSgpOyAvLyBqc2hpbnQgaWdub3JlOmxpbmVcclxuICAgIHRoaXMuZ2FtZS5waHlzaWNzLnAyLndvcmxkLmFkZEJvZHkobW91c2VCb2R5KTtcclxuICAgIHRoaXMucGxhY2VLZXkgPSB0aGlzLmdhbWUuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5LZXlib2FyZC5QKTtcclxuICAgIHRoaXMucGxhY2VLZXkub25Eb3duLmFkZCh0aGlzLnBsYWNlQ3ViZSwgdGhpcyk7XHJcbiAgICBcclxuICAgIHRoaXMubW91c2VYID0gMDtcclxuICAgIHRoaXMubW91c2VZID0gMDtcclxuICAgIFxyXG4gICAgdGhpcy5pbnB1dC5vbkRvd24uYWRkKHRoaXMuY2xpY2ssIHRoaXMpO1xyXG4gICAgdGhpcy5pbnB1dC5vblVwLmFkZCh0aGlzLnJlbGVhc2UsIHRoaXMpO1xyXG4gICAgdGhpcy5pbnB1dC5hZGRNb3ZlQ2FsbGJhY2sodGhpcy5tb3ZlLCB0aGlzKTtcclxuICAgIHRoaXMuZ3JhYmJlZCA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMubGluZSA9IG5ldyBQaGFzZXIuTGluZSgwLCAwLCAwLCAwKTtcclxuICAgIFxyXG4gICAgdGhpcy5yb290U3Bhd25lZCA9IGZhbHNlO1xyXG4gICAgXHJcbiAgICB0aGlzLmRlYnVnTnVtID0gMDtcclxuICAgIFxyXG4gICAgIC8vIHZhciB0aGlzUG9pbnQgPSBuZXcgUGhhc2VyLlBvaW50KDEwLCAxMCk7XHJcbiAgICAgLy8gdmFyIG90aGVyUG9pbnQgPSBuZXcgUGhhc2VyLlBvaW50KDEwLCAxMSk7XHJcbiAgICAgLy8gdmFyIGFuZ2xlVG9PdGhlciA9IFBoYXNlci5Qb2ludC5hbmdsZSh0aGlzUG9pbnQsIG90aGVyUG9pbnQpO1xyXG4gICAgIC8vIGNvbnNvbGUubG9nKGFuZ2xlVG9PdGhlcik7XHJcbiAgfSxcclxuXHJcbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAodGhpcy5ncmFiYmVkKSB7XHJcbiAgICAgIHZhciBhbmdsZSA9IE1hdGguYXRhbjIodGhpcy5ncmFiYmVkLnNwcml0ZS55IC0gdGhpcy5pbnB1dC5wb3NpdGlvbi55LCB0aGlzLmdyYWJiZWQuc3ByaXRlLnggLSB0aGlzLmlucHV0LnBvc2l0aW9uLngpICsgTWF0aC5QSTtcclxuICAgICAgdmFyIGRpc3QgPSBVdGlscy5kaXN0YW5jZSh0aGlzLmdyYWJiZWQuc3ByaXRlLngsIHRoaXMuZ3JhYmJlZC5zcHJpdGUueSwgdGhpcy5pbnB1dC5wb3NpdGlvbi54LCB0aGlzLmlucHV0LnBvc2l0aW9uLnkpO1xyXG4gICAgICB2YXIgd2VpZ2h0ID0gMTA7XHJcbiAgICAgIHRoaXMuZ3JhYmJlZC5mb3JjZS54ID0gTWF0aC5jb3MoYW5nbGUpICogZGlzdCAqIHdlaWdodDtcclxuICAgICAgdGhpcy5ncmFiYmVkLmZvcmNlLnkgPSBNYXRoLnNpbihhbmdsZSkgKiBkaXN0ICogd2VpZ2h0O1xyXG4gICAgICB0aGlzLmxpbmUuc2V0VG8odGhpcy5ncmFiYmVkLnNwcml0ZS54LCB0aGlzLmdyYWJiZWQuc3ByaXRlLnksIHRoaXMuaW5wdXQucG9zaXRpb24ueCwgdGhpcy5pbnB1dC5wb3NpdGlvbi55KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICB0aGlzLmxpbmUuc2V0VG8oMCwgMCwgMCwgMCk7XHJcbiAgICB9XHJcbiAgfSxcclxuICBcclxuICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuZ2FtZS5kZWJ1Zy5nZW9tKHRoaXMubGluZSk7XHJcbiAgfSxcclxuXHJcbiAgY2xpY2s6IGZ1bmN0aW9uIChwb2ludGVyKSB7XHJcbiAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmdyYWJiZWQpO1xyXG4gICAgdmFyIGJvZGllcyA9IHRoaXMuZ2FtZS5waHlzaWNzLnAyLmhpdFRlc3QocG9pbnRlci5wb3NpdGlvbik7XHJcbiAgICBpZiAoYm9kaWVzLmxlbmd0aClcclxuICAgIHtcclxuICAgICAgICB0aGlzLmdyYWJiZWQgPSBib2RpZXNbMF0ucGFyZW50O1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZ3JhYmJlZC5zcHJpdGUubmFtZSwgdGhpcy5ncmFiYmVkLnNwcml0ZS5ub3J0aCwgdGhpcy5ncmFiYmVkLnNwcml0ZS5lYXN0LCB0aGlzLmdyYWJiZWQuc3ByaXRlLnNvdXRoLCB0aGlzLmdyYWJiZWQuc3ByaXRlLndlc3QpO1xyXG4gICAgfVxyXG4gIH0sXHJcbiAgXHJcbiAgcmVsZWFzZTogZnVuY3Rpb24gKCkge1xyXG4gICAgIGlmICh0aGlzLmdyYWJiZWQpIHtcclxuICAgICAgICB0aGlzLmdyYWJiZWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgfVxyXG4gIH0sXHJcbiAgXHJcbiAgbW92ZTogZnVuY3Rpb24gKHBvaW50ZXIpIHtcclxuICAgIC8vIHAyIHVzZXMgZGlmZmVyZW50IGNvb3JkaW5hdGUgc3lzdGVtLCBzbyBjb252ZXJ0IHRoZSBwb2ludGVyIHBvc2l0aW9uIHRvIHAyJ3MgY29vcmRpbmF0ZSBzeXN0ZW1cclxuICAgIG1vdXNlQm9keS5wb3NpdGlvblswXSA9IHRoaXMuZ2FtZS5waHlzaWNzLnAyLnB4bWkocG9pbnRlci5wb3NpdGlvbi54KTtcclxuICAgIG1vdXNlQm9keS5wb3NpdGlvblsxXSA9IHRoaXMuZ2FtZS5waHlzaWNzLnAyLnB4bWkocG9pbnRlci5wb3NpdGlvbi55KTtcclxuICAgIHRoaXMubW91c2VYID0gcG9pbnRlci5wb3NpdGlvbi54O1xyXG4gICAgdGhpcy5tb3VzZVkgPSBwb2ludGVyLnBvc2l0aW9uLnk7XHJcbiAgfSxcclxuICBcclxuICBwbGFjZUN1YmU6IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBlbnRpdHkgPSBuZXcgQ3ViZSh0aGlzLmdhbWUsIHRoaXMubW91c2VYLCB0aGlzLm1vdXNlWSk7XHJcbiAgICB2YXIgc2NhbGUgPSAwLjU7XHJcbiAgICBlbnRpdHkubmFtZSA9IHRoaXMuZGVidWdOdW0rKztcclxuICAgIGVudGl0eS5zY2FsZS54ID0gc2NhbGU7XHJcbiAgICBlbnRpdHkuc2NhbGUueSA9IHNjYWxlO1xyXG4gICAgZW50aXR5LmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XHJcbiAgICB0aGlzLmdhbWUucGh5c2ljcy5wMi5lbmFibGUoZW50aXR5LCB0cnVlKTtcclxuICAgIGVudGl0eS5ib2R5Lm9uQmVnaW5Db250YWN0LmFkZChlbnRpdHkuY3ViZUNvbGxpZGUsIGVudGl0eSk7XHJcbiAgICBlbnRpdHkuYm9keS5kYW1waW5nID0gMC45O1xyXG4gICAgZW50aXR5LmJvZHkuYW5ndWxhckRhbXBpbmcgPSAwLjk7XHJcbiAgICBpZiAoIXRoaXMucm9vdFNwYXduZWQpIHtcclxuICAgICAgIGVudGl0eS5yb290ID0gdHJ1ZTtcclxuICAgICAgIHRoaXMucm9vdFNwYXduZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxufTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIiwidmFyIE1lbnUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgdGhpcy50ZXh0ID0gbnVsbDtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gTWVudTtcclxuXHJcbk1lbnUucHJvdG90eXBlID0ge1xyXG5cclxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciB4ID0gdGhpcy5nYW1lLndpZHRoIC8gMjtcclxuICAgIHZhciB5ID0gdGhpcy5nYW1lLmhlaWdodCAvIDI7XHJcblxyXG4gICAgdmFyIHN0eWxlID0geyBmb250OiAnNjVweCBBcmlhbCcsIGZpbGw6ICcjZmZmZmZmJywgYWxpZ246ICdjZW50ZXInIH07XHJcblxyXG4gICAgdGhpcy50ZXh0ID0gdGhpcy5hZGQudGV4dCh4IC0gMzAwLCB5IC0gMjAwLCAnUHJlc3MgdG8gU3RhcnQnLCBzdHlsZSk7XHJcblxyXG4gICAgdGhpcy5pbnB1dC5vbkRvd24uYWRkKHRoaXMub25Eb3duLCB0aGlzKTtcclxuICB9LFxyXG5cclxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcclxuICB9LFxyXG5cclxuICBvbkRvd246IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydChwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwpOyAvLyBqc2hpbnQgaWdub3JlOmxpbmVcclxuICB9XHJcbn07XHJcbiIsInZhciBQcmVsb2FkZXIgPSBmdW5jdGlvbiAoZ2FtZSkge1xyXG4gIGdhbWUgPSBudWxsO1xyXG4gIHRoaXMuYXNzZXQgPSBudWxsO1xyXG4gIHRoaXMucmVhZHkgPSBmYWxzZTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gUHJlbG9hZGVyO1xyXG5cclxuUHJlbG9hZGVyLnByb3RvdHlwZSA9IHtcclxuXHJcbiAgcHJlbG9hZDogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5hc3NldCA9IHRoaXMuYWRkLnNwcml0ZSgzMjAsIDI0MCwgJ3ByZWxvYWRlcicpO1xyXG4gICAgdGhpcy5hc3NldC5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xyXG5cclxuICAgIHRoaXMubG9hZC5vbkxvYWRDb21wbGV0ZS5hZGRPbmNlKHRoaXMub25Mb2FkQ29tcGxldGUsIHRoaXMpO1xyXG4gICAgdGhpcy5sb2FkLnNldFByZWxvYWRTcHJpdGUodGhpcy5hc3NldCk7XHJcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ3Rlc3RzcHJpdGUnLCAnYXNzZXRzL3Rlc3QyLnBuZycpO1xyXG4gIH0sXHJcblxyXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5hc3NldC5jcm9wRW5hYmxlZCA9IGZhbHNlO1xyXG4gIH0sXHJcblxyXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKCEhdGhpcy5yZWFkeSkge1xyXG4gICAgICAvLyB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ01lbnUnKTtcclxuICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KHBsYXllclN0YXRlLmN1cnJlbnRMZXZlbCk7IC8vIGpzaGludCBpZ25vcmU6bGluZVxyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIG9uTG9hZENvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLnJlYWR5ID0gdHJ1ZTtcclxuICB9XHJcbn07XHJcbiIsInZhciBTcGxhc2ggPSBmdW5jdGlvbiAoKSB7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFNwbGFzaDtcclxuXHJcblNwbGFzaC5wcm90b3R5cGUgPSB7XHJcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgfVxyXG59OyIsIi8qXHJcbkNvbGxlY3Rpb24gb2YgdXRpbGl0eSBmdW5jdGlvbnMuXHJcbiovXHJcblxyXG52YXIgVXRpbHMgPSB7XHJcbiAgICBjb250YWluc09iamVjdDogZnVuY3Rpb24ob2JqLCBsaXN0KSB7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGxpc3RbaV0gPT09IG9iaikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0sXHJcbiAgICBkaXN0YW5jZTogZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIpIHtcclxuICAgICAgIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3coeDEgLSB4MiwgMikgKyBNYXRoLnBvdyh5MSAtIHkyLCAyKSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFV0aWxzOyJdfQ==
