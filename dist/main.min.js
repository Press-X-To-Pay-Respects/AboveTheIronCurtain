(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./src/js/main.js":[function(require,module,exports){
var game = new Phaser.Game(window.innerWidth, window.innerHeigh, Phaser.AUTO, 'atic-game');

window.playerState = {
    currentLevel: 'Menu'
};

//  The Google WebFont Loader will look for this object, so create it before loading the script.
WebFontConfig = { // jshint ignore:line
    //  The Google Fonts we want to load (specify as many as you like in the array)
    google: {
      families: ['Roboto::latin', 'VT323::latin']
    }
};

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));

game.state.start('Boot');
},{"./states/boot":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\states\\boot.js","./states/game":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\states\\game.js","./states/menu":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\states\\menu.js","./states/preloader":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\states\\preloader.js","./states/splash":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\states\\splash.js"}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\effects\\BinaryParticle.js":[function(require,module,exports){
var BinaryParticle = function(game, targetObj, x, y, tarOffsetX, tarOffsetY) {
	var style = {font: '20px VT323', fill: '#FFFFFF', align: 'center'};
	var byteSymbol = Math.random() >= 0.5 ? '1' : '0';
	Phaser.Text.call(this, game, x, y, byteSymbol, style);
	game.add.existing(this);
	this.targetObj = targetObj;
	this.speed = 3.6;
	this.tarOffsetX = tarOffsetX;
	this.tarOffsetY = tarOffsetY;
};

BinaryParticle.prototype = Object.create(Phaser.Text.prototype);
BinaryParticle.prototype.constructor = BinaryParticle;

BinaryParticle.prototype.update = function() {
	//Get delta vector to target object
	var delta = [this.targetObj.x + this.tarOffsetX - this.x, this.targetObj.y + this.tarOffsetY - this.y];
	//Get distance and check if we've reached target distance
	var dist = Math.sqrt(Math.pow(delta[0], 2) + Math.pow(delta[1], 2));
	if(dist <= this.speed) {
		this.destroy();
		return;
	}
	//Normalize delta vector
	delta = [delta[0]/dist, delta[1]/dist];
	//Update position
	this.x = this.x + this.speed*delta[0];
	this.y = this.y + this.speed*delta[1];
};

module.exports = BinaryParticle;
},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\effects\\Emitter.js":[function(require,module,exports){
var BinaryParticle = require('./BinaryParticle');

var Emitter = function(gameState) {
	this.gameState = gameState;
};

Emitter.prototype.constructor = Emitter;

Emitter.prototype.emitBinary = function (targetObj, x, y, spacing) {
	var offsetX = (Math.random()-0.5)*spacing;
	var offsetY = (Math.random()-0.5)*spacing;
	var newParticle = new BinaryParticle(this.gameState.game, targetObj, x, y, offsetX, offsetY);
};

module.exports = Emitter;
},{"./BinaryParticle":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\effects\\BinaryParticle.js"}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\Bullet.js":[function(require,module,exports){
//Bullets are tagged as 'playerBullet' or 'enemyBullet'
var Bullet = function(gameState, x, y, direction, inhertitSpeed, tag) {
    Phaser.Sprite.call(this, gameState.game, x, y, 'bullet');
	this.direction = direction; //Unit vector representing direction bullet is travelling;
	this.speed = 500 + inhertitSpeed;				//Speed bullet is travelling;
	this.tag = tag;
	this.game = gameState.game;
	this.game.add.existing(this);
	this.lifeTime = 300;
	var scale = 0.5;
	this.scale.x = scale;
	this.scale.y = scale;
	this.anchor.setTo(0.5, 0.5);
	this.destroyBuffer = 100;
	
	//set physics
	gameState.game.physics.p2.enable(this);
	this.body.setCollisionGroup(gameState.collisionGroup);
	this.body.collides(gameState.collisionGroup);
	//Set proper collision function by determining type from 'tag'
	if(this.tag === 'enemyBullet') {
		this.collision = function(other) {
			if(other) {
				if(other.sprite){
					if(other.sprite.tag) {
						if(other.sprite.tag === 'module') {
							other.sprite.takeDamage(1);
						}
						this.destroy();
					}
				}
			}
		};
	}
	else if(this.tag === 'playerBullet') {
		this.collision = function(other) {
			if(other) {
				if(other.sprite){
					if(other.sprite.tag) {
						if(other.sprite.tag === 'enemy_module') {
							other.sprite.takeDamage(1);
						}
					}
				}
			}
			this.destroy();
		};
	}
	this.body.onBeginContact.add(this.collision, this);
	this.body.setZeroDamping();
	this.body.mass = 0.1;
	this.body.velocity.x = direction[0]*this.speed;
	this.body.velocity.y = direction[1]*this.speed;
};

Bullet.prototype = Object.create(Phaser.Sprite.prototype);
Bullet.prototype.constructor = Bullet;

Bullet.prototype.update = function() {
	if(this.body.x > this.game.camera.x + this.game.camera.width + this.destroyBuffer || this.body.x  < this.game.camera.x - this.destroyBuffer || 
	this.body.y > this.game.camera.y + this.game.camera.height + this.destroyBuffer || this.body.y < this.game.camera.y - this.destroyBuffer) {
		this.destroy(true);
	}
};

module.exports = Bullet;
},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\Hackable.js":[function(require,module,exports){
// DEPRECATED

/*
Defines a hackable object.
*/

var Hackable = function (gameState, x, y, sprite, hackDistance) {
   Phaser.Sprite.call(this, gameState.game, x, y, sprite);
   gameState.game.add.existing(this);
	//store gameState
	this.gameState = gameState;
	//set isHacked to false
	this.isHacked = false;
	this.beingHacked = false;
	this.beingHackedPrev = false;
	//add hackBar
	this.hackBar = gameState.uiBuilder.buildProgressBar('growing', 1500, 1200, 100, 10,  200);
	this.hackBar.setStyle(0, 0xFFFFFF, 0x363636, 0, 0, 0, 0xFFFFFF, 0x2020CC);
	this.hackBar.hackable = this;
	this.hackBar.onEvent = function() {
		this.hackable.animations.stop();
		this.hackable.animations.play('hacked');
		this.hackable.isHacked = true;
		this.destroy();
	};
	this.tag = 'neutralObj';	//Tag is used to identify object type during collision checking
	this.hackDistance = hackDistance;
	var scale = 0.5;
   this.scale.x = scale;
   this.scale.y = scale;
   this.anchor.setTo(0.5, 0.5);
   this.animations.add('hackable', [0,1,2,3,4], 10, true);
   this.animations.add('hacked', [5,6,7,8,9], 10, true);
   this.hacking = this.gameState.add.audio('hacking', 1, true);
   
   //Set up physics body for 'hackable' sprite
   gameState.game.physics.p2.enable(this);
   this.body.setCollisionGroup(gameState.collisionGroup);
	this.body.collides(gameState.collisionGroup);
   this.body.onBeginContact.add(this.cubeCollide, this);
   this.body.damping = 0.9;
   this.body.angularDamping = 0.9;
};

Hackable.prototype = Object.create(Phaser.Sprite.prototype);
Hackable.prototype.constructor = Hackable;

/**
 * Automatically called by World.update
 */
Hackable.prototype.update = function() {
	this.hackBar.setLocation(this.x, this.y - 70);
	//check if getting hacked
	if(!this.isHacked) {
		this.animations.play('hackable');
		if(this.gameState.player.activeHackerModules.length > 0) {
			var dist;
			var hacker;
			//Loop through all hacker modules on the player's cubesat
			for(var i = 0; i < this.gameState.player.activeHackerModules.length; i++) {
				hacker = this.gameState.player.activeHackerModules[i];
				dist = Math.sqrt( Math.pow(this.x - hacker.cube.x, 2) + Math.pow(this.y - hacker.cube.y, 2) );
				if(dist < this.hackDistance) {
					//If hacker is in range, increase hack value and try to emit binary particle
					if(this.beingHacked === true) {
						this.beingHackedPrev = true;
					}
					this.beingHacked = true;
					this.hackBar.addValue(0.1);
					hacker.count++;
					if(hacker.count >= hacker.cycle) {
						hacker.count = 0;
						this.gameState.BinaryEmitter.emitBinary(this, hacker.cube.x, hacker.cube.y, 60);
						if(hacker.cube.frame === 5) {
							hacker.cube.frame = 0;
						}
						hacker.cube.frame++;
						
					}
				}
				else {
					hacker.cube.animations.stop();
					if(this.beingHacked === false) {
						this.beingHackedPrev = false;
					}
					this.beingHacked = false;
				}
			}
		}
	}
	else {
		this.hacking.stop();
	}
	if(this.beingHacked === true && this.beingHackedPrev === false) {
		if(this.hacking.paused === true) {
			this.hacking.resume();
		}
		else {
			this.hacking.play();
		}
	}
	else if(this.beingHacked === false && this.beingHackedPrev === true){
		this.hacking.pause();
	}
};


Hackable.prototype.cubeCollide = function(other) {
/*   if (this.group === undefined) {
      return;
   }
   this.group.handleCollision(this, other.sprite);*/
};

module.exports = Hackable;
},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\Module.js":[function(require,module,exports){
//Don't use this function to create modules, instead use moduleBuilder()
var Module = function(setType, setCube, setGameState) {
	this.isActive = false;
	this.type = setType;
	this.cube = setCube;
	setCube.module = this;
	this.gameState = setGameState;
};

Module.prototype.constructor = Module;

module.exports = Module;
},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\ModuleBuilder.js":[function(require,module,exports){
var Cube = require('./cube');
var Module = require('./Module');
var Bullet = require('./Bullet');

var thrustAmt = 5000;

//Use this to create a moduleBuilder- only need to create one instance of it
var ModuleBuilder = function(setGameState, setColGroup) {
	//Ensure that cannot create multiple instances of this class
	if(ModuleBuilder.prototype.exists) {
		return ModuleBuilder.prototype.existingReference;
	}
		
	this.gameState = setGameState;
   this.colGroup = setColGroup;
	// this.coreExists = false;	//records if core has been created
	this.core = null;			//stores core when it is created
	//var space = this.gameState.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
	ModuleBuilder.prototype.exists = true;
	ModuleBuilder.prototype.existingReference = this;
};

ModuleBuilder.prototype.constructor = ModuleBuilder;

//These var's help create the singleton functionality
ModuleBuilder.prototype.exists = false;
ModuleBuilder.prototype.existingReference = null;

/** Module functions **/
function solarPanelGiveTarget(target) {
   if (this === target || !this.cube.group || !target.cube.group || this.cube.group !== target.cube.group) {
      return;
   }
   this.cube.loseConnection();
   var ourGroup = this.cube.group;
   var newConnection = {start: this.cube, end: target.cube};
   this.cube.myConnection = newConnection;
   target.cube.myConnection = newConnection;
   ourGroup.displayConnection(this.cube.myConnection);
	if(!target.isActive) {
		//Activate the module
		target.isActive = true;
		this.modulePower.play();
		if(target.type === 'hacker') {
			ourGroup.activeHackerModules.push(target);
		}
		//If this is one of the powerable types, switch the frame from 'greyed' to 'active'
		if(target.type === 'gun' || target.type === 'hacker' || target.type === 'thruster') {
			target.cube.frame = 1;
		}
	}
}

function solarPanelMouseOver() {
   if (!this.cube.myConnection || !this.cube.group) {
      return;
   }
   this.cube.group.displayConnection(this.cube.myConnection);
}

function genericOnRemove() {
   this.cube.loseConnection();
}

function hackerOnLoseConnection() {
   var hackIndex = this.gameState.player.activeHackerModules.indexOf(this);
   this.gameState.player.activeHackerModules.splice(hackIndex, 1);
   this.isActive = false;
}

function beginAct() {
   this.timer = 0;
   this.act = true;
}

function endAct() {
   this.act = false;
   this.cube.frame = 1;
}

function thrusterUpdate() {
   if (this.haltTime && this.haltTime > 0) {
      this.haltTime -= this.cube.game.time.elapsed;
      this.cube.frame = 1;
   } else if (this.act && this.cube.myConnection) {
	  if(this.isThrust === true) {
		this.isThrustPrev = true;
	  }
	  this.isThrust = true;
      this.cube.body.force.x = thrustAmt * Math.cos(this.cube.rotation - Math.PI / 2);
      this.cube.body.force.y = thrustAmt * Math.sin(this.cube.rotation - Math.PI / 2);
	  if(this.cube.frame === 1) {
		this.cube.frame = 3;
	  }
	  else {
		this.cube.frame = 2;
	  }
	  if(this.isThrust === true && this.isThrustPrev === false) {
		this.thrusterLoop.play();
	  }
   }
   else if(!this.act) {
	  if(this.isThrust === false) {
		this.isThrustPrev = false;
	  }
	  this.isThrust = false;
	  if(this.isThrust === false && this.isThrustPrev === true) {
		this.thrusterLoop.stop();
	  }
   }
}

function thrusterHalt() {
   this.haltTime = 1500;
}

function gunUpdate() {
   if (!this.cube.myConnection || !this.act) {
      this.cube.animations.stop();
	  return;
   }
   if (this.timer <= 0) {
      var angle = this.cube.body.rotation % (2*Math.PI);
      var direction = [Math.sin(angle), -Math.cos(angle)];
      var deltaDist = Math.sqrt(Math.pow(this.cube.deltaX, 2) + Math.pow(this.cube.deltaY, 2));
      var speed = deltaDist * 50;
      new Bullet(this.gameState, this.cube.x + 30*direction[0], this.cube.y + 30*direction[1], 
               direction, speed, this.tag + 'Bullet');
	  this.gun.play();
      this.timer = 400;
   } else {
      this.timer -= this.gameState.game.time.elapsed;
   }
}

function hackableUpdate() {
   this.hackBar.setLocation(this.cube.x, this.cube.y - 25);
   if (this.barFadeDelay <= 0 && this.hackBar.graphics.alpha > 0) {
      this.hackBar.graphics.alpha -= this.gameState.time.elapsed * this.barFade;
   } else if (this.barFadeDelay > 0) {
      this.barFadeDelay -= this.gameState.time.elapsed;
   }
	//check if getting hacked
	if(!this.isHacked) {
		this.cube.animations.play('hackable');
		if(this.gameState.player.activeHackerModules.length > 0) {
			var dist;
			var hacker;
			//Loop through all hacker modules on the player's cubsat
			for(var i = 0; i < this.gameState.player.activeHackerModules.length; i++) {
				hacker = this.gameState.player.activeHackerModules[i];
				dist = Math.sqrt( Math.pow(this.cube.x - hacker.cube.x, 2) + Math.pow(this.cube.y - hacker.cube.y, 2) );
				if(dist < this.hackDistance) {
					//If hacker is in range, increase hack value and try to emit binary particle
               if (this.beingHacked) {
                  this.beingHackedPrev = true;
               }
               this.beingHacked = true;
					this.hackBar.addValue(0.1);
					hacker.count++;
					if(hacker.count >= hacker.cycle) {
                  this.hackBar.graphics.alpha = 1;
                  this.barFadeDelay = this.barFadeMaxDelay;
						hacker.count = 0;
						this.gameState.BinaryEmitter.emitBinary(this.cube, hacker.cube.x, hacker.cube.y, 60);
						if(hacker.cube.frame === 5) {
							hacker.cube.frame = 0;
						}
						hacker.cube.frame++;
						
					}
				}
				else {
					hacker.cube.animations.stop();
               if(!this.beingHacked) {
						this.beingHackedPrev = false;
					}
					this.beingHacked = false;
				}
			}
		}
	} else if (this.delay < 0) {
      this.hacking.stop();
      this.hackBar.destroy();
      this.cube.dieQuick();
   } else {
      this.hacking.stop();
      this.delay -= this.gameState.time.elapsed;
   }
   if(this.beingHacked === true && this.beingHackedPrev === false) {
		if(this.hacking.paused === true) {
			this.hacking.resume();
		}
		else {
			this.hacking.play();
		}
	}
	else if(this.beingHacked === false && this.beingHackedPrev === true){
		this.hacking.pause();
	}
}
/** End module functions **/

//call this function from ModuleBuilder to construct modules
//TYPES: 'core' 'shield' 'thruster' 'solarPannel' 'hacker'
ModuleBuilder.prototype.build = function(type, x, y, forPlayer) {	
	//Create cube object to be stored within module
	//Sprite names for modules are directly mapped to module names, so just pass 'type' as sprite name
	var newCube = new Cube(this.gameState, x, y, type);
    var scale = 0.5;
    newCube.name = this.gameState.debugNum++;
    newCube.scale.setTo(scale, scale);
    newCube.anchor.setTo(0.5, 0.5);
	
	//Create physics for new cube
    this.gameState.game.physics.p2.enable(newCube);
	newCube.body.setCollisionGroup(this.gameState.collisionGroup);
	newCube.body.collides(this.gameState.collisionGroup);
	newCube.body.onBeginContact.add(newCube.cubeCollide, newCube);
   newCube.body.damping = 0.9;
   newCube.body.angularDamping = 0.9;
 
   var cIndicator = this.gameState.add.sprite(0, 0, 'connections', 'connection_line.png');
   cIndicator.anchor.setTo(0.5, 0.5);
   cIndicator.animations.add('end', ['connection_end.png'], 60, true);
   cIndicator.animations.add('line', ['connection_line.png'], 60, true);
   cIndicator.animations.add('right', ['connection_right.png'], 60, true);
   newCube.addChild(cIndicator);
   newCube.cIndicator = cIndicator;
   cIndicator.alpha = 0;
	
	//Create module to wrap around cube class
	var newModule = new Module(type, newCube, this.gameState);
		
	//TODO: edit special module attributes based on 'type'
	if(type === 'hacker') {
		newModule.cycle = 6;
		newModule.count = 0;
		newModule.cube.animations.add('hacker', [0,1,2,3,4], 10, true);
      newModule.onRemove = genericOnRemove;
      newModule.onLoseConnection = hackerOnLoseConnection;
      newModule.powerable = true;
	}
	
	//Store module if it is core
	if(type === 'core')
	{
		newModule.cube.animations.add('core', [0,1,2], 20, true);
		newModule.cube.animations.play('core');
		this.core = newModule;
		this.coreExists = true;
      newModule.onRemove = genericOnRemove;
	}
   
   // solar panel testing
   if (type === 'solarPanel') {
	  newModule.modulePower = this.gameState.add.audio('modulePower', 0.5);
      newModule.giveTarget = solarPanelGiveTarget;
      newModule.mouseOver = solarPanelMouseOver;
      newModule.onRemove = genericOnRemove;
   }
   
   //Thruster module events
	if(type === 'thruster') {
	  newModule.isThrust = false;
	  newModule.isThrustPrev = false;
	  newModule.thrusterLoop = this.gameState.add.audio('thrusterLoop', 1, true);
	  newModule.thrusterLoop.allowMultiple = true;
      if (forPlayer) {
         var thrusterKey = this.gameState.input.keyboard.addKey(Phaser.Keyboard.W); 
         this.gameState.input.keyboard.addKeyCapture([thrusterKey]);
         thrusterKey.onDown.add(beginAct, newModule);
         thrusterKey.onUp.add(endAct, newModule);
      } else {
         // newModule.thrust = false;
         newModule.beginAct = beginAct;
         newModule.endAct = endAct;
      }
      newModule.update = thrusterUpdate;
      newModule.thrusterHalt = thrusterHalt;
      newModule.onRemove = genericOnRemove;
      newModule.powerable = true;
	}

	//Gun module events
	if(type === 'gun') {
	  newModule.cube.animations.add('gun', [0,1,2,3,4,5], 16, true);
	  newModule.gun = this.gameState.add.audio('gun');
	  newModule.gun.allowMultiple = true;
      if (forPlayer) {
	     newModule.tag = 'player';
         var actKey = this.gameState.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
         this.gameState.input.keyboard.addKeyCapture([actKey]);
         actKey.onDown.add(beginAct, newModule);
         actKey.onUp.add(endAct, newModule);
      } else {
		 newModule.tag = 'enemy';
         newModule.beginAct = beginAct;
         newModule.endAct = endAct;
      }
	  newModule.update = gunUpdate;
     newModule.onRemove = genericOnRemove;
     newModule.powerable = true;
	}
   
   if (type === 'hackable') {
      // set values
      newModule.isHacked = false;
      newModule.hackDistance = 400;
      newModule.cube.animations.add('hackable', [0,1,2,3,4], 10, true);
      newModule.cube.animations.add('hacked', [5,6,7,8,9], 10, true);
      newModule.barFade = 0.001;
      newModule.barFadeMaxDelay = 200;
      newModule.barFadeDelay = 0;
      newModule.delay = 1600;
      newModule.beingHacked = false;
      newModule.beingHackedPrev = false;
      newModule.hacking = this.gameState.add.audio('hacking', 1, true);
      // give progress bar
      newModule.hackBar = this.gameState.uiBuilder.buildProgressBar('growing', 1500, 1200, 100, 10,  200);
      newModule.hackBar.setStyle(0, 0xFFFFFF, 0x363636, 0, 0, 0, 0xFFFFFF, 0x2020CC);
      newModule.hackBar.hackable = newModule.cube;
      newModule.hackBar.onEvent = function() {
         this.hackable.animations.stop();
         this.hackable.animations.play('hacked');
         this.hackable.module.isHacked = true;
      };
      // add functions
      newModule.update = hackableUpdate;
      newModule.onRemove = genericOnRemove;
   }
	//Return the module object
	return newModule;
};

module.exports = ModuleBuilder;
















},{"./Bullet":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\Bullet.js","./Module":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\Module.js","./cube":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\cube.js"}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\cheating.js":[function(require,module,exports){
var Cheating = function(state) {
   // initialisation
	this.state = state;
   this.game = state.game;
   this.cam = this.game.camera;
   this.mouse = this.state.mouse;
   // buttons
   //core
	this.placeCoreKey = this.game.input.keyboard.addKey(Phaser.Keyboard.P);
	this.placeCoreKey.onDown.add(this.debugAddModule, {caller: this, key: 'core'});
	//shield
	this.placeShieldKey = this.game.input.keyboard.addKey(Phaser.Keyboard.O);
    this.placeShieldKey.onDown.add(this.debugAddModule, {caller: this, key: 'shield'});
	//thruster
	this.placeThrusterKey = this.game.input.keyboard.addKey(Phaser.Keyboard.I);
    this.placeThrusterKey.onDown.add(this.debugAddModule, {caller: this, key: 'thruster'});
	//solarPanel
	this.placeSPKey = this.game.input.keyboard.addKey(Phaser.Keyboard.U);
    this.placeSPKey.onDown.add(this.debugAddModule, {caller: this, key: 'solarPanel'});
	//hacker
	this.placeHackKey = this.game.input.keyboard.addKey(Phaser.Keyboard.Y);
	this.placeHackKey.onDown.add(this.debugAddModule, {caller: this, key: 'hacker'});
	//gun
	this.placeGunKey = this.game.input.keyboard.addKey(Phaser.Keyboard.T);
    this.placeGunKey.onDown.add(this.debugAddModule, {caller: this, key: 'gun'});
	//hackable
	this.placeHackableKey = this.game.input.keyboard.addKey(Phaser.Keyboard.L);
   this.placeHackableKey.onDown.add(this.debugAddModule, {caller: this, key: 'hackable'});
};

Cheating.prototype.constructor = Cheating;

Cheating.prototype.debugAddModule = function() {
   this.caller.state.moduleBuilder.build(this.key, this.caller.mouse.x, this.caller.mouse.y, true);
};

module.exports = Cheating;














},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\cube.js":[function(require,module,exports){
/*
Defines a cube.
*/

var Cube = function (gameState, x, y, sprite) {
    Phaser.Sprite.call(this, gameState.game, x, y, sprite);
	 this.tag = 'module';	//tag is used to detect object type during collision checking
    this.game = gameState.game;
	this.gameState = gameState;
    this.game.add.existing(this);
    this.group = undefined;
    this.module = undefined;
    this.indicatorFade = 0.02;
    this.healthBar = gameState.uiBuilder.buildProgressBar('shrinking', 0, 0, 20, 4, 3);
	this.healthBar.setStyle(0, 0xFFFFFF, 0x363636, 0, 0, 0, 0xFFFFFF, 0x20CC20);
	this.healthBar.cube = this;
	this.healthBarFade = 0.0008;
	this.impact = this.game.add.audio('moduleImpact');
	this.impact.volume = 0.25;
	this.impact.allowMultiple = true;
	//set update function of health bar
	this.healthBar.update = function() {
		this.setLocation(this.cube.x, this.cube.y+10);
	};
	//onEvent called when cube runs out of health
	this.healthBar.onEvent = function() {
		this.cube.dying = true;
		this.cube.life = 50;
		// this.group.countCubes();
		// this.destroy();
	};
	this.constraints = [];
};

Cube.prototype = Object.create(Phaser.Sprite.prototype);
Cube.prototype.constructor = Cube;

/**
 * Automatically called by World.update
 */
Cube.prototype.update = function() {
   if (this.cIndicator && this.cIndicator.alpha > 0) {
      this.cIndicator.alpha -= this.indicatorFade;
   }
   if (this.module.update) {
      this.module.update();
   }
   if (this.healthBar.graphics.alpha > 0) {
      this.healthBar.graphics.alpha -= this.healthBarFade * this.game.time.elapsed;
   }
   if (this.dying) {
      this.life -= this.game.time.elapsed;
      if (this.life < 0) {
         this.dying = false;
         this.healthBar.destroy();
         if (this.group) {
            if(this.tag === 'enemy_module') {
               if(this.key === 'thruster') {
                  this.gameState.money += 35;
               }
               else if(this.key === 'shield') {
                  this.gameState.money += 10;
               }
               else if(this.key === 'gun') {
                  this.gameState.money += 50;
               }
               else if(this.key === 'solarPanel') {
                  this.gameState.money += 25;
               }
               this.gameState.moneyText.text = this.gameState.money;
            }
            this.group.destroyCube(this);
         } else {
            if(this.key === 'core' && this.tag === 'module') {
               this.kill();
               this.gameState.restartLevel();
            }
            this.destroy();
         }
      }
   }
};

Cube.prototype.loseConnection = function() {
  if (!this.myConnection) {
    return;
  }  
  if (this.myConnection.start === this) {
      var endModule = this.myConnection.end.module;
      if (endModule.hasOwnProperty('onLoseConnection')) {
         endModule.onLoseConnection();
      }
      this.myConnection.end.myConnection = undefined;
      this.myConnection = undefined;
   } else if (this.myConnection.end === this) {
      var startModule = this.myConnection.end.module;
      if (startModule.hasOwnProperty('onLoseConnection')) {
         startModule.onLoseConnection();
      }
      this.myConnection.start.myConnection = undefined;
      this.myConnection = undefined;
   }
};

Cube.prototype.cubeCollide = function(other) {
   // floating cube, bad collision, collision with non-sprite, collision with non-cube
   if (!this.group || !other || !other.sprite || other.prototype !== this.prototype) {
      return;
   }
   if (other.group && this.group === other.group) {// if cubes in same group
      return;
   }
   if (this.group.isPlayer) { // player
      if (other.sprite.tag === 'enemy_module') { // collision with enemy, ramming
         this.group.handleRamming(this, other.sprite);
      } else if (other.sprite.tag === 'module') { // collision with floating, attatching
         this.group.handleAttatch(this, other.sprite);
      }
   } else {// enemy
      this.group.handleRamming(this, other.sprite); // enemies only ram on collision
   }
   this.group.countCubes();
};

Cube.prototype.toString = function() {
   var string = '';
   string += this.concat('name', this.name);
   return string;
};

Cube.prototype.concat = function(string, val) {
   return string + ': ' + val + '\n';
};

Cube.prototype.displayIndicator = function() {
  this.cIndicator.alpha = 1; 
};

Cube.prototype.hideIndicator = function() {
  this.cIndicator.alpha = 0; 
};

Cube.prototype.takeDamage = function(amt) {
   this.impact.play();
   this.healthBar.addValue(-amt);
   this.healthBar.graphics.alpha = 1;
};

Cube.prototype.dieQuick = function() {
  this.dying = true;
  this.life = 0;
};

Cube.prototype.remove = function() {
   if (!this.group) {
      return;
   }
   this.group.remove(this);
};

module.exports = Cube;















},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\cube_group.js":[function(require,module,exports){
var Astar = require('../libs/javascript-astar/astar');
var EnemyAI = require('./enemy_ai');

/*
Defines a cube group.
*/

var CubeGroup = function (game, root) {
   this.game = game;
   this.root = root;
   this.cubes = [];
   var col = [];
   col.push(this.root);
   this.cubes.push(col);
   if (this.root) {
      this.root.group = this;
   }
   this.DIR = {NORTH: 0, EAST: 1, SOUTH: 2, WEST: 3};
   this.offset = 2;
	this.activeHackerModules = [];	//list of hacker modules in this group
	//this.activeGuns = [];
	this.moduleConnect = this.game.add.audio('moduleConnect');
	this.moduleConnect.allowMultiple = true;

   this.numCubes = 1;
   this.bounceBackForce = 30;
   this.minRamVel = 300;
   this.debug = false;
};

CubeGroup.prototype.constructor = CubeGroup;

/**
 * Automatically called by World.update
 */
CubeGroup.prototype.update = function() {
   if (this.AI) {
      this.AI.update();
   }
};

CubeGroup.prototype.call = function(fun) {
   for (var row = 0; row < this.cubesWidth(); row++) {
      for (var col = 0; col < this.cubesHeight(); col++) {
         var cube = this.cubes[row][col];
         if (cube && cube.hasOwnProperty(fun)) {
            // if cubes need functions called
         } else if (cube && cube.module && cube.module.hasOwnProperty(fun)) {
            var fn = cube.module[fun];
            if (typeof fn === 'function') {
               fn.call(cube.module);
            }
         }
      }
   }
};

CubeGroup.prototype.callOnType = function(fun, type) {
   for (var row = 0; row < this.cubesWidth(); row++) {
      for (var col = 0; col < this.cubesHeight(); col++) {
         var cube = this.cubes[row][col];
         if (cube && cube.hasOwnProperty(fun)) {
            // if cubes need functions called
         } else if (cube && cube.module && cube.module.type === type && cube.module.hasOwnProperty(fun)) {
            var fn = cube.module[fun];
            if (typeof fn === 'function') {
               fn.call(cube.module);
            }
         }
      }
   }
};

CubeGroup.prototype.getModules = function(type) {
   var modules = [];
   for (var row = 0; row < this.cubesWidth(); row++) {
      for (var col = 0; col < this.cubesHeight(); col++) {
         var cube = this.cubes[row][col];
         if (cube && cube.module.type === type) {
            modules.push(cube.module);
         }
      }
   }
   return modules;
};

CubeGroup.prototype.giveAI = function(type, player) {
   this.AI = new EnemyAI(this.game, this, type, player);
};

CubeGroup.prototype.add = function(cube, point) {
  if (!this.root && cube.module.type === 'core') {
     this.root = cube;
  }
  cube.group = this;
  this.set(cube, point);
  this.createConstraints(cube, point);
};

CubeGroup.prototype.handleAttatch = function(origin, other) {
   if (this.debug) { console.log('handleCollision() start:', origin.module.type, other.module.type); }
   if (this.debug) { this.displayCubes(); }
   var relSide = this.relativeSide(origin.body, other.body);
   var originLoc = this.find(origin);
   var otherLoc = this.calcPos(origin, relSide);
   this.moduleConnect.play();
   if (this.debug) console.log('handleCollision() pre-find:', 'relSide:', relSide, 'originLoc:', Math.floor(originLoc.x), Math.floor(originLoc.y), 'otherLoc:', Math.floor(otherLoc.x), Math.floor(otherLoc.y)); // jshint ignore:line
   this.set(other, otherLoc);
   otherLoc = this.find(other); // update position since set can shift grid
   if (!otherLoc) {
      if (this.debug) {
         console.log('handleCollision(): otherLoc DNE', '---------------------');
         this.displayCubes();
      }
      return;
   }
   if (this.debug) console.log('handleCollision() post-find:', 'otherLoc:', Math.floor(otherLoc.x), Math.floor(otherLoc.y)); // jshint ignore:line
   this.createConstraints(other, otherLoc);
   if (other.module.type === 'solarPanel') {
      this.createConnectionFrom(other);
   } else if (other.module.powerable) {
      var spareSolarPanel = this.spareSolarPanel();
      if (spareSolarPanel) {
         spareSolarPanel.giveTarget(other.module);
      }
   }
   if (this.debug) { this.displayCubes(); }
   if (this.debug) { console.log('handleCollision() end:', '------------------------------'); }
};

CubeGroup.prototype.createConnectionFrom = function(panel) {
   for (var row = 0; row < this.cubesWidth(); row++) {
      for (var col = 0; col < this.cubesHeight(); col++) {
         var cube = this.cubes[row][col];
         if (cube && cube !== panel && !cube.myConnection && cube.module.powerable) {
            panel.module.giveTarget(cube.module);
            return;
         }
      }
   }
};

CubeGroup.prototype.spareSolarPanel = function() {
   for (var row = 0; row < this.cubesWidth(); row++) {
      for (var col = 0; col < this.cubesHeight(); col++) {
         var cube = this.cubes[row][col];
         if (cube && !cube.myConnection && cube.module.type === 'solarPanel') {
            return cube.module;
         }
      }
   }
};

CubeGroup.prototype.handleRamming = function(origin, other) {
   if (!other.group || other.group === this) {
      return;
   }
   var sumVel = Math.abs(origin.body.velocity.x) + Math.abs(origin.body.velocity.y);
   if (this.debug) { console.log('handleRamming():', 'sumVel:', sumVel.toPrecision(4)); }
   if (sumVel >= this.minRamVel) {
      if (this.game.juicy) {
         this.game.juicy.shake();
      }
      other.takeDamage(3);
      this.call('thrusterHalt');
   }
};

CubeGroup.prototype.calcPos = function(origin, relSide) {
   var diffAngle = origin.body.rotation - this.root.body.rotation;
   var relative = this.angleToDir(diffAngle);
   var output = this.find(origin);
   if (relative === 0) { // north relative to the root
      if (relSide === 0) {
         output.y++;
      } else if (relSide === 1) {
         output.x++;
      } else if (relSide === 2) {
         output.y--;
      } else if (relSide === 3) {
         output.x--;
      }
   } else if (relative === 1) { // east relative to root
      if (relSide === 0) {
         output.x++;
      } else if (relSide === 1) {
         output.y--;
      } else if (relSide === 2) {
         output.x--;
      } else if (relSide === 3) {
         output.y++;
      }
   } else if (relative === 2) { // south relative to root
      if (relSide === 0) {
         output.y--;
      } else if (relSide === 1) {
         output.x--;
      } else if (relSide === 2) {
         output.y++;
      } else if (relSide === 3) {
         output.x++;
      }
   } else if (relative === 3) { // west relative to root
      if (relSide === 0) {
         output.x--;
      } else if (relSide === 1) {
         output.y++;
      } else if (relSide === 2) {
         output.x++;
      } else if (relSide === 3) {
         output.y--;
      }
   }
   return output;
};

CubeGroup.prototype.angleToDir = function(angle) {
   if (angle >= 0) {
     angle %= 2 * Math.PI;
  } else {
     angle *= -1;
     angle %= 2 * Math.PI;
     angle *= -1;
  }
  if (this.debug) { console.log('angleToDir():', 'angle:', angle.toPrecision(4)); }
  if ((angle >= -1 / 4 * Math.PI && angle < 1 / 4 * Math.PI) || angle > 7 / 4 * Math.PI) {
     if (this.debug) { console.log('angleToDir() case one NORTH'); }
     return this.DIR.NORTH;
  } else if (angle >= 1 / 4 * Math.PI && angle < 3 / 4 * Math.PI) {
     if (this.debug) { console.log('angleToDir() case two EAST'); }
     return this.DIR.EAST;
  } else if (angle >= 3 / 4 * Math.PI && angle < 5 / 4 * Math.PI) {
     if (this.debug) { console.log('angleToDir() case three SOUTH'); }
     return this.DIR.SOUTH;
  } else if (angle >= 5 / 4 * Math.PI && angle < 7 / 4 * Math.PI) {
     if (this.debug) { console.log('angleToDir() case four WEST'); }
     return this.DIR.WEST;
  } else if (angle >= -3 / 4 * Math.PI && angle < -1 / 4 * Math.PI) {
     if (this.debug) { console.log('angleToDir() case five WEST'); }
     return this.DIR.WEST;
  } else if (angle >= -5 / 4 * Math.PI && angle < -3 / 4 * Math.PI) {
     if (this.debug) { console.log('angleToDir() case six SOUTH'); }
     return this.DIR.SOUTH;
  } else if (angle >= -7 / 4 * Math.PI && angle < -5 / 4 * Math.PI) {
     if (this.debug) { console.log('angleToDir() case seven EAST'); }
     return this.DIR.EAST;
  } else if (angle < -7 / 4 * Math.PI) {
     if (this.debug) { console.log('angleToDir() case eight NORTH'); }
     return this.DIR.NORTH;
  }
};

CubeGroup.prototype.createConstraints = function(me, point) {
   var neighbors = this.getNeighbors(me);
   for (var i = 0; i < neighbors.length; i++) {
      var neighbor = neighbors[i];
      var mySide = this.relativeSide(me.body, neighbor.body);
      var neighborSide = this.relativeSide(neighbor.body, me.body);
      var constraint;
      var offset = me.width + this.offset;
      if (mySide === 0) {
        if (neighborSide === 0) {
           constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [0, offset], Math.PI);
        } else if (neighborSide === 1) {
            constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [0, offset], 1 / 2 * Math.PI);
        } else if (neighborSide === 2) {
            constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [0, offset], 0);
        } else if (neighborSide === 3) {
            constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [0, offset], 3 / 2 * Math.PI);
        }
     } else if (mySide === 1) {
        if (neighborSide === 0) {
           constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [-offset, 0], -1 / 2 * Math.PI);
        } else if (neighborSide === 1) {
            constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [-offset, 0], Math.PI);
        } else if (neighborSide === 2) {
            constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [-offset, 0], 1 / 2 * Math.PI);
        } else if (neighborSide === 3) {
            constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [-offset, 0], 0);
        }
     } else if (mySide === 2) {
         if (neighborSide === 0) {
           constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [0, -offset], 0);
        } else if (neighborSide === 1) {
            constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [0, -offset], 3 / 2 * Math.PI);
        } else if (neighborSide === 2) {
            constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [0, -offset], Math.PI);
        } else if (neighborSide === 3) {
            constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [0, -offset], 1 / 2 * Math.PI);
        }
     } else if (mySide === 3) {
        if (neighborSide === 0) {
           constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [offset, 0], 1 / 2 * Math.PI);
        } else if (neighborSide === 1) {
            constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [offset, 0], 0);
        } else if (neighborSide === 2) {
            constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [offset, 0], -1 / 2 * Math.PI);
        } else if (neighborSide === 3) {
            constraint = this.game.physics.p2.createLockConstraint(me.body, neighbor.body, [offset, 0], Math.PI);
        }
     }
     me.constraints.push(constraint);
     neighbor.constraints.push(constraint);
   }
};

CubeGroup.prototype.relativeSide = function(thisBody, otherBody) {
  var thisPoint = new Phaser.Point(thisBody.x, thisBody.y);
  var otherPoint = new Phaser.Point(otherBody.x, otherBody.y);
  var angleToOther = this.angleBetweenPoints(thisPoint, otherPoint);
  var diffAngle = angleToOther - thisBody.rotation;
  var returnDir = this.angleToDir(diffAngle);
  if (this.debug) { console.log('relativeSide():', 'angleToOther:', angleToOther.toPrecision(4), 'thisBody.rotation:', thisBody.rotation.toPrecision(4), 'diffAngle:', diffAngle.toPrecision(4), 'returnDir:', returnDir); }
  return returnDir;
};

CubeGroup.prototype.angleBetweenPoints = function(thisPoint, otherPoint) {
  var angleToOther = Phaser.Point.angle(thisPoint, otherPoint);
  if (angleToOther < 0) { // fix dumb part of Phaser.Point.angle()
     angleToOther = 2 * Math.PI + angleToOther;
  }
  angleToOther = (angleToOther + 3/2 * Math.PI) % (2 * Math.PI); // rotate 90 d clockwise
   return angleToOther;
};

CubeGroup.prototype.find = function(cube) {
   for (var row = 0; row < this.cubesWidth(); row++) {
      for (var col = 0; col < this.cubesHeight(); col++) {
         if (this.cubes[row][col] === cube) {
            return new Phaser.Point(row, col);
         }
      }
   }
   return undefined;
};

CubeGroup.prototype.get = function(point) {
  if (!point || this.outOfBounds(point)) {
      return;
  }
  return this.cubes[point.x][point.y];
};

CubeGroup.prototype.cubesWidth = function() {
   return this.cubes.length;
};

CubeGroup.prototype.cubesHeight = function() {
   return this.cubes[0].length;
};

CubeGroup.prototype.addTopRow = function() {
   for (var row = 0; row < this.cubesWidth(); row++) {
      this.cubes[row].push(undefined);
   }
};

CubeGroup.prototype.addRightCol = function() {
   var newCol = [];
   for (var i = 0; i < this.cubesHeight(); i++) {
      newCol.push(undefined);
   }
   this.cubes.push(newCol);
};

CubeGroup.prototype.addBotRow = function() {
   for (var row = 0; row < this.cubesWidth(); row++) {
      this.cubes[row].unshift(undefined);
   }
};

CubeGroup.prototype.addLeftCol = function() {
   var newCol = new Array(this.cubesHeight());
   this.cubes.unshift(newCol);
};

CubeGroup.prototype.getCube = function(point) {
   if (!point || this.outOfBounds(point)) {
      return undefined;
   }
   return this.cubes[point.x][point.y];
};

CubeGroup.prototype.adjust = function(point, dir) {
  if (!point) {
     return;
  }
  var newPoint = new Phaser.Point(point.x, point.y);
  switch (dir) {
      case this.DIR.NORTH:
      newPoint.y++;
      break;
      case this.DIR.EAST:
      newPoint.x++;
      break;
      case this.DIR.SOUTH:
      newPoint.y--;
      break;
      case this.DIR.WEST:
      newPoint.x--;
      break;
   }
   return newPoint;
};

CubeGroup.prototype.set = function(cube, point) {
   if (!point) {
      console.log('set given undefined point');
      return;
   }
   if (point.x < 0) {
      if (this.debug) { console.log('add left col'); }
      this.addLeftCol();
      point.x = 0;
   } else if (point.x >= this.cubesWidth()) {
      if (this.debug) { console.log('add right col'); }
      this.addRightCol();
      point.x = this.cubesWidth() - 1;
   } else if (point.y < 0) {
      if (this.debug) { console.log('add bot row'); }
      this.addBotRow();
      point.y = 0;
   } else if (point.y >= this.cubesHeight()) {
      if (this.debug) { console.log('add top row'); }
      this.addTopRow();
      point.y = this.cubesHeight() - 1;
   }
   if (this.get(point)) {
      return;
   }
   this.cubes[point.x][point.y] = cube;
   cube.group = this;
};

CubeGroup.prototype.outOfBounds = function(point) {
   if (!point) {
      console.log('out of bounds given undefined point');
      return;
   }
   if (point.x < 0 || point.x >= this.cubesWidth() || point.y < 0 || point.y >= this.cubesHeight()) {
      return true;
   }
   return false;
};

CubeGroup.prototype.displayCubes = function() {
   var output = 'displayCubes():\n';
   var row = 0;
   var col = this.cubesHeight() - 1;
   while (col >= 0) {
      while (row < this.cubesWidth()) {
         var cube = this.cubes[row][col];
         if (cube) {
            switch (cube.module.type) {
               case 'shield':
               output += 'S ';
               break;
               case 'core':
               output += 'C ';
               break;
               case 'thruster':
               output += 'T ';
               break;
               case 'solarPanel':
               output += 'P ';
               break;
               case 'hacker':
               output += 'H ';
               break;
               case 'gun':
               output += 'G ';
               break;
            }
         } else {
            output += '_ ';
         }
         row++;
      }
      row = 0;
      col--;
      output += '\n';
   }
   console.log(output);
};

CubeGroup.prototype.displayConnection = function(connection) {
   this.hideOtherConnections(connection);
   var graph = new Astar.Graph(this.cubesToGraph());
   var startPoint = this.find(connection.start);
   var endPoint = this.find(connection.end);
   if (!startPoint || !endPoint) {
      console.log('displayConnection failed to get points');
      return;
   }
   var start = graph.grid[startPoint.x][startPoint.y];
   var end = graph.grid[endPoint.x][endPoint.y];
   var result = Astar.astar.search(graph, start, end);
   result.unshift(start);
   var previous;
   for(var i = 0; i < result.length; i++) {
      var curPoint = new Phaser.Point(result[i].x, result[i].y);
      var curCube = this.get(curPoint);
      var indicator = curCube.cIndicator;
      var prevPoint;
      var nextPoint;
      var side;
      var prevCube;
      var nextCube;
      if (!previous) {
         indicator.animations.play('end');
         nextPoint = new Phaser.Point(result[i+1].x, result[i+1].y);
         nextCube = this.get(nextPoint);
         side = this.relativeSide(curCube.body, nextCube.body);
         indicator.rotation = this.dirToAngle(side);
      } else if (i === result.length - 1) {
         indicator.animations.play('end');
         prevPoint = new Phaser.Point(previous.x, previous.y);
         prevCube = this.get(prevPoint);
         side = this.relativeSide(curCube.body, prevCube.body);
         indicator.rotation = this.dirToAngle(side);
      } else {
         indicator.animations.play('line');
         prevPoint = new Phaser.Point(previous.x, previous.y);
         nextPoint = new Phaser.Point(result[i+1].x, result[i+1].y);
         prevCube = this.get(prevPoint);
         nextCube = this.get(nextPoint);
         var prevSide = this.relativeSide(curCube.body, prevCube.body);
         var nextSide = this.relativeSide(curCube.body, nextCube.body);
         this.manageIndicator(indicator, prevSide, nextSide);
      }
      previous = result[i];
      curCube.displayIndicator();
    }
};

CubeGroup.prototype.manageIndicator = function(indicator, prevDir, nextDir) {
  indicator.scale.setTo(Math.abs(indicator.scale.x), indicator.scale.y);
  if (prevDir === this.DIR.NORTH && nextDir === this.DIR.SOUTH) { // 2
      if (this.debug) { console.log('case 2'); }
      indicator.rotation = Math.PI;
   } else if (prevDir === this.DIR.SOUTH && nextDir === this.DIR.NORTH) { // 1
      if (this.debug) { console.log('case 1'); }
      indicator.rotation = 0;
   } else if (prevDir === this.DIR.EAST && nextDir === this.DIR.WEST) { // 4
      if (this.debug) { console.log('case 4'); }
      indicator.rotation = 1 / 2 * Math.PI;
   } else if (prevDir === this.DIR.WEST && nextDir === this.DIR.EAST) { // 3
      if (this.debug) { console.log('case 3'); }
      indicator.rotation = 3 / 2  * Math.PI;
   } else {
      indicator.animations.play('right');
      if (prevDir === this.DIR.SOUTH && nextDir === this.DIR.EAST) { // 5
         if (this.debug) { console.log('case 5'); }
         indicator.rotation = 0;
      } else if (prevDir === this.DIR.WEST && nextDir === this.DIR.SOUTH) { // 6
         if (this.debug) { console.log('case 6'); }
         indicator.rotation = 1 / 2 * Math.PI;
      } else if (prevDir === this.DIR.NORTH && nextDir === this.DIR.WEST) { // 7
         if (this.debug) { console.log('case 7'); }
         indicator.rotation = Math.PI;
      } else if (prevDir === this.DIR.EAST && nextDir === this.DIR.NORTH) { // 8
         if (this.debug) { console.log('case 8'); }
         indicator.rotation = 3 / 2 * Math.PI;
      } else {
         indicator.scale.setTo(-Math.abs(indicator.scale.x), indicator.scale.y);
         if (prevDir === this.DIR.SOUTH && nextDir === this.DIR.WEST) { // 9
            if (this.debug) { console.log('case 9'); }
            indicator.rotation = 0;
         } else if (prevDir === this.DIR.WEST && nextDir === this.DIR.NORTH) { // 10
            if (this.debug) { console.log('case 10'); }
            indicator.rotation = 1 / 2 * Math.PI;
         } else if (prevDir === this.DIR.NORTH && nextDir === this.DIR.EAST) { // 11
            if (this.debug) { console.log('case 11'); }
            indicator.rotation = Math.PI;
         } else if (prevDir === this.DIR.EAST && nextDir === this.DIR.SOUTH) { // 12
            if (this.debug) { console.log('case 12'); }
            indicator.rotation = 3 / 2 * Math.PI;
         }
      }
   } 
};

CubeGroup.prototype.hideOtherConnections = function(exception) {
   for (var row = 0; row < this.cubesWidth(); row++) {
      for (var col = 0; col < this.cubesHeight(); col++) {
         var cube = this.cubes[row][col];
         if (cube && cube.myConnection && cube.myConnection !== exception) {
            cube.hideIndicator();
         }
      }
   }
};

CubeGroup.prototype.cubesToGraph = function() {
  var graph = [];
  for (var row = 0; row < this.cubesWidth(); row++) {
     var newCol = [];
      for (var col = 0; col < this.cubesHeight(); col++) {
         if (this.cubes[row][col]) {
            newCol.push(1);
         } else {
            newCol.push(0);
         }
      }
      graph.push(newCol);
   }
   return graph;
};

CubeGroup.prototype.dirBetween = function(a, b) {
   var deltaX = a.x - b.x;
   var deltaY = a.y - b.y;
   if (deltaX > 0) {
      return this.DIR.WEST;
   }
   if (deltaX < 0) {
      return this.DIR.EAST;
   }
   if (deltaY > 0) {
      return this.DIR.SOUTH;
   }
   if (deltaY < 0) {
      return this.DIR.NORTH;
   }
   return this.DIR.NORTH;
};

CubeGroup.prototype.dirToAngle = function(dir) {
  switch (dir) {
   case this.DIR.NORTH:
   return Math.PI;
   case this.DIR.EAST:
   return 3 / 2 * Math.PI;
   case this.DIR.SOUTH:
   return 0;
   case this.DIR.WEST:
   return 1 / 2 * Math.PI;
  }  
};

CubeGroup.prototype.destroyCube = function(cube) {
  var loc = this.find(cube);
  if (!loc) {
     console.log('attempt to destroy cube not in group');
     return;
  }
  // remove cube from group
  this.remove(cube);
  // destroy cube
  if(cube.key === 'core' && cube.tag === 'module') {
	cube.kill();
	this.game.restartLevel();
  }
  cube.destroy(true);
};

CubeGroup.prototype.remove = function(cube) {
   if (this.debug) { console.log('remove()'); }
   if (this.root === cube) {
      return;
   }
   // remove cube from array
   var row, col;
   for (row = 0; row < this.cubesWidth(); row++) {
      for (col = 0; col < this.cubesHeight(); col++) {
         if (this.cubes[row][col] === cube) {
            cube.group = undefined;
            cube.tag = 'module';
            this.cubes[row][col] = undefined;
            break;
         }
      }
   }
   //If this is an active module, splice it from the active list
   if(cube.module.isActive){
	   if(cube.module.type === 'hacker') {
			var hackIndex = this.activeHackerModules.indexOf(cube.module);
			this.activeHackerModules.splice(hackIndex, 1);
	   }
	   cube.module.isActive = false;
   }
   //set sprite of cube to greyed if necisarry
   if(cube.module.type === 'thruster' || cube.module.type === 'gun' || cube.module.type === 'hacker') {
		cube.frame = 0;
   }
   // remove constraints from cube
   this.removeConstraints(cube);
   cube.group = undefined;
   if (cube.module && cube.module.hasOwnProperty('onRemove')) {
      cube.module.onRemove();
   }
   // test for exiles
   for (row = 0; row < this.cubesWidth(); row++) {
      for (col = 0; col < this.cubesHeight(); col++) {
         var exile = this.cubes[row][col];
         if (exile && this.isExile(exile)) {
            this.remove(exile);
         }
      }
   }
   if (this.debug) { this.displayCubes(); }
};

CubeGroup.prototype.removeNeighborsConstraint = function(constraint, cube) {
   // console.log('removeNeighborsConstraint');
   var neighbors = this.getNeighbors(cube);
   for (var i = 0; i < neighbors.length; i++) {
      var neighbor = neighbors[i];
      for (var j = 0; j < neighbor.constraints.length; j++) {
         if (neighbor.constraints[j] === constraint) {
            neighbor.constraints.splice(j, 1);
         }
      }
   }
};

CubeGroup.prototype.getNeighbors = function(cube) {
   var loc = this.find(cube);
   var north = this.get(this.adjust(loc, this.DIR.NORTH));
   var east = this.get(this.adjust(loc, this.DIR.EAST));
   var south = this.get(this.adjust(loc, this.DIR.SOUTH));
   var west = this.get(this.adjust(loc, this.DIR.WEST));
   var neighbors = [];
   if (north) {
      neighbors.push(north);
   }
   if (east) {
      neighbors.push(east);
   }
   if (south) {
      neighbors.push(south);
   }
   if (west) {
      neighbors.push(west);
   }
   return neighbors;
};

CubeGroup.prototype.removeConstraints = function(cube) {
   // console.log('removeConstraints');
   while (cube.constraints.length > 0) {
      this.removeNeighborsConstraint(cube.constraints[0], cube);
      this.game.physics.p2.removeConstraint(cube.constraints[0]);
      cube.constraints.splice(0, 1);
   }
};

// only used to test Astar
CubeGroup.prototype.testPath = function() {
  var graph = new Astar.Graph([
        [1,1,1,1],
        [0,1,1,0],
        [0,0,0,1]
    ]);
   var start = graph.grid[0][0];
   var end = graph.grid[2][3];
   var result = Astar.astar.search(graph, start, end);
   result.unshift(start);
   for(var i = 0; i < result.length; i++) {
      console.log(result[i].x, result[i].y);
    } 
};

CubeGroup.prototype.isExile = function(cube) {
   if (cube === this.root) {
      return;
   }
   var graph = new Astar.Graph(this.cubesToGraph());
   var startPoint = this.find(this.root);
   var endPoint = this.find(cube);
   var start = graph.grid[startPoint.x][startPoint.y];
   var end = graph.grid[endPoint.x][endPoint.y];
   var result = Astar.astar.search(graph, start, end);
   // if no path is found, the cube is an exile
   if (result.length === 0) {
      return true;
   }
   return false;
};

CubeGroup.prototype.countCubes = function() {
	var row, col;
	var num  = 0;
	for (row = 0; row < this.cubesWidth(); row++) {
		for (col = 0; col < this.cubesHeight(); col++) {
			if (this.cubes[row][col] !== undefined) {
				num++;
			}
		}
	}
	//console.log(num);
	this.numCubes = num;
};

module.exports = CubeGroup;

















},{"../libs/javascript-astar/astar":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\libs\\javascript-astar\\astar.js","./enemy_ai":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\enemy_ai.js"}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\enemy_ai.js":[function(require,module,exports){
var Utils = require('../utils.js');

var EnemyAI = function(game, group, type, playerGroup) {
   this.game = game;
   this.group = group;
   this.type = type;
   this.playerGroup = playerGroup;
   this.player = this.playerGroup.root;
   this.ramDist = 500;
   this.shootDist = 500;
   this.rotationForce = 50;
   this.facingAllowance = Math.PI / 15;
   this.acting = false;
   switch (this.type) {
      case 'ram':
      this.allocateTo('thruster');
      break;
      case 'shoot':
      this.allocateTo('gun');
   }
};

EnemyAI.prototype.constructor = EnemyAI;

EnemyAI.prototype.update = function() {
   switch (this.type) {
      case 'ram':
      this.customUpdate('thruster', this.ramDist);
      break;
      case 'shoot':
      this.customUpdate('gun', this.shootDist);
   }
};

EnemyAI.prototype.customUpdate = function(type, threshold) {
   if (!this.group.root) {
      return;
   }
   else if(!this.group.root.body) {
		return;
   }
   var root = this.group.root;
   var myPos = new Phaser.Point(root.x, root.y);
   var playerPos = new Phaser.Point(this.player.x, this.player.y);
   var dist = Utils.distance(myPos.x, myPos.y, playerPos.x, playerPos.y);
   if (dist <= threshold) {
      var angleTo = this.angleTo(myPos, playerPos);
      var diffAngle = angleTo - root.body.rotation;
      if (diffAngle > 0) {
         root.body.angularForce = this.rotationForce;
      } else {
         root.body.angularForce = -this.rotationForce;
      }
      if (Math.abs(diffAngle) <= this.facingAllowance && !this.acting) {
         // this.group.call('beginAct');
         this.group.callOnType('beginAct', type);
         this.acting = true;
         // this.allocateTo(type);
      } else if (Math.abs(diffAngle) > this.facingAllowance && this.acting){
         // this.group.call('endAct');
         this.group.callOnType('endAct', type);
         this.acting = false;
      }
   }
};

EnemyAI.prototype.allocateTo = function(type) {
   var panels = [];
   var types = [];
   for (var row = 0; row < this.group.cubesWidth(); row++) {
      for (var col = 0; col < this.group.cubesHeight(); col++) {
         var cube = this.group.cubes[row][col];
         if (cube && cube.module) {
            if (cube.module.type === 'solarPanel' && !cube.myConnection) {
               panels.push(cube.module);
            } else if (cube.module.type === type && !cube.myConnection) {
               types.push(cube.module);
            }
         }
      }
   }
   var i = 0;
   while (i < types.length && i < panels.length) {
      var tarPanel = panels[i];
      var tarType = types[i];
      var newConnection = {start: tarPanel.cube, end: tarType.cube};
      tarPanel.cube.myConnection = newConnection;
      tarType.cube.myConnection = newConnection;
      this.group.displayConnection(tarPanel.cube.myConnection);
      i++;
   }
};

EnemyAI.prototype.angleTo = function(from, to) {
  var angleToOther = Phaser.Point.angle(from, to);
  if (angleToOther < 0) { // fix dumb part of Phaser.Point.angle()
     angleToOther = 2 * Math.PI + angleToOther;
  }
  angleToOther = (angleToOther + 3/2 * Math.PI) % (2 * Math.PI); // rotate 90 d clockwise
  return angleToOther;
};

module.exports = EnemyAI;











},{"../utils.js":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\utils.js"}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\helper.js":[function(require,module,exports){
var Helper = function(state) {
	this.state = state;
   this.game = this.state.game;
   this.cam = this.game.camera;
   this.sm = this.state.soundManager;
   this.helpBanner = this.state.uiBuilder.buildBanner(0.5, 0.5, 'tutorial_text');
	this.helpButton = this.game.add.button(this.cam.x - 100, this.cam.y - 100, 'helpButton', this.helpBanner.toggle, this.helpBanner, 1, 0, 2);
	this.helpButton.onInputOver.add(this.sm.playHoverClick, this.sm);
	this.helpButton.onInputDown.add(this.sm.playDownClick, this.sm);
};

Helper.prototype.constructor = Helper;

Helper.prototype.update = function() {
   this.helpButton.x = this.cam.x + 16;
   this.helpButton.y = this.cam.y + 16;
};

module.exports = Helper;
},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\mouse.js":[function(require,module,exports){
var Utils = require('../utils.js');

var Mouse = function(game, input, playerGroup) {
   this.game = game;
   this.input = input;
	this.body = new p2.Body(); // jshint ignore:line
   this.game.physics.p2.world.addBody(this.body);
   this.input.onDown.add(this.click, this);
   this.input.onUp.add(this.release, this);
   this.input.addMoveCallback(this.move, this);
   this.x = 0;
   this.y = 0;
   this.grabbed = undefined;
   this.lastClicked = undefined;
   this.line = new Phaser.Line(0, 0, 0, 0);
   this.removeThreshold = 100; // time distance you must pull to remove module
   this.removeDist = 0; // distance you are pulling
   this.playerGroup = playerGroup;
   // keys
   this.ccwKey = this.game.input.keyboard.addKey(Phaser.Keyboard.Q);
	this.cwKey = this.game.input.keyboard.addKey(Phaser.Keyboard.E);
};

Mouse.prototype.constructor = Mouse;

Mouse.prototype.update = function() {
   if (this.grabbed) {
      var angle = Math.atan2(this.grabbed.sprite.y - (this.input.position.y + this.game.camera.y), this.grabbed.sprite.x - (this.input.position.x+ this.game.camera.x)) + Math.PI;
      var dist = Utils.distance(this.grabbed.sprite.x, this.grabbed.sprite.y, (this.input.position.x+ this.game.camera.x), (this.input.position.y + this.game.camera.y));
      var weight;
	  if(this.grabbed.sprite.key === 'asteroid') {
		weight = 1;
	  }
	  else {
		weight = 10;
	  }
	  if (!this.grabbed.sprite.group) {
         this.grabbed.force.x = Math.cos(angle) * dist * weight;
         this.grabbed.force.y = Math.sin(angle) * dist * weight;
      }
      this.line.setTo(this.grabbed.sprite.x, this.grabbed.sprite.y, (this.input.position.x+ this.game.camera.x), (this.input.position.y + this.game.camera.y));
      var deltaX = this.grabbed.sprite.x - this.x;
	  var deltaY = this.grabbed.sprite.y - this.y;
	  this.removeDist = Math.sqrt(Math.pow(deltaX, 2) + Math.pow(deltaY, 2));
      if(this.grabbed.sprite.tag === 'module') {
		  if (this.removeDist >= this.removeThreshold && this.grabbed.sprite.key !== 'asteroid') {
			 this.grabbed.sprite.remove();
		  }
	  }
    } else {
       this.line.setTo(0, 0, 0, 0);
    }
    var point = new Phaser.Point(this.x, this.y);
    var bodies = this.game.physics.p2.hitTest(point);
    if (bodies.length)
    {
        var hover = bodies[0].parent;
        if (hover.sprite.module && hover.sprite.module.mouseOver) {
           hover.sprite.module.mouseOver();
        }
    }
    // rotate
   if(this.ccwKey.isDown) {
		if(this.grabbed !== undefined && this.grabbed.sprite.group === undefined) {
			this.grabbed.angularForce += -5;
		}
	}
	if(this.cwKey.isDown) {
		if(this.grabbed !== undefined && this.grabbed.sprite.group === undefined) {
			this.grabbed.angularForce += 5;
		}
	}
};

Mouse.prototype.click = function(pointer) {
   var point = new Phaser.Point(pointer.x + this.game.camera.x, pointer.y + this.game.camera.y);
   var bodies = this.game.physics.p2.hitTest(point);
   if (bodies.length)
   {
     var temp = bodies[0].parent;
     // console.log('rotation:', temp.rotation);
     this.grabbed = temp;
     if (this.grabbed.sprite.module && this.grabbed.sprite.module.hasOwnProperty('mouseDown')) {
       this.grabbed.sprite.module.mouseDown();
     }
     if (this.lastClicked && this.lastClicked.sprite && this.lastClicked.sprite.module &&
     this.lastClicked.sprite.module.giveTarget) {
        this.lastClicked.sprite.module.giveTarget(this.grabbed.sprite.module);
     }
     if (temp.sprite && temp.sprite.module && temp.sprite.module.type === 'core') {
        this.grabbed = undefined;
     }
     if (temp.sprite && temp.sprite.group && temp.sprite.group !== this.playerGroup) {
        this.grabbed = undefined;
     }
     this.lastClicked = temp;
   }
};
  
 Mouse.prototype.release = function() {
   if (this.grabbed) {
     this.grabbed = undefined;
   }
};

Mouse.prototype.move = function(pointer) {
   // p2 uses different coordinate system, so convert the pointer position to p2's coordinate system
   this.body.position[0] = this.game.physics.p2.pxmi(pointer.position.x);
   this.body.position[1] = this.game.physics.p2.pxmi(pointer.position.y);
   this.x = pointer.position.x + this.game.camera.x;
   this.y = pointer.position.y + this.game.camera.y;
};

Mouse.prototype.render = function() {
   //this.game.debug.geom(this.line);
};

module.exports = Mouse;















},{"../utils.js":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\utils.js"}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\sound_manager.js":[function(require,module,exports){
/*
Plays sounds needed across multiple scripts.
*/
var SoundManager = function(state) {
   // initial variables
	this.state = state;
   this.game = this.state.game;
   this.cam = this.game.camera;
   // sounds
   this.hoverClick = this.game.add.audio('hoverClick');
   this.downClick = this.game.add.audio('downClick');
};

SoundManager.prototype.constructor = SoundManager;

SoundManager.prototype.playHoverClick = function() {
   this.hoverClick.play();
};

SoundManager.prototype.playDownClick = function() {
   this.downClick.play();
};

module.exports = SoundManager;













},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\functionAccess\\Renderables.js":[function(require,module,exports){
var Renderables = function() {
	if(Renderables.prototype.exists) {
		return Renderables.prototype.existingReference;
	}
	
	this.list = [];
	Renderables.prototype.exists = true;
	Renderables.prototype.existingReference = this;
};

Renderables.prototype.constructor = Renderables;
//These var's help create the singleton functionality
Renderables.prototype.exists = false;
Renderables.prototype.existingReference = null;

Renderables.prototype.subscribe = function(subscriber) {
	this.list.push(subscriber);
};

Renderables.prototype.unsubscribe = function(unsubscriber) {
	for(var i = 0; i < this.list.length; i++) {
		if(this.list[i] === unsubscriber) {
			this.list[i] = false;
		}
	}
};

Renderables.prototype.renderAll = function() {
	for(var i = 0; i < this.list.length; i++) {
		if(this.list[i] === false) {
			continue;
		}
		this.list[i].render();
	}
};

module.exports = Renderables;
},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\libs\\javascript-astar\\astar.js":[function(require,module,exports){
// javascript-astar 0.4.0
// http://github.com/bgrins/javascript-astar
// Freely distributable under the MIT License.
// Implements the astar search algorithm in javascript using a Binary Heap.
// Includes Binary Heap (with modifications) from Marijn Haverbeke.
// http://eloquentjavascript.net/appendix2.html

(function(definition) {
    /* global module, define */
    if(typeof module === 'object' && typeof module.exports === 'object') {
        module.exports = definition();
    } else if(typeof define === 'function' && define.amd) {
        define([], definition);
    } else {
        var exports = definition();
        window.astar = exports.astar;
        window.Graph = exports.Graph;
    }
})(function() {

function pathTo(node){
    var curr = node,
        path = [];
    while(curr.parent) {
        path.push(curr);
        curr = curr.parent;
    }
    return path.reverse();
}

function getHeap() {
    return new BinaryHeap(function(node) {
        return node.f;
    });
}

var astar = {
    /**
    * Perform an A* Search on a graph given a start and end node.
    * @param {Graph} graph
    * @param {GridNode} start
    * @param {GridNode} end
    * @param {Object} [options]
    * @param {bool} [options.closest] Specifies whether to return the
               path to the closest node if the target is unreachable.
    * @param {Function} [options.heuristic] Heuristic function (see
    *          astar.heuristics).
    */
    search: function(graph, start, end, options) {
        graph.cleanDirty();
        options = options || {};
        var heuristic = options.heuristic || astar.heuristics.manhattan,
            closest = options.closest || false;

        var openHeap = getHeap(),
            closestNode = start; // set the start node to be the closest if required

        start.h = heuristic(start, end);

        openHeap.push(start);

        while(openHeap.size() > 0) {

            // Grab the lowest f(x) to process next.  Heap keeps this sorted for us.
            var currentNode = openHeap.pop();

            // End case -- result has been found, return the traced path.
            if(currentNode === end) {
                return pathTo(currentNode);
            }

            // Normal case -- move currentNode from open to closed, process each of its neighbors.
            currentNode.closed = true;

            // Find all neighbors for the current node.
            var neighbors = graph.neighbors(currentNode);

            for (var i = 0, il = neighbors.length; i < il; ++i) {
                var neighbor = neighbors[i];

                if (neighbor.closed || neighbor.isWall()) {
                    // Not a valid node to process, skip to next neighbor.
                    continue;
                }

                // The g score is the shortest distance from start to current node.
                // We need to check if the path we have arrived at this neighbor is the shortest one we have seen yet.
                var gScore = currentNode.g + neighbor.getCost(currentNode),
                    beenVisited = neighbor.visited;

                if (!beenVisited || gScore < neighbor.g) {

                    // Found an optimal (so far) path to this node.  Take score for node to see how good it is.
                    neighbor.visited = true;
                    neighbor.parent = currentNode;
                    neighbor.h = neighbor.h || heuristic(neighbor, end);
                    neighbor.g = gScore;
                    neighbor.f = neighbor.g + neighbor.h;
                    graph.markDirty(neighbor);
                    if (closest) {
                        // If the neighbour is closer than the current closestNode or if it's equally close but has
                        // a cheaper path than the current closest node then it becomes the closest node
                        if (neighbor.h < closestNode.h || (neighbor.h === closestNode.h && neighbor.g < closestNode.g)) {
                            closestNode = neighbor;
                        }
                    }

                    if (!beenVisited) {
                        // Pushing to heap will put it in proper place based on the 'f' value.
                        openHeap.push(neighbor);
                    }
                    else {
                        // Already seen the node, but since it has been rescored we need to reorder it in the heap
                        openHeap.rescoreElement(neighbor);
                    }
                }
            }
        }

        if (closest) {
            return pathTo(closestNode);
        }

        // No result was found - empty array signifies failure to find path.
        return [];
    },
    // See list of heuristics: http://theory.stanford.edu/~amitp/GameProgramming/Heuristics.html
    heuristics: {
        manhattan: function(pos0, pos1) {
            var d1 = Math.abs(pos1.x - pos0.x);
            var d2 = Math.abs(pos1.y - pos0.y);
            return d1 + d2;
        },
        diagonal: function(pos0, pos1) {
            var D = 1;
            var D2 = Math.sqrt(2);
            var d1 = Math.abs(pos1.x - pos0.x);
            var d2 = Math.abs(pos1.y - pos0.y);
            return (D * (d1 + d2)) + ((D2 - (2 * D)) * Math.min(d1, d2));
        }
    },
    cleanNode:function(node){
        node.f = 0;
        node.g = 0;
        node.h = 0;
        node.visited = false;
        node.closed = false;
        node.parent = null;
    }
};

/**
* A graph memory structure
* @param {Array} gridIn 2D array of input weights
* @param {Object} [options]
* @param {bool} [options.diagonal] Specifies whether diagonal moves are allowed
*/
function Graph(gridIn, options) {
    options = options || {};
    this.nodes = [];
    this.diagonal = !!options.diagonal;
    this.grid = [];
    for (var x = 0; x < gridIn.length; x++) {
        this.grid[x] = [];

        for (var y = 0, row = gridIn[x]; y < row.length; y++) {
            var node = new GridNode(x, y, row[y]);
            this.grid[x][y] = node;
            this.nodes.push(node);
        }
    }
    this.init();
}

Graph.prototype.init = function() {
    this.dirtyNodes = [];
    for (var i = 0; i < this.nodes.length; i++) {
        astar.cleanNode(this.nodes[i]);
    }
};

Graph.prototype.cleanDirty = function() {
    for (var i = 0; i < this.dirtyNodes.length; i++) {
        astar.cleanNode(this.dirtyNodes[i]);
    }
    this.dirtyNodes = [];
};

Graph.prototype.markDirty = function(node) {
    this.dirtyNodes.push(node);
};

Graph.prototype.neighbors = function(node) {
    var ret = [],
        x = node.x,
        y = node.y,
        grid = this.grid;

    // West
    if(grid[x-1] && grid[x-1][y]) {
        ret.push(grid[x-1][y]);
    }

    // East
    if(grid[x+1] && grid[x+1][y]) {
        ret.push(grid[x+1][y]);
    }

    // South
    if(grid[x] && grid[x][y-1]) {
        ret.push(grid[x][y-1]);
    }

    // North
    if(grid[x] && grid[x][y+1]) {
        ret.push(grid[x][y+1]);
    }

    if (this.diagonal) {
        // Southwest
        if(grid[x-1] && grid[x-1][y-1]) {
            ret.push(grid[x-1][y-1]);
        }

        // Southeast
        if(grid[x+1] && grid[x+1][y-1]) {
            ret.push(grid[x+1][y-1]);
        }

        // Northwest
        if(grid[x-1] && grid[x-1][y+1]) {
            ret.push(grid[x-1][y+1]);
        }

        // Northeast
        if(grid[x+1] && grid[x+1][y+1]) {
            ret.push(grid[x+1][y+1]);
        }
    }

    return ret;
};

Graph.prototype.toString = function() {
    var graphString = [],
        nodes = this.grid, // when using grid
        rowDebug, row, y, l;
    for (var x = 0, len = nodes.length; x < len; x++) {
        rowDebug = [];
        row = nodes[x];
        for (y = 0, l = row.length; y < l; y++) {
            rowDebug.push(row[y].weight);
        }
        graphString.push(rowDebug.join(' '));
    }
    return graphString.join('\n');
};

function GridNode(x, y, weight) {
    this.x = x;
    this.y = y;
    this.weight = weight;
}

GridNode.prototype.toString = function() {
    return '[' + this.x + ' ' + this.y + ']';
};

GridNode.prototype.getCost = function(fromNeighbor) {
    // Take diagonal weight into consideration.
    if (fromNeighbor && fromNeighbor.x !== this.x && fromNeighbor.y !== this.y) {
        return this.weight * 1.41421;
    }
    return this.weight;
};

GridNode.prototype.isWall = function() {
    return this.weight === 0;
};

function BinaryHeap(scoreFunction){
    this.content = [];
    this.scoreFunction = scoreFunction;
}

BinaryHeap.prototype = {
    push: function(element) {
        // Add the new element to the end of the array.
        this.content.push(element);

        // Allow it to sink down.
        this.sinkDown(this.content.length - 1);
    },
    pop: function() {
        // Store the first element so we can return it later.
        var result = this.content[0];
        // Get the element at the end of the array.
        var end = this.content.pop();
        // If there are any elements left, put the end element at the
        // start, and let it bubble up.
        if (this.content.length > 0) {
            this.content[0] = end;
            this.bubbleUp(0);
        }
        return result;
    },
    remove: function(node) {
        var i = this.content.indexOf(node);

        // When it is found, the process seen in 'pop' is repeated
        // to fill up the hole.
        var end = this.content.pop();

        if (i !== this.content.length - 1) {
            this.content[i] = end;

            if (this.scoreFunction(end) < this.scoreFunction(node)) {
                this.sinkDown(i);
            }
            else {
                this.bubbleUp(i);
            }
        }
    },
    size: function() {
        return this.content.length;
    },
    rescoreElement: function(node) {
        this.sinkDown(this.content.indexOf(node));
    },
    sinkDown: function(n) {
        // Fetch the element that has to be sunk.
        var element = this.content[n];

        // When at 0, an element can not sink any further.
        while (n > 0) {

            // Compute the parent element's index, and fetch it.
            var parentN = ((n + 1) >> 1) - 1, parent = this.content[parentN]; // jshint ignore:line
            // Swap the elements if the parent is greater.
            if (this.scoreFunction(element) < this.scoreFunction(parent)) {
                this.content[parentN] = element;
                this.content[n] = parent;
                // Update 'n' to continue at the new position.
                n = parentN;
            }
            // Found a parent that is less, no need to sink any further.
            else {
                break;
            }
        }
    },
    bubbleUp: function(n) {
        // Look up the target element and its score.
        var length = this.content.length,
            element = this.content[n],
            elemScore = this.scoreFunction(element);

        while(true) {
            // Compute the indices of the child elements.
            var child2N = (n + 1) << 1, child1N = child2N - 1; // jshint ignore:line
            // This is used to store the new position of the element, if any.
            var swap = null,
                child1Score;
            // If the first child exists (is inside the array)...
            if (child1N < length) {
                // Look it up and compute its score.
                var child1 = this.content[child1N];
                child1Score = this.scoreFunction(child1);

                // If the score is less than our element's, we need to swap.
                if (child1Score < elemScore){
                    swap = child1N;
                }
            }

            // Do the same checks for the other child.
            if (child2N < length) {
                var child2 = this.content[child2N],
                    child2Score = this.scoreFunction(child2);
                if (child2Score < (swap === null ? elemScore : child1Score)) {
                    swap = child2N;
                }
            }

            // If the element needs to be moved, swap it, and continue.
            if (swap !== null) {
                this.content[n] = this.content[swap];
                this.content[swap] = element;
                n = swap;
            }
            // Otherwise, we are done.
            else {
                break;
            }
        }
    }
};

return {
    astar: astar,
    Graph: Graph
};

});

},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\states\\boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/images/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      //this.game.stage.scale.pageAlignHorizontally = true;
      this.game.scale.scaleMode = Phaser.ScaleManager.RESIZE;
    } else {
      this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.game.scale.minWidth =  480;
      this.game.scale.minHeight = 260;
      this.game.scale.maxWidth = 640;
      this.game.scale.maxHeight = 480;
      this.game.scale.forceLandscape = true;
      this.game.scale.pageAlignHorizontally = true;
      this.game.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\states\\game.js":[function(require,module,exports){
/*
Main testing environment.
*/

var Renderables = require('../functionAccess/Renderables');
var UIBuilder = require('../ui/UIBuilder');
var ModuleBuilder = require('../entities/ModuleBuilder');
var CubeGroup = require('../entities/cube_group');
var Hackable = require('../entities/Hackable');
var Emitter = require('../effects/Emitter');
var Mouse = require('../entities/mouse');
var Bullet = require('../entities/Bullet');
var SoundManager = require('../entities/sound_manager');
var Shop = require('../ui/shop');
var Helper = require('../entities/helper');
var Cheating = require('../entities/cheating');

var playerStartX = 1200, playerStartY = 1200;
var bg, bg2;
var numRoids;
var maxRoids = 100;
var newModuleSpeed = 1000;
var asteroids, asteroidList;
var leftKey, rightKey;
var warning;
var timer;

var Game = function () { };

module.exports = Game;

Game.prototype = {
	
  create: function () {
	this.game.world.setBounds(0, 0, 8000, 4000);
	
	numRoids = 0;
	//Create the two background images
   bg = this.game.add.sprite(0, 0, 'earthNight');
	bg2 = this.game.add.sprite(-8000, 0, 'earthNight');
	
	//Set up physics
	this.game.physics.startSystem(Phaser.Physics.P2JS);
	this.game.physics.p2.setImpactEvents(true);
	//add collision group
	this.collisionGroup = this.game.physics.p2.createCollisionGroup();
	
   this.simplify = true; // prevents things that get in the way of debugging
	
	this.mouse = new Mouse(this.game, this.input);
   
	this.updateDependents = [];

	//create Renderables class
	this.renderables = new Renderables();
	//create the UIBuilder
	this.uiBuilder = new UIBuilder(this, this.renderables);   
	//create ModuleBuilder and store it in this game state object
	this.moduleBuilder = new ModuleBuilder(this);
	//create and store the core module
	this.coreModule = this.moduleBuilder.build('core', playerStartX, playerStartY, true);
	this.game.camera.x = playerStartX;
	this.game.camera.y = playerStartY;
	this.cubeWidth = this.coreModule.cube.width;
	this.cubeBuffer = 2;
	this.testVar = 7;
	var playerGroup = new CubeGroup(this, this.coreModule.cube);
	this.updateDependents.push(playerGroup);
	this.player = playerGroup;
	this.player.isPlayer = true;
   
	this.mouse = new Mouse(this.game, this.input, playerGroup);
	this.player.isPlayer = true;
	
	//Create the emitter for the binary particle effects
	this.BinaryEmitter = new Emitter(this);
	
	//test hackable object
	// this.testHack = new Hackable(this, 1600, 1200, 'hackable1', 400);
	
	asteroids = this.game.add.group();
	asteroids.enableBody = true;
	asteroids.physicsBodyType = Phaser.Physics.P2JS;
	asteroidList = new Phaser.ArraySet();
	if (!this.simplify) { this.generateAsteroids(); }
	
	timer = this.game.time.create(false);
	warning = this.game.add.image(this.game.camera.x, this.game.camera.y, 'warning');
	warning.kill();
	
	leftKey = this.game.input.keyboard.addKey(Phaser.Keyboard.A);
	rightKey = this.game.input.keyboard.addKey(Phaser.Keyboard.D);
	
	this.pauseText = this.game.add.text(-1000, -1000, 'Press \'Esc\' To Unpause');
	this.pauseText.font = 'Roboto';
    this.pauseText.fontSize = 64;
    this.pauseText.fill = '#ffffff';
	this.pauseKey = this.game.input.keyboard.addKey(27);
	this.pauseKey.onDown.add(this.pauseMenu, this);

   this.levelData = JSON.parse(this.game.cache.getText('level_one'));
   this.loadData();

   this.juicy = this.game.plugins.add(new Phaser.Plugin.Juicy(this));
   this.game.camera.follow(this.coreModule.cube);
	
	this.mainSong = this.game.add.audio('mainSong', 1, true);
	if (!this.simplify) { this.mainSong.play('',0,1,true,true); }
   
   this.soundManager = new SoundManager(this);
   this.shop = new Shop(this);
   this.updateDependents.push(this.shop);
   this.helper = new Helper(this);
   this.updateDependents.push(this.helper);
   this.cheating = new Cheating(this);
  },
  
  restartLevel: function() {
	this.mainSong.stop();
	this.game.state.start(playerState.currentLevel);
  },
  
	pauseMenu: function() {
		
		if(this.game.paused === false) {
			this.pauseText.x = this.game.camera.x + (this.game.camera.width / 2) - (this.pauseText.width / 2);
			this.pauseText.y = this.game.camera.y + (this.game.camera.height / 2) - (this.pauseText.height / 2);
			this.game.paused = true;
		}
		else {
			this.game.paused = false;
			this.pauseText.x = -1000;
			this.pauseText.y = -1000;
		}
	},
  
  loadData: function() {
      var myLevel = this.levelData['level_one'];
      for (var key in myLevel) {
         if (myLevel.hasOwnProperty(key)) {
            var element = myLevel[key];
            if (element.hasOwnProperty('blueprint')) { // enemy type
               var enemyX = element['x_pos'];
               var enemyY = element['y_pos'];
               var enemyGroup = new CubeGroup(this, undefined);
               this.updateDependents.push(enemyGroup);
               var blueprint = element['blueprint'];
               for (var row = 0; row < blueprint.length; row++) {
                  for (var col = 0; col < blueprint[row].length; col++) {
                     var type = blueprint[row][col];
                     if (type !== 'none') {
                        var newModule = this.moduleBuilder.build(type, enemyX + row * (this.cubeWidth + this.cubeBuffer),
                        enemyY - col * (this.cubeWidth + this.cubeBuffer), false);
                        newModule.cube.tag = 'enemy_module';
                        var point = new Phaser.Point(row, col);
                        enemyGroup.add(newModule.cube, point);
                     }
                  }
               }
               var aiType = element['type'];
               enemyGroup.giveAI(aiType, this.player);
            }
         }
      }
  },

  update: function () {
	if(leftKey.isDown) {
		if(this.coreModule.cube.body.angularVelocity > -9) { 
			this.coreModule.cube.body.angularForce += -7.5 * Math.pow(this.player.numCubes, 1.65);
		}
	}
	if(rightKey.isDown) {
		if(this.coreModule.cube.body.angularVelocity < 9) {
			this.coreModule.cube.body.angularForce += 7.5 * Math.pow(this.player.numCubes, 1.65);
		}
	}
	this.mouse.update();
	this.scrollBG();
 
	for (var i = 0; i < this.updateDependents.length; i++) {
		if (this.updateDependents[i].update) {
			this.updateDependents[i].update();
		}
	}
	//Warning Code
	if(this.coreModule.cube.x + (Math.max(this.player.cubesWidth(), this.player.cubesHeight()) / 2 * 64) > 8000 ||
	this.coreModule.cube.x - (Math.max(this.player.cubesWidth(), this.player.cubesHeight()) / 2 * 64) < 0 ||
	this.coreModule.cube.y + (Math.max(this.player.cubesWidth(), this.player.cubesHeight()) / 2 * 64) > 4000 ||
	this.coreModule.cube.y - (Math.max(this.player.cubesWidth(), this.player.cubesHeight()) / 2 * 64) < 0) {
		if(timer.length === 0) {
			warning.revive();
			timer.loop(Phaser.Timer.SECOND * 5, this.resetPlayer, this);
			timer.start();
		}
	}
	else {
		if(warning.alive === true) {
			warning.kill();
		}
		if(timer.length > 0) {
			timer.stop(true);
		}
	}
	warning.x = this.game.camera.x;
	warning.y = this.game.camera.y;
  },
  
  render: function () {
	this.mouse.render();
	this.renderables.renderAll();
  },
  
	scrollBG: function() {
		bg.x += 0.125;
		if(bg.x >= 8000) {
			bg.x = 0;
		}
		bg2.x += 0.125;
		if(bg2.x >= 8000) {
			bg2.x = 0;
		}
	},
	
	generateAsteroids: function() {
		for(;numRoids < maxRoids; numRoids++) {
			var randX = this.game.rnd.integerInRange(0, this.game.world.width);
			var randY = this.game.rnd.integerInRange(0, this.game.world.height);
			
			while(randX < this.coreModule.cube.x - (this.player.cubesWidth() / 2 + 100) && randX > this.coreModule.cube.x + (this.player.cubesWidth() / 2 + 100) &&
			randY < this.coreModule.cube.y - (this.player.cubesHeight() / 2 + 100) && randY > this.coreModule.cube.y + (this.player.cubesHeight() / 2 + 100)) {
				randX = this.game.rnd.integerInRange(0, this.game.world.width);
				randY = this.game.rnd.integerInRange(0, this.game.world.height);
			}
			
			var asteroid = asteroids.create(randX, randY, 'asteroid');
			
			asteroid.body.clearShapes(); 
			asteroid.body.loadPolygon('asteroidPolygon', 'asteroid'); //Change the collision detection from an AABB to a polygon
			asteroid.body.damping = this.game.rnd.realInRange(0, 0.3) * this.game.rnd.integerInRange(0, 1) * this.game.rnd.integerInRange(0, 1);
			asteroid.body.rotation = this.game.rnd.realInRange(0, 2 * Math.PI);
			asteroid.body.force.x = this.game.rnd.integerInRange(-10, 10) * 750;
			asteroid.body.force.y = this.game.rnd.integerInRange(-10, 10) * 750;
			asteroid.body.setCollisionGroup(this.collisionGroup);
			asteroid.body.collides(this.collisionGroup);
			asteroid.body.collideWorldBounds = false;
			asteroid.autoCull = true;
			asteroid.checkWorldBounds = true;
			asteroid.events.onOutOfBounds.add(this.resetAsteroid, {roid: asteroid, coreModule: this.coreModule, player: this.player, game: this.game});
			asteroidList.add(asteroid);
		}
	},
	
	resetAsteroid: function() {
		var randX = this.game.rnd.integerInRange(0, this.game.world.width);
		var randY = this.game.rnd.integerInRange(0, this.game.world.height);
			
		while(randX < this.coreModule.cube.x - (this.player.cubesWidth() / 2 + 100) && randX > this.coreModule.cube.x + (this.player.cubesWidth() / 2 + 100) &&
			randY < this.coreModule.cube.y - (this.player.cubesHeight() / 2 + 100) && randY > this.coreModule.cube.y + (this.player.cubesHeight() / 2 + 100)) {
				randX = this.game.rnd.integerInRange(0, this.game.world.width);
				randY = this.game.rnd.integerInRange(0, this.game.world.height);
		}
		this.roid.x = randX;
		this.roid.y = randY;
		this.roid.body.rotation = this.game.rnd.realInRange(0, 2 * Math.PI);
		this.roid.body.force.x = this.game.rnd.integerInRange(-10, 10) * 750;
		this.roid.body.force.y = this.game.rnd.integerInRange(-10, 10) * 750;
	},
	
	resetPlayer: function() {
		if(this.coreModule.cube.x + (Math.max(this.player.cubesWidth(), this.player.cubesHeight()) / 2 * 64) > 8000) {
			this.coreModule.cube.body.moveLeft(this.player.numCubes * 750);
		}
		if(this.coreModule.cube.x - (Math.max(this.player.cubesWidth(), this.player.cubesHeight()) / 2 * 64) < 0) {
			this.coreModule.cube.body.moveRight(this.player.numCubes * 750);
		}
		if(this.coreModule.cube.y + (Math.max(this.player.cubesWidth(), this.player.cubesHeight()) / 2 * 64) > 4000) {
			this.coreModule.cube.body.moveUp(this.player.numCubes * 750);
		}
		else if(this.coreModule.cube.y - (Math.max(this.player.cubesWidth(), this.player.cubesHeight()) / 2 * 64) < 0) {
			this.coreModule.cube.body.moveDown(this.player.numCubes * 750);
		}
	},
};




























},{"../effects/Emitter":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\effects\\Emitter.js","../entities/Bullet":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\Bullet.js","../entities/Hackable":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\Hackable.js","../entities/ModuleBuilder":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\ModuleBuilder.js","../entities/cheating":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\cheating.js","../entities/cube_group":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\cube_group.js","../entities/helper":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\helper.js","../entities/mouse":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\mouse.js","../entities/sound_manager":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\entities\\sound_manager.js","../functionAccess/Renderables":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\functionAccess\\Renderables.js","../ui/UIBuilder":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\ui\\UIBuilder.js","../ui/shop":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\ui\\shop.js"}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\states\\menu.js":[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

var menuSong;

Menu.prototype = {
	
  pos: [-25, 25, 75],
  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;
	this.diff = 768;
	this.creditsSpeed = 16;
	this.creditsOpening = false;
	this.creditsClosing = false;
	this.bg = this.game.add.sprite(-4500, -500, 'earthNight');
	this.bg2 = this.game.add.sprite(-12500, -500, 'earthNight');
	
	menuSong = this.game.add.audio('menuSong');
	menuSong.play('',0,1,true,true);
    
    this.titleButton = this.add.image(this.world.centerX, this.world.centerY + 32, 'title');
    this.titleButton.anchor.setTo(0.5, 0.5);
    
    this.selectButton = this.addButton(0, 'startGameButton', this.changeToGame, this);
  	this.selectButton.anchor.setTo(0.5, 0.5);
  	
  	this.manualButton = this.addButton(1, 'missionSelectButton', this.changeToMenu, this);
  	this.manualButton.anchor.setTo(0.5, 0.5);
  	
  	this.creditsButton = this.addButton(2, 'creditsButton', this.doCredits, {game: this, button: 'creditsButton'});
  	this.creditsButton.anchor.setTo(0.5, 0.5);
	
	this.credits = this.add.image(this.world.centerX - 360, this.world.centerY - 256 + this.diff, 'credits');
	this.credits.kill();
	this.creditsCloseButton = this.addButton(10, 'closeButton', this.doCredits, {game: this, button: 'closeCreditsButton'});
	this.creditsCloseButton.x = this.credits.x + this.credits.width - 32;
	this.creditsCloseButton.y = this.credits.y;
  },

  addButton: function(button, img, func, context){
    return this.add.button(this.world.centerX, this.world.centerY + (button) * 90, img, func, context, 1, 0, 2);
  },
  
  draw: function(){
  },
  
  changeToGame: function(){
	if(!this.credits.alive) {
		menuSong.stop();
		this.game.state.start('Game');
	}
  },  
  
  changeToMenu: function(){
	if(!this.credits.alive) {
		menuSong.stop();
		this.game.state.start('Menu');
	}
  },
  
  doCredits: function() {
	if(!this.game.credits.alive && !this.game.creditsOpening && !this.game.creditsClosing && this.button === 'creditsButton') {
	  this.game.credits.revive();
	  this.game.diff = 768;
	  this.game.creditsOpening = true;
   }
   else if(this.game.credits.alive && !this.game.creditsClosing && !this.game.creditsOpening && this.button === 'closeCreditsButton') {
	  this.game.creditsClosing = true;
   }
  },
  /*
  changeState: function(state){
  	switch(state){
  		case 'game':
  			this.game.state.start('Game');
  			break;
  		case 'menu':
  			this.game.state.start('Menu');
  			break;
  		default:
  			break;
  	}
  },
  */
	update: function () {
		this.bg.x += 0.125;
		if(this.bg.x >= 0) {
			this.bg.x = -8000;
		}
		this.bg2.x += 0.125;
		if(this.bg2.x >= 0) {
			this.bg2.x = -8000;
		}
		if(this.creditsOpening === true) {	
		  this.diff -= this.creditsSpeed;
			if(this.diff <= 0) {
				this.creditsOpening = false;
			}
		}
		else if(this.creditsClosing === true) {
		  this.diff += this.creditsSpeed;
			if(this.diff >= 768) {
				this.credits.kill();
				this.creditsClosing = false;
			}
		}
		this.credits.y = this.world.centerY - 256 + this.diff;
		this.creditsCloseButton.x = this.credits.x + this.credits.width - 32;
		this.creditsCloseButton.y = this.credits.y;
	},

};

},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\states\\preloader.js":[function(require,module,exports){
var Preloader = function (game) {
  game = null;
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(640, 360, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
	
	//Load Spritesheets
	this.load.spritesheet('core', 'assets/images/coreSheet.png', 64, 64); 
	this.load.spritesheet('thruster', 'assets/images/thrusterSheet.png', 64, 64);
	this.load.spritesheet('gun', 'assets/images/gunSheet.png', 64, 64);
	this.load.spritesheet('hacker', 'assets/images/hackSheet.png', 64, 64);
	this.load.spritesheet('shieldButton', 'assets/images/shieldButtonSheet.png', 256, 82);
	this.load.spritesheet('solarPanelButton', 'assets/images/solarPanelButtonSheet.png', 256, 82);
	this.load.spritesheet('thrusterButton', 'assets/images/thrusterButtonSheet.png', 256, 82);
	this.load.spritesheet('gunButton', 'assets/images/gunButtonSheet.png', 256, 82);
	this.load.spritesheet('hackButton', 'assets/images/hackButtonSheet.png', 256, 82);
	this.load.spritesheet('hackable', 'assets/images/hackableSheet.png', 64, 64);
	this.load.spritesheet('shopButton', 'assets/images/shopButtonSheet.png', 32, 32);
	this.load.spritesheet('closeButton', 'assets/images/closeButtonSheet.png', 32, 32);
	
	//Load Images
	this.load.image('earthNight', 'assets/images/bg_earthNightSmall.jpg');
	this.load.image('credits', 'assets/images/credits.png');
	this.load.image('bullet', 'assets/images/bullet.png');
	this.load.image('shield', 'assets/images/shield.png');
	this.load.image('solarPanel', 'assets/images/solarPanel.png');
	this.load.image('asteroid', 'assets/images/asteroid.png');
	this.load.image('shopPanel', 'assets/images/shopBackPanel.png');
	this.load.image('warning', 'assets/images/warning.png');
	this.load.image('be', 'assets/images/be.png');
    
	//Load Fonts
	this.load.script('webfont', '//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js');
	
	//Load JSON Files
	this.load.atlasJSONHash('connections', 'assets/images/connections.png', 'assets/json/connections.json');
	this.load.atlasJSONHash('connections', 'assets/images/connections.png', 'assets/json/connections.json');
	this.load.atlasJSONHash('helpButton', 'assets/images/helpButtonSheet.png', 'assets/json/help_button.json');
	this.load.atlasJSONHash('arrowButton', 'assets/images/arrowButtonSheet.png', 'assets/json/arrow_button.json');
	this.load.physics('module_physics', 'assets/json/module_physics.json');
	this.load.physics('asteroidPolygon', 'assets/json/asteroidPolygon.json');
	this.load.text('level_one', 'assets/json/level_one.json');
	this.load.text('tutorial_text', 'assets/json/tutorial_text.json');
	
	//Load Sound Effects
	this.load.audio('downClick', 'assets/sound/downClick.ogg');
	this.load.audio('hoverClick', 'assets/sound/hoverClick.ogg');
	this.load.audio('error', 'assets/sound/error.ogg');
	this.load.audio('cashRegister', 'assets/sound/cashRegister.ogg');
	this.load.audio('gun', 'assets/sound/gun.ogg');
	this.load.audio('hacking', 'assets/sound/hacking.ogg');
	this.load.audio('moduleImpact', 'assets/sound/moduleImpact.ogg');
	this.load.audio('moduleConnect', 'assets/sound/moduleConnect.ogg');
	this.load.audio('modulePower', 'assets/sound/modulePower.ogg');
	this.load.audio('thrusterLoop', 'assets/sound/thrusterLoop.ogg');
	
	this.load.text('tutorial_text', 'assets/json/tutorial_text.json');
	// this.load.script('webfont', '//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js');
	this.load.atlasJSONHash('helpButton', 'assets/images/helpButtonSheet.png', 'assets/json/help_button.json');
	this.load.atlasJSONHash('arrowButton', 'assets/images/arrowButtonSheet.png', 'assets/json/arrow_button.json');
	//menu buttons
	this.load.spritesheet('startGameButton', 'assets/images/startGameButtonSheet.png', 256, 82);
	this.load.spritesheet('missionSelectButton', 'assets/images/missionSelectButtonSheet.png', 256, 82);
	this.load.spritesheet('creditsButton', 'assets/images/creditsButtonSheet.png', 256, 82);
	this.load.image('title', 'assets/images/title.png');

	
	
	//Load Music
	this.load.audio('menuSong', 'assets/sound/Yet Another.ogg');
	this.load.audio('mainSong', 'assets/sound/Top (down) Night.ogg');

  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      // this.game.state.start('Menu');
      this.game.state.start(playerState.currentLevel); // jshint ignore:line
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\states\\splash.js":[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\ui\\ProgressBar.js":[function(require,module,exports){
//NOTE: DON'T USE this code to create a ProgressBar. Instead, use the UIBuilder object and call buildProgressBar

var ProgressBar = function(setType, setMaxValue, setGraphics, setRenderables) {
	this.type = setType; //Two types, "growing" (starts at 0, triggers event when full) 
						 //and "shrinking" (starts full, triggers at 0)
	this.bgBorderSize = 2;			//default size of background border
	this.bgBorderColor = 0xAAAAAA;	//default color of background border
	this.bgColor = 0x888888;		//default color of background
	this.paddingHoriz = 5;			//default sum of padding on left and right side inner value bar
	this.paddingVert = 5;			//default sum (i.e. half on each side) of vertical padding of inner value bar
	this.valueBorderSize = 1;		//default size of value border
	this.valueBorderColor = 0x8888FF; //default color of value border
	this.valueColor = 0x000099;		//default color of inner value bar
	this.x = null;
	this.y = null;
	this.width = null;
	this.height = null;
	this.maxValue = setMaxValue;
	this.graphics = setGraphics; //store graphics class (used to draw bar)
	this.renderables = setRenderables;
	
	this.onEvent = function() {}; //overwrite this function to make whatever you want happen when progressBar reaches limit
	
	//switch(this.type) {
	//case 'growing' : 
	if(setType === 'growing') {
		this.value = 0;
		//tryTrigger is called automatically when you add/subtract value, and will trigger the onEvent() function
		this.tryTrigger = function() {
			if(this.value >= this.maxValue) {
				this.onEvent();
			}
		};
		//break;
	}
	else if(setType === 'shrinking') {
	//case 'shrinking' :
		this.value = this.maxValue;
		this.tryTrigger = function() {
			if(this.value <= 0) {
				this.onEvent();
			}
		};
	}
};

ProgressBar.prototype.constructor = ProgressBar;

ProgressBar.prototype.destroy = function() {
	this.graphics.clear();
	this.renderables.unsubscribe(this);
};

//To subtract value, just use negative numbers as argument i.e. foo.addValue(-5);
ProgressBar.prototype.addValue = function (addThis) {
	this.value += addThis;
	if(this.value > this.maxValue) {
		this.value = this.maxValue;
	}
	if(this.value < 0) {
		this.value = 0;
	}
	this.tryTrigger();
};

//Sets the location where progress bar is rendered
ProgressBar.prototype.setLocation = function(setX, setY) {
	this.x = setX;
	this.y = setY;
};

//Sets the size of the progress bar
ProgressBar.prototype.setSize = function(setWidth, setHeight) {
	this.width = setWidth;
	this.height = setHeight;
};

ProgressBar.prototype.setStyle = function(bgBorderSize, bgBorderColor, bgColor, paddingHoriz, paddingVert, valueBorderSize, valueBorderColor, valueColor) {
	this.bgBorderSize = bgBorderSize;
	this.bgBorderColor = bgBorderColor;
	this.bgColor = bgColor;
	this.paddingHoriz = paddingHoriz;
	this.paddingVert = paddingVert;
	this.valueBorderSize = valueBorderSize;
	this.valueBorderColor = valueBorderColor;
	this.valueColor = valueColor;
};

//update for progress bar, called just before drawing progress bar
//Overwrite this function if desired
ProgressBar.prototype.update = function() {};

//Renders progressBar
ProgressBar.prototype.render = function() {
	this.update();
	this.graphics.clear();
	//Draw background of bar
	this.graphics.lineStyle(this.bgBorderSize, this.bgBorderColor, 1); //sets border color and size
	this.graphics.beginFill(this.bgColor); //sets color of background fill
	this.graphics.drawRect(this.x-this.width/2, this.y-this.height/2, this.width, this.height);
	this.graphics.endFill();
	//Draw value of bar
	var percentage = this.value / this.maxValue;
	var barWidth = this.width - this.paddingHoriz;
	var barHeight = this.height - this.paddingVert;
	this.graphics.lineStyle(this.valueBorderSize, this.valueBorderColor, 1);
	this.graphics.beginFill(this.valueColor);
	this.graphics.drawRect(this.x-(barWidth/2), this.y-(barHeight/2), barWidth*percentage, barHeight);
	this.graphics.endFill();
};

module.exports = ProgressBar;
},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\ui\\UIBuilder.js":[function(require,module,exports){
var ProgressBar = require('./ProgressBar');
var Banner = require('./banner');

var UIBuilder = function(setGameState, setRenderables) {
	//Ensure that cannot create multiple instances of this class
	if(UIBuilder.prototype.exists) {
		return UIBuilder.prototype.existingReference;
	}
	
	this.gameState = setGameState;
	this.renderables = setRenderables;
	//Create and store a graphics object (used for stuff like drawing rectangles)
	UIBuilder.prototype.exists = true;
	UIBuilder.prototype.existingReference = this;
};

UIBuilder.prototype.constructor = UIBuilder;
//These var's help create the singleton functionality
UIBuilder.prototype.exists = false;
UIBuilder.prototype.existingReference = null;

//Use this function to create a progress bar
//Usage: type: can be "growing" or "shrinking", this will effect if bar starts at 0 and goes up or vis versa
//		 maxValue: sets the max value of the progress bar, i.e. using 100 creates a bar from 0 to 100
//		 x,y: sets location
//		 DON'T FORGET to overwrite the onEvent() function for the progress bar after creating it
//			-onEvent() is automatically called when bar fills/shrinks past limit (depending on bar type)
UIBuilder.prototype.buildProgressBar = function(type, x, y, width, height, maxValue) {
	//create and format new prog bar
	var graphics = this.gameState.game.add.graphics(0,0);
	var newProgBar = new ProgressBar(type, maxValue, graphics, this.renderables);
	newProgBar.setLocation(x,y);
	newProgBar.setSize(width, height);
	//subscribe to 'renderables' so that render() is called automatically
	this.renderables.subscribe(newProgBar);
	return newProgBar;
};

UIBuilder.prototype.buildBanner = function(xRatio, yRatio, texts) {
   var graphics = this.gameState.game.add.graphics(0, 0);
   var newBanner = new Banner(this.gameState, xRatio, yRatio, texts, graphics, this.renderables);
   this.renderables.subscribe(newBanner);
   return newBanner;
};

module.exports = UIBuilder;
},{"./ProgressBar":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\ui\\ProgressBar.js","./banner":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\ui\\banner.js"}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\ui\\banner.js":[function(require,module,exports){
var Utils = require('../utils');

//NOTE: DON'T USE this code to create a Banner. Instead, use the UIBuilder object and call buildBanner
var Banner = function(state, xRatio, yRatio, textJSON, graphics, renderables) {
   this.bgBorderSize = 6;			//default size of background border
	this.bgBorderColor = 0xffffff;	//default color of background border
	this.bgColor = 0x4a4a4a;		//default color of background
   this.shadowOffsetX = 3;
   this.shadowOffsetY = 3;
   this.shadowColor = 'rgba(0,0,0,0.9)';
   this.shadowBlur = 5;
   this.normalText = '#ffffff';
   this.highlightText = '#00ff00';
   this.textWrapPadding = 10;
   this.offScreenPadding = -200;
   this.textJSON = textJSON;
   this.state = state;
   this.game = state.game;
   this.cam = this.game.camera;
   this.sm = this.state.soundManager;
   this.xRatio = xRatio;
   this.yRatio = yRatio;
   this.graphics = graphics;
   this.renderables = renderables;
   this.width = 400;
   this.height = 200;
   this.index = 0;
   this.x = 0;
   this.hideBuffer = -50;
   this.hideHeight = -this.height - this.hideBuffer;
   this.y = this.cam.y - this.cam.height / 2 - this.hideHeight;
   this.slideY = this.hideHeight;
   this.goalY = this.y;
   this.slideRate = 0.2;
   this.visible = false;
   // add buttons
   this.rightButton = this.game.add.button(0, 0, 'arrowButton', this.nextIndex, this, 1, 0, 2);
	this.rightButton.onInputOver.add(this.sm.playHoverClick, this.sm);
	this.rightButton.onInputDown.add(this.sm.playDownClick, this.sm);
   this.leftButton = this.game.add.button(0, 0, 'arrowButton', this.prevIndex, this, 1, 0, 2);
	this.leftButton.onInputOver.add(this.sm.playHoverClick, this.sm);
	this.leftButton.onInputDown.add(this.sm.playDownClick, this.sm);
   this.leftButton.scale.x = -1;
   this.group = new Phaser.Group(this.game);
   this.group.add(this.graphics);
   this.group.add(this.rightButton);
   this.group.add(this.leftButton);
   this.addTexts();
   this.game.world.bringToTop(this.group);
   this.debug = false;
};

Banner.prototype.constructor = Banner;

Banner.prototype.destroy = function() {
	this.graphics.clear();
	this.renderables.unsubscribe(this);
};

Banner.prototype.update = function() {
   // TODO: add layer groups to other things
   this.game.world.bringToTop(this.group);
   // my pos
   this.x = this.cam.x + this.cam.width * this.xRatio;
   if (this.visible) {
      this.goalY = this.cam.height / 2;
   } else {
      this.goalY = this.hideHeight;
   }
   this.slideY = Utils.lerp(this.slideY, this.goalY, this.slideRate);
   if (this.debug) { console.log('this.cam.y:', this.cam.y, 'this.slideY:', this.slideY, 'this.y:', this.y); }
   this.y = this.cam.y + this.slideY;
   // text pos
   var curText = this.textObjs[this.index];
   curText.x = this.x;
   curText.y = this.y;
   // button pos
   this.rightButton.x = this.x + this.width / 2 + this.rightButton.width / 2;
   this.rightButton.y = this.y - this.rightButton.height / 2;
   this.leftButton.x = this.x - this.width / 2 + this.leftButton.width / 2;
   this.leftButton.y = this.y - this.leftButton.height / 2;
};

Banner.prototype.addTexts = function() {
   if (!this.textObs) {
      this.textObjs = [];
   }
   var textDefs = JSON.parse(this.game.cache.getText(this.textJSON));
   var textArray = textDefs['text'];
   var textColors = textDefs['colors'];
   for (var i = 0; i < textArray.length; i++) {
      var text = textArray[i];
      var newText = this.game.add.text(this.offScreenPadding, this.offScreenPadding, text);
      newText.font = 'Roboto';
      newText.fontSize = 24;
      newText.align = 'center';
      newText.fill = this.normalText;
      newText.wordWrap = true;
      newText.wordWrapWidth = this.width - this.textWrapPadding;
      newText.anchor.set(0.5);
      newText.setShadow(this.shadowOffsetX, this.shadowOffsetY, this.shadowColor, this.shadowBlur);
      var newColors = textColors[i];
      for (var j = 0; j < newColors.length; j++) {
         newText.addColor(this.highlightText, newColors[j]);
         j++;
         newText.addColor(this.normalText, newColors[j]);
      }
      this.textObjs.push(newText);
      this.group.add(newText);
   }
};

Banner.prototype.render = function() {
	this.update();
	this.graphics.clear();
	//Draw background
	this.graphics.lineStyle(this.bgBorderSize, this.bgBorderColor, 1); //sets border color and size
	this.graphics.beginFill(this.bgColor); //sets color of background fill
	this.graphics.drawRect(this.x-this.width/2, this.y-this.height/2, this.width, this.height);
	this.graphics.endFill();
};

Banner.prototype.show = function() {
   // this.goalY = this.cam.y + this.cam.height * this.yRatio;
   this.visible = true;
};

Banner.prototype.hide = function() {
   // this.goalY = this.hideHeight;
   this.visible = false;
};

Banner.prototype.toggle = function() {
  if (this.visible) {
     this.hide();
  } else {
     this.show();
  }  
};

Banner.prototype.hideCurText = function() {
  this.textObjs[this.index].x = this.textObjs[this.index].y = 0; 
};

Banner.prototype.nextIndex = function() {
   this.hideCurText();
   this.index++;
   if (this.index >= this.textObjs.length) {
      this.index = 0;
   }
};

Banner.prototype.prevIndex = function() {
   this.hideCurText();
   this.index--;
   if (this.index < 0) {
      this.index = this.textObjs.length - 1;
   }
};

module.exports = Banner;









},{"../utils":"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\utils.js"}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\ui\\shop.js":[function(require,module,exports){
var Shop = function(state) {
   // initial variables
	this.state = state;
   this.game = this.state.game;
   this.cam = this.game.camera;
   this.sm = this.state.soundManager;
   this.mouse = this.state.mouse;
   this.money = 500;
   this.shopSpeed = 1;
   this.diff = 0;
   this.newModuleSpeed = 1500;
   // create button
   this.shopButton = this.game.add.button(this.game.camera.x + this.game.camera.width - 48, 16, 'shopButton', this.useShopButton, this, 1, 0, 2);
	this.shopButton.onInputOver.add(this.sm.playHoverClick, this.sm);
	this.shopButton.onInputDown.add(this.sm.playDownClick, this.sm);
   // create text
   this.moneyText = this.game.add.text(this.shopButton.x - 8, this.shopButton.y + 48, this.money);
   this.moneyText.font = 'VT323';
   this.moneyText.fontSize = 24;
   this.moneyText.fill = '#ffffff';
   this.moneyText.text = this.money;
	this.be = this.game.add.image(this.moneyText.x + this.moneyText.width + 8, this.moneyText.y, 'be');
   // create sounds
   this.cashRegister = this.game.add.audio('cashRegister');
   this.cashRegister.allowMultiple = true;
   this.error = this.game.add.audio('error');
   // add controls
   this.addMoneyKey = this.game.input.keyboard.addKey(Phaser.Keyboard.K);
	this.addMoneyKey.onDown.add(this.debugAddMoney, this);
   // create buttons
	this.shopPanel = this.game.add.image(this.cam.x + this.cam.width + 256 + 16, this.cam.y + 16, 'shopPanel');
	this.shopPanel.kill();
	this.shieldButton = this.game.add.button(this.cam.x + this.cam.width - this.diff, this.cam.y + 52 + (88 * 1), 'shieldButton', this.purchaseModule, {state: this, key: 'shield'}, 1, 0, 2);
	this.formatButton(this.shieldButton);
	this.solarPanelButton = this.game.add.button(this.cam.x + this.cam.width - this.diff, this.cam.y + 52 + (88 * 2), 'solarPanelButton', this.purchaseModule, {state: this, key: 'solarPanel'}, 1, 0, 2);
	this.formatButton(this.solarPanelButton);
	this.thrusterButton = this.game.add.button(this.cam.x + this.cam.width - this.diff, this.cam.y + 52 + (88 * 3), 'thrusterButton', this.purchaseModule, {state: this, key: 'thruster'}, 1, 0, 2);
	this.formatButton(this.thrusterButton);
	this.gunButton = this.game.add.button(this.cam.x + this.cam.width - this.diff, this.cam.y + 52 + (88 * 4), 'gunButton', this.purchaseModule, {state: this, key: 'gun'}, 1, 0, 2);
	this.formatButton(this.gunButton);
	this.hackButton = this.game.add.button(this.cam.x + this.cam.width - this.diff, this.cam.y + 52 + (88 * 5), 'hackButton', this.purchaseModule, {state: this, key: 'hacker'}, 1, 0, 2);
	this.formatButton(this.hackButton);
	this.shopButton = this.game.add.button(this.cam.x + this.cam.width - 48, 16, 'shopButton', this.useShopButton, this, 1, 0, 2);
	this.shopButton.onInputOver.add(this.sm.playHoverClick, this.sm);
	this.shopButton.onInputDown.add(this.sm.playDownClick, this.sm);
};

Shop.prototype.constructor = Shop;

Shop.prototype.update = function() {
   // find diff
	if(this.shopMenuOpening === true) {	
      this.diff += this.shopSpeed * this.game.time.elapsed;
		if(this.diff >= 276) {
			this.shopMenuOpening = false;
			this.addShopButtons();
		}
	}
	else if(this.shopMenuClosing === true) {
      this.diff -= this.shopSpeed * this.game.time.elapsed;
		if(this.diff <= 0) {
			this.shopPanel.kill();
			this.shopMenuClosing = false;
		}
	}
   // update opening button position
   this.shopButton.x = this.cam.x + this.cam.width - 48 - this.diff;
	this.shopButton.y = this.cam.y + 16;
   // update text position
   this.moneyText.x = this.shopButton.x - 16;
	this.moneyText.y = this.shopButton.y + 48;
	this.be.x = this.moneyText.x + this.moneyText.width + 8;
	this.be.y = this.moneyText.y;
   // update purchasing button position
   this.shopPanel.x = this.cam.x + this.cam.width + 16 - this.diff;
	this.shopPanel.y = this.cam.y + 16;
	this.shieldButton.x = this.cam.x + this.cam.width + 16 - this.diff;
	this.shieldButton.y = this.cam.y + 70 + (86 * 0);
	this.solarPanelButton.x = this.cam.x + this.cam.width + 16 - this.diff;
	this.solarPanelButton.y = this.cam.y + 70 + (86 * 1);
	this.thrusterButton.x = this.cam.x + this.cam.width + 16 - this.diff;
	this.thrusterButton.y = this.cam.y + 70 + (86 * 2);
	this.gunButton.x = this.cam.x + this.cam.width + 16 - this.diff;
	this.gunButton.y = this.cam.y + 70 + (86 * 3);
	this.hackButton.x = this.cam.x + this.cam.width + 16 - this.diff;
	this.hackButton.y = this.cam.y + 70 + (86 * 4);
};

Shop.prototype.purchaseModule = function() {
   var randY = this.state.game.rnd.integerInRange(100, this.state.cam.height - 100);
   if(this.key === 'shield' && this.state.mouse.x > this.state.shieldButton.x && this.state.mouse.x < this.state.shieldButton.x + 256 && this.state.mouse.y > this.state.shieldButton.y && this.state.mouse.y < this.state.shieldButton.y + 82) {
      if(this.state.money >= 45) {
         this.state.addModule(this.state.cam.x + this.state.cam.width + 80, this.state.cam.y + randY, this.key);
         this.state.money -= 45;
         this.state.cashRegister.play();
      }
      else {
         this.state.error.play();
      }
   }
   else if(this.key === 'solarPanel' && this.state.mouse.x > this.state.solarPanelButton.x && this.state.mouse.x < this.state.solarPanelButton.x + 256 && this.state.mouse.y > this.state.solarPanelButton.y && this.state.mouse.y < this.state.solarPanelButton.y + 82) {
      if(this.state.money >= 105) {
         this.state.addModule(this.state.cam.x + this.state.cam.width + 80, this.state.cam.y + randY, this.key);
         this.state.money -= 105;
         this.state.cashRegister.play();
      }
      else {
         this.state.error.play();
      }
   }
   else if(this.key === 'thruster' && this.state.mouse.x > this.state.thrusterButton.x && this.state.mouse.x < this.state.thrusterButton.x + 256 && this.state.mouse.y > this.state.thrusterButton.y && this.state.mouse.y < this.state.thrusterButton.y + 82) {
      if(this.state.money >= 90) {
         this.state.addModule(this.state.cam.x + this.state.cam.width + 80, this.state.cam.y + randY, this.key);
         this.state.money -= 90;
         this.state.cashRegister.play();
      }
      else {
         this.state.error.play();
      }
   }
   else if(this.key === 'gun' && this.state.mouse.x > this.state.gunButton.x && this.state.mouse.x < this.state.gunButton.x + 256 && this.state.mouse.y > this.state.gunButton.y && this.state.mouse.y < this.state.gunButton.y + 82) {
      if(this.state.money >= 120) {
         this.state.addModule(this.state.cam.x + this.state.cam.width + 80, this.state.cam.y + randY, this.key);
         this.state.money -= 120;
         this.state.cashRegister.play();
      }
      else {
         this.state.error.play();
      }
   }
   else if(this.key === 'hacker' && this.state.mouse.x > this.state.hackButton.x && this.state.mouse.x < this.state.hackButton.x + 256 && this.state.mouse.y > this.state.hackButton.y && this.state.mouse.y < this.state.hackButton.y + 82) {
      if(this.state.money >= 200) {
         this.state.addModule(this.state.cam.x + this.state.cam.width + 80, this.state.cam.y + randY, this.key);
         this.state.money -= 200;
         this.state.cashRegister.play();
      }
      else {
         this.state.error.play();
      }
   }
   this.state.moneyText.text = this.state.money; 
};

Shop.prototype.addModule = function (x, y, key) {
   var newModule = this.state.moduleBuilder.build(key, x, y, true);
   newModule.cube.body.moveLeft(this.newModuleSpeed);
};

Shop.prototype.addShopButtons = function() {
   this.shieldButton.revive();
   this.solarPanelButton.revive();
   this.thrusterButton.revive();
   this.gunButton.revive();
   this.hackButton.revive(); 
};

Shop.prototype.formatButton = function(button) {
   button.onInputOver.add(this.sm.playHoverClick, this.sm);
   button.onInputDown.add(this.sm.playDownClick, this.sm);
   button.kill();
};

Shop.prototype.addMoney = function(amt) {
   this.money += amt;
   this.moneyText.text = this.money;
   this.cashRegister.play();
};

Shop.prototype.debugAddMoney = function() {
  this.addMoney(1000); 
};

Shop.prototype.useShopButton = function() {
   if(!this.shopPanel.alive && !this.shopMenuOpening && !this.shopMenuClosing) {
      this.shopPanel.revive();
      this.diff = 0;
      this.shopMenuOpening = true;
   }
   else if(this.shopPanel.alive&& !this.shopMenuClosing && !this.shopMenuOpening) {
      this.shopMenuClosing = true;
   }
};

module.exports = Shop;





// //Shop Movement Code
	// if(shopMenuOpening === true) {	
		// // diff += 4;
      // diff += this.shopSpeed * this.game.time.elapsed;
		// if(diff >= 276) {
			// shopMenuOpening = false;
			// this.addShopButtons();
		// }
	// }
	// else if(shopMenuClosing === true) {
		// // diff -= 4;
      // diff -= this.shopSpeed * this.game.time.elapsed;
		// if(diff <= 0) {
			// shopPanel.kill();
			// shopMenuClosing = false;
		// }
	// }




},{}],"c:\\Users\\CannpinCarl\\Documents\\CMPM20\\Above the Iron Curtain\\AboveTheIronCurtain\\src\\js\\utils.js":[function(require,module,exports){
/*
Collection of utility functions.
*/

var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    },
    distance: function(x1, y1, x2, y2) {
       return Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));
    },
    lerp: function(a, b, t) {
       if (t < 0 || t > 1) {
          console.log('bad range for Utils.lerp(), must be between 0 and 1');
          return 0;
       }
       return a + t * (b - a);
    }
};

module.exports = Utils;
},{}]},{},["./src/js/main.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlc1xcYnJvd3NlcmlmeVxcbm9kZV9tb2R1bGVzXFxicm93c2VyLXBhY2tcXF9wcmVsdWRlLmpzIiwic3JjL2pzL21haW4uanMiLCJzcmMvanMvZWZmZWN0cy9CaW5hcnlQYXJ0aWNsZS5qcyIsInNyYy9qcy9lZmZlY3RzL0VtaXR0ZXIuanMiLCJzcmMvanMvZW50aXRpZXMvQnVsbGV0LmpzIiwic3JjL2pzL2VudGl0aWVzL0hhY2thYmxlLmpzIiwic3JjL2pzL2VudGl0aWVzL01vZHVsZS5qcyIsInNyYy9qcy9lbnRpdGllcy9Nb2R1bGVCdWlsZGVyLmpzIiwic3JjL2pzL2VudGl0aWVzL2NoZWF0aW5nLmpzIiwic3JjL2pzL2VudGl0aWVzL2N1YmUuanMiLCJzcmMvanMvZW50aXRpZXMvY3ViZV9ncm91cC5qcyIsInNyYy9qcy9lbnRpdGllcy9lbmVteV9haS5qcyIsInNyYy9qcy9lbnRpdGllcy9oZWxwZXIuanMiLCJzcmMvanMvZW50aXRpZXMvbW91c2UuanMiLCJzcmMvanMvZW50aXRpZXMvc291bmRfbWFuYWdlci5qcyIsInNyYy9qcy9mdW5jdGlvbkFjY2Vzcy9SZW5kZXJhYmxlcy5qcyIsInNyYy9qcy9saWJzL2phdmFzY3JpcHQtYXN0YXIvYXN0YXIuanMiLCJzcmMvanMvc3RhdGVzL2Jvb3QuanMiLCJzcmMvanMvc3RhdGVzL2dhbWUuanMiLCJzcmMvanMvc3RhdGVzL21lbnUuanMiLCJzcmMvanMvc3RhdGVzL3ByZWxvYWRlci5qcyIsInNyYy9qcy9zdGF0ZXMvc3BsYXNoLmpzIiwic3JjL2pzL3VpL1Byb2dyZXNzQmFyLmpzIiwic3JjL2pzL3VpL1VJQnVpbGRlci5qcyIsInNyYy9qcy91aS9iYW5uZXIuanMiLCJzcmMvanMvdWkvc2hvcC5qcyIsInNyYy9qcy91dGlscy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzeUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDektBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwidmFyIGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUod2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdoLCBQaGFzZXIuQVVUTywgJ2F0aWMtZ2FtZScpO1xyXG5cclxud2luZG93LnBsYXllclN0YXRlID0ge1xyXG4gICAgY3VycmVudExldmVsOiAnTWVudSdcclxufTtcclxuXHJcbi8vICBUaGUgR29vZ2xlIFdlYkZvbnQgTG9hZGVyIHdpbGwgbG9vayBmb3IgdGhpcyBvYmplY3QsIHNvIGNyZWF0ZSBpdCBiZWZvcmUgbG9hZGluZyB0aGUgc2NyaXB0LlxyXG5XZWJGb250Q29uZmlnID0geyAvLyBqc2hpbnQgaWdub3JlOmxpbmVcclxuICAgIC8vICBUaGUgR29vZ2xlIEZvbnRzIHdlIHdhbnQgdG8gbG9hZCAoc3BlY2lmeSBhcyBtYW55IGFzIHlvdSBsaWtlIGluIHRoZSBhcnJheSlcclxuICAgIGdvb2dsZToge1xyXG4gICAgICBmYW1pbGllczogWydSb2JvdG86OmxhdGluJywgJ1ZUMzIzOjpsYXRpbiddXHJcbiAgICB9XHJcbn07XHJcblxyXG5nYW1lLnN0YXRlLmFkZCgnQm9vdCcsIHJlcXVpcmUoJy4vc3RhdGVzL2Jvb3QnKSk7XHJcbmdhbWUuc3RhdGUuYWRkKCdTcGxhc2gnLCByZXF1aXJlKCcuL3N0YXRlcy9zcGxhc2gnKSk7XHJcbmdhbWUuc3RhdGUuYWRkKCdQcmVsb2FkZXInLCByZXF1aXJlKCcuL3N0YXRlcy9wcmVsb2FkZXInKSk7XHJcbmdhbWUuc3RhdGUuYWRkKCdNZW51JywgcmVxdWlyZSgnLi9zdGF0ZXMvbWVudScpKTtcclxuZ2FtZS5zdGF0ZS5hZGQoJ0dhbWUnLCByZXF1aXJlKCcuL3N0YXRlcy9nYW1lJykpO1xyXG5cclxuZ2FtZS5zdGF0ZS5zdGFydCgnQm9vdCcpOyIsInZhciBCaW5hcnlQYXJ0aWNsZSA9IGZ1bmN0aW9uKGdhbWUsIHRhcmdldE9iaiwgeCwgeSwgdGFyT2Zmc2V0WCwgdGFyT2Zmc2V0WSkge1xyXG5cdHZhciBzdHlsZSA9IHtmb250OiAnMjBweCBWVDMyMycsIGZpbGw6ICcjRkZGRkZGJywgYWxpZ246ICdjZW50ZXInfTtcclxuXHR2YXIgYnl0ZVN5bWJvbCA9IE1hdGgucmFuZG9tKCkgPj0gMC41ID8gJzEnIDogJzAnO1xyXG5cdFBoYXNlci5UZXh0LmNhbGwodGhpcywgZ2FtZSwgeCwgeSwgYnl0ZVN5bWJvbCwgc3R5bGUpO1xyXG5cdGdhbWUuYWRkLmV4aXN0aW5nKHRoaXMpO1xyXG5cdHRoaXMudGFyZ2V0T2JqID0gdGFyZ2V0T2JqO1xyXG5cdHRoaXMuc3BlZWQgPSAzLjY7XHJcblx0dGhpcy50YXJPZmZzZXRYID0gdGFyT2Zmc2V0WDtcclxuXHR0aGlzLnRhck9mZnNldFkgPSB0YXJPZmZzZXRZO1xyXG59O1xyXG5cclxuQmluYXJ5UGFydGljbGUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuVGV4dC5wcm90b3R5cGUpO1xyXG5CaW5hcnlQYXJ0aWNsZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBCaW5hcnlQYXJ0aWNsZTtcclxuXHJcbkJpbmFyeVBhcnRpY2xlLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcclxuXHQvL0dldCBkZWx0YSB2ZWN0b3IgdG8gdGFyZ2V0IG9iamVjdFxyXG5cdHZhciBkZWx0YSA9IFt0aGlzLnRhcmdldE9iai54ICsgdGhpcy50YXJPZmZzZXRYIC0gdGhpcy54LCB0aGlzLnRhcmdldE9iai55ICsgdGhpcy50YXJPZmZzZXRZIC0gdGhpcy55XTtcclxuXHQvL0dldCBkaXN0YW5jZSBhbmQgY2hlY2sgaWYgd2UndmUgcmVhY2hlZCB0YXJnZXQgZGlzdGFuY2VcclxuXHR2YXIgZGlzdCA9IE1hdGguc3FydChNYXRoLnBvdyhkZWx0YVswXSwgMikgKyBNYXRoLnBvdyhkZWx0YVsxXSwgMikpO1xyXG5cdGlmKGRpc3QgPD0gdGhpcy5zcGVlZCkge1xyXG5cdFx0dGhpcy5kZXN0cm95KCk7XHJcblx0XHRyZXR1cm47XHJcblx0fVxyXG5cdC8vTm9ybWFsaXplIGRlbHRhIHZlY3RvclxyXG5cdGRlbHRhID0gW2RlbHRhWzBdL2Rpc3QsIGRlbHRhWzFdL2Rpc3RdO1xyXG5cdC8vVXBkYXRlIHBvc2l0aW9uXHJcblx0dGhpcy54ID0gdGhpcy54ICsgdGhpcy5zcGVlZCpkZWx0YVswXTtcclxuXHR0aGlzLnkgPSB0aGlzLnkgKyB0aGlzLnNwZWVkKmRlbHRhWzFdO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBCaW5hcnlQYXJ0aWNsZTsiLCJ2YXIgQmluYXJ5UGFydGljbGUgPSByZXF1aXJlKCcuL0JpbmFyeVBhcnRpY2xlJyk7XHJcblxyXG52YXIgRW1pdHRlciA9IGZ1bmN0aW9uKGdhbWVTdGF0ZSkge1xyXG5cdHRoaXMuZ2FtZVN0YXRlID0gZ2FtZVN0YXRlO1xyXG59O1xyXG5cclxuRW1pdHRlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBFbWl0dGVyO1xyXG5cclxuRW1pdHRlci5wcm90b3R5cGUuZW1pdEJpbmFyeSA9IGZ1bmN0aW9uICh0YXJnZXRPYmosIHgsIHksIHNwYWNpbmcpIHtcclxuXHR2YXIgb2Zmc2V0WCA9IChNYXRoLnJhbmRvbSgpLTAuNSkqc3BhY2luZztcclxuXHR2YXIgb2Zmc2V0WSA9IChNYXRoLnJhbmRvbSgpLTAuNSkqc3BhY2luZztcclxuXHR2YXIgbmV3UGFydGljbGUgPSBuZXcgQmluYXJ5UGFydGljbGUodGhpcy5nYW1lU3RhdGUuZ2FtZSwgdGFyZ2V0T2JqLCB4LCB5LCBvZmZzZXRYLCBvZmZzZXRZKTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gRW1pdHRlcjsiLCIvL0J1bGxldHMgYXJlIHRhZ2dlZCBhcyAncGxheWVyQnVsbGV0JyBvciAnZW5lbXlCdWxsZXQnXHJcbnZhciBCdWxsZXQgPSBmdW5jdGlvbihnYW1lU3RhdGUsIHgsIHksIGRpcmVjdGlvbiwgaW5oZXJ0aXRTcGVlZCwgdGFnKSB7XHJcbiAgICBQaGFzZXIuU3ByaXRlLmNhbGwodGhpcywgZ2FtZVN0YXRlLmdhbWUsIHgsIHksICdidWxsZXQnKTtcclxuXHR0aGlzLmRpcmVjdGlvbiA9IGRpcmVjdGlvbjsgLy9Vbml0IHZlY3RvciByZXByZXNlbnRpbmcgZGlyZWN0aW9uIGJ1bGxldCBpcyB0cmF2ZWxsaW5nO1xyXG5cdHRoaXMuc3BlZWQgPSA1MDAgKyBpbmhlcnRpdFNwZWVkO1x0XHRcdFx0Ly9TcGVlZCBidWxsZXQgaXMgdHJhdmVsbGluZztcclxuXHR0aGlzLnRhZyA9IHRhZztcclxuXHR0aGlzLmdhbWUgPSBnYW1lU3RhdGUuZ2FtZTtcclxuXHR0aGlzLmdhbWUuYWRkLmV4aXN0aW5nKHRoaXMpO1xyXG5cdHRoaXMubGlmZVRpbWUgPSAzMDA7XHJcblx0dmFyIHNjYWxlID0gMC41O1xyXG5cdHRoaXMuc2NhbGUueCA9IHNjYWxlO1xyXG5cdHRoaXMuc2NhbGUueSA9IHNjYWxlO1xyXG5cdHRoaXMuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcclxuXHR0aGlzLmRlc3Ryb3lCdWZmZXIgPSAxMDA7XHJcblx0XHJcblx0Ly9zZXQgcGh5c2ljc1xyXG5cdGdhbWVTdGF0ZS5nYW1lLnBoeXNpY3MucDIuZW5hYmxlKHRoaXMpO1xyXG5cdHRoaXMuYm9keS5zZXRDb2xsaXNpb25Hcm91cChnYW1lU3RhdGUuY29sbGlzaW9uR3JvdXApO1xyXG5cdHRoaXMuYm9keS5jb2xsaWRlcyhnYW1lU3RhdGUuY29sbGlzaW9uR3JvdXApO1xyXG5cdC8vU2V0IHByb3BlciBjb2xsaXNpb24gZnVuY3Rpb24gYnkgZGV0ZXJtaW5pbmcgdHlwZSBmcm9tICd0YWcnXHJcblx0aWYodGhpcy50YWcgPT09ICdlbmVteUJ1bGxldCcpIHtcclxuXHRcdHRoaXMuY29sbGlzaW9uID0gZnVuY3Rpb24ob3RoZXIpIHtcclxuXHRcdFx0aWYob3RoZXIpIHtcclxuXHRcdFx0XHRpZihvdGhlci5zcHJpdGUpe1xyXG5cdFx0XHRcdFx0aWYob3RoZXIuc3ByaXRlLnRhZykge1xyXG5cdFx0XHRcdFx0XHRpZihvdGhlci5zcHJpdGUudGFnID09PSAnbW9kdWxlJykge1xyXG5cdFx0XHRcdFx0XHRcdG90aGVyLnNwcml0ZS50YWtlRGFtYWdlKDEpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdHRoaXMuZGVzdHJveSgpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHR9XHJcblx0ZWxzZSBpZih0aGlzLnRhZyA9PT0gJ3BsYXllckJ1bGxldCcpIHtcclxuXHRcdHRoaXMuY29sbGlzaW9uID0gZnVuY3Rpb24ob3RoZXIpIHtcclxuXHRcdFx0aWYob3RoZXIpIHtcclxuXHRcdFx0XHRpZihvdGhlci5zcHJpdGUpe1xyXG5cdFx0XHRcdFx0aWYob3RoZXIuc3ByaXRlLnRhZykge1xyXG5cdFx0XHRcdFx0XHRpZihvdGhlci5zcHJpdGUudGFnID09PSAnZW5lbXlfbW9kdWxlJykge1xyXG5cdFx0XHRcdFx0XHRcdG90aGVyLnNwcml0ZS50YWtlRGFtYWdlKDEpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMuZGVzdHJveSgpO1xyXG5cdFx0fTtcclxuXHR9XHJcblx0dGhpcy5ib2R5Lm9uQmVnaW5Db250YWN0LmFkZCh0aGlzLmNvbGxpc2lvbiwgdGhpcyk7XHJcblx0dGhpcy5ib2R5LnNldFplcm9EYW1waW5nKCk7XHJcblx0dGhpcy5ib2R5Lm1hc3MgPSAwLjE7XHJcblx0dGhpcy5ib2R5LnZlbG9jaXR5LnggPSBkaXJlY3Rpb25bMF0qdGhpcy5zcGVlZDtcclxuXHR0aGlzLmJvZHkudmVsb2NpdHkueSA9IGRpcmVjdGlvblsxXSp0aGlzLnNwZWVkO1xyXG59O1xyXG5cclxuQnVsbGV0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUGhhc2VyLlNwcml0ZS5wcm90b3R5cGUpO1xyXG5CdWxsZXQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQnVsbGV0O1xyXG5cclxuQnVsbGV0LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcclxuXHRpZih0aGlzLmJvZHkueCA+IHRoaXMuZ2FtZS5jYW1lcmEueCArIHRoaXMuZ2FtZS5jYW1lcmEud2lkdGggKyB0aGlzLmRlc3Ryb3lCdWZmZXIgfHwgdGhpcy5ib2R5LnggIDwgdGhpcy5nYW1lLmNhbWVyYS54IC0gdGhpcy5kZXN0cm95QnVmZmVyIHx8IFxyXG5cdHRoaXMuYm9keS55ID4gdGhpcy5nYW1lLmNhbWVyYS55ICsgdGhpcy5nYW1lLmNhbWVyYS5oZWlnaHQgKyB0aGlzLmRlc3Ryb3lCdWZmZXIgfHwgdGhpcy5ib2R5LnkgPCB0aGlzLmdhbWUuY2FtZXJhLnkgLSB0aGlzLmRlc3Ryb3lCdWZmZXIpIHtcclxuXHRcdHRoaXMuZGVzdHJveSh0cnVlKTtcclxuXHR9XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEJ1bGxldDsiLCIvLyBERVBSRUNBVEVEXHJcblxyXG4vKlxyXG5EZWZpbmVzIGEgaGFja2FibGUgb2JqZWN0LlxyXG4qL1xyXG5cclxudmFyIEhhY2thYmxlID0gZnVuY3Rpb24gKGdhbWVTdGF0ZSwgeCwgeSwgc3ByaXRlLCBoYWNrRGlzdGFuY2UpIHtcclxuICAgUGhhc2VyLlNwcml0ZS5jYWxsKHRoaXMsIGdhbWVTdGF0ZS5nYW1lLCB4LCB5LCBzcHJpdGUpO1xyXG4gICBnYW1lU3RhdGUuZ2FtZS5hZGQuZXhpc3RpbmcodGhpcyk7XHJcblx0Ly9zdG9yZSBnYW1lU3RhdGVcclxuXHR0aGlzLmdhbWVTdGF0ZSA9IGdhbWVTdGF0ZTtcclxuXHQvL3NldCBpc0hhY2tlZCB0byBmYWxzZVxyXG5cdHRoaXMuaXNIYWNrZWQgPSBmYWxzZTtcclxuXHR0aGlzLmJlaW5nSGFja2VkID0gZmFsc2U7XHJcblx0dGhpcy5iZWluZ0hhY2tlZFByZXYgPSBmYWxzZTtcclxuXHQvL2FkZCBoYWNrQmFyXHJcblx0dGhpcy5oYWNrQmFyID0gZ2FtZVN0YXRlLnVpQnVpbGRlci5idWlsZFByb2dyZXNzQmFyKCdncm93aW5nJywgMTUwMCwgMTIwMCwgMTAwLCAxMCwgIDIwMCk7XHJcblx0dGhpcy5oYWNrQmFyLnNldFN0eWxlKDAsIDB4RkZGRkZGLCAweDM2MzYzNiwgMCwgMCwgMCwgMHhGRkZGRkYsIDB4MjAyMENDKTtcclxuXHR0aGlzLmhhY2tCYXIuaGFja2FibGUgPSB0aGlzO1xyXG5cdHRoaXMuaGFja0Jhci5vbkV2ZW50ID0gZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmhhY2thYmxlLmFuaW1hdGlvbnMuc3RvcCgpO1xyXG5cdFx0dGhpcy5oYWNrYWJsZS5hbmltYXRpb25zLnBsYXkoJ2hhY2tlZCcpO1xyXG5cdFx0dGhpcy5oYWNrYWJsZS5pc0hhY2tlZCA9IHRydWU7XHJcblx0XHR0aGlzLmRlc3Ryb3koKTtcclxuXHR9O1xyXG5cdHRoaXMudGFnID0gJ25ldXRyYWxPYmonO1x0Ly9UYWcgaXMgdXNlZCB0byBpZGVudGlmeSBvYmplY3QgdHlwZSBkdXJpbmcgY29sbGlzaW9uIGNoZWNraW5nXHJcblx0dGhpcy5oYWNrRGlzdGFuY2UgPSBoYWNrRGlzdGFuY2U7XHJcblx0dmFyIHNjYWxlID0gMC41O1xyXG4gICB0aGlzLnNjYWxlLnggPSBzY2FsZTtcclxuICAgdGhpcy5zY2FsZS55ID0gc2NhbGU7XHJcbiAgIHRoaXMuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcclxuICAgdGhpcy5hbmltYXRpb25zLmFkZCgnaGFja2FibGUnLCBbMCwxLDIsMyw0XSwgMTAsIHRydWUpO1xyXG4gICB0aGlzLmFuaW1hdGlvbnMuYWRkKCdoYWNrZWQnLCBbNSw2LDcsOCw5XSwgMTAsIHRydWUpO1xyXG4gICB0aGlzLmhhY2tpbmcgPSB0aGlzLmdhbWVTdGF0ZS5hZGQuYXVkaW8oJ2hhY2tpbmcnLCAxLCB0cnVlKTtcclxuICAgXHJcbiAgIC8vU2V0IHVwIHBoeXNpY3MgYm9keSBmb3IgJ2hhY2thYmxlJyBzcHJpdGVcclxuICAgZ2FtZVN0YXRlLmdhbWUucGh5c2ljcy5wMi5lbmFibGUodGhpcyk7XHJcbiAgIHRoaXMuYm9keS5zZXRDb2xsaXNpb25Hcm91cChnYW1lU3RhdGUuY29sbGlzaW9uR3JvdXApO1xyXG5cdHRoaXMuYm9keS5jb2xsaWRlcyhnYW1lU3RhdGUuY29sbGlzaW9uR3JvdXApO1xyXG4gICB0aGlzLmJvZHkub25CZWdpbkNvbnRhY3QuYWRkKHRoaXMuY3ViZUNvbGxpZGUsIHRoaXMpO1xyXG4gICB0aGlzLmJvZHkuZGFtcGluZyA9IDAuOTtcclxuICAgdGhpcy5ib2R5LmFuZ3VsYXJEYW1waW5nID0gMC45O1xyXG59O1xyXG5cclxuSGFja2FibGUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuU3ByaXRlLnByb3RvdHlwZSk7XHJcbkhhY2thYmxlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEhhY2thYmxlO1xyXG5cclxuLyoqXHJcbiAqIEF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IFdvcmxkLnVwZGF0ZVxyXG4gKi9cclxuSGFja2FibGUucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xyXG5cdHRoaXMuaGFja0Jhci5zZXRMb2NhdGlvbih0aGlzLngsIHRoaXMueSAtIDcwKTtcclxuXHQvL2NoZWNrIGlmIGdldHRpbmcgaGFja2VkXHJcblx0aWYoIXRoaXMuaXNIYWNrZWQpIHtcclxuXHRcdHRoaXMuYW5pbWF0aW9ucy5wbGF5KCdoYWNrYWJsZScpO1xyXG5cdFx0aWYodGhpcy5nYW1lU3RhdGUucGxheWVyLmFjdGl2ZUhhY2tlck1vZHVsZXMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHR2YXIgZGlzdDtcclxuXHRcdFx0dmFyIGhhY2tlcjtcclxuXHRcdFx0Ly9Mb29wIHRocm91Z2ggYWxsIGhhY2tlciBtb2R1bGVzIG9uIHRoZSBwbGF5ZXIncyBjdWJlc2F0XHJcblx0XHRcdGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLmdhbWVTdGF0ZS5wbGF5ZXIuYWN0aXZlSGFja2VyTW9kdWxlcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdGhhY2tlciA9IHRoaXMuZ2FtZVN0YXRlLnBsYXllci5hY3RpdmVIYWNrZXJNb2R1bGVzW2ldO1xyXG5cdFx0XHRcdGRpc3QgPSBNYXRoLnNxcnQoIE1hdGgucG93KHRoaXMueCAtIGhhY2tlci5jdWJlLngsIDIpICsgTWF0aC5wb3codGhpcy55IC0gaGFja2VyLmN1YmUueSwgMikgKTtcclxuXHRcdFx0XHRpZihkaXN0IDwgdGhpcy5oYWNrRGlzdGFuY2UpIHtcclxuXHRcdFx0XHRcdC8vSWYgaGFja2VyIGlzIGluIHJhbmdlLCBpbmNyZWFzZSBoYWNrIHZhbHVlIGFuZCB0cnkgdG8gZW1pdCBiaW5hcnkgcGFydGljbGVcclxuXHRcdFx0XHRcdGlmKHRoaXMuYmVpbmdIYWNrZWQgPT09IHRydWUpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5iZWluZ0hhY2tlZFByZXYgPSB0cnVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0dGhpcy5iZWluZ0hhY2tlZCA9IHRydWU7XHJcblx0XHRcdFx0XHR0aGlzLmhhY2tCYXIuYWRkVmFsdWUoMC4xKTtcclxuXHRcdFx0XHRcdGhhY2tlci5jb3VudCsrO1xyXG5cdFx0XHRcdFx0aWYoaGFja2VyLmNvdW50ID49IGhhY2tlci5jeWNsZSkge1xyXG5cdFx0XHRcdFx0XHRoYWNrZXIuY291bnQgPSAwO1xyXG5cdFx0XHRcdFx0XHR0aGlzLmdhbWVTdGF0ZS5CaW5hcnlFbWl0dGVyLmVtaXRCaW5hcnkodGhpcywgaGFja2VyLmN1YmUueCwgaGFja2VyLmN1YmUueSwgNjApO1xyXG5cdFx0XHRcdFx0XHRpZihoYWNrZXIuY3ViZS5mcmFtZSA9PT0gNSkge1xyXG5cdFx0XHRcdFx0XHRcdGhhY2tlci5jdWJlLmZyYW1lID0gMDtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRoYWNrZXIuY3ViZS5mcmFtZSsrO1xyXG5cdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRoYWNrZXIuY3ViZS5hbmltYXRpb25zLnN0b3AoKTtcclxuXHRcdFx0XHRcdGlmKHRoaXMuYmVpbmdIYWNrZWQgPT09IGZhbHNlKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuYmVpbmdIYWNrZWRQcmV2ID0gZmFsc2U7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR0aGlzLmJlaW5nSGFja2VkID0gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0dGhpcy5oYWNraW5nLnN0b3AoKTtcclxuXHR9XHJcblx0aWYodGhpcy5iZWluZ0hhY2tlZCA9PT0gdHJ1ZSAmJiB0aGlzLmJlaW5nSGFja2VkUHJldiA9PT0gZmFsc2UpIHtcclxuXHRcdGlmKHRoaXMuaGFja2luZy5wYXVzZWQgPT09IHRydWUpIHtcclxuXHRcdFx0dGhpcy5oYWNraW5nLnJlc3VtZSgpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuaGFja2luZy5wbGF5KCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGVsc2UgaWYodGhpcy5iZWluZ0hhY2tlZCA9PT0gZmFsc2UgJiYgdGhpcy5iZWluZ0hhY2tlZFByZXYgPT09IHRydWUpe1xyXG5cdFx0dGhpcy5oYWNraW5nLnBhdXNlKCk7XHJcblx0fVxyXG59O1xyXG5cclxuXHJcbkhhY2thYmxlLnByb3RvdHlwZS5jdWJlQ29sbGlkZSA9IGZ1bmN0aW9uKG90aGVyKSB7XHJcbi8qICAgaWYgKHRoaXMuZ3JvdXAgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgIH1cclxuICAgdGhpcy5ncm91cC5oYW5kbGVDb2xsaXNpb24odGhpcywgb3RoZXIuc3ByaXRlKTsqL1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBIYWNrYWJsZTsiLCIvL0Rvbid0IHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGNyZWF0ZSBtb2R1bGVzLCBpbnN0ZWFkIHVzZSBtb2R1bGVCdWlsZGVyKClcclxudmFyIE1vZHVsZSA9IGZ1bmN0aW9uKHNldFR5cGUsIHNldEN1YmUsIHNldEdhbWVTdGF0ZSkge1xyXG5cdHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcclxuXHR0aGlzLnR5cGUgPSBzZXRUeXBlO1xyXG5cdHRoaXMuY3ViZSA9IHNldEN1YmU7XHJcblx0c2V0Q3ViZS5tb2R1bGUgPSB0aGlzO1xyXG5cdHRoaXMuZ2FtZVN0YXRlID0gc2V0R2FtZVN0YXRlO1xyXG59O1xyXG5cclxuTW9kdWxlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IE1vZHVsZTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gTW9kdWxlOyIsInZhciBDdWJlID0gcmVxdWlyZSgnLi9jdWJlJyk7XHJcbnZhciBNb2R1bGUgPSByZXF1aXJlKCcuL01vZHVsZScpO1xyXG52YXIgQnVsbGV0ID0gcmVxdWlyZSgnLi9CdWxsZXQnKTtcclxuXHJcbnZhciB0aHJ1c3RBbXQgPSA1MDAwO1xyXG5cclxuLy9Vc2UgdGhpcyB0byBjcmVhdGUgYSBtb2R1bGVCdWlsZGVyLSBvbmx5IG5lZWQgdG8gY3JlYXRlIG9uZSBpbnN0YW5jZSBvZiBpdFxyXG52YXIgTW9kdWxlQnVpbGRlciA9IGZ1bmN0aW9uKHNldEdhbWVTdGF0ZSwgc2V0Q29sR3JvdXApIHtcclxuXHQvL0Vuc3VyZSB0aGF0IGNhbm5vdCBjcmVhdGUgbXVsdGlwbGUgaW5zdGFuY2VzIG9mIHRoaXMgY2xhc3NcclxuXHRpZihNb2R1bGVCdWlsZGVyLnByb3RvdHlwZS5leGlzdHMpIHtcclxuXHRcdHJldHVybiBNb2R1bGVCdWlsZGVyLnByb3RvdHlwZS5leGlzdGluZ1JlZmVyZW5jZTtcclxuXHR9XHJcblx0XHRcclxuXHR0aGlzLmdhbWVTdGF0ZSA9IHNldEdhbWVTdGF0ZTtcclxuICAgdGhpcy5jb2xHcm91cCA9IHNldENvbEdyb3VwO1xyXG5cdC8vIHRoaXMuY29yZUV4aXN0cyA9IGZhbHNlO1x0Ly9yZWNvcmRzIGlmIGNvcmUgaGFzIGJlZW4gY3JlYXRlZFxyXG5cdHRoaXMuY29yZSA9IG51bGw7XHRcdFx0Ly9zdG9yZXMgY29yZSB3aGVuIGl0IGlzIGNyZWF0ZWRcclxuXHQvL3ZhciBzcGFjZSA9IHRoaXMuZ2FtZVN0YXRlLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuS2V5Ym9hcmQuU1BBQ0VCQVIpO1xyXG5cdE1vZHVsZUJ1aWxkZXIucHJvdG90eXBlLmV4aXN0cyA9IHRydWU7XHJcblx0TW9kdWxlQnVpbGRlci5wcm90b3R5cGUuZXhpc3RpbmdSZWZlcmVuY2UgPSB0aGlzO1xyXG59O1xyXG5cclxuTW9kdWxlQnVpbGRlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBNb2R1bGVCdWlsZGVyO1xyXG5cclxuLy9UaGVzZSB2YXIncyBoZWxwIGNyZWF0ZSB0aGUgc2luZ2xldG9uIGZ1bmN0aW9uYWxpdHlcclxuTW9kdWxlQnVpbGRlci5wcm90b3R5cGUuZXhpc3RzID0gZmFsc2U7XHJcbk1vZHVsZUJ1aWxkZXIucHJvdG90eXBlLmV4aXN0aW5nUmVmZXJlbmNlID0gbnVsbDtcclxuXHJcbi8qKiBNb2R1bGUgZnVuY3Rpb25zICoqL1xyXG5mdW5jdGlvbiBzb2xhclBhbmVsR2l2ZVRhcmdldCh0YXJnZXQpIHtcclxuICAgaWYgKHRoaXMgPT09IHRhcmdldCB8fCAhdGhpcy5jdWJlLmdyb3VwIHx8ICF0YXJnZXQuY3ViZS5ncm91cCB8fCB0aGlzLmN1YmUuZ3JvdXAgIT09IHRhcmdldC5jdWJlLmdyb3VwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgfVxyXG4gICB0aGlzLmN1YmUubG9zZUNvbm5lY3Rpb24oKTtcclxuICAgdmFyIG91ckdyb3VwID0gdGhpcy5jdWJlLmdyb3VwO1xyXG4gICB2YXIgbmV3Q29ubmVjdGlvbiA9IHtzdGFydDogdGhpcy5jdWJlLCBlbmQ6IHRhcmdldC5jdWJlfTtcclxuICAgdGhpcy5jdWJlLm15Q29ubmVjdGlvbiA9IG5ld0Nvbm5lY3Rpb247XHJcbiAgIHRhcmdldC5jdWJlLm15Q29ubmVjdGlvbiA9IG5ld0Nvbm5lY3Rpb247XHJcbiAgIG91ckdyb3VwLmRpc3BsYXlDb25uZWN0aW9uKHRoaXMuY3ViZS5teUNvbm5lY3Rpb24pO1xyXG5cdGlmKCF0YXJnZXQuaXNBY3RpdmUpIHtcclxuXHRcdC8vQWN0aXZhdGUgdGhlIG1vZHVsZVxyXG5cdFx0dGFyZ2V0LmlzQWN0aXZlID0gdHJ1ZTtcclxuXHRcdHRoaXMubW9kdWxlUG93ZXIucGxheSgpO1xyXG5cdFx0aWYodGFyZ2V0LnR5cGUgPT09ICdoYWNrZXInKSB7XHJcblx0XHRcdG91ckdyb3VwLmFjdGl2ZUhhY2tlck1vZHVsZXMucHVzaCh0YXJnZXQpO1xyXG5cdFx0fVxyXG5cdFx0Ly9JZiB0aGlzIGlzIG9uZSBvZiB0aGUgcG93ZXJhYmxlIHR5cGVzLCBzd2l0Y2ggdGhlIGZyYW1lIGZyb20gJ2dyZXllZCcgdG8gJ2FjdGl2ZSdcclxuXHRcdGlmKHRhcmdldC50eXBlID09PSAnZ3VuJyB8fCB0YXJnZXQudHlwZSA9PT0gJ2hhY2tlcicgfHwgdGFyZ2V0LnR5cGUgPT09ICd0aHJ1c3RlcicpIHtcclxuXHRcdFx0dGFyZ2V0LmN1YmUuZnJhbWUgPSAxO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuZnVuY3Rpb24gc29sYXJQYW5lbE1vdXNlT3ZlcigpIHtcclxuICAgaWYgKCF0aGlzLmN1YmUubXlDb25uZWN0aW9uIHx8ICF0aGlzLmN1YmUuZ3JvdXApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICB9XHJcbiAgIHRoaXMuY3ViZS5ncm91cC5kaXNwbGF5Q29ubmVjdGlvbih0aGlzLmN1YmUubXlDb25uZWN0aW9uKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2VuZXJpY09uUmVtb3ZlKCkge1xyXG4gICB0aGlzLmN1YmUubG9zZUNvbm5lY3Rpb24oKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFja2VyT25Mb3NlQ29ubmVjdGlvbigpIHtcclxuICAgdmFyIGhhY2tJbmRleCA9IHRoaXMuZ2FtZVN0YXRlLnBsYXllci5hY3RpdmVIYWNrZXJNb2R1bGVzLmluZGV4T2YodGhpcyk7XHJcbiAgIHRoaXMuZ2FtZVN0YXRlLnBsYXllci5hY3RpdmVIYWNrZXJNb2R1bGVzLnNwbGljZShoYWNrSW5kZXgsIDEpO1xyXG4gICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGJlZ2luQWN0KCkge1xyXG4gICB0aGlzLnRpbWVyID0gMDtcclxuICAgdGhpcy5hY3QgPSB0cnVlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBlbmRBY3QoKSB7XHJcbiAgIHRoaXMuYWN0ID0gZmFsc2U7XHJcbiAgIHRoaXMuY3ViZS5mcmFtZSA9IDE7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRocnVzdGVyVXBkYXRlKCkge1xyXG4gICBpZiAodGhpcy5oYWx0VGltZSAmJiB0aGlzLmhhbHRUaW1lID4gMCkge1xyXG4gICAgICB0aGlzLmhhbHRUaW1lIC09IHRoaXMuY3ViZS5nYW1lLnRpbWUuZWxhcHNlZDtcclxuICAgICAgdGhpcy5jdWJlLmZyYW1lID0gMTtcclxuICAgfSBlbHNlIGlmICh0aGlzLmFjdCAmJiB0aGlzLmN1YmUubXlDb25uZWN0aW9uKSB7XHJcblx0ICBpZih0aGlzLmlzVGhydXN0ID09PSB0cnVlKSB7XHJcblx0XHR0aGlzLmlzVGhydXN0UHJldiA9IHRydWU7XHJcblx0ICB9XHJcblx0ICB0aGlzLmlzVGhydXN0ID0gdHJ1ZTtcclxuICAgICAgdGhpcy5jdWJlLmJvZHkuZm9yY2UueCA9IHRocnVzdEFtdCAqIE1hdGguY29zKHRoaXMuY3ViZS5yb3RhdGlvbiAtIE1hdGguUEkgLyAyKTtcclxuICAgICAgdGhpcy5jdWJlLmJvZHkuZm9yY2UueSA9IHRocnVzdEFtdCAqIE1hdGguc2luKHRoaXMuY3ViZS5yb3RhdGlvbiAtIE1hdGguUEkgLyAyKTtcclxuXHQgIGlmKHRoaXMuY3ViZS5mcmFtZSA9PT0gMSkge1xyXG5cdFx0dGhpcy5jdWJlLmZyYW1lID0gMztcclxuXHQgIH1cclxuXHQgIGVsc2Uge1xyXG5cdFx0dGhpcy5jdWJlLmZyYW1lID0gMjtcclxuXHQgIH1cclxuXHQgIGlmKHRoaXMuaXNUaHJ1c3QgPT09IHRydWUgJiYgdGhpcy5pc1RocnVzdFByZXYgPT09IGZhbHNlKSB7XHJcblx0XHR0aGlzLnRocnVzdGVyTG9vcC5wbGF5KCk7XHJcblx0ICB9XHJcbiAgIH1cclxuICAgZWxzZSBpZighdGhpcy5hY3QpIHtcclxuXHQgIGlmKHRoaXMuaXNUaHJ1c3QgPT09IGZhbHNlKSB7XHJcblx0XHR0aGlzLmlzVGhydXN0UHJldiA9IGZhbHNlO1xyXG5cdCAgfVxyXG5cdCAgdGhpcy5pc1RocnVzdCA9IGZhbHNlO1xyXG5cdCAgaWYodGhpcy5pc1RocnVzdCA9PT0gZmFsc2UgJiYgdGhpcy5pc1RocnVzdFByZXYgPT09IHRydWUpIHtcclxuXHRcdHRoaXMudGhydXN0ZXJMb29wLnN0b3AoKTtcclxuXHQgIH1cclxuICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiB0aHJ1c3RlckhhbHQoKSB7XHJcbiAgIHRoaXMuaGFsdFRpbWUgPSAxNTAwO1xyXG59XHJcblxyXG5mdW5jdGlvbiBndW5VcGRhdGUoKSB7XHJcbiAgIGlmICghdGhpcy5jdWJlLm15Q29ubmVjdGlvbiB8fCAhdGhpcy5hY3QpIHtcclxuICAgICAgdGhpcy5jdWJlLmFuaW1hdGlvbnMuc3RvcCgpO1xyXG5cdCAgcmV0dXJuO1xyXG4gICB9XHJcbiAgIGlmICh0aGlzLnRpbWVyIDw9IDApIHtcclxuICAgICAgdmFyIGFuZ2xlID0gdGhpcy5jdWJlLmJvZHkucm90YXRpb24gJSAoMipNYXRoLlBJKTtcclxuICAgICAgdmFyIGRpcmVjdGlvbiA9IFtNYXRoLnNpbihhbmdsZSksIC1NYXRoLmNvcyhhbmdsZSldO1xyXG4gICAgICB2YXIgZGVsdGFEaXN0ID0gTWF0aC5zcXJ0KE1hdGgucG93KHRoaXMuY3ViZS5kZWx0YVgsIDIpICsgTWF0aC5wb3codGhpcy5jdWJlLmRlbHRhWSwgMikpO1xyXG4gICAgICB2YXIgc3BlZWQgPSBkZWx0YURpc3QgKiA1MDtcclxuICAgICAgbmV3IEJ1bGxldCh0aGlzLmdhbWVTdGF0ZSwgdGhpcy5jdWJlLnggKyAzMCpkaXJlY3Rpb25bMF0sIHRoaXMuY3ViZS55ICsgMzAqZGlyZWN0aW9uWzFdLCBcclxuICAgICAgICAgICAgICAgZGlyZWN0aW9uLCBzcGVlZCwgdGhpcy50YWcgKyAnQnVsbGV0Jyk7XHJcblx0ICB0aGlzLmd1bi5wbGF5KCk7XHJcbiAgICAgIHRoaXMudGltZXIgPSA0MDA7XHJcbiAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudGltZXIgLT0gdGhpcy5nYW1lU3RhdGUuZ2FtZS50aW1lLmVsYXBzZWQ7XHJcbiAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaGFja2FibGVVcGRhdGUoKSB7XHJcbiAgIHRoaXMuaGFja0Jhci5zZXRMb2NhdGlvbih0aGlzLmN1YmUueCwgdGhpcy5jdWJlLnkgLSAyNSk7XHJcbiAgIGlmICh0aGlzLmJhckZhZGVEZWxheSA8PSAwICYmIHRoaXMuaGFja0Jhci5ncmFwaGljcy5hbHBoYSA+IDApIHtcclxuICAgICAgdGhpcy5oYWNrQmFyLmdyYXBoaWNzLmFscGhhIC09IHRoaXMuZ2FtZVN0YXRlLnRpbWUuZWxhcHNlZCAqIHRoaXMuYmFyRmFkZTtcclxuICAgfSBlbHNlIGlmICh0aGlzLmJhckZhZGVEZWxheSA+IDApIHtcclxuICAgICAgdGhpcy5iYXJGYWRlRGVsYXkgLT0gdGhpcy5nYW1lU3RhdGUudGltZS5lbGFwc2VkO1xyXG4gICB9XHJcblx0Ly9jaGVjayBpZiBnZXR0aW5nIGhhY2tlZFxyXG5cdGlmKCF0aGlzLmlzSGFja2VkKSB7XHJcblx0XHR0aGlzLmN1YmUuYW5pbWF0aW9ucy5wbGF5KCdoYWNrYWJsZScpO1xyXG5cdFx0aWYodGhpcy5nYW1lU3RhdGUucGxheWVyLmFjdGl2ZUhhY2tlck1vZHVsZXMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHR2YXIgZGlzdDtcclxuXHRcdFx0dmFyIGhhY2tlcjtcclxuXHRcdFx0Ly9Mb29wIHRocm91Z2ggYWxsIGhhY2tlciBtb2R1bGVzIG9uIHRoZSBwbGF5ZXIncyBjdWJzYXRcclxuXHRcdFx0Zm9yKHZhciBpID0gMDsgaSA8IHRoaXMuZ2FtZVN0YXRlLnBsYXllci5hY3RpdmVIYWNrZXJNb2R1bGVzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0aGFja2VyID0gdGhpcy5nYW1lU3RhdGUucGxheWVyLmFjdGl2ZUhhY2tlck1vZHVsZXNbaV07XHJcblx0XHRcdFx0ZGlzdCA9IE1hdGguc3FydCggTWF0aC5wb3codGhpcy5jdWJlLnggLSBoYWNrZXIuY3ViZS54LCAyKSArIE1hdGgucG93KHRoaXMuY3ViZS55IC0gaGFja2VyLmN1YmUueSwgMikgKTtcclxuXHRcdFx0XHRpZihkaXN0IDwgdGhpcy5oYWNrRGlzdGFuY2UpIHtcclxuXHRcdFx0XHRcdC8vSWYgaGFja2VyIGlzIGluIHJhbmdlLCBpbmNyZWFzZSBoYWNrIHZhbHVlIGFuZCB0cnkgdG8gZW1pdCBiaW5hcnkgcGFydGljbGVcclxuICAgICAgICAgICAgICAgaWYgKHRoaXMuYmVpbmdIYWNrZWQpIHtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5iZWluZ0hhY2tlZFByZXYgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIHRoaXMuYmVpbmdIYWNrZWQgPSB0cnVlO1xyXG5cdFx0XHRcdFx0dGhpcy5oYWNrQmFyLmFkZFZhbHVlKDAuMSk7XHJcblx0XHRcdFx0XHRoYWNrZXIuY291bnQrKztcclxuXHRcdFx0XHRcdGlmKGhhY2tlci5jb3VudCA+PSBoYWNrZXIuY3ljbGUpIHtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5oYWNrQmFyLmdyYXBoaWNzLmFscGhhID0gMTtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5iYXJGYWRlRGVsYXkgPSB0aGlzLmJhckZhZGVNYXhEZWxheTtcclxuXHRcdFx0XHRcdFx0aGFja2VyLmNvdW50ID0gMDtcclxuXHRcdFx0XHRcdFx0dGhpcy5nYW1lU3RhdGUuQmluYXJ5RW1pdHRlci5lbWl0QmluYXJ5KHRoaXMuY3ViZSwgaGFja2VyLmN1YmUueCwgaGFja2VyLmN1YmUueSwgNjApO1xyXG5cdFx0XHRcdFx0XHRpZihoYWNrZXIuY3ViZS5mcmFtZSA9PT0gNSkge1xyXG5cdFx0XHRcdFx0XHRcdGhhY2tlci5jdWJlLmZyYW1lID0gMDtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRoYWNrZXIuY3ViZS5mcmFtZSsrO1xyXG5cdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRoYWNrZXIuY3ViZS5hbmltYXRpb25zLnN0b3AoKTtcclxuICAgICAgICAgICAgICAgaWYoIXRoaXMuYmVpbmdIYWNrZWQpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5iZWluZ0hhY2tlZFByZXYgPSBmYWxzZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHRoaXMuYmVpbmdIYWNrZWQgPSBmYWxzZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9IGVsc2UgaWYgKHRoaXMuZGVsYXkgPCAwKSB7XHJcbiAgICAgIHRoaXMuaGFja2luZy5zdG9wKCk7XHJcbiAgICAgIHRoaXMuaGFja0Jhci5kZXN0cm95KCk7XHJcbiAgICAgIHRoaXMuY3ViZS5kaWVRdWljaygpO1xyXG4gICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmhhY2tpbmcuc3RvcCgpO1xyXG4gICAgICB0aGlzLmRlbGF5IC09IHRoaXMuZ2FtZVN0YXRlLnRpbWUuZWxhcHNlZDtcclxuICAgfVxyXG4gICBpZih0aGlzLmJlaW5nSGFja2VkID09PSB0cnVlICYmIHRoaXMuYmVpbmdIYWNrZWRQcmV2ID09PSBmYWxzZSkge1xyXG5cdFx0aWYodGhpcy5oYWNraW5nLnBhdXNlZCA9PT0gdHJ1ZSkge1xyXG5cdFx0XHR0aGlzLmhhY2tpbmcucmVzdW1lKCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5oYWNraW5nLnBsYXkoKTtcclxuXHRcdH1cclxuXHR9XHJcblx0ZWxzZSBpZih0aGlzLmJlaW5nSGFja2VkID09PSBmYWxzZSAmJiB0aGlzLmJlaW5nSGFja2VkUHJldiA9PT0gdHJ1ZSl7XHJcblx0XHR0aGlzLmhhY2tpbmcucGF1c2UoKTtcclxuXHR9XHJcbn1cclxuLyoqIEVuZCBtb2R1bGUgZnVuY3Rpb25zICoqL1xyXG5cclxuLy9jYWxsIHRoaXMgZnVuY3Rpb24gZnJvbSBNb2R1bGVCdWlsZGVyIHRvIGNvbnN0cnVjdCBtb2R1bGVzXHJcbi8vVFlQRVM6ICdjb3JlJyAnc2hpZWxkJyAndGhydXN0ZXInICdzb2xhclBhbm5lbCcgJ2hhY2tlcidcclxuTW9kdWxlQnVpbGRlci5wcm90b3R5cGUuYnVpbGQgPSBmdW5jdGlvbih0eXBlLCB4LCB5LCBmb3JQbGF5ZXIpIHtcdFxyXG5cdC8vQ3JlYXRlIGN1YmUgb2JqZWN0IHRvIGJlIHN0b3JlZCB3aXRoaW4gbW9kdWxlXHJcblx0Ly9TcHJpdGUgbmFtZXMgZm9yIG1vZHVsZXMgYXJlIGRpcmVjdGx5IG1hcHBlZCB0byBtb2R1bGUgbmFtZXMsIHNvIGp1c3QgcGFzcyAndHlwZScgYXMgc3ByaXRlIG5hbWVcclxuXHR2YXIgbmV3Q3ViZSA9IG5ldyBDdWJlKHRoaXMuZ2FtZVN0YXRlLCB4LCB5LCB0eXBlKTtcclxuICAgIHZhciBzY2FsZSA9IDAuNTtcclxuICAgIG5ld0N1YmUubmFtZSA9IHRoaXMuZ2FtZVN0YXRlLmRlYnVnTnVtKys7XHJcbiAgICBuZXdDdWJlLnNjYWxlLnNldFRvKHNjYWxlLCBzY2FsZSk7XHJcbiAgICBuZXdDdWJlLmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XHJcblx0XHJcblx0Ly9DcmVhdGUgcGh5c2ljcyBmb3IgbmV3IGN1YmVcclxuICAgIHRoaXMuZ2FtZVN0YXRlLmdhbWUucGh5c2ljcy5wMi5lbmFibGUobmV3Q3ViZSk7XHJcblx0bmV3Q3ViZS5ib2R5LnNldENvbGxpc2lvbkdyb3VwKHRoaXMuZ2FtZVN0YXRlLmNvbGxpc2lvbkdyb3VwKTtcclxuXHRuZXdDdWJlLmJvZHkuY29sbGlkZXModGhpcy5nYW1lU3RhdGUuY29sbGlzaW9uR3JvdXApO1xyXG5cdG5ld0N1YmUuYm9keS5vbkJlZ2luQ29udGFjdC5hZGQobmV3Q3ViZS5jdWJlQ29sbGlkZSwgbmV3Q3ViZSk7XHJcbiAgIG5ld0N1YmUuYm9keS5kYW1waW5nID0gMC45O1xyXG4gICBuZXdDdWJlLmJvZHkuYW5ndWxhckRhbXBpbmcgPSAwLjk7XHJcbiBcclxuICAgdmFyIGNJbmRpY2F0b3IgPSB0aGlzLmdhbWVTdGF0ZS5hZGQuc3ByaXRlKDAsIDAsICdjb25uZWN0aW9ucycsICdjb25uZWN0aW9uX2xpbmUucG5nJyk7XHJcbiAgIGNJbmRpY2F0b3IuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcclxuICAgY0luZGljYXRvci5hbmltYXRpb25zLmFkZCgnZW5kJywgWydjb25uZWN0aW9uX2VuZC5wbmcnXSwgNjAsIHRydWUpO1xyXG4gICBjSW5kaWNhdG9yLmFuaW1hdGlvbnMuYWRkKCdsaW5lJywgWydjb25uZWN0aW9uX2xpbmUucG5nJ10sIDYwLCB0cnVlKTtcclxuICAgY0luZGljYXRvci5hbmltYXRpb25zLmFkZCgncmlnaHQnLCBbJ2Nvbm5lY3Rpb25fcmlnaHQucG5nJ10sIDYwLCB0cnVlKTtcclxuICAgbmV3Q3ViZS5hZGRDaGlsZChjSW5kaWNhdG9yKTtcclxuICAgbmV3Q3ViZS5jSW5kaWNhdG9yID0gY0luZGljYXRvcjtcclxuICAgY0luZGljYXRvci5hbHBoYSA9IDA7XHJcblx0XHJcblx0Ly9DcmVhdGUgbW9kdWxlIHRvIHdyYXAgYXJvdW5kIGN1YmUgY2xhc3NcclxuXHR2YXIgbmV3TW9kdWxlID0gbmV3IE1vZHVsZSh0eXBlLCBuZXdDdWJlLCB0aGlzLmdhbWVTdGF0ZSk7XHJcblx0XHRcclxuXHQvL1RPRE86IGVkaXQgc3BlY2lhbCBtb2R1bGUgYXR0cmlidXRlcyBiYXNlZCBvbiAndHlwZSdcclxuXHRpZih0eXBlID09PSAnaGFja2VyJykge1xyXG5cdFx0bmV3TW9kdWxlLmN5Y2xlID0gNjtcclxuXHRcdG5ld01vZHVsZS5jb3VudCA9IDA7XHJcblx0XHRuZXdNb2R1bGUuY3ViZS5hbmltYXRpb25zLmFkZCgnaGFja2VyJywgWzAsMSwyLDMsNF0sIDEwLCB0cnVlKTtcclxuICAgICAgbmV3TW9kdWxlLm9uUmVtb3ZlID0gZ2VuZXJpY09uUmVtb3ZlO1xyXG4gICAgICBuZXdNb2R1bGUub25Mb3NlQ29ubmVjdGlvbiA9IGhhY2tlck9uTG9zZUNvbm5lY3Rpb247XHJcbiAgICAgIG5ld01vZHVsZS5wb3dlcmFibGUgPSB0cnVlO1xyXG5cdH1cclxuXHRcclxuXHQvL1N0b3JlIG1vZHVsZSBpZiBpdCBpcyBjb3JlXHJcblx0aWYodHlwZSA9PT0gJ2NvcmUnKVxyXG5cdHtcclxuXHRcdG5ld01vZHVsZS5jdWJlLmFuaW1hdGlvbnMuYWRkKCdjb3JlJywgWzAsMSwyXSwgMjAsIHRydWUpO1xyXG5cdFx0bmV3TW9kdWxlLmN1YmUuYW5pbWF0aW9ucy5wbGF5KCdjb3JlJyk7XHJcblx0XHR0aGlzLmNvcmUgPSBuZXdNb2R1bGU7XHJcblx0XHR0aGlzLmNvcmVFeGlzdHMgPSB0cnVlO1xyXG4gICAgICBuZXdNb2R1bGUub25SZW1vdmUgPSBnZW5lcmljT25SZW1vdmU7XHJcblx0fVxyXG4gICBcclxuICAgLy8gc29sYXIgcGFuZWwgdGVzdGluZ1xyXG4gICBpZiAodHlwZSA9PT0gJ3NvbGFyUGFuZWwnKSB7XHJcblx0ICBuZXdNb2R1bGUubW9kdWxlUG93ZXIgPSB0aGlzLmdhbWVTdGF0ZS5hZGQuYXVkaW8oJ21vZHVsZVBvd2VyJywgMC41KTtcclxuICAgICAgbmV3TW9kdWxlLmdpdmVUYXJnZXQgPSBzb2xhclBhbmVsR2l2ZVRhcmdldDtcclxuICAgICAgbmV3TW9kdWxlLm1vdXNlT3ZlciA9IHNvbGFyUGFuZWxNb3VzZU92ZXI7XHJcbiAgICAgIG5ld01vZHVsZS5vblJlbW92ZSA9IGdlbmVyaWNPblJlbW92ZTtcclxuICAgfVxyXG4gICBcclxuICAgLy9UaHJ1c3RlciBtb2R1bGUgZXZlbnRzXHJcblx0aWYodHlwZSA9PT0gJ3RocnVzdGVyJykge1xyXG5cdCAgbmV3TW9kdWxlLmlzVGhydXN0ID0gZmFsc2U7XHJcblx0ICBuZXdNb2R1bGUuaXNUaHJ1c3RQcmV2ID0gZmFsc2U7XHJcblx0ICBuZXdNb2R1bGUudGhydXN0ZXJMb29wID0gdGhpcy5nYW1lU3RhdGUuYWRkLmF1ZGlvKCd0aHJ1c3Rlckxvb3AnLCAxLCB0cnVlKTtcclxuXHQgIG5ld01vZHVsZS50aHJ1c3Rlckxvb3AuYWxsb3dNdWx0aXBsZSA9IHRydWU7XHJcbiAgICAgIGlmIChmb3JQbGF5ZXIpIHtcclxuICAgICAgICAgdmFyIHRocnVzdGVyS2V5ID0gdGhpcy5nYW1lU3RhdGUuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5LZXlib2FyZC5XKTsgXHJcbiAgICAgICAgIHRoaXMuZ2FtZVN0YXRlLmlucHV0LmtleWJvYXJkLmFkZEtleUNhcHR1cmUoW3RocnVzdGVyS2V5XSk7XHJcbiAgICAgICAgIHRocnVzdGVyS2V5Lm9uRG93bi5hZGQoYmVnaW5BY3QsIG5ld01vZHVsZSk7XHJcbiAgICAgICAgIHRocnVzdGVyS2V5Lm9uVXAuYWRkKGVuZEFjdCwgbmV3TW9kdWxlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgLy8gbmV3TW9kdWxlLnRocnVzdCA9IGZhbHNlO1xyXG4gICAgICAgICBuZXdNb2R1bGUuYmVnaW5BY3QgPSBiZWdpbkFjdDtcclxuICAgICAgICAgbmV3TW9kdWxlLmVuZEFjdCA9IGVuZEFjdDtcclxuICAgICAgfVxyXG4gICAgICBuZXdNb2R1bGUudXBkYXRlID0gdGhydXN0ZXJVcGRhdGU7XHJcbiAgICAgIG5ld01vZHVsZS50aHJ1c3RlckhhbHQgPSB0aHJ1c3RlckhhbHQ7XHJcbiAgICAgIG5ld01vZHVsZS5vblJlbW92ZSA9IGdlbmVyaWNPblJlbW92ZTtcclxuICAgICAgbmV3TW9kdWxlLnBvd2VyYWJsZSA9IHRydWU7XHJcblx0fVxyXG5cclxuXHQvL0d1biBtb2R1bGUgZXZlbnRzXHJcblx0aWYodHlwZSA9PT0gJ2d1bicpIHtcclxuXHQgIG5ld01vZHVsZS5jdWJlLmFuaW1hdGlvbnMuYWRkKCdndW4nLCBbMCwxLDIsMyw0LDVdLCAxNiwgdHJ1ZSk7XHJcblx0ICBuZXdNb2R1bGUuZ3VuID0gdGhpcy5nYW1lU3RhdGUuYWRkLmF1ZGlvKCdndW4nKTtcclxuXHQgIG5ld01vZHVsZS5ndW4uYWxsb3dNdWx0aXBsZSA9IHRydWU7XHJcbiAgICAgIGlmIChmb3JQbGF5ZXIpIHtcclxuXHQgICAgIG5ld01vZHVsZS50YWcgPSAncGxheWVyJztcclxuICAgICAgICAgdmFyIGFjdEtleSA9IHRoaXMuZ2FtZVN0YXRlLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuS2V5Ym9hcmQuU1BBQ0VCQVIpO1xyXG4gICAgICAgICB0aGlzLmdhbWVTdGF0ZS5pbnB1dC5rZXlib2FyZC5hZGRLZXlDYXB0dXJlKFthY3RLZXldKTtcclxuICAgICAgICAgYWN0S2V5Lm9uRG93bi5hZGQoYmVnaW5BY3QsIG5ld01vZHVsZSk7XHJcbiAgICAgICAgIGFjdEtleS5vblVwLmFkZChlbmRBY3QsIG5ld01vZHVsZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcblx0XHQgbmV3TW9kdWxlLnRhZyA9ICdlbmVteSc7XHJcbiAgICAgICAgIG5ld01vZHVsZS5iZWdpbkFjdCA9IGJlZ2luQWN0O1xyXG4gICAgICAgICBuZXdNb2R1bGUuZW5kQWN0ID0gZW5kQWN0O1xyXG4gICAgICB9XHJcblx0ICBuZXdNb2R1bGUudXBkYXRlID0gZ3VuVXBkYXRlO1xyXG4gICAgIG5ld01vZHVsZS5vblJlbW92ZSA9IGdlbmVyaWNPblJlbW92ZTtcclxuICAgICBuZXdNb2R1bGUucG93ZXJhYmxlID0gdHJ1ZTtcclxuXHR9XHJcbiAgIFxyXG4gICBpZiAodHlwZSA9PT0gJ2hhY2thYmxlJykge1xyXG4gICAgICAvLyBzZXQgdmFsdWVzXHJcbiAgICAgIG5ld01vZHVsZS5pc0hhY2tlZCA9IGZhbHNlO1xyXG4gICAgICBuZXdNb2R1bGUuaGFja0Rpc3RhbmNlID0gNDAwO1xyXG4gICAgICBuZXdNb2R1bGUuY3ViZS5hbmltYXRpb25zLmFkZCgnaGFja2FibGUnLCBbMCwxLDIsMyw0XSwgMTAsIHRydWUpO1xyXG4gICAgICBuZXdNb2R1bGUuY3ViZS5hbmltYXRpb25zLmFkZCgnaGFja2VkJywgWzUsNiw3LDgsOV0sIDEwLCB0cnVlKTtcclxuICAgICAgbmV3TW9kdWxlLmJhckZhZGUgPSAwLjAwMTtcclxuICAgICAgbmV3TW9kdWxlLmJhckZhZGVNYXhEZWxheSA9IDIwMDtcclxuICAgICAgbmV3TW9kdWxlLmJhckZhZGVEZWxheSA9IDA7XHJcbiAgICAgIG5ld01vZHVsZS5kZWxheSA9IDE2MDA7XHJcbiAgICAgIG5ld01vZHVsZS5iZWluZ0hhY2tlZCA9IGZhbHNlO1xyXG4gICAgICBuZXdNb2R1bGUuYmVpbmdIYWNrZWRQcmV2ID0gZmFsc2U7XHJcbiAgICAgIG5ld01vZHVsZS5oYWNraW5nID0gdGhpcy5nYW1lU3RhdGUuYWRkLmF1ZGlvKCdoYWNraW5nJywgMSwgdHJ1ZSk7XHJcbiAgICAgIC8vIGdpdmUgcHJvZ3Jlc3MgYmFyXHJcbiAgICAgIG5ld01vZHVsZS5oYWNrQmFyID0gdGhpcy5nYW1lU3RhdGUudWlCdWlsZGVyLmJ1aWxkUHJvZ3Jlc3NCYXIoJ2dyb3dpbmcnLCAxNTAwLCAxMjAwLCAxMDAsIDEwLCAgMjAwKTtcclxuICAgICAgbmV3TW9kdWxlLmhhY2tCYXIuc2V0U3R5bGUoMCwgMHhGRkZGRkYsIDB4MzYzNjM2LCAwLCAwLCAwLCAweEZGRkZGRiwgMHgyMDIwQ0MpO1xyXG4gICAgICBuZXdNb2R1bGUuaGFja0Jhci5oYWNrYWJsZSA9IG5ld01vZHVsZS5jdWJlO1xyXG4gICAgICBuZXdNb2R1bGUuaGFja0Jhci5vbkV2ZW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgIHRoaXMuaGFja2FibGUuYW5pbWF0aW9ucy5zdG9wKCk7XHJcbiAgICAgICAgIHRoaXMuaGFja2FibGUuYW5pbWF0aW9ucy5wbGF5KCdoYWNrZWQnKTtcclxuICAgICAgICAgdGhpcy5oYWNrYWJsZS5tb2R1bGUuaXNIYWNrZWQgPSB0cnVlO1xyXG4gICAgICB9O1xyXG4gICAgICAvLyBhZGQgZnVuY3Rpb25zXHJcbiAgICAgIG5ld01vZHVsZS51cGRhdGUgPSBoYWNrYWJsZVVwZGF0ZTtcclxuICAgICAgbmV3TW9kdWxlLm9uUmVtb3ZlID0gZ2VuZXJpY09uUmVtb3ZlO1xyXG4gICB9XHJcblx0Ly9SZXR1cm4gdGhlIG1vZHVsZSBvYmplY3RcclxuXHRyZXR1cm4gbmV3TW9kdWxlO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBNb2R1bGVCdWlsZGVyO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4iLCJ2YXIgQ2hlYXRpbmcgPSBmdW5jdGlvbihzdGF0ZSkge1xyXG4gICAvLyBpbml0aWFsaXNhdGlvblxyXG5cdHRoaXMuc3RhdGUgPSBzdGF0ZTtcclxuICAgdGhpcy5nYW1lID0gc3RhdGUuZ2FtZTtcclxuICAgdGhpcy5jYW0gPSB0aGlzLmdhbWUuY2FtZXJhO1xyXG4gICB0aGlzLm1vdXNlID0gdGhpcy5zdGF0ZS5tb3VzZTtcclxuICAgLy8gYnV0dG9uc1xyXG4gICAvL2NvcmVcclxuXHR0aGlzLnBsYWNlQ29yZUtleSA9IHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLktleWJvYXJkLlApO1xyXG5cdHRoaXMucGxhY2VDb3JlS2V5Lm9uRG93bi5hZGQodGhpcy5kZWJ1Z0FkZE1vZHVsZSwge2NhbGxlcjogdGhpcywga2V5OiAnY29yZSd9KTtcclxuXHQvL3NoaWVsZFxyXG5cdHRoaXMucGxhY2VTaGllbGRLZXkgPSB0aGlzLmdhbWUuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5LZXlib2FyZC5PKTtcclxuICAgIHRoaXMucGxhY2VTaGllbGRLZXkub25Eb3duLmFkZCh0aGlzLmRlYnVnQWRkTW9kdWxlLCB7Y2FsbGVyOiB0aGlzLCBrZXk6ICdzaGllbGQnfSk7XHJcblx0Ly90aHJ1c3RlclxyXG5cdHRoaXMucGxhY2VUaHJ1c3RlcktleSA9IHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLktleWJvYXJkLkkpO1xyXG4gICAgdGhpcy5wbGFjZVRocnVzdGVyS2V5Lm9uRG93bi5hZGQodGhpcy5kZWJ1Z0FkZE1vZHVsZSwge2NhbGxlcjogdGhpcywga2V5OiAndGhydXN0ZXInfSk7XHJcblx0Ly9zb2xhclBhbmVsXHJcblx0dGhpcy5wbGFjZVNQS2V5ID0gdGhpcy5nYW1lLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuS2V5Ym9hcmQuVSk7XHJcbiAgICB0aGlzLnBsYWNlU1BLZXkub25Eb3duLmFkZCh0aGlzLmRlYnVnQWRkTW9kdWxlLCB7Y2FsbGVyOiB0aGlzLCBrZXk6ICdzb2xhclBhbmVsJ30pO1xyXG5cdC8vaGFja2VyXHJcblx0dGhpcy5wbGFjZUhhY2tLZXkgPSB0aGlzLmdhbWUuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5LZXlib2FyZC5ZKTtcclxuXHR0aGlzLnBsYWNlSGFja0tleS5vbkRvd24uYWRkKHRoaXMuZGVidWdBZGRNb2R1bGUsIHtjYWxsZXI6IHRoaXMsIGtleTogJ2hhY2tlcid9KTtcclxuXHQvL2d1blxyXG5cdHRoaXMucGxhY2VHdW5LZXkgPSB0aGlzLmdhbWUuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5LZXlib2FyZC5UKTtcclxuICAgIHRoaXMucGxhY2VHdW5LZXkub25Eb3duLmFkZCh0aGlzLmRlYnVnQWRkTW9kdWxlLCB7Y2FsbGVyOiB0aGlzLCBrZXk6ICdndW4nfSk7XHJcblx0Ly9oYWNrYWJsZVxyXG5cdHRoaXMucGxhY2VIYWNrYWJsZUtleSA9IHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLktleWJvYXJkLkwpO1xyXG4gICB0aGlzLnBsYWNlSGFja2FibGVLZXkub25Eb3duLmFkZCh0aGlzLmRlYnVnQWRkTW9kdWxlLCB7Y2FsbGVyOiB0aGlzLCBrZXk6ICdoYWNrYWJsZSd9KTtcclxufTtcclxuXHJcbkNoZWF0aW5nLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IENoZWF0aW5nO1xyXG5cclxuQ2hlYXRpbmcucHJvdG90eXBlLmRlYnVnQWRkTW9kdWxlID0gZnVuY3Rpb24oKSB7XHJcbiAgIHRoaXMuY2FsbGVyLnN0YXRlLm1vZHVsZUJ1aWxkZXIuYnVpbGQodGhpcy5rZXksIHRoaXMuY2FsbGVyLm1vdXNlLngsIHRoaXMuY2FsbGVyLm1vdXNlLnksIHRydWUpO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBDaGVhdGluZztcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiIsIi8qXHJcbkRlZmluZXMgYSBjdWJlLlxyXG4qL1xyXG5cclxudmFyIEN1YmUgPSBmdW5jdGlvbiAoZ2FtZVN0YXRlLCB4LCB5LCBzcHJpdGUpIHtcclxuICAgIFBoYXNlci5TcHJpdGUuY2FsbCh0aGlzLCBnYW1lU3RhdGUuZ2FtZSwgeCwgeSwgc3ByaXRlKTtcclxuXHQgdGhpcy50YWcgPSAnbW9kdWxlJztcdC8vdGFnIGlzIHVzZWQgdG8gZGV0ZWN0IG9iamVjdCB0eXBlIGR1cmluZyBjb2xsaXNpb24gY2hlY2tpbmdcclxuICAgIHRoaXMuZ2FtZSA9IGdhbWVTdGF0ZS5nYW1lO1xyXG5cdHRoaXMuZ2FtZVN0YXRlID0gZ2FtZVN0YXRlO1xyXG4gICAgdGhpcy5nYW1lLmFkZC5leGlzdGluZyh0aGlzKTtcclxuICAgIHRoaXMuZ3JvdXAgPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLm1vZHVsZSA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMuaW5kaWNhdG9yRmFkZSA9IDAuMDI7XHJcbiAgICB0aGlzLmhlYWx0aEJhciA9IGdhbWVTdGF0ZS51aUJ1aWxkZXIuYnVpbGRQcm9ncmVzc0Jhcignc2hyaW5raW5nJywgMCwgMCwgMjAsIDQsIDMpO1xyXG5cdHRoaXMuaGVhbHRoQmFyLnNldFN0eWxlKDAsIDB4RkZGRkZGLCAweDM2MzYzNiwgMCwgMCwgMCwgMHhGRkZGRkYsIDB4MjBDQzIwKTtcclxuXHR0aGlzLmhlYWx0aEJhci5jdWJlID0gdGhpcztcclxuXHR0aGlzLmhlYWx0aEJhckZhZGUgPSAwLjAwMDg7XHJcblx0dGhpcy5pbXBhY3QgPSB0aGlzLmdhbWUuYWRkLmF1ZGlvKCdtb2R1bGVJbXBhY3QnKTtcclxuXHR0aGlzLmltcGFjdC52b2x1bWUgPSAwLjI1O1xyXG5cdHRoaXMuaW1wYWN0LmFsbG93TXVsdGlwbGUgPSB0cnVlO1xyXG5cdC8vc2V0IHVwZGF0ZSBmdW5jdGlvbiBvZiBoZWFsdGggYmFyXHJcblx0dGhpcy5oZWFsdGhCYXIudXBkYXRlID0gZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnNldExvY2F0aW9uKHRoaXMuY3ViZS54LCB0aGlzLmN1YmUueSsxMCk7XHJcblx0fTtcclxuXHQvL29uRXZlbnQgY2FsbGVkIHdoZW4gY3ViZSBydW5zIG91dCBvZiBoZWFsdGhcclxuXHR0aGlzLmhlYWx0aEJhci5vbkV2ZW50ID0gZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmN1YmUuZHlpbmcgPSB0cnVlO1xyXG5cdFx0dGhpcy5jdWJlLmxpZmUgPSA1MDtcclxuXHRcdC8vIHRoaXMuZ3JvdXAuY291bnRDdWJlcygpO1xyXG5cdFx0Ly8gdGhpcy5kZXN0cm95KCk7XHJcblx0fTtcclxuXHR0aGlzLmNvbnN0cmFpbnRzID0gW107XHJcbn07XHJcblxyXG5DdWJlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUGhhc2VyLlNwcml0ZS5wcm90b3R5cGUpO1xyXG5DdWJlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEN1YmU7XHJcblxyXG4vKipcclxuICogQXV0b21hdGljYWxseSBjYWxsZWQgYnkgV29ybGQudXBkYXRlXHJcbiAqL1xyXG5DdWJlLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcclxuICAgaWYgKHRoaXMuY0luZGljYXRvciAmJiB0aGlzLmNJbmRpY2F0b3IuYWxwaGEgPiAwKSB7XHJcbiAgICAgIHRoaXMuY0luZGljYXRvci5hbHBoYSAtPSB0aGlzLmluZGljYXRvckZhZGU7XHJcbiAgIH1cclxuICAgaWYgKHRoaXMubW9kdWxlLnVwZGF0ZSkge1xyXG4gICAgICB0aGlzLm1vZHVsZS51cGRhdGUoKTtcclxuICAgfVxyXG4gICBpZiAodGhpcy5oZWFsdGhCYXIuZ3JhcGhpY3MuYWxwaGEgPiAwKSB7XHJcbiAgICAgIHRoaXMuaGVhbHRoQmFyLmdyYXBoaWNzLmFscGhhIC09IHRoaXMuaGVhbHRoQmFyRmFkZSAqIHRoaXMuZ2FtZS50aW1lLmVsYXBzZWQ7XHJcbiAgIH1cclxuICAgaWYgKHRoaXMuZHlpbmcpIHtcclxuICAgICAgdGhpcy5saWZlIC09IHRoaXMuZ2FtZS50aW1lLmVsYXBzZWQ7XHJcbiAgICAgIGlmICh0aGlzLmxpZmUgPCAwKSB7XHJcbiAgICAgICAgIHRoaXMuZHlpbmcgPSBmYWxzZTtcclxuICAgICAgICAgdGhpcy5oZWFsdGhCYXIuZGVzdHJveSgpO1xyXG4gICAgICAgICBpZiAodGhpcy5ncm91cCkge1xyXG4gICAgICAgICAgICBpZih0aGlzLnRhZyA9PT0gJ2VuZW15X21vZHVsZScpIHtcclxuICAgICAgICAgICAgICAgaWYodGhpcy5rZXkgPT09ICd0aHJ1c3RlcicpIHtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lU3RhdGUubW9uZXkgKz0gMzU7XHJcbiAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgZWxzZSBpZih0aGlzLmtleSA9PT0gJ3NoaWVsZCcpIHtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lU3RhdGUubW9uZXkgKz0gMTA7XHJcbiAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgZWxzZSBpZih0aGlzLmtleSA9PT0gJ2d1bicpIHtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lU3RhdGUubW9uZXkgKz0gNTA7XHJcbiAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgZWxzZSBpZih0aGlzLmtleSA9PT0gJ3NvbGFyUGFuZWwnKSB7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZVN0YXRlLm1vbmV5ICs9IDI1O1xyXG4gICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIHRoaXMuZ2FtZVN0YXRlLm1vbmV5VGV4dC50ZXh0ID0gdGhpcy5nYW1lU3RhdGUubW9uZXk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5ncm91cC5kZXN0cm95Q3ViZSh0aGlzKTtcclxuICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYodGhpcy5rZXkgPT09ICdjb3JlJyAmJiB0aGlzLnRhZyA9PT0gJ21vZHVsZScpIHtcclxuICAgICAgICAgICAgICAgdGhpcy5raWxsKCk7XHJcbiAgICAgICAgICAgICAgIHRoaXMuZ2FtZVN0YXRlLnJlc3RhcnRMZXZlbCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveSgpO1xyXG4gICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgfVxyXG59O1xyXG5cclxuQ3ViZS5wcm90b3R5cGUubG9zZUNvbm5lY3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICBpZiAoIXRoaXMubXlDb25uZWN0aW9uKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfSAgXHJcbiAgaWYgKHRoaXMubXlDb25uZWN0aW9uLnN0YXJ0ID09PSB0aGlzKSB7XHJcbiAgICAgIHZhciBlbmRNb2R1bGUgPSB0aGlzLm15Q29ubmVjdGlvbi5lbmQubW9kdWxlO1xyXG4gICAgICBpZiAoZW5kTW9kdWxlLmhhc093blByb3BlcnR5KCdvbkxvc2VDb25uZWN0aW9uJykpIHtcclxuICAgICAgICAgZW5kTW9kdWxlLm9uTG9zZUNvbm5lY3Rpb24oKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLm15Q29ubmVjdGlvbi5lbmQubXlDb25uZWN0aW9uID0gdW5kZWZpbmVkO1xyXG4gICAgICB0aGlzLm15Q29ubmVjdGlvbiA9IHVuZGVmaW5lZDtcclxuICAgfSBlbHNlIGlmICh0aGlzLm15Q29ubmVjdGlvbi5lbmQgPT09IHRoaXMpIHtcclxuICAgICAgdmFyIHN0YXJ0TW9kdWxlID0gdGhpcy5teUNvbm5lY3Rpb24uZW5kLm1vZHVsZTtcclxuICAgICAgaWYgKHN0YXJ0TW9kdWxlLmhhc093blByb3BlcnR5KCdvbkxvc2VDb25uZWN0aW9uJykpIHtcclxuICAgICAgICAgc3RhcnRNb2R1bGUub25Mb3NlQ29ubmVjdGlvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMubXlDb25uZWN0aW9uLnN0YXJ0Lm15Q29ubmVjdGlvbiA9IHVuZGVmaW5lZDtcclxuICAgICAgdGhpcy5teUNvbm5lY3Rpb24gPSB1bmRlZmluZWQ7XHJcbiAgIH1cclxufTtcclxuXHJcbkN1YmUucHJvdG90eXBlLmN1YmVDb2xsaWRlID0gZnVuY3Rpb24ob3RoZXIpIHtcclxuICAgLy8gZmxvYXRpbmcgY3ViZSwgYmFkIGNvbGxpc2lvbiwgY29sbGlzaW9uIHdpdGggbm9uLXNwcml0ZSwgY29sbGlzaW9uIHdpdGggbm9uLWN1YmVcclxuICAgaWYgKCF0aGlzLmdyb3VwIHx8ICFvdGhlciB8fCAhb3RoZXIuc3ByaXRlIHx8IG90aGVyLnByb3RvdHlwZSAhPT0gdGhpcy5wcm90b3R5cGUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICB9XHJcbiAgIGlmIChvdGhlci5ncm91cCAmJiB0aGlzLmdyb3VwID09PSBvdGhlci5ncm91cCkgey8vIGlmIGN1YmVzIGluIHNhbWUgZ3JvdXBcclxuICAgICAgcmV0dXJuO1xyXG4gICB9XHJcbiAgIGlmICh0aGlzLmdyb3VwLmlzUGxheWVyKSB7IC8vIHBsYXllclxyXG4gICAgICBpZiAob3RoZXIuc3ByaXRlLnRhZyA9PT0gJ2VuZW15X21vZHVsZScpIHsgLy8gY29sbGlzaW9uIHdpdGggZW5lbXksIHJhbW1pbmdcclxuICAgICAgICAgdGhpcy5ncm91cC5oYW5kbGVSYW1taW5nKHRoaXMsIG90aGVyLnNwcml0ZSk7XHJcbiAgICAgIH0gZWxzZSBpZiAob3RoZXIuc3ByaXRlLnRhZyA9PT0gJ21vZHVsZScpIHsgLy8gY29sbGlzaW9uIHdpdGggZmxvYXRpbmcsIGF0dGF0Y2hpbmdcclxuICAgICAgICAgdGhpcy5ncm91cC5oYW5kbGVBdHRhdGNoKHRoaXMsIG90aGVyLnNwcml0ZSk7XHJcbiAgICAgIH1cclxuICAgfSBlbHNlIHsvLyBlbmVteVxyXG4gICAgICB0aGlzLmdyb3VwLmhhbmRsZVJhbW1pbmcodGhpcywgb3RoZXIuc3ByaXRlKTsgLy8gZW5lbWllcyBvbmx5IHJhbSBvbiBjb2xsaXNpb25cclxuICAgfVxyXG4gICB0aGlzLmdyb3VwLmNvdW50Q3ViZXMoKTtcclxufTtcclxuXHJcbkN1YmUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgIHZhciBzdHJpbmcgPSAnJztcclxuICAgc3RyaW5nICs9IHRoaXMuY29uY2F0KCduYW1lJywgdGhpcy5uYW1lKTtcclxuICAgcmV0dXJuIHN0cmluZztcclxufTtcclxuXHJcbkN1YmUucHJvdG90eXBlLmNvbmNhdCA9IGZ1bmN0aW9uKHN0cmluZywgdmFsKSB7XHJcbiAgIHJldHVybiBzdHJpbmcgKyAnOiAnICsgdmFsICsgJ1xcbic7XHJcbn07XHJcblxyXG5DdWJlLnByb3RvdHlwZS5kaXNwbGF5SW5kaWNhdG9yID0gZnVuY3Rpb24oKSB7XHJcbiAgdGhpcy5jSW5kaWNhdG9yLmFscGhhID0gMTsgXHJcbn07XHJcblxyXG5DdWJlLnByb3RvdHlwZS5oaWRlSW5kaWNhdG9yID0gZnVuY3Rpb24oKSB7XHJcbiAgdGhpcy5jSW5kaWNhdG9yLmFscGhhID0gMDsgXHJcbn07XHJcblxyXG5DdWJlLnByb3RvdHlwZS50YWtlRGFtYWdlID0gZnVuY3Rpb24oYW10KSB7XHJcbiAgIHRoaXMuaW1wYWN0LnBsYXkoKTtcclxuICAgdGhpcy5oZWFsdGhCYXIuYWRkVmFsdWUoLWFtdCk7XHJcbiAgIHRoaXMuaGVhbHRoQmFyLmdyYXBoaWNzLmFscGhhID0gMTtcclxufTtcclxuXHJcbkN1YmUucHJvdG90eXBlLmRpZVF1aWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgdGhpcy5keWluZyA9IHRydWU7XHJcbiAgdGhpcy5saWZlID0gMDtcclxufTtcclxuXHJcbkN1YmUucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICBpZiAoIXRoaXMuZ3JvdXApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICB9XHJcbiAgIHRoaXMuZ3JvdXAucmVtb3ZlKHRoaXMpO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBDdWJlO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiIsInZhciBBc3RhciA9IHJlcXVpcmUoJy4uL2xpYnMvamF2YXNjcmlwdC1hc3Rhci9hc3RhcicpO1xyXG52YXIgRW5lbXlBSSA9IHJlcXVpcmUoJy4vZW5lbXlfYWknKTtcclxuXHJcbi8qXHJcbkRlZmluZXMgYSBjdWJlIGdyb3VwLlxyXG4qL1xyXG5cclxudmFyIEN1YmVHcm91cCA9IGZ1bmN0aW9uIChnYW1lLCByb290KSB7XHJcbiAgIHRoaXMuZ2FtZSA9IGdhbWU7XHJcbiAgIHRoaXMucm9vdCA9IHJvb3Q7XHJcbiAgIHRoaXMuY3ViZXMgPSBbXTtcclxuICAgdmFyIGNvbCA9IFtdO1xyXG4gICBjb2wucHVzaCh0aGlzLnJvb3QpO1xyXG4gICB0aGlzLmN1YmVzLnB1c2goY29sKTtcclxuICAgaWYgKHRoaXMucm9vdCkge1xyXG4gICAgICB0aGlzLnJvb3QuZ3JvdXAgPSB0aGlzO1xyXG4gICB9XHJcbiAgIHRoaXMuRElSID0ge05PUlRIOiAwLCBFQVNUOiAxLCBTT1VUSDogMiwgV0VTVDogM307XHJcbiAgIHRoaXMub2Zmc2V0ID0gMjtcclxuXHR0aGlzLmFjdGl2ZUhhY2tlck1vZHVsZXMgPSBbXTtcdC8vbGlzdCBvZiBoYWNrZXIgbW9kdWxlcyBpbiB0aGlzIGdyb3VwXHJcblx0Ly90aGlzLmFjdGl2ZUd1bnMgPSBbXTtcclxuXHR0aGlzLm1vZHVsZUNvbm5lY3QgPSB0aGlzLmdhbWUuYWRkLmF1ZGlvKCdtb2R1bGVDb25uZWN0Jyk7XHJcblx0dGhpcy5tb2R1bGVDb25uZWN0LmFsbG93TXVsdGlwbGUgPSB0cnVlO1xyXG5cclxuICAgdGhpcy5udW1DdWJlcyA9IDE7XHJcbiAgIHRoaXMuYm91bmNlQmFja0ZvcmNlID0gMzA7XHJcbiAgIHRoaXMubWluUmFtVmVsID0gMzAwO1xyXG4gICB0aGlzLmRlYnVnID0gZmFsc2U7XHJcbn07XHJcblxyXG5DdWJlR3JvdXAucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ3ViZUdyb3VwO1xyXG5cclxuLyoqXHJcbiAqIEF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IFdvcmxkLnVwZGF0ZVxyXG4gKi9cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcclxuICAgaWYgKHRoaXMuQUkpIHtcclxuICAgICAgdGhpcy5BSS51cGRhdGUoKTtcclxuICAgfVxyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24oZnVuKSB7XHJcbiAgIGZvciAodmFyIHJvdyA9IDA7IHJvdyA8IHRoaXMuY3ViZXNXaWR0aCgpOyByb3crKykge1xyXG4gICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCB0aGlzLmN1YmVzSGVpZ2h0KCk7IGNvbCsrKSB7XHJcbiAgICAgICAgIHZhciBjdWJlID0gdGhpcy5jdWJlc1tyb3ddW2NvbF07XHJcbiAgICAgICAgIGlmIChjdWJlICYmIGN1YmUuaGFzT3duUHJvcGVydHkoZnVuKSkge1xyXG4gICAgICAgICAgICAvLyBpZiBjdWJlcyBuZWVkIGZ1bmN0aW9ucyBjYWxsZWRcclxuICAgICAgICAgfSBlbHNlIGlmIChjdWJlICYmIGN1YmUubW9kdWxlICYmIGN1YmUubW9kdWxlLmhhc093blByb3BlcnR5KGZ1bikpIHtcclxuICAgICAgICAgICAgdmFyIGZuID0gY3ViZS5tb2R1bGVbZnVuXTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICBmbi5jYWxsKGN1YmUubW9kdWxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgfVxyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5jYWxsT25UeXBlID0gZnVuY3Rpb24oZnVuLCB0eXBlKSB7XHJcbiAgIGZvciAodmFyIHJvdyA9IDA7IHJvdyA8IHRoaXMuY3ViZXNXaWR0aCgpOyByb3crKykge1xyXG4gICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCB0aGlzLmN1YmVzSGVpZ2h0KCk7IGNvbCsrKSB7XHJcbiAgICAgICAgIHZhciBjdWJlID0gdGhpcy5jdWJlc1tyb3ddW2NvbF07XHJcbiAgICAgICAgIGlmIChjdWJlICYmIGN1YmUuaGFzT3duUHJvcGVydHkoZnVuKSkge1xyXG4gICAgICAgICAgICAvLyBpZiBjdWJlcyBuZWVkIGZ1bmN0aW9ucyBjYWxsZWRcclxuICAgICAgICAgfSBlbHNlIGlmIChjdWJlICYmIGN1YmUubW9kdWxlICYmIGN1YmUubW9kdWxlLnR5cGUgPT09IHR5cGUgJiYgY3ViZS5tb2R1bGUuaGFzT3duUHJvcGVydHkoZnVuKSkge1xyXG4gICAgICAgICAgICB2YXIgZm4gPSBjdWJlLm1vZHVsZVtmdW5dO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgIGZuLmNhbGwoY3ViZS5tb2R1bGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgIH1cclxuICAgICAgfVxyXG4gICB9XHJcbn07XHJcblxyXG5DdWJlR3JvdXAucHJvdG90eXBlLmdldE1vZHVsZXMgPSBmdW5jdGlvbih0eXBlKSB7XHJcbiAgIHZhciBtb2R1bGVzID0gW107XHJcbiAgIGZvciAodmFyIHJvdyA9IDA7IHJvdyA8IHRoaXMuY3ViZXNXaWR0aCgpOyByb3crKykge1xyXG4gICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCB0aGlzLmN1YmVzSGVpZ2h0KCk7IGNvbCsrKSB7XHJcbiAgICAgICAgIHZhciBjdWJlID0gdGhpcy5jdWJlc1tyb3ddW2NvbF07XHJcbiAgICAgICAgIGlmIChjdWJlICYmIGN1YmUubW9kdWxlLnR5cGUgPT09IHR5cGUpIHtcclxuICAgICAgICAgICAgbW9kdWxlcy5wdXNoKGN1YmUubW9kdWxlKTtcclxuICAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgIH1cclxuICAgcmV0dXJuIG1vZHVsZXM7XHJcbn07XHJcblxyXG5DdWJlR3JvdXAucHJvdG90eXBlLmdpdmVBSSA9IGZ1bmN0aW9uKHR5cGUsIHBsYXllcikge1xyXG4gICB0aGlzLkFJID0gbmV3IEVuZW15QUkodGhpcy5nYW1lLCB0aGlzLCB0eXBlLCBwbGF5ZXIpO1xyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihjdWJlLCBwb2ludCkge1xyXG4gIGlmICghdGhpcy5yb290ICYmIGN1YmUubW9kdWxlLnR5cGUgPT09ICdjb3JlJykge1xyXG4gICAgIHRoaXMucm9vdCA9IGN1YmU7XHJcbiAgfVxyXG4gIGN1YmUuZ3JvdXAgPSB0aGlzO1xyXG4gIHRoaXMuc2V0KGN1YmUsIHBvaW50KTtcclxuICB0aGlzLmNyZWF0ZUNvbnN0cmFpbnRzKGN1YmUsIHBvaW50KTtcclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUuaGFuZGxlQXR0YXRjaCA9IGZ1bmN0aW9uKG9yaWdpbiwgb3RoZXIpIHtcclxuICAgaWYgKHRoaXMuZGVidWcpIHsgY29uc29sZS5sb2coJ2hhbmRsZUNvbGxpc2lvbigpIHN0YXJ0OicsIG9yaWdpbi5tb2R1bGUudHlwZSwgb3RoZXIubW9kdWxlLnR5cGUpOyB9XHJcbiAgIGlmICh0aGlzLmRlYnVnKSB7IHRoaXMuZGlzcGxheUN1YmVzKCk7IH1cclxuICAgdmFyIHJlbFNpZGUgPSB0aGlzLnJlbGF0aXZlU2lkZShvcmlnaW4uYm9keSwgb3RoZXIuYm9keSk7XHJcbiAgIHZhciBvcmlnaW5Mb2MgPSB0aGlzLmZpbmQob3JpZ2luKTtcclxuICAgdmFyIG90aGVyTG9jID0gdGhpcy5jYWxjUG9zKG9yaWdpbiwgcmVsU2lkZSk7XHJcbiAgIHRoaXMubW9kdWxlQ29ubmVjdC5wbGF5KCk7XHJcbiAgIGlmICh0aGlzLmRlYnVnKSBjb25zb2xlLmxvZygnaGFuZGxlQ29sbGlzaW9uKCkgcHJlLWZpbmQ6JywgJ3JlbFNpZGU6JywgcmVsU2lkZSwgJ29yaWdpbkxvYzonLCBNYXRoLmZsb29yKG9yaWdpbkxvYy54KSwgTWF0aC5mbG9vcihvcmlnaW5Mb2MueSksICdvdGhlckxvYzonLCBNYXRoLmZsb29yKG90aGVyTG9jLngpLCBNYXRoLmZsb29yKG90aGVyTG9jLnkpKTsgLy8ganNoaW50IGlnbm9yZTpsaW5lXHJcbiAgIHRoaXMuc2V0KG90aGVyLCBvdGhlckxvYyk7XHJcbiAgIG90aGVyTG9jID0gdGhpcy5maW5kKG90aGVyKTsgLy8gdXBkYXRlIHBvc2l0aW9uIHNpbmNlIHNldCBjYW4gc2hpZnQgZ3JpZFxyXG4gICBpZiAoIW90aGVyTG9jKSB7XHJcbiAgICAgIGlmICh0aGlzLmRlYnVnKSB7XHJcbiAgICAgICAgIGNvbnNvbGUubG9nKCdoYW5kbGVDb2xsaXNpb24oKTogb3RoZXJMb2MgRE5FJywgJy0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xyXG4gICAgICAgICB0aGlzLmRpc3BsYXlDdWJlcygpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybjtcclxuICAgfVxyXG4gICBpZiAodGhpcy5kZWJ1ZykgY29uc29sZS5sb2coJ2hhbmRsZUNvbGxpc2lvbigpIHBvc3QtZmluZDonLCAnb3RoZXJMb2M6JywgTWF0aC5mbG9vcihvdGhlckxvYy54KSwgTWF0aC5mbG9vcihvdGhlckxvYy55KSk7IC8vIGpzaGludCBpZ25vcmU6bGluZVxyXG4gICB0aGlzLmNyZWF0ZUNvbnN0cmFpbnRzKG90aGVyLCBvdGhlckxvYyk7XHJcbiAgIGlmIChvdGhlci5tb2R1bGUudHlwZSA9PT0gJ3NvbGFyUGFuZWwnKSB7XHJcbiAgICAgIHRoaXMuY3JlYXRlQ29ubmVjdGlvbkZyb20ob3RoZXIpO1xyXG4gICB9IGVsc2UgaWYgKG90aGVyLm1vZHVsZS5wb3dlcmFibGUpIHtcclxuICAgICAgdmFyIHNwYXJlU29sYXJQYW5lbCA9IHRoaXMuc3BhcmVTb2xhclBhbmVsKCk7XHJcbiAgICAgIGlmIChzcGFyZVNvbGFyUGFuZWwpIHtcclxuICAgICAgICAgc3BhcmVTb2xhclBhbmVsLmdpdmVUYXJnZXQob3RoZXIubW9kdWxlKTtcclxuICAgICAgfVxyXG4gICB9XHJcbiAgIGlmICh0aGlzLmRlYnVnKSB7IHRoaXMuZGlzcGxheUN1YmVzKCk7IH1cclxuICAgaWYgKHRoaXMuZGVidWcpIHsgY29uc29sZS5sb2coJ2hhbmRsZUNvbGxpc2lvbigpIGVuZDonLCAnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyk7IH1cclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUuY3JlYXRlQ29ubmVjdGlvbkZyb20gPSBmdW5jdGlvbihwYW5lbCkge1xyXG4gICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCB0aGlzLmN1YmVzV2lkdGgoKTsgcm93KyspIHtcclxuICAgICAgZm9yICh2YXIgY29sID0gMDsgY29sIDwgdGhpcy5jdWJlc0hlaWdodCgpOyBjb2wrKykge1xyXG4gICAgICAgICB2YXIgY3ViZSA9IHRoaXMuY3ViZXNbcm93XVtjb2xdO1xyXG4gICAgICAgICBpZiAoY3ViZSAmJiBjdWJlICE9PSBwYW5lbCAmJiAhY3ViZS5teUNvbm5lY3Rpb24gJiYgY3ViZS5tb2R1bGUucG93ZXJhYmxlKSB7XHJcbiAgICAgICAgICAgIHBhbmVsLm1vZHVsZS5naXZlVGFyZ2V0KGN1YmUubW9kdWxlKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgfVxyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5zcGFyZVNvbGFyUGFuZWwgPSBmdW5jdGlvbigpIHtcclxuICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgdGhpcy5jdWJlc1dpZHRoKCk7IHJvdysrKSB7XHJcbiAgICAgIGZvciAodmFyIGNvbCA9IDA7IGNvbCA8IHRoaXMuY3ViZXNIZWlnaHQoKTsgY29sKyspIHtcclxuICAgICAgICAgdmFyIGN1YmUgPSB0aGlzLmN1YmVzW3Jvd11bY29sXTtcclxuICAgICAgICAgaWYgKGN1YmUgJiYgIWN1YmUubXlDb25uZWN0aW9uICYmIGN1YmUubW9kdWxlLnR5cGUgPT09ICdzb2xhclBhbmVsJykge1xyXG4gICAgICAgICAgICByZXR1cm4gY3ViZS5tb2R1bGU7XHJcbiAgICAgICAgIH1cclxuICAgICAgfVxyXG4gICB9XHJcbn07XHJcblxyXG5DdWJlR3JvdXAucHJvdG90eXBlLmhhbmRsZVJhbW1pbmcgPSBmdW5jdGlvbihvcmlnaW4sIG90aGVyKSB7XHJcbiAgIGlmICghb3RoZXIuZ3JvdXAgfHwgb3RoZXIuZ3JvdXAgPT09IHRoaXMpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICB9XHJcbiAgIHZhciBzdW1WZWwgPSBNYXRoLmFicyhvcmlnaW4uYm9keS52ZWxvY2l0eS54KSArIE1hdGguYWJzKG9yaWdpbi5ib2R5LnZlbG9jaXR5LnkpO1xyXG4gICBpZiAodGhpcy5kZWJ1ZykgeyBjb25zb2xlLmxvZygnaGFuZGxlUmFtbWluZygpOicsICdzdW1WZWw6Jywgc3VtVmVsLnRvUHJlY2lzaW9uKDQpKTsgfVxyXG4gICBpZiAoc3VtVmVsID49IHRoaXMubWluUmFtVmVsKSB7XHJcbiAgICAgIGlmICh0aGlzLmdhbWUuanVpY3kpIHtcclxuICAgICAgICAgdGhpcy5nYW1lLmp1aWN5LnNoYWtlKCk7XHJcbiAgICAgIH1cclxuICAgICAgb3RoZXIudGFrZURhbWFnZSgzKTtcclxuICAgICAgdGhpcy5jYWxsKCd0aHJ1c3RlckhhbHQnKTtcclxuICAgfVxyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5jYWxjUG9zID0gZnVuY3Rpb24ob3JpZ2luLCByZWxTaWRlKSB7XHJcbiAgIHZhciBkaWZmQW5nbGUgPSBvcmlnaW4uYm9keS5yb3RhdGlvbiAtIHRoaXMucm9vdC5ib2R5LnJvdGF0aW9uO1xyXG4gICB2YXIgcmVsYXRpdmUgPSB0aGlzLmFuZ2xlVG9EaXIoZGlmZkFuZ2xlKTtcclxuICAgdmFyIG91dHB1dCA9IHRoaXMuZmluZChvcmlnaW4pO1xyXG4gICBpZiAocmVsYXRpdmUgPT09IDApIHsgLy8gbm9ydGggcmVsYXRpdmUgdG8gdGhlIHJvb3RcclxuICAgICAgaWYgKHJlbFNpZGUgPT09IDApIHtcclxuICAgICAgICAgb3V0cHV0LnkrKztcclxuICAgICAgfSBlbHNlIGlmIChyZWxTaWRlID09PSAxKSB7XHJcbiAgICAgICAgIG91dHB1dC54Kys7XHJcbiAgICAgIH0gZWxzZSBpZiAocmVsU2lkZSA9PT0gMikge1xyXG4gICAgICAgICBvdXRwdXQueS0tO1xyXG4gICAgICB9IGVsc2UgaWYgKHJlbFNpZGUgPT09IDMpIHtcclxuICAgICAgICAgb3V0cHV0LngtLTtcclxuICAgICAgfVxyXG4gICB9IGVsc2UgaWYgKHJlbGF0aXZlID09PSAxKSB7IC8vIGVhc3QgcmVsYXRpdmUgdG8gcm9vdFxyXG4gICAgICBpZiAocmVsU2lkZSA9PT0gMCkge1xyXG4gICAgICAgICBvdXRwdXQueCsrO1xyXG4gICAgICB9IGVsc2UgaWYgKHJlbFNpZGUgPT09IDEpIHtcclxuICAgICAgICAgb3V0cHV0LnktLTtcclxuICAgICAgfSBlbHNlIGlmIChyZWxTaWRlID09PSAyKSB7XHJcbiAgICAgICAgIG91dHB1dC54LS07XHJcbiAgICAgIH0gZWxzZSBpZiAocmVsU2lkZSA9PT0gMykge1xyXG4gICAgICAgICBvdXRwdXQueSsrO1xyXG4gICAgICB9XHJcbiAgIH0gZWxzZSBpZiAocmVsYXRpdmUgPT09IDIpIHsgLy8gc291dGggcmVsYXRpdmUgdG8gcm9vdFxyXG4gICAgICBpZiAocmVsU2lkZSA9PT0gMCkge1xyXG4gICAgICAgICBvdXRwdXQueS0tO1xyXG4gICAgICB9IGVsc2UgaWYgKHJlbFNpZGUgPT09IDEpIHtcclxuICAgICAgICAgb3V0cHV0LngtLTtcclxuICAgICAgfSBlbHNlIGlmIChyZWxTaWRlID09PSAyKSB7XHJcbiAgICAgICAgIG91dHB1dC55Kys7XHJcbiAgICAgIH0gZWxzZSBpZiAocmVsU2lkZSA9PT0gMykge1xyXG4gICAgICAgICBvdXRwdXQueCsrO1xyXG4gICAgICB9XHJcbiAgIH0gZWxzZSBpZiAocmVsYXRpdmUgPT09IDMpIHsgLy8gd2VzdCByZWxhdGl2ZSB0byByb290XHJcbiAgICAgIGlmIChyZWxTaWRlID09PSAwKSB7XHJcbiAgICAgICAgIG91dHB1dC54LS07XHJcbiAgICAgIH0gZWxzZSBpZiAocmVsU2lkZSA9PT0gMSkge1xyXG4gICAgICAgICBvdXRwdXQueSsrO1xyXG4gICAgICB9IGVsc2UgaWYgKHJlbFNpZGUgPT09IDIpIHtcclxuICAgICAgICAgb3V0cHV0LngrKztcclxuICAgICAgfSBlbHNlIGlmIChyZWxTaWRlID09PSAzKSB7XHJcbiAgICAgICAgIG91dHB1dC55LS07XHJcbiAgICAgIH1cclxuICAgfVxyXG4gICByZXR1cm4gb3V0cHV0O1xyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5hbmdsZVRvRGlyID0gZnVuY3Rpb24oYW5nbGUpIHtcclxuICAgaWYgKGFuZ2xlID49IDApIHtcclxuICAgICBhbmdsZSAlPSAyICogTWF0aC5QSTtcclxuICB9IGVsc2Uge1xyXG4gICAgIGFuZ2xlICo9IC0xO1xyXG4gICAgIGFuZ2xlICU9IDIgKiBNYXRoLlBJO1xyXG4gICAgIGFuZ2xlICo9IC0xO1xyXG4gIH1cclxuICBpZiAodGhpcy5kZWJ1ZykgeyBjb25zb2xlLmxvZygnYW5nbGVUb0RpcigpOicsICdhbmdsZTonLCBhbmdsZS50b1ByZWNpc2lvbig0KSk7IH1cclxuICBpZiAoKGFuZ2xlID49IC0xIC8gNCAqIE1hdGguUEkgJiYgYW5nbGUgPCAxIC8gNCAqIE1hdGguUEkpIHx8IGFuZ2xlID4gNyAvIDQgKiBNYXRoLlBJKSB7XHJcbiAgICAgaWYgKHRoaXMuZGVidWcpIHsgY29uc29sZS5sb2coJ2FuZ2xlVG9EaXIoKSBjYXNlIG9uZSBOT1JUSCcpOyB9XHJcbiAgICAgcmV0dXJuIHRoaXMuRElSLk5PUlRIO1xyXG4gIH0gZWxzZSBpZiAoYW5nbGUgPj0gMSAvIDQgKiBNYXRoLlBJICYmIGFuZ2xlIDwgMyAvIDQgKiBNYXRoLlBJKSB7XHJcbiAgICAgaWYgKHRoaXMuZGVidWcpIHsgY29uc29sZS5sb2coJ2FuZ2xlVG9EaXIoKSBjYXNlIHR3byBFQVNUJyk7IH1cclxuICAgICByZXR1cm4gdGhpcy5ESVIuRUFTVDtcclxuICB9IGVsc2UgaWYgKGFuZ2xlID49IDMgLyA0ICogTWF0aC5QSSAmJiBhbmdsZSA8IDUgLyA0ICogTWF0aC5QSSkge1xyXG4gICAgIGlmICh0aGlzLmRlYnVnKSB7IGNvbnNvbGUubG9nKCdhbmdsZVRvRGlyKCkgY2FzZSB0aHJlZSBTT1VUSCcpOyB9XHJcbiAgICAgcmV0dXJuIHRoaXMuRElSLlNPVVRIO1xyXG4gIH0gZWxzZSBpZiAoYW5nbGUgPj0gNSAvIDQgKiBNYXRoLlBJICYmIGFuZ2xlIDwgNyAvIDQgKiBNYXRoLlBJKSB7XHJcbiAgICAgaWYgKHRoaXMuZGVidWcpIHsgY29uc29sZS5sb2coJ2FuZ2xlVG9EaXIoKSBjYXNlIGZvdXIgV0VTVCcpOyB9XHJcbiAgICAgcmV0dXJuIHRoaXMuRElSLldFU1Q7XHJcbiAgfSBlbHNlIGlmIChhbmdsZSA+PSAtMyAvIDQgKiBNYXRoLlBJICYmIGFuZ2xlIDwgLTEgLyA0ICogTWF0aC5QSSkge1xyXG4gICAgIGlmICh0aGlzLmRlYnVnKSB7IGNvbnNvbGUubG9nKCdhbmdsZVRvRGlyKCkgY2FzZSBmaXZlIFdFU1QnKTsgfVxyXG4gICAgIHJldHVybiB0aGlzLkRJUi5XRVNUO1xyXG4gIH0gZWxzZSBpZiAoYW5nbGUgPj0gLTUgLyA0ICogTWF0aC5QSSAmJiBhbmdsZSA8IC0zIC8gNCAqIE1hdGguUEkpIHtcclxuICAgICBpZiAodGhpcy5kZWJ1ZykgeyBjb25zb2xlLmxvZygnYW5nbGVUb0RpcigpIGNhc2Ugc2l4IFNPVVRIJyk7IH1cclxuICAgICByZXR1cm4gdGhpcy5ESVIuU09VVEg7XHJcbiAgfSBlbHNlIGlmIChhbmdsZSA+PSAtNyAvIDQgKiBNYXRoLlBJICYmIGFuZ2xlIDwgLTUgLyA0ICogTWF0aC5QSSkge1xyXG4gICAgIGlmICh0aGlzLmRlYnVnKSB7IGNvbnNvbGUubG9nKCdhbmdsZVRvRGlyKCkgY2FzZSBzZXZlbiBFQVNUJyk7IH1cclxuICAgICByZXR1cm4gdGhpcy5ESVIuRUFTVDtcclxuICB9IGVsc2UgaWYgKGFuZ2xlIDwgLTcgLyA0ICogTWF0aC5QSSkge1xyXG4gICAgIGlmICh0aGlzLmRlYnVnKSB7IGNvbnNvbGUubG9nKCdhbmdsZVRvRGlyKCkgY2FzZSBlaWdodCBOT1JUSCcpOyB9XHJcbiAgICAgcmV0dXJuIHRoaXMuRElSLk5PUlRIO1xyXG4gIH1cclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUuY3JlYXRlQ29uc3RyYWludHMgPSBmdW5jdGlvbihtZSwgcG9pbnQpIHtcclxuICAgdmFyIG5laWdoYm9ycyA9IHRoaXMuZ2V0TmVpZ2hib3JzKG1lKTtcclxuICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuZWlnaGJvcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgdmFyIG5laWdoYm9yID0gbmVpZ2hib3JzW2ldO1xyXG4gICAgICB2YXIgbXlTaWRlID0gdGhpcy5yZWxhdGl2ZVNpZGUobWUuYm9keSwgbmVpZ2hib3IuYm9keSk7XHJcbiAgICAgIHZhciBuZWlnaGJvclNpZGUgPSB0aGlzLnJlbGF0aXZlU2lkZShuZWlnaGJvci5ib2R5LCBtZS5ib2R5KTtcclxuICAgICAgdmFyIGNvbnN0cmFpbnQ7XHJcbiAgICAgIHZhciBvZmZzZXQgPSBtZS53aWR0aCArIHRoaXMub2Zmc2V0O1xyXG4gICAgICBpZiAobXlTaWRlID09PSAwKSB7XHJcbiAgICAgICAgaWYgKG5laWdoYm9yU2lkZSA9PT0gMCkge1xyXG4gICAgICAgICAgIGNvbnN0cmFpbnQgPSB0aGlzLmdhbWUucGh5c2ljcy5wMi5jcmVhdGVMb2NrQ29uc3RyYWludChtZS5ib2R5LCBuZWlnaGJvci5ib2R5LCBbMCwgb2Zmc2V0XSwgTWF0aC5QSSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChuZWlnaGJvclNpZGUgPT09IDEpIHtcclxuICAgICAgICAgICAgY29uc3RyYWludCA9IHRoaXMuZ2FtZS5waHlzaWNzLnAyLmNyZWF0ZUxvY2tDb25zdHJhaW50KG1lLmJvZHksIG5laWdoYm9yLmJvZHksIFswLCBvZmZzZXRdLCAxIC8gMiAqIE1hdGguUEkpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobmVpZ2hib3JTaWRlID09PSAyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0cmFpbnQgPSB0aGlzLmdhbWUucGh5c2ljcy5wMi5jcmVhdGVMb2NrQ29uc3RyYWludChtZS5ib2R5LCBuZWlnaGJvci5ib2R5LCBbMCwgb2Zmc2V0XSwgMCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChuZWlnaGJvclNpZGUgPT09IDMpIHtcclxuICAgICAgICAgICAgY29uc3RyYWludCA9IHRoaXMuZ2FtZS5waHlzaWNzLnAyLmNyZWF0ZUxvY2tDb25zdHJhaW50KG1lLmJvZHksIG5laWdoYm9yLmJvZHksIFswLCBvZmZzZXRdLCAzIC8gMiAqIE1hdGguUEkpO1xyXG4gICAgICAgIH1cclxuICAgICB9IGVsc2UgaWYgKG15U2lkZSA9PT0gMSkge1xyXG4gICAgICAgIGlmIChuZWlnaGJvclNpZGUgPT09IDApIHtcclxuICAgICAgICAgICBjb25zdHJhaW50ID0gdGhpcy5nYW1lLnBoeXNpY3MucDIuY3JlYXRlTG9ja0NvbnN0cmFpbnQobWUuYm9keSwgbmVpZ2hib3IuYm9keSwgWy1vZmZzZXQsIDBdLCAtMSAvIDIgKiBNYXRoLlBJKTtcclxuICAgICAgICB9IGVsc2UgaWYgKG5laWdoYm9yU2lkZSA9PT0gMSkge1xyXG4gICAgICAgICAgICBjb25zdHJhaW50ID0gdGhpcy5nYW1lLnBoeXNpY3MucDIuY3JlYXRlTG9ja0NvbnN0cmFpbnQobWUuYm9keSwgbmVpZ2hib3IuYm9keSwgWy1vZmZzZXQsIDBdLCBNYXRoLlBJKTtcclxuICAgICAgICB9IGVsc2UgaWYgKG5laWdoYm9yU2lkZSA9PT0gMikge1xyXG4gICAgICAgICAgICBjb25zdHJhaW50ID0gdGhpcy5nYW1lLnBoeXNpY3MucDIuY3JlYXRlTG9ja0NvbnN0cmFpbnQobWUuYm9keSwgbmVpZ2hib3IuYm9keSwgWy1vZmZzZXQsIDBdLCAxIC8gMiAqIE1hdGguUEkpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobmVpZ2hib3JTaWRlID09PSAzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0cmFpbnQgPSB0aGlzLmdhbWUucGh5c2ljcy5wMi5jcmVhdGVMb2NrQ29uc3RyYWludChtZS5ib2R5LCBuZWlnaGJvci5ib2R5LCBbLW9mZnNldCwgMF0sIDApO1xyXG4gICAgICAgIH1cclxuICAgICB9IGVsc2UgaWYgKG15U2lkZSA9PT0gMikge1xyXG4gICAgICAgICBpZiAobmVpZ2hib3JTaWRlID09PSAwKSB7XHJcbiAgICAgICAgICAgY29uc3RyYWludCA9IHRoaXMuZ2FtZS5waHlzaWNzLnAyLmNyZWF0ZUxvY2tDb25zdHJhaW50KG1lLmJvZHksIG5laWdoYm9yLmJvZHksIFswLCAtb2Zmc2V0XSwgMCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChuZWlnaGJvclNpZGUgPT09IDEpIHtcclxuICAgICAgICAgICAgY29uc3RyYWludCA9IHRoaXMuZ2FtZS5waHlzaWNzLnAyLmNyZWF0ZUxvY2tDb25zdHJhaW50KG1lLmJvZHksIG5laWdoYm9yLmJvZHksIFswLCAtb2Zmc2V0XSwgMyAvIDIgKiBNYXRoLlBJKTtcclxuICAgICAgICB9IGVsc2UgaWYgKG5laWdoYm9yU2lkZSA9PT0gMikge1xyXG4gICAgICAgICAgICBjb25zdHJhaW50ID0gdGhpcy5nYW1lLnBoeXNpY3MucDIuY3JlYXRlTG9ja0NvbnN0cmFpbnQobWUuYm9keSwgbmVpZ2hib3IuYm9keSwgWzAsIC1vZmZzZXRdLCBNYXRoLlBJKTtcclxuICAgICAgICB9IGVsc2UgaWYgKG5laWdoYm9yU2lkZSA9PT0gMykge1xyXG4gICAgICAgICAgICBjb25zdHJhaW50ID0gdGhpcy5nYW1lLnBoeXNpY3MucDIuY3JlYXRlTG9ja0NvbnN0cmFpbnQobWUuYm9keSwgbmVpZ2hib3IuYm9keSwgWzAsIC1vZmZzZXRdLCAxIC8gMiAqIE1hdGguUEkpO1xyXG4gICAgICAgIH1cclxuICAgICB9IGVsc2UgaWYgKG15U2lkZSA9PT0gMykge1xyXG4gICAgICAgIGlmIChuZWlnaGJvclNpZGUgPT09IDApIHtcclxuICAgICAgICAgICBjb25zdHJhaW50ID0gdGhpcy5nYW1lLnBoeXNpY3MucDIuY3JlYXRlTG9ja0NvbnN0cmFpbnQobWUuYm9keSwgbmVpZ2hib3IuYm9keSwgW29mZnNldCwgMF0sIDEgLyAyICogTWF0aC5QSSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChuZWlnaGJvclNpZGUgPT09IDEpIHtcclxuICAgICAgICAgICAgY29uc3RyYWludCA9IHRoaXMuZ2FtZS5waHlzaWNzLnAyLmNyZWF0ZUxvY2tDb25zdHJhaW50KG1lLmJvZHksIG5laWdoYm9yLmJvZHksIFtvZmZzZXQsIDBdLCAwKTtcclxuICAgICAgICB9IGVsc2UgaWYgKG5laWdoYm9yU2lkZSA9PT0gMikge1xyXG4gICAgICAgICAgICBjb25zdHJhaW50ID0gdGhpcy5nYW1lLnBoeXNpY3MucDIuY3JlYXRlTG9ja0NvbnN0cmFpbnQobWUuYm9keSwgbmVpZ2hib3IuYm9keSwgW29mZnNldCwgMF0sIC0xIC8gMiAqIE1hdGguUEkpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobmVpZ2hib3JTaWRlID09PSAzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0cmFpbnQgPSB0aGlzLmdhbWUucGh5c2ljcy5wMi5jcmVhdGVMb2NrQ29uc3RyYWludChtZS5ib2R5LCBuZWlnaGJvci5ib2R5LCBbb2Zmc2V0LCAwXSwgTWF0aC5QSSk7XHJcbiAgICAgICAgfVxyXG4gICAgIH1cclxuICAgICBtZS5jb25zdHJhaW50cy5wdXNoKGNvbnN0cmFpbnQpO1xyXG4gICAgIG5laWdoYm9yLmNvbnN0cmFpbnRzLnB1c2goY29uc3RyYWludCk7XHJcbiAgIH1cclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUucmVsYXRpdmVTaWRlID0gZnVuY3Rpb24odGhpc0JvZHksIG90aGVyQm9keSkge1xyXG4gIHZhciB0aGlzUG9pbnQgPSBuZXcgUGhhc2VyLlBvaW50KHRoaXNCb2R5LngsIHRoaXNCb2R5LnkpO1xyXG4gIHZhciBvdGhlclBvaW50ID0gbmV3IFBoYXNlci5Qb2ludChvdGhlckJvZHkueCwgb3RoZXJCb2R5LnkpO1xyXG4gIHZhciBhbmdsZVRvT3RoZXIgPSB0aGlzLmFuZ2xlQmV0d2VlblBvaW50cyh0aGlzUG9pbnQsIG90aGVyUG9pbnQpO1xyXG4gIHZhciBkaWZmQW5nbGUgPSBhbmdsZVRvT3RoZXIgLSB0aGlzQm9keS5yb3RhdGlvbjtcclxuICB2YXIgcmV0dXJuRGlyID0gdGhpcy5hbmdsZVRvRGlyKGRpZmZBbmdsZSk7XHJcbiAgaWYgKHRoaXMuZGVidWcpIHsgY29uc29sZS5sb2coJ3JlbGF0aXZlU2lkZSgpOicsICdhbmdsZVRvT3RoZXI6JywgYW5nbGVUb090aGVyLnRvUHJlY2lzaW9uKDQpLCAndGhpc0JvZHkucm90YXRpb246JywgdGhpc0JvZHkucm90YXRpb24udG9QcmVjaXNpb24oNCksICdkaWZmQW5nbGU6JywgZGlmZkFuZ2xlLnRvUHJlY2lzaW9uKDQpLCAncmV0dXJuRGlyOicsIHJldHVybkRpcik7IH1cclxuICByZXR1cm4gcmV0dXJuRGlyO1xyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5hbmdsZUJldHdlZW5Qb2ludHMgPSBmdW5jdGlvbih0aGlzUG9pbnQsIG90aGVyUG9pbnQpIHtcclxuICB2YXIgYW5nbGVUb090aGVyID0gUGhhc2VyLlBvaW50LmFuZ2xlKHRoaXNQb2ludCwgb3RoZXJQb2ludCk7XHJcbiAgaWYgKGFuZ2xlVG9PdGhlciA8IDApIHsgLy8gZml4IGR1bWIgcGFydCBvZiBQaGFzZXIuUG9pbnQuYW5nbGUoKVxyXG4gICAgIGFuZ2xlVG9PdGhlciA9IDIgKiBNYXRoLlBJICsgYW5nbGVUb090aGVyO1xyXG4gIH1cclxuICBhbmdsZVRvT3RoZXIgPSAoYW5nbGVUb090aGVyICsgMy8yICogTWF0aC5QSSkgJSAoMiAqIE1hdGguUEkpOyAvLyByb3RhdGUgOTAgZCBjbG9ja3dpc2VcclxuICAgcmV0dXJuIGFuZ2xlVG9PdGhlcjtcclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uKGN1YmUpIHtcclxuICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgdGhpcy5jdWJlc1dpZHRoKCk7IHJvdysrKSB7XHJcbiAgICAgIGZvciAodmFyIGNvbCA9IDA7IGNvbCA8IHRoaXMuY3ViZXNIZWlnaHQoKTsgY29sKyspIHtcclxuICAgICAgICAgaWYgKHRoaXMuY3ViZXNbcm93XVtjb2xdID09PSBjdWJlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUGhhc2VyLlBvaW50KHJvdywgY29sKTtcclxuICAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgIH1cclxuICAgcmV0dXJuIHVuZGVmaW5lZDtcclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24ocG9pbnQpIHtcclxuICBpZiAoIXBvaW50IHx8IHRoaXMub3V0T2ZCb3VuZHMocG9pbnQpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICB9XHJcbiAgcmV0dXJuIHRoaXMuY3ViZXNbcG9pbnQueF1bcG9pbnQueV07XHJcbn07XHJcblxyXG5DdWJlR3JvdXAucHJvdG90eXBlLmN1YmVzV2lkdGggPSBmdW5jdGlvbigpIHtcclxuICAgcmV0dXJuIHRoaXMuY3ViZXMubGVuZ3RoO1xyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5jdWJlc0hlaWdodCA9IGZ1bmN0aW9uKCkge1xyXG4gICByZXR1cm4gdGhpcy5jdWJlc1swXS5sZW5ndGg7XHJcbn07XHJcblxyXG5DdWJlR3JvdXAucHJvdG90eXBlLmFkZFRvcFJvdyA9IGZ1bmN0aW9uKCkge1xyXG4gICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCB0aGlzLmN1YmVzV2lkdGgoKTsgcm93KyspIHtcclxuICAgICAgdGhpcy5jdWJlc1tyb3ddLnB1c2godW5kZWZpbmVkKTtcclxuICAgfVxyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5hZGRSaWdodENvbCA9IGZ1bmN0aW9uKCkge1xyXG4gICB2YXIgbmV3Q29sID0gW107XHJcbiAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jdWJlc0hlaWdodCgpOyBpKyspIHtcclxuICAgICAgbmV3Q29sLnB1c2godW5kZWZpbmVkKTtcclxuICAgfVxyXG4gICB0aGlzLmN1YmVzLnB1c2gobmV3Q29sKTtcclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUuYWRkQm90Um93ID0gZnVuY3Rpb24oKSB7XHJcbiAgIGZvciAodmFyIHJvdyA9IDA7IHJvdyA8IHRoaXMuY3ViZXNXaWR0aCgpOyByb3crKykge1xyXG4gICAgICB0aGlzLmN1YmVzW3Jvd10udW5zaGlmdCh1bmRlZmluZWQpO1xyXG4gICB9XHJcbn07XHJcblxyXG5DdWJlR3JvdXAucHJvdG90eXBlLmFkZExlZnRDb2wgPSBmdW5jdGlvbigpIHtcclxuICAgdmFyIG5ld0NvbCA9IG5ldyBBcnJheSh0aGlzLmN1YmVzSGVpZ2h0KCkpO1xyXG4gICB0aGlzLmN1YmVzLnVuc2hpZnQobmV3Q29sKTtcclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUuZ2V0Q3ViZSA9IGZ1bmN0aW9uKHBvaW50KSB7XHJcbiAgIGlmICghcG9pbnQgfHwgdGhpcy5vdXRPZkJvdW5kcyhwb2ludCkpIHtcclxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgfVxyXG4gICByZXR1cm4gdGhpcy5jdWJlc1twb2ludC54XVtwb2ludC55XTtcclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUuYWRqdXN0ID0gZnVuY3Rpb24ocG9pbnQsIGRpcikge1xyXG4gIGlmICghcG9pbnQpIHtcclxuICAgICByZXR1cm47XHJcbiAgfVxyXG4gIHZhciBuZXdQb2ludCA9IG5ldyBQaGFzZXIuUG9pbnQocG9pbnQueCwgcG9pbnQueSk7XHJcbiAgc3dpdGNoIChkaXIpIHtcclxuICAgICAgY2FzZSB0aGlzLkRJUi5OT1JUSDpcclxuICAgICAgbmV3UG9pbnQueSsrO1xyXG4gICAgICBicmVhaztcclxuICAgICAgY2FzZSB0aGlzLkRJUi5FQVNUOlxyXG4gICAgICBuZXdQb2ludC54Kys7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIHRoaXMuRElSLlNPVVRIOlxyXG4gICAgICBuZXdQb2ludC55LS07XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIHRoaXMuRElSLldFU1Q6XHJcbiAgICAgIG5ld1BvaW50LngtLTtcclxuICAgICAgYnJlYWs7XHJcbiAgIH1cclxuICAgcmV0dXJuIG5ld1BvaW50O1xyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbihjdWJlLCBwb2ludCkge1xyXG4gICBpZiAoIXBvaW50KSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdzZXQgZ2l2ZW4gdW5kZWZpbmVkIHBvaW50Jyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgfVxyXG4gICBpZiAocG9pbnQueCA8IDApIHtcclxuICAgICAgaWYgKHRoaXMuZGVidWcpIHsgY29uc29sZS5sb2coJ2FkZCBsZWZ0IGNvbCcpOyB9XHJcbiAgICAgIHRoaXMuYWRkTGVmdENvbCgpO1xyXG4gICAgICBwb2ludC54ID0gMDtcclxuICAgfSBlbHNlIGlmIChwb2ludC54ID49IHRoaXMuY3ViZXNXaWR0aCgpKSB7XHJcbiAgICAgIGlmICh0aGlzLmRlYnVnKSB7IGNvbnNvbGUubG9nKCdhZGQgcmlnaHQgY29sJyk7IH1cclxuICAgICAgdGhpcy5hZGRSaWdodENvbCgpO1xyXG4gICAgICBwb2ludC54ID0gdGhpcy5jdWJlc1dpZHRoKCkgLSAxO1xyXG4gICB9IGVsc2UgaWYgKHBvaW50LnkgPCAwKSB7XHJcbiAgICAgIGlmICh0aGlzLmRlYnVnKSB7IGNvbnNvbGUubG9nKCdhZGQgYm90IHJvdycpOyB9XHJcbiAgICAgIHRoaXMuYWRkQm90Um93KCk7XHJcbiAgICAgIHBvaW50LnkgPSAwO1xyXG4gICB9IGVsc2UgaWYgKHBvaW50LnkgPj0gdGhpcy5jdWJlc0hlaWdodCgpKSB7XHJcbiAgICAgIGlmICh0aGlzLmRlYnVnKSB7IGNvbnNvbGUubG9nKCdhZGQgdG9wIHJvdycpOyB9XHJcbiAgICAgIHRoaXMuYWRkVG9wUm93KCk7XHJcbiAgICAgIHBvaW50LnkgPSB0aGlzLmN1YmVzSGVpZ2h0KCkgLSAxO1xyXG4gICB9XHJcbiAgIGlmICh0aGlzLmdldChwb2ludCkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICB9XHJcbiAgIHRoaXMuY3ViZXNbcG9pbnQueF1bcG9pbnQueV0gPSBjdWJlO1xyXG4gICBjdWJlLmdyb3VwID0gdGhpcztcclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUub3V0T2ZCb3VuZHMgPSBmdW5jdGlvbihwb2ludCkge1xyXG4gICBpZiAoIXBvaW50KSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdvdXQgb2YgYm91bmRzIGdpdmVuIHVuZGVmaW5lZCBwb2ludCcpO1xyXG4gICAgICByZXR1cm47XHJcbiAgIH1cclxuICAgaWYgKHBvaW50LnggPCAwIHx8IHBvaW50LnggPj0gdGhpcy5jdWJlc1dpZHRoKCkgfHwgcG9pbnQueSA8IDAgfHwgcG9pbnQueSA+PSB0aGlzLmN1YmVzSGVpZ2h0KCkpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgIH1cclxuICAgcmV0dXJuIGZhbHNlO1xyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5kaXNwbGF5Q3ViZXMgPSBmdW5jdGlvbigpIHtcclxuICAgdmFyIG91dHB1dCA9ICdkaXNwbGF5Q3ViZXMoKTpcXG4nO1xyXG4gICB2YXIgcm93ID0gMDtcclxuICAgdmFyIGNvbCA9IHRoaXMuY3ViZXNIZWlnaHQoKSAtIDE7XHJcbiAgIHdoaWxlIChjb2wgPj0gMCkge1xyXG4gICAgICB3aGlsZSAocm93IDwgdGhpcy5jdWJlc1dpZHRoKCkpIHtcclxuICAgICAgICAgdmFyIGN1YmUgPSB0aGlzLmN1YmVzW3Jvd11bY29sXTtcclxuICAgICAgICAgaWYgKGN1YmUpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChjdWJlLm1vZHVsZS50eXBlKSB7XHJcbiAgICAgICAgICAgICAgIGNhc2UgJ3NoaWVsZCc6XHJcbiAgICAgICAgICAgICAgIG91dHB1dCArPSAnUyAnO1xyXG4gICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgY2FzZSAnY29yZSc6XHJcbiAgICAgICAgICAgICAgIG91dHB1dCArPSAnQyAnO1xyXG4gICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgY2FzZSAndGhydXN0ZXInOlxyXG4gICAgICAgICAgICAgICBvdXRwdXQgKz0gJ1QgJztcclxuICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgIGNhc2UgJ3NvbGFyUGFuZWwnOlxyXG4gICAgICAgICAgICAgICBvdXRwdXQgKz0gJ1AgJztcclxuICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgIGNhc2UgJ2hhY2tlcic6XHJcbiAgICAgICAgICAgICAgIG91dHB1dCArPSAnSCAnO1xyXG4gICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgY2FzZSAnZ3VuJzpcclxuICAgICAgICAgICAgICAgb3V0cHV0ICs9ICdHICc7XHJcbiAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG91dHB1dCArPSAnXyAnO1xyXG4gICAgICAgICB9XHJcbiAgICAgICAgIHJvdysrO1xyXG4gICAgICB9XHJcbiAgICAgIHJvdyA9IDA7XHJcbiAgICAgIGNvbC0tO1xyXG4gICAgICBvdXRwdXQgKz0gJ1xcbic7XHJcbiAgIH1cclxuICAgY29uc29sZS5sb2cob3V0cHV0KTtcclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUuZGlzcGxheUNvbm5lY3Rpb24gPSBmdW5jdGlvbihjb25uZWN0aW9uKSB7XHJcbiAgIHRoaXMuaGlkZU90aGVyQ29ubmVjdGlvbnMoY29ubmVjdGlvbik7XHJcbiAgIHZhciBncmFwaCA9IG5ldyBBc3Rhci5HcmFwaCh0aGlzLmN1YmVzVG9HcmFwaCgpKTtcclxuICAgdmFyIHN0YXJ0UG9pbnQgPSB0aGlzLmZpbmQoY29ubmVjdGlvbi5zdGFydCk7XHJcbiAgIHZhciBlbmRQb2ludCA9IHRoaXMuZmluZChjb25uZWN0aW9uLmVuZCk7XHJcbiAgIGlmICghc3RhcnRQb2ludCB8fCAhZW5kUG9pbnQpIHtcclxuICAgICAgY29uc29sZS5sb2coJ2Rpc3BsYXlDb25uZWN0aW9uIGZhaWxlZCB0byBnZXQgcG9pbnRzJyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgfVxyXG4gICB2YXIgc3RhcnQgPSBncmFwaC5ncmlkW3N0YXJ0UG9pbnQueF1bc3RhcnRQb2ludC55XTtcclxuICAgdmFyIGVuZCA9IGdyYXBoLmdyaWRbZW5kUG9pbnQueF1bZW5kUG9pbnQueV07XHJcbiAgIHZhciByZXN1bHQgPSBBc3Rhci5hc3Rhci5zZWFyY2goZ3JhcGgsIHN0YXJ0LCBlbmQpO1xyXG4gICByZXN1bHQudW5zaGlmdChzdGFydCk7XHJcbiAgIHZhciBwcmV2aW91cztcclxuICAgZm9yKHZhciBpID0gMDsgaSA8IHJlc3VsdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICB2YXIgY3VyUG9pbnQgPSBuZXcgUGhhc2VyLlBvaW50KHJlc3VsdFtpXS54LCByZXN1bHRbaV0ueSk7XHJcbiAgICAgIHZhciBjdXJDdWJlID0gdGhpcy5nZXQoY3VyUG9pbnQpO1xyXG4gICAgICB2YXIgaW5kaWNhdG9yID0gY3VyQ3ViZS5jSW5kaWNhdG9yO1xyXG4gICAgICB2YXIgcHJldlBvaW50O1xyXG4gICAgICB2YXIgbmV4dFBvaW50O1xyXG4gICAgICB2YXIgc2lkZTtcclxuICAgICAgdmFyIHByZXZDdWJlO1xyXG4gICAgICB2YXIgbmV4dEN1YmU7XHJcbiAgICAgIGlmICghcHJldmlvdXMpIHtcclxuICAgICAgICAgaW5kaWNhdG9yLmFuaW1hdGlvbnMucGxheSgnZW5kJyk7XHJcbiAgICAgICAgIG5leHRQb2ludCA9IG5ldyBQaGFzZXIuUG9pbnQocmVzdWx0W2krMV0ueCwgcmVzdWx0W2krMV0ueSk7XHJcbiAgICAgICAgIG5leHRDdWJlID0gdGhpcy5nZXQobmV4dFBvaW50KTtcclxuICAgICAgICAgc2lkZSA9IHRoaXMucmVsYXRpdmVTaWRlKGN1ckN1YmUuYm9keSwgbmV4dEN1YmUuYm9keSk7XHJcbiAgICAgICAgIGluZGljYXRvci5yb3RhdGlvbiA9IHRoaXMuZGlyVG9BbmdsZShzaWRlKTtcclxuICAgICAgfSBlbHNlIGlmIChpID09PSByZXN1bHQubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICBpbmRpY2F0b3IuYW5pbWF0aW9ucy5wbGF5KCdlbmQnKTtcclxuICAgICAgICAgcHJldlBvaW50ID0gbmV3IFBoYXNlci5Qb2ludChwcmV2aW91cy54LCBwcmV2aW91cy55KTtcclxuICAgICAgICAgcHJldkN1YmUgPSB0aGlzLmdldChwcmV2UG9pbnQpO1xyXG4gICAgICAgICBzaWRlID0gdGhpcy5yZWxhdGl2ZVNpZGUoY3VyQ3ViZS5ib2R5LCBwcmV2Q3ViZS5ib2R5KTtcclxuICAgICAgICAgaW5kaWNhdG9yLnJvdGF0aW9uID0gdGhpcy5kaXJUb0FuZ2xlKHNpZGUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICBpbmRpY2F0b3IuYW5pbWF0aW9ucy5wbGF5KCdsaW5lJyk7XHJcbiAgICAgICAgIHByZXZQb2ludCA9IG5ldyBQaGFzZXIuUG9pbnQocHJldmlvdXMueCwgcHJldmlvdXMueSk7XHJcbiAgICAgICAgIG5leHRQb2ludCA9IG5ldyBQaGFzZXIuUG9pbnQocmVzdWx0W2krMV0ueCwgcmVzdWx0W2krMV0ueSk7XHJcbiAgICAgICAgIHByZXZDdWJlID0gdGhpcy5nZXQocHJldlBvaW50KTtcclxuICAgICAgICAgbmV4dEN1YmUgPSB0aGlzLmdldChuZXh0UG9pbnQpO1xyXG4gICAgICAgICB2YXIgcHJldlNpZGUgPSB0aGlzLnJlbGF0aXZlU2lkZShjdXJDdWJlLmJvZHksIHByZXZDdWJlLmJvZHkpO1xyXG4gICAgICAgICB2YXIgbmV4dFNpZGUgPSB0aGlzLnJlbGF0aXZlU2lkZShjdXJDdWJlLmJvZHksIG5leHRDdWJlLmJvZHkpO1xyXG4gICAgICAgICB0aGlzLm1hbmFnZUluZGljYXRvcihpbmRpY2F0b3IsIHByZXZTaWRlLCBuZXh0U2lkZSk7XHJcbiAgICAgIH1cclxuICAgICAgcHJldmlvdXMgPSByZXN1bHRbaV07XHJcbiAgICAgIGN1ckN1YmUuZGlzcGxheUluZGljYXRvcigpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5tYW5hZ2VJbmRpY2F0b3IgPSBmdW5jdGlvbihpbmRpY2F0b3IsIHByZXZEaXIsIG5leHREaXIpIHtcclxuICBpbmRpY2F0b3Iuc2NhbGUuc2V0VG8oTWF0aC5hYnMoaW5kaWNhdG9yLnNjYWxlLngpLCBpbmRpY2F0b3Iuc2NhbGUueSk7XHJcbiAgaWYgKHByZXZEaXIgPT09IHRoaXMuRElSLk5PUlRIICYmIG5leHREaXIgPT09IHRoaXMuRElSLlNPVVRIKSB7IC8vIDJcclxuICAgICAgaWYgKHRoaXMuZGVidWcpIHsgY29uc29sZS5sb2coJ2Nhc2UgMicpOyB9XHJcbiAgICAgIGluZGljYXRvci5yb3RhdGlvbiA9IE1hdGguUEk7XHJcbiAgIH0gZWxzZSBpZiAocHJldkRpciA9PT0gdGhpcy5ESVIuU09VVEggJiYgbmV4dERpciA9PT0gdGhpcy5ESVIuTk9SVEgpIHsgLy8gMVxyXG4gICAgICBpZiAodGhpcy5kZWJ1ZykgeyBjb25zb2xlLmxvZygnY2FzZSAxJyk7IH1cclxuICAgICAgaW5kaWNhdG9yLnJvdGF0aW9uID0gMDtcclxuICAgfSBlbHNlIGlmIChwcmV2RGlyID09PSB0aGlzLkRJUi5FQVNUICYmIG5leHREaXIgPT09IHRoaXMuRElSLldFU1QpIHsgLy8gNFxyXG4gICAgICBpZiAodGhpcy5kZWJ1ZykgeyBjb25zb2xlLmxvZygnY2FzZSA0Jyk7IH1cclxuICAgICAgaW5kaWNhdG9yLnJvdGF0aW9uID0gMSAvIDIgKiBNYXRoLlBJO1xyXG4gICB9IGVsc2UgaWYgKHByZXZEaXIgPT09IHRoaXMuRElSLldFU1QgJiYgbmV4dERpciA9PT0gdGhpcy5ESVIuRUFTVCkgeyAvLyAzXHJcbiAgICAgIGlmICh0aGlzLmRlYnVnKSB7IGNvbnNvbGUubG9nKCdjYXNlIDMnKTsgfVxyXG4gICAgICBpbmRpY2F0b3Iucm90YXRpb24gPSAzIC8gMiAgKiBNYXRoLlBJO1xyXG4gICB9IGVsc2Uge1xyXG4gICAgICBpbmRpY2F0b3IuYW5pbWF0aW9ucy5wbGF5KCdyaWdodCcpO1xyXG4gICAgICBpZiAocHJldkRpciA9PT0gdGhpcy5ESVIuU09VVEggJiYgbmV4dERpciA9PT0gdGhpcy5ESVIuRUFTVCkgeyAvLyA1XHJcbiAgICAgICAgIGlmICh0aGlzLmRlYnVnKSB7IGNvbnNvbGUubG9nKCdjYXNlIDUnKTsgfVxyXG4gICAgICAgICBpbmRpY2F0b3Iucm90YXRpb24gPSAwO1xyXG4gICAgICB9IGVsc2UgaWYgKHByZXZEaXIgPT09IHRoaXMuRElSLldFU1QgJiYgbmV4dERpciA9PT0gdGhpcy5ESVIuU09VVEgpIHsgLy8gNlxyXG4gICAgICAgICBpZiAodGhpcy5kZWJ1ZykgeyBjb25zb2xlLmxvZygnY2FzZSA2Jyk7IH1cclxuICAgICAgICAgaW5kaWNhdG9yLnJvdGF0aW9uID0gMSAvIDIgKiBNYXRoLlBJO1xyXG4gICAgICB9IGVsc2UgaWYgKHByZXZEaXIgPT09IHRoaXMuRElSLk5PUlRIICYmIG5leHREaXIgPT09IHRoaXMuRElSLldFU1QpIHsgLy8gN1xyXG4gICAgICAgICBpZiAodGhpcy5kZWJ1ZykgeyBjb25zb2xlLmxvZygnY2FzZSA3Jyk7IH1cclxuICAgICAgICAgaW5kaWNhdG9yLnJvdGF0aW9uID0gTWF0aC5QSTtcclxuICAgICAgfSBlbHNlIGlmIChwcmV2RGlyID09PSB0aGlzLkRJUi5FQVNUICYmIG5leHREaXIgPT09IHRoaXMuRElSLk5PUlRIKSB7IC8vIDhcclxuICAgICAgICAgaWYgKHRoaXMuZGVidWcpIHsgY29uc29sZS5sb2coJ2Nhc2UgOCcpOyB9XHJcbiAgICAgICAgIGluZGljYXRvci5yb3RhdGlvbiA9IDMgLyAyICogTWF0aC5QSTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgaW5kaWNhdG9yLnNjYWxlLnNldFRvKC1NYXRoLmFicyhpbmRpY2F0b3Iuc2NhbGUueCksIGluZGljYXRvci5zY2FsZS55KTtcclxuICAgICAgICAgaWYgKHByZXZEaXIgPT09IHRoaXMuRElSLlNPVVRIICYmIG5leHREaXIgPT09IHRoaXMuRElSLldFU1QpIHsgLy8gOVxyXG4gICAgICAgICAgICBpZiAodGhpcy5kZWJ1ZykgeyBjb25zb2xlLmxvZygnY2FzZSA5Jyk7IH1cclxuICAgICAgICAgICAgaW5kaWNhdG9yLnJvdGF0aW9uID0gMDtcclxuICAgICAgICAgfSBlbHNlIGlmIChwcmV2RGlyID09PSB0aGlzLkRJUi5XRVNUICYmIG5leHREaXIgPT09IHRoaXMuRElSLk5PUlRIKSB7IC8vIDEwXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRlYnVnKSB7IGNvbnNvbGUubG9nKCdjYXNlIDEwJyk7IH1cclxuICAgICAgICAgICAgaW5kaWNhdG9yLnJvdGF0aW9uID0gMSAvIDIgKiBNYXRoLlBJO1xyXG4gICAgICAgICB9IGVsc2UgaWYgKHByZXZEaXIgPT09IHRoaXMuRElSLk5PUlRIICYmIG5leHREaXIgPT09IHRoaXMuRElSLkVBU1QpIHsgLy8gMTFcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGVidWcpIHsgY29uc29sZS5sb2coJ2Nhc2UgMTEnKTsgfVxyXG4gICAgICAgICAgICBpbmRpY2F0b3Iucm90YXRpb24gPSBNYXRoLlBJO1xyXG4gICAgICAgICB9IGVsc2UgaWYgKHByZXZEaXIgPT09IHRoaXMuRElSLkVBU1QgJiYgbmV4dERpciA9PT0gdGhpcy5ESVIuU09VVEgpIHsgLy8gMTJcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGVidWcpIHsgY29uc29sZS5sb2coJ2Nhc2UgMTInKTsgfVxyXG4gICAgICAgICAgICBpbmRpY2F0b3Iucm90YXRpb24gPSAzIC8gMiAqIE1hdGguUEk7XHJcbiAgICAgICAgIH1cclxuICAgICAgfVxyXG4gICB9IFxyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5oaWRlT3RoZXJDb25uZWN0aW9ucyA9IGZ1bmN0aW9uKGV4Y2VwdGlvbikge1xyXG4gICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCB0aGlzLmN1YmVzV2lkdGgoKTsgcm93KyspIHtcclxuICAgICAgZm9yICh2YXIgY29sID0gMDsgY29sIDwgdGhpcy5jdWJlc0hlaWdodCgpOyBjb2wrKykge1xyXG4gICAgICAgICB2YXIgY3ViZSA9IHRoaXMuY3ViZXNbcm93XVtjb2xdO1xyXG4gICAgICAgICBpZiAoY3ViZSAmJiBjdWJlLm15Q29ubmVjdGlvbiAmJiBjdWJlLm15Q29ubmVjdGlvbiAhPT0gZXhjZXB0aW9uKSB7XHJcbiAgICAgICAgICAgIGN1YmUuaGlkZUluZGljYXRvcigpO1xyXG4gICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgfVxyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5jdWJlc1RvR3JhcGggPSBmdW5jdGlvbigpIHtcclxuICB2YXIgZ3JhcGggPSBbXTtcclxuICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCB0aGlzLmN1YmVzV2lkdGgoKTsgcm93KyspIHtcclxuICAgICB2YXIgbmV3Q29sID0gW107XHJcbiAgICAgIGZvciAodmFyIGNvbCA9IDA7IGNvbCA8IHRoaXMuY3ViZXNIZWlnaHQoKTsgY29sKyspIHtcclxuICAgICAgICAgaWYgKHRoaXMuY3ViZXNbcm93XVtjb2xdKSB7XHJcbiAgICAgICAgICAgIG5ld0NvbC5wdXNoKDEpO1xyXG4gICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBuZXdDb2wucHVzaCgwKTtcclxuICAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGdyYXBoLnB1c2gobmV3Q29sKTtcclxuICAgfVxyXG4gICByZXR1cm4gZ3JhcGg7XHJcbn07XHJcblxyXG5DdWJlR3JvdXAucHJvdG90eXBlLmRpckJldHdlZW4gPSBmdW5jdGlvbihhLCBiKSB7XHJcbiAgIHZhciBkZWx0YVggPSBhLnggLSBiLng7XHJcbiAgIHZhciBkZWx0YVkgPSBhLnkgLSBiLnk7XHJcbiAgIGlmIChkZWx0YVggPiAwKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLkRJUi5XRVNUO1xyXG4gICB9XHJcbiAgIGlmIChkZWx0YVggPCAwKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLkRJUi5FQVNUO1xyXG4gICB9XHJcbiAgIGlmIChkZWx0YVkgPiAwKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLkRJUi5TT1VUSDtcclxuICAgfVxyXG4gICBpZiAoZGVsdGFZIDwgMCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5ESVIuTk9SVEg7XHJcbiAgIH1cclxuICAgcmV0dXJuIHRoaXMuRElSLk5PUlRIO1xyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5kaXJUb0FuZ2xlID0gZnVuY3Rpb24oZGlyKSB7XHJcbiAgc3dpdGNoIChkaXIpIHtcclxuICAgY2FzZSB0aGlzLkRJUi5OT1JUSDpcclxuICAgcmV0dXJuIE1hdGguUEk7XHJcbiAgIGNhc2UgdGhpcy5ESVIuRUFTVDpcclxuICAgcmV0dXJuIDMgLyAyICogTWF0aC5QSTtcclxuICAgY2FzZSB0aGlzLkRJUi5TT1VUSDpcclxuICAgcmV0dXJuIDA7XHJcbiAgIGNhc2UgdGhpcy5ESVIuV0VTVDpcclxuICAgcmV0dXJuIDEgLyAyICogTWF0aC5QSTtcclxuICB9ICBcclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUuZGVzdHJveUN1YmUgPSBmdW5jdGlvbihjdWJlKSB7XHJcbiAgdmFyIGxvYyA9IHRoaXMuZmluZChjdWJlKTtcclxuICBpZiAoIWxvYykge1xyXG4gICAgIGNvbnNvbGUubG9nKCdhdHRlbXB0IHRvIGRlc3Ryb3kgY3ViZSBub3QgaW4gZ3JvdXAnKTtcclxuICAgICByZXR1cm47XHJcbiAgfVxyXG4gIC8vIHJlbW92ZSBjdWJlIGZyb20gZ3JvdXBcclxuICB0aGlzLnJlbW92ZShjdWJlKTtcclxuICAvLyBkZXN0cm95IGN1YmVcclxuICBpZihjdWJlLmtleSA9PT0gJ2NvcmUnICYmIGN1YmUudGFnID09PSAnbW9kdWxlJykge1xyXG5cdGN1YmUua2lsbCgpO1xyXG5cdHRoaXMuZ2FtZS5yZXN0YXJ0TGV2ZWwoKTtcclxuICB9XHJcbiAgY3ViZS5kZXN0cm95KHRydWUpO1xyXG59O1xyXG5cclxuQ3ViZUdyb3VwLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihjdWJlKSB7XHJcbiAgIGlmICh0aGlzLmRlYnVnKSB7IGNvbnNvbGUubG9nKCdyZW1vdmUoKScpOyB9XHJcbiAgIGlmICh0aGlzLnJvb3QgPT09IGN1YmUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICB9XHJcbiAgIC8vIHJlbW92ZSBjdWJlIGZyb20gYXJyYXlcclxuICAgdmFyIHJvdywgY29sO1xyXG4gICBmb3IgKHJvdyA9IDA7IHJvdyA8IHRoaXMuY3ViZXNXaWR0aCgpOyByb3crKykge1xyXG4gICAgICBmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXMuY3ViZXNIZWlnaHQoKTsgY29sKyspIHtcclxuICAgICAgICAgaWYgKHRoaXMuY3ViZXNbcm93XVtjb2xdID09PSBjdWJlKSB7XHJcbiAgICAgICAgICAgIGN1YmUuZ3JvdXAgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIGN1YmUudGFnID0gJ21vZHVsZSc7XHJcbiAgICAgICAgICAgIHRoaXMuY3ViZXNbcm93XVtjb2xdID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgIH1cclxuICAgLy9JZiB0aGlzIGlzIGFuIGFjdGl2ZSBtb2R1bGUsIHNwbGljZSBpdCBmcm9tIHRoZSBhY3RpdmUgbGlzdFxyXG4gICBpZihjdWJlLm1vZHVsZS5pc0FjdGl2ZSl7XHJcblx0ICAgaWYoY3ViZS5tb2R1bGUudHlwZSA9PT0gJ2hhY2tlcicpIHtcclxuXHRcdFx0dmFyIGhhY2tJbmRleCA9IHRoaXMuYWN0aXZlSGFja2VyTW9kdWxlcy5pbmRleE9mKGN1YmUubW9kdWxlKTtcclxuXHRcdFx0dGhpcy5hY3RpdmVIYWNrZXJNb2R1bGVzLnNwbGljZShoYWNrSW5kZXgsIDEpO1xyXG5cdCAgIH1cclxuXHQgICBjdWJlLm1vZHVsZS5pc0FjdGl2ZSA9IGZhbHNlO1xyXG4gICB9XHJcbiAgIC8vc2V0IHNwcml0ZSBvZiBjdWJlIHRvIGdyZXllZCBpZiBuZWNpc2FycnlcclxuICAgaWYoY3ViZS5tb2R1bGUudHlwZSA9PT0gJ3RocnVzdGVyJyB8fCBjdWJlLm1vZHVsZS50eXBlID09PSAnZ3VuJyB8fCBjdWJlLm1vZHVsZS50eXBlID09PSAnaGFja2VyJykge1xyXG5cdFx0Y3ViZS5mcmFtZSA9IDA7XHJcbiAgIH1cclxuICAgLy8gcmVtb3ZlIGNvbnN0cmFpbnRzIGZyb20gY3ViZVxyXG4gICB0aGlzLnJlbW92ZUNvbnN0cmFpbnRzKGN1YmUpO1xyXG4gICBjdWJlLmdyb3VwID0gdW5kZWZpbmVkO1xyXG4gICBpZiAoY3ViZS5tb2R1bGUgJiYgY3ViZS5tb2R1bGUuaGFzT3duUHJvcGVydHkoJ29uUmVtb3ZlJykpIHtcclxuICAgICAgY3ViZS5tb2R1bGUub25SZW1vdmUoKTtcclxuICAgfVxyXG4gICAvLyB0ZXN0IGZvciBleGlsZXNcclxuICAgZm9yIChyb3cgPSAwOyByb3cgPCB0aGlzLmN1YmVzV2lkdGgoKTsgcm93KyspIHtcclxuICAgICAgZm9yIChjb2wgPSAwOyBjb2wgPCB0aGlzLmN1YmVzSGVpZ2h0KCk7IGNvbCsrKSB7XHJcbiAgICAgICAgIHZhciBleGlsZSA9IHRoaXMuY3ViZXNbcm93XVtjb2xdO1xyXG4gICAgICAgICBpZiAoZXhpbGUgJiYgdGhpcy5pc0V4aWxlKGV4aWxlKSkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZShleGlsZSk7XHJcbiAgICAgICAgIH1cclxuICAgICAgfVxyXG4gICB9XHJcbiAgIGlmICh0aGlzLmRlYnVnKSB7IHRoaXMuZGlzcGxheUN1YmVzKCk7IH1cclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUucmVtb3ZlTmVpZ2hib3JzQ29uc3RyYWludCA9IGZ1bmN0aW9uKGNvbnN0cmFpbnQsIGN1YmUpIHtcclxuICAgLy8gY29uc29sZS5sb2coJ3JlbW92ZU5laWdoYm9yc0NvbnN0cmFpbnQnKTtcclxuICAgdmFyIG5laWdoYm9ycyA9IHRoaXMuZ2V0TmVpZ2hib3JzKGN1YmUpO1xyXG4gICBmb3IgKHZhciBpID0gMDsgaSA8IG5laWdoYm9ycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICB2YXIgbmVpZ2hib3IgPSBuZWlnaGJvcnNbaV07XHJcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbmVpZ2hib3IuY29uc3RyYWludHMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgaWYgKG5laWdoYm9yLmNvbnN0cmFpbnRzW2pdID09PSBjb25zdHJhaW50KSB7XHJcbiAgICAgICAgICAgIG5laWdoYm9yLmNvbnN0cmFpbnRzLnNwbGljZShqLCAxKTtcclxuICAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgIH1cclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUuZ2V0TmVpZ2hib3JzID0gZnVuY3Rpb24oY3ViZSkge1xyXG4gICB2YXIgbG9jID0gdGhpcy5maW5kKGN1YmUpO1xyXG4gICB2YXIgbm9ydGggPSB0aGlzLmdldCh0aGlzLmFkanVzdChsb2MsIHRoaXMuRElSLk5PUlRIKSk7XHJcbiAgIHZhciBlYXN0ID0gdGhpcy5nZXQodGhpcy5hZGp1c3QobG9jLCB0aGlzLkRJUi5FQVNUKSk7XHJcbiAgIHZhciBzb3V0aCA9IHRoaXMuZ2V0KHRoaXMuYWRqdXN0KGxvYywgdGhpcy5ESVIuU09VVEgpKTtcclxuICAgdmFyIHdlc3QgPSB0aGlzLmdldCh0aGlzLmFkanVzdChsb2MsIHRoaXMuRElSLldFU1QpKTtcclxuICAgdmFyIG5laWdoYm9ycyA9IFtdO1xyXG4gICBpZiAobm9ydGgpIHtcclxuICAgICAgbmVpZ2hib3JzLnB1c2gobm9ydGgpO1xyXG4gICB9XHJcbiAgIGlmIChlYXN0KSB7XHJcbiAgICAgIG5laWdoYm9ycy5wdXNoKGVhc3QpO1xyXG4gICB9XHJcbiAgIGlmIChzb3V0aCkge1xyXG4gICAgICBuZWlnaGJvcnMucHVzaChzb3V0aCk7XHJcbiAgIH1cclxuICAgaWYgKHdlc3QpIHtcclxuICAgICAgbmVpZ2hib3JzLnB1c2god2VzdCk7XHJcbiAgIH1cclxuICAgcmV0dXJuIG5laWdoYm9ycztcclxufTtcclxuXHJcbkN1YmVHcm91cC5wcm90b3R5cGUucmVtb3ZlQ29uc3RyYWludHMgPSBmdW5jdGlvbihjdWJlKSB7XHJcbiAgIC8vIGNvbnNvbGUubG9nKCdyZW1vdmVDb25zdHJhaW50cycpO1xyXG4gICB3aGlsZSAoY3ViZS5jb25zdHJhaW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRoaXMucmVtb3ZlTmVpZ2hib3JzQ29uc3RyYWludChjdWJlLmNvbnN0cmFpbnRzWzBdLCBjdWJlKTtcclxuICAgICAgdGhpcy5nYW1lLnBoeXNpY3MucDIucmVtb3ZlQ29uc3RyYWludChjdWJlLmNvbnN0cmFpbnRzWzBdKTtcclxuICAgICAgY3ViZS5jb25zdHJhaW50cy5zcGxpY2UoMCwgMSk7XHJcbiAgIH1cclxufTtcclxuXHJcbi8vIG9ubHkgdXNlZCB0byB0ZXN0IEFzdGFyXHJcbkN1YmVHcm91cC5wcm90b3R5cGUudGVzdFBhdGggPSBmdW5jdGlvbigpIHtcclxuICB2YXIgZ3JhcGggPSBuZXcgQXN0YXIuR3JhcGgoW1xyXG4gICAgICAgIFsxLDEsMSwxXSxcclxuICAgICAgICBbMCwxLDEsMF0sXHJcbiAgICAgICAgWzAsMCwwLDFdXHJcbiAgICBdKTtcclxuICAgdmFyIHN0YXJ0ID0gZ3JhcGguZ3JpZFswXVswXTtcclxuICAgdmFyIGVuZCA9IGdyYXBoLmdyaWRbMl1bM107XHJcbiAgIHZhciByZXN1bHQgPSBBc3Rhci5hc3Rhci5zZWFyY2goZ3JhcGgsIHN0YXJ0LCBlbmQpO1xyXG4gICByZXN1bHQudW5zaGlmdChzdGFydCk7XHJcbiAgIGZvcih2YXIgaSA9IDA7IGkgPCByZXN1bHQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc29sZS5sb2cocmVzdWx0W2ldLngsIHJlc3VsdFtpXS55KTtcclxuICAgIH0gXHJcbn07XHJcblxyXG5DdWJlR3JvdXAucHJvdG90eXBlLmlzRXhpbGUgPSBmdW5jdGlvbihjdWJlKSB7XHJcbiAgIGlmIChjdWJlID09PSB0aGlzLnJvb3QpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICB9XHJcbiAgIHZhciBncmFwaCA9IG5ldyBBc3Rhci5HcmFwaCh0aGlzLmN1YmVzVG9HcmFwaCgpKTtcclxuICAgdmFyIHN0YXJ0UG9pbnQgPSB0aGlzLmZpbmQodGhpcy5yb290KTtcclxuICAgdmFyIGVuZFBvaW50ID0gdGhpcy5maW5kKGN1YmUpO1xyXG4gICB2YXIgc3RhcnQgPSBncmFwaC5ncmlkW3N0YXJ0UG9pbnQueF1bc3RhcnRQb2ludC55XTtcclxuICAgdmFyIGVuZCA9IGdyYXBoLmdyaWRbZW5kUG9pbnQueF1bZW5kUG9pbnQueV07XHJcbiAgIHZhciByZXN1bHQgPSBBc3Rhci5hc3Rhci5zZWFyY2goZ3JhcGgsIHN0YXJ0LCBlbmQpO1xyXG4gICAvLyBpZiBubyBwYXRoIGlzIGZvdW5kLCB0aGUgY3ViZSBpcyBhbiBleGlsZVxyXG4gICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgfVxyXG4gICByZXR1cm4gZmFsc2U7XHJcbn07XHJcblxyXG5DdWJlR3JvdXAucHJvdG90eXBlLmNvdW50Q3ViZXMgPSBmdW5jdGlvbigpIHtcclxuXHR2YXIgcm93LCBjb2w7XHJcblx0dmFyIG51bSAgPSAwO1xyXG5cdGZvciAocm93ID0gMDsgcm93IDwgdGhpcy5jdWJlc1dpZHRoKCk7IHJvdysrKSB7XHJcblx0XHRmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXMuY3ViZXNIZWlnaHQoKTsgY29sKyspIHtcclxuXHRcdFx0aWYgKHRoaXMuY3ViZXNbcm93XVtjb2xdICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRudW0rKztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHQvL2NvbnNvbGUubG9nKG51bSk7XHJcblx0dGhpcy5udW1DdWJlcyA9IG51bTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gQ3ViZUdyb3VwO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIiwidmFyIFV0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMuanMnKTtcclxuXHJcbnZhciBFbmVteUFJID0gZnVuY3Rpb24oZ2FtZSwgZ3JvdXAsIHR5cGUsIHBsYXllckdyb3VwKSB7XHJcbiAgIHRoaXMuZ2FtZSA9IGdhbWU7XHJcbiAgIHRoaXMuZ3JvdXAgPSBncm91cDtcclxuICAgdGhpcy50eXBlID0gdHlwZTtcclxuICAgdGhpcy5wbGF5ZXJHcm91cCA9IHBsYXllckdyb3VwO1xyXG4gICB0aGlzLnBsYXllciA9IHRoaXMucGxheWVyR3JvdXAucm9vdDtcclxuICAgdGhpcy5yYW1EaXN0ID0gNTAwO1xyXG4gICB0aGlzLnNob290RGlzdCA9IDUwMDtcclxuICAgdGhpcy5yb3RhdGlvbkZvcmNlID0gNTA7XHJcbiAgIHRoaXMuZmFjaW5nQWxsb3dhbmNlID0gTWF0aC5QSSAvIDE1O1xyXG4gICB0aGlzLmFjdGluZyA9IGZhbHNlO1xyXG4gICBzd2l0Y2ggKHRoaXMudHlwZSkge1xyXG4gICAgICBjYXNlICdyYW0nOlxyXG4gICAgICB0aGlzLmFsbG9jYXRlVG8oJ3RocnVzdGVyJyk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdzaG9vdCc6XHJcbiAgICAgIHRoaXMuYWxsb2NhdGVUbygnZ3VuJyk7XHJcbiAgIH1cclxufTtcclxuXHJcbkVuZW15QUkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gRW5lbXlBSTtcclxuXHJcbkVuZW15QUkucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICBzd2l0Y2ggKHRoaXMudHlwZSkge1xyXG4gICAgICBjYXNlICdyYW0nOlxyXG4gICAgICB0aGlzLmN1c3RvbVVwZGF0ZSgndGhydXN0ZXInLCB0aGlzLnJhbURpc3QpO1xyXG4gICAgICBicmVhaztcclxuICAgICAgY2FzZSAnc2hvb3QnOlxyXG4gICAgICB0aGlzLmN1c3RvbVVwZGF0ZSgnZ3VuJywgdGhpcy5zaG9vdERpc3QpO1xyXG4gICB9XHJcbn07XHJcblxyXG5FbmVteUFJLnByb3RvdHlwZS5jdXN0b21VcGRhdGUgPSBmdW5jdGlvbih0eXBlLCB0aHJlc2hvbGQpIHtcclxuICAgaWYgKCF0aGlzLmdyb3VwLnJvb3QpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICB9XHJcbiAgIGVsc2UgaWYoIXRoaXMuZ3JvdXAucm9vdC5ib2R5KSB7XHJcblx0XHRyZXR1cm47XHJcbiAgIH1cclxuICAgdmFyIHJvb3QgPSB0aGlzLmdyb3VwLnJvb3Q7XHJcbiAgIHZhciBteVBvcyA9IG5ldyBQaGFzZXIuUG9pbnQocm9vdC54LCByb290LnkpO1xyXG4gICB2YXIgcGxheWVyUG9zID0gbmV3IFBoYXNlci5Qb2ludCh0aGlzLnBsYXllci54LCB0aGlzLnBsYXllci55KTtcclxuICAgdmFyIGRpc3QgPSBVdGlscy5kaXN0YW5jZShteVBvcy54LCBteVBvcy55LCBwbGF5ZXJQb3MueCwgcGxheWVyUG9zLnkpO1xyXG4gICBpZiAoZGlzdCA8PSB0aHJlc2hvbGQpIHtcclxuICAgICAgdmFyIGFuZ2xlVG8gPSB0aGlzLmFuZ2xlVG8obXlQb3MsIHBsYXllclBvcyk7XHJcbiAgICAgIHZhciBkaWZmQW5nbGUgPSBhbmdsZVRvIC0gcm9vdC5ib2R5LnJvdGF0aW9uO1xyXG4gICAgICBpZiAoZGlmZkFuZ2xlID4gMCkge1xyXG4gICAgICAgICByb290LmJvZHkuYW5ndWxhckZvcmNlID0gdGhpcy5yb3RhdGlvbkZvcmNlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICByb290LmJvZHkuYW5ndWxhckZvcmNlID0gLXRoaXMucm90YXRpb25Gb3JjZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoTWF0aC5hYnMoZGlmZkFuZ2xlKSA8PSB0aGlzLmZhY2luZ0FsbG93YW5jZSAmJiAhdGhpcy5hY3RpbmcpIHtcclxuICAgICAgICAgLy8gdGhpcy5ncm91cC5jYWxsKCdiZWdpbkFjdCcpO1xyXG4gICAgICAgICB0aGlzLmdyb3VwLmNhbGxPblR5cGUoJ2JlZ2luQWN0JywgdHlwZSk7XHJcbiAgICAgICAgIHRoaXMuYWN0aW5nID0gdHJ1ZTtcclxuICAgICAgICAgLy8gdGhpcy5hbGxvY2F0ZVRvKHR5cGUpO1xyXG4gICAgICB9IGVsc2UgaWYgKE1hdGguYWJzKGRpZmZBbmdsZSkgPiB0aGlzLmZhY2luZ0FsbG93YW5jZSAmJiB0aGlzLmFjdGluZyl7XHJcbiAgICAgICAgIC8vIHRoaXMuZ3JvdXAuY2FsbCgnZW5kQWN0Jyk7XHJcbiAgICAgICAgIHRoaXMuZ3JvdXAuY2FsbE9uVHlwZSgnZW5kQWN0JywgdHlwZSk7XHJcbiAgICAgICAgIHRoaXMuYWN0aW5nID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgfVxyXG59O1xyXG5cclxuRW5lbXlBSS5wcm90b3R5cGUuYWxsb2NhdGVUbyA9IGZ1bmN0aW9uKHR5cGUpIHtcclxuICAgdmFyIHBhbmVscyA9IFtdO1xyXG4gICB2YXIgdHlwZXMgPSBbXTtcclxuICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgdGhpcy5ncm91cC5jdWJlc1dpZHRoKCk7IHJvdysrKSB7XHJcbiAgICAgIGZvciAodmFyIGNvbCA9IDA7IGNvbCA8IHRoaXMuZ3JvdXAuY3ViZXNIZWlnaHQoKTsgY29sKyspIHtcclxuICAgICAgICAgdmFyIGN1YmUgPSB0aGlzLmdyb3VwLmN1YmVzW3Jvd11bY29sXTtcclxuICAgICAgICAgaWYgKGN1YmUgJiYgY3ViZS5tb2R1bGUpIHtcclxuICAgICAgICAgICAgaWYgKGN1YmUubW9kdWxlLnR5cGUgPT09ICdzb2xhclBhbmVsJyAmJiAhY3ViZS5teUNvbm5lY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgcGFuZWxzLnB1c2goY3ViZS5tb2R1bGUpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGN1YmUubW9kdWxlLnR5cGUgPT09IHR5cGUgJiYgIWN1YmUubXlDb25uZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgIHR5cGVzLnB1c2goY3ViZS5tb2R1bGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgIH1cclxuICAgICAgfVxyXG4gICB9XHJcbiAgIHZhciBpID0gMDtcclxuICAgd2hpbGUgKGkgPCB0eXBlcy5sZW5ndGggJiYgaSA8IHBhbmVscy5sZW5ndGgpIHtcclxuICAgICAgdmFyIHRhclBhbmVsID0gcGFuZWxzW2ldO1xyXG4gICAgICB2YXIgdGFyVHlwZSA9IHR5cGVzW2ldO1xyXG4gICAgICB2YXIgbmV3Q29ubmVjdGlvbiA9IHtzdGFydDogdGFyUGFuZWwuY3ViZSwgZW5kOiB0YXJUeXBlLmN1YmV9O1xyXG4gICAgICB0YXJQYW5lbC5jdWJlLm15Q29ubmVjdGlvbiA9IG5ld0Nvbm5lY3Rpb247XHJcbiAgICAgIHRhclR5cGUuY3ViZS5teUNvbm5lY3Rpb24gPSBuZXdDb25uZWN0aW9uO1xyXG4gICAgICB0aGlzLmdyb3VwLmRpc3BsYXlDb25uZWN0aW9uKHRhclBhbmVsLmN1YmUubXlDb25uZWN0aW9uKTtcclxuICAgICAgaSsrO1xyXG4gICB9XHJcbn07XHJcblxyXG5FbmVteUFJLnByb3RvdHlwZS5hbmdsZVRvID0gZnVuY3Rpb24oZnJvbSwgdG8pIHtcclxuICB2YXIgYW5nbGVUb090aGVyID0gUGhhc2VyLlBvaW50LmFuZ2xlKGZyb20sIHRvKTtcclxuICBpZiAoYW5nbGVUb090aGVyIDwgMCkgeyAvLyBmaXggZHVtYiBwYXJ0IG9mIFBoYXNlci5Qb2ludC5hbmdsZSgpXHJcbiAgICAgYW5nbGVUb090aGVyID0gMiAqIE1hdGguUEkgKyBhbmdsZVRvT3RoZXI7XHJcbiAgfVxyXG4gIGFuZ2xlVG9PdGhlciA9IChhbmdsZVRvT3RoZXIgKyAzLzIgKiBNYXRoLlBJKSAlICgyICogTWF0aC5QSSk7IC8vIHJvdGF0ZSA5MCBkIGNsb2Nrd2lzZVxyXG4gIHJldHVybiBhbmdsZVRvT3RoZXI7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEVuZW15QUk7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4iLCJ2YXIgSGVscGVyID0gZnVuY3Rpb24oc3RhdGUpIHtcclxuXHR0aGlzLnN0YXRlID0gc3RhdGU7XHJcbiAgIHRoaXMuZ2FtZSA9IHRoaXMuc3RhdGUuZ2FtZTtcclxuICAgdGhpcy5jYW0gPSB0aGlzLmdhbWUuY2FtZXJhO1xyXG4gICB0aGlzLnNtID0gdGhpcy5zdGF0ZS5zb3VuZE1hbmFnZXI7XHJcbiAgIHRoaXMuaGVscEJhbm5lciA9IHRoaXMuc3RhdGUudWlCdWlsZGVyLmJ1aWxkQmFubmVyKDAuNSwgMC41LCAndHV0b3JpYWxfdGV4dCcpO1xyXG5cdHRoaXMuaGVscEJ1dHRvbiA9IHRoaXMuZ2FtZS5hZGQuYnV0dG9uKHRoaXMuY2FtLnggLSAxMDAsIHRoaXMuY2FtLnkgLSAxMDAsICdoZWxwQnV0dG9uJywgdGhpcy5oZWxwQmFubmVyLnRvZ2dsZSwgdGhpcy5oZWxwQmFubmVyLCAxLCAwLCAyKTtcclxuXHR0aGlzLmhlbHBCdXR0b24ub25JbnB1dE92ZXIuYWRkKHRoaXMuc20ucGxheUhvdmVyQ2xpY2ssIHRoaXMuc20pO1xyXG5cdHRoaXMuaGVscEJ1dHRvbi5vbklucHV0RG93bi5hZGQodGhpcy5zbS5wbGF5RG93bkNsaWNrLCB0aGlzLnNtKTtcclxufTtcclxuXHJcbkhlbHBlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBIZWxwZXI7XHJcblxyXG5IZWxwZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICB0aGlzLmhlbHBCdXR0b24ueCA9IHRoaXMuY2FtLnggKyAxNjtcclxuICAgdGhpcy5oZWxwQnV0dG9uLnkgPSB0aGlzLmNhbS55ICsgMTY7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEhlbHBlcjsiLCJ2YXIgVXRpbHMgPSByZXF1aXJlKCcuLi91dGlscy5qcycpO1xyXG5cclxudmFyIE1vdXNlID0gZnVuY3Rpb24oZ2FtZSwgaW5wdXQsIHBsYXllckdyb3VwKSB7XHJcbiAgIHRoaXMuZ2FtZSA9IGdhbWU7XHJcbiAgIHRoaXMuaW5wdXQgPSBpbnB1dDtcclxuXHR0aGlzLmJvZHkgPSBuZXcgcDIuQm9keSgpOyAvLyBqc2hpbnQgaWdub3JlOmxpbmVcclxuICAgdGhpcy5nYW1lLnBoeXNpY3MucDIud29ybGQuYWRkQm9keSh0aGlzLmJvZHkpO1xyXG4gICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5jbGljaywgdGhpcyk7XHJcbiAgIHRoaXMuaW5wdXQub25VcC5hZGQodGhpcy5yZWxlYXNlLCB0aGlzKTtcclxuICAgdGhpcy5pbnB1dC5hZGRNb3ZlQ2FsbGJhY2sodGhpcy5tb3ZlLCB0aGlzKTtcclxuICAgdGhpcy54ID0gMDtcclxuICAgdGhpcy55ID0gMDtcclxuICAgdGhpcy5ncmFiYmVkID0gdW5kZWZpbmVkO1xyXG4gICB0aGlzLmxhc3RDbGlja2VkID0gdW5kZWZpbmVkO1xyXG4gICB0aGlzLmxpbmUgPSBuZXcgUGhhc2VyLkxpbmUoMCwgMCwgMCwgMCk7XHJcbiAgIHRoaXMucmVtb3ZlVGhyZXNob2xkID0gMTAwOyAvLyB0aW1lIGRpc3RhbmNlIHlvdSBtdXN0IHB1bGwgdG8gcmVtb3ZlIG1vZHVsZVxyXG4gICB0aGlzLnJlbW92ZURpc3QgPSAwOyAvLyBkaXN0YW5jZSB5b3UgYXJlIHB1bGxpbmdcclxuICAgdGhpcy5wbGF5ZXJHcm91cCA9IHBsYXllckdyb3VwO1xyXG4gICAvLyBrZXlzXHJcbiAgIHRoaXMuY2N3S2V5ID0gdGhpcy5nYW1lLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuS2V5Ym9hcmQuUSk7XHJcblx0dGhpcy5jd0tleSA9IHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLktleWJvYXJkLkUpO1xyXG59O1xyXG5cclxuTW91c2UucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTW91c2U7XHJcblxyXG5Nb3VzZS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgIGlmICh0aGlzLmdyYWJiZWQpIHtcclxuICAgICAgdmFyIGFuZ2xlID0gTWF0aC5hdGFuMih0aGlzLmdyYWJiZWQuc3ByaXRlLnkgLSAodGhpcy5pbnB1dC5wb3NpdGlvbi55ICsgdGhpcy5nYW1lLmNhbWVyYS55KSwgdGhpcy5ncmFiYmVkLnNwcml0ZS54IC0gKHRoaXMuaW5wdXQucG9zaXRpb24ueCsgdGhpcy5nYW1lLmNhbWVyYS54KSkgKyBNYXRoLlBJO1xyXG4gICAgICB2YXIgZGlzdCA9IFV0aWxzLmRpc3RhbmNlKHRoaXMuZ3JhYmJlZC5zcHJpdGUueCwgdGhpcy5ncmFiYmVkLnNwcml0ZS55LCAodGhpcy5pbnB1dC5wb3NpdGlvbi54KyB0aGlzLmdhbWUuY2FtZXJhLngpLCAodGhpcy5pbnB1dC5wb3NpdGlvbi55ICsgdGhpcy5nYW1lLmNhbWVyYS55KSk7XHJcbiAgICAgIHZhciB3ZWlnaHQ7XHJcblx0ICBpZih0aGlzLmdyYWJiZWQuc3ByaXRlLmtleSA9PT0gJ2FzdGVyb2lkJykge1xyXG5cdFx0d2VpZ2h0ID0gMTtcclxuXHQgIH1cclxuXHQgIGVsc2Uge1xyXG5cdFx0d2VpZ2h0ID0gMTA7XHJcblx0ICB9XHJcblx0ICBpZiAoIXRoaXMuZ3JhYmJlZC5zcHJpdGUuZ3JvdXApIHtcclxuICAgICAgICAgdGhpcy5ncmFiYmVkLmZvcmNlLnggPSBNYXRoLmNvcyhhbmdsZSkgKiBkaXN0ICogd2VpZ2h0O1xyXG4gICAgICAgICB0aGlzLmdyYWJiZWQuZm9yY2UueSA9IE1hdGguc2luKGFuZ2xlKSAqIGRpc3QgKiB3ZWlnaHQ7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5saW5lLnNldFRvKHRoaXMuZ3JhYmJlZC5zcHJpdGUueCwgdGhpcy5ncmFiYmVkLnNwcml0ZS55LCAodGhpcy5pbnB1dC5wb3NpdGlvbi54KyB0aGlzLmdhbWUuY2FtZXJhLngpLCAodGhpcy5pbnB1dC5wb3NpdGlvbi55ICsgdGhpcy5nYW1lLmNhbWVyYS55KSk7XHJcbiAgICAgIHZhciBkZWx0YVggPSB0aGlzLmdyYWJiZWQuc3ByaXRlLnggLSB0aGlzLng7XHJcblx0ICB2YXIgZGVsdGFZID0gdGhpcy5ncmFiYmVkLnNwcml0ZS55IC0gdGhpcy55O1xyXG5cdCAgdGhpcy5yZW1vdmVEaXN0ID0gTWF0aC5zcXJ0KE1hdGgucG93KGRlbHRhWCwgMikgKyBNYXRoLnBvdyhkZWx0YVksIDIpKTtcclxuICAgICAgaWYodGhpcy5ncmFiYmVkLnNwcml0ZS50YWcgPT09ICdtb2R1bGUnKSB7XHJcblx0XHQgIGlmICh0aGlzLnJlbW92ZURpc3QgPj0gdGhpcy5yZW1vdmVUaHJlc2hvbGQgJiYgdGhpcy5ncmFiYmVkLnNwcml0ZS5rZXkgIT09ICdhc3Rlcm9pZCcpIHtcclxuXHRcdFx0IHRoaXMuZ3JhYmJlZC5zcHJpdGUucmVtb3ZlKCk7XHJcblx0XHQgIH1cclxuXHQgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICB0aGlzLmxpbmUuc2V0VG8oMCwgMCwgMCwgMCk7XHJcbiAgICB9XHJcbiAgICB2YXIgcG9pbnQgPSBuZXcgUGhhc2VyLlBvaW50KHRoaXMueCwgdGhpcy55KTtcclxuICAgIHZhciBib2RpZXMgPSB0aGlzLmdhbWUucGh5c2ljcy5wMi5oaXRUZXN0KHBvaW50KTtcclxuICAgIGlmIChib2RpZXMubGVuZ3RoKVxyXG4gICAge1xyXG4gICAgICAgIHZhciBob3ZlciA9IGJvZGllc1swXS5wYXJlbnQ7XHJcbiAgICAgICAgaWYgKGhvdmVyLnNwcml0ZS5tb2R1bGUgJiYgaG92ZXIuc3ByaXRlLm1vZHVsZS5tb3VzZU92ZXIpIHtcclxuICAgICAgICAgICBob3Zlci5zcHJpdGUubW9kdWxlLm1vdXNlT3ZlcigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIHJvdGF0ZVxyXG4gICBpZih0aGlzLmNjd0tleS5pc0Rvd24pIHtcclxuXHRcdGlmKHRoaXMuZ3JhYmJlZCAhPT0gdW5kZWZpbmVkICYmIHRoaXMuZ3JhYmJlZC5zcHJpdGUuZ3JvdXAgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLmdyYWJiZWQuYW5ndWxhckZvcmNlICs9IC01O1xyXG5cdFx0fVxyXG5cdH1cclxuXHRpZih0aGlzLmN3S2V5LmlzRG93bikge1xyXG5cdFx0aWYodGhpcy5ncmFiYmVkICE9PSB1bmRlZmluZWQgJiYgdGhpcy5ncmFiYmVkLnNwcml0ZS5ncm91cCA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMuZ3JhYmJlZC5hbmd1bGFyRm9yY2UgKz0gNTtcclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG5Nb3VzZS5wcm90b3R5cGUuY2xpY2sgPSBmdW5jdGlvbihwb2ludGVyKSB7XHJcbiAgIHZhciBwb2ludCA9IG5ldyBQaGFzZXIuUG9pbnQocG9pbnRlci54ICsgdGhpcy5nYW1lLmNhbWVyYS54LCBwb2ludGVyLnkgKyB0aGlzLmdhbWUuY2FtZXJhLnkpO1xyXG4gICB2YXIgYm9kaWVzID0gdGhpcy5nYW1lLnBoeXNpY3MucDIuaGl0VGVzdChwb2ludCk7XHJcbiAgIGlmIChib2RpZXMubGVuZ3RoKVxyXG4gICB7XHJcbiAgICAgdmFyIHRlbXAgPSBib2RpZXNbMF0ucGFyZW50O1xyXG4gICAgIC8vIGNvbnNvbGUubG9nKCdyb3RhdGlvbjonLCB0ZW1wLnJvdGF0aW9uKTtcclxuICAgICB0aGlzLmdyYWJiZWQgPSB0ZW1wO1xyXG4gICAgIGlmICh0aGlzLmdyYWJiZWQuc3ByaXRlLm1vZHVsZSAmJiB0aGlzLmdyYWJiZWQuc3ByaXRlLm1vZHVsZS5oYXNPd25Qcm9wZXJ0eSgnbW91c2VEb3duJykpIHtcclxuICAgICAgIHRoaXMuZ3JhYmJlZC5zcHJpdGUubW9kdWxlLm1vdXNlRG93bigpO1xyXG4gICAgIH1cclxuICAgICBpZiAodGhpcy5sYXN0Q2xpY2tlZCAmJiB0aGlzLmxhc3RDbGlja2VkLnNwcml0ZSAmJiB0aGlzLmxhc3RDbGlja2VkLnNwcml0ZS5tb2R1bGUgJiZcclxuICAgICB0aGlzLmxhc3RDbGlja2VkLnNwcml0ZS5tb2R1bGUuZ2l2ZVRhcmdldCkge1xyXG4gICAgICAgIHRoaXMubGFzdENsaWNrZWQuc3ByaXRlLm1vZHVsZS5naXZlVGFyZ2V0KHRoaXMuZ3JhYmJlZC5zcHJpdGUubW9kdWxlKTtcclxuICAgICB9XHJcbiAgICAgaWYgKHRlbXAuc3ByaXRlICYmIHRlbXAuc3ByaXRlLm1vZHVsZSAmJiB0ZW1wLnNwcml0ZS5tb2R1bGUudHlwZSA9PT0gJ2NvcmUnKSB7XHJcbiAgICAgICAgdGhpcy5ncmFiYmVkID0gdW5kZWZpbmVkO1xyXG4gICAgIH1cclxuICAgICBpZiAodGVtcC5zcHJpdGUgJiYgdGVtcC5zcHJpdGUuZ3JvdXAgJiYgdGVtcC5zcHJpdGUuZ3JvdXAgIT09IHRoaXMucGxheWVyR3JvdXApIHtcclxuICAgICAgICB0aGlzLmdyYWJiZWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgfVxyXG4gICAgIHRoaXMubGFzdENsaWNrZWQgPSB0ZW1wO1xyXG4gICB9XHJcbn07XHJcbiAgXHJcbiBNb3VzZS5wcm90b3R5cGUucmVsZWFzZSA9IGZ1bmN0aW9uKCkge1xyXG4gICBpZiAodGhpcy5ncmFiYmVkKSB7XHJcbiAgICAgdGhpcy5ncmFiYmVkID0gdW5kZWZpbmVkO1xyXG4gICB9XHJcbn07XHJcblxyXG5Nb3VzZS5wcm90b3R5cGUubW92ZSA9IGZ1bmN0aW9uKHBvaW50ZXIpIHtcclxuICAgLy8gcDIgdXNlcyBkaWZmZXJlbnQgY29vcmRpbmF0ZSBzeXN0ZW0sIHNvIGNvbnZlcnQgdGhlIHBvaW50ZXIgcG9zaXRpb24gdG8gcDIncyBjb29yZGluYXRlIHN5c3RlbVxyXG4gICB0aGlzLmJvZHkucG9zaXRpb25bMF0gPSB0aGlzLmdhbWUucGh5c2ljcy5wMi5weG1pKHBvaW50ZXIucG9zaXRpb24ueCk7XHJcbiAgIHRoaXMuYm9keS5wb3NpdGlvblsxXSA9IHRoaXMuZ2FtZS5waHlzaWNzLnAyLnB4bWkocG9pbnRlci5wb3NpdGlvbi55KTtcclxuICAgdGhpcy54ID0gcG9pbnRlci5wb3NpdGlvbi54ICsgdGhpcy5nYW1lLmNhbWVyYS54O1xyXG4gICB0aGlzLnkgPSBwb2ludGVyLnBvc2l0aW9uLnkgKyB0aGlzLmdhbWUuY2FtZXJhLnk7XHJcbn07XHJcblxyXG5Nb3VzZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XHJcbiAgIC8vdGhpcy5nYW1lLmRlYnVnLmdlb20odGhpcy5saW5lKTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gTW91c2U7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIiwiLypcclxuUGxheXMgc291bmRzIG5lZWRlZCBhY3Jvc3MgbXVsdGlwbGUgc2NyaXB0cy5cclxuKi9cclxudmFyIFNvdW5kTWFuYWdlciA9IGZ1bmN0aW9uKHN0YXRlKSB7XHJcbiAgIC8vIGluaXRpYWwgdmFyaWFibGVzXHJcblx0dGhpcy5zdGF0ZSA9IHN0YXRlO1xyXG4gICB0aGlzLmdhbWUgPSB0aGlzLnN0YXRlLmdhbWU7XHJcbiAgIHRoaXMuY2FtID0gdGhpcy5nYW1lLmNhbWVyYTtcclxuICAgLy8gc291bmRzXHJcbiAgIHRoaXMuaG92ZXJDbGljayA9IHRoaXMuZ2FtZS5hZGQuYXVkaW8oJ2hvdmVyQ2xpY2snKTtcclxuICAgdGhpcy5kb3duQ2xpY2sgPSB0aGlzLmdhbWUuYWRkLmF1ZGlvKCdkb3duQ2xpY2snKTtcclxufTtcclxuXHJcblNvdW5kTWFuYWdlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBTb3VuZE1hbmFnZXI7XHJcblxyXG5Tb3VuZE1hbmFnZXIucHJvdG90eXBlLnBsYXlIb3ZlckNsaWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgIHRoaXMuaG92ZXJDbGljay5wbGF5KCk7XHJcbn07XHJcblxyXG5Tb3VuZE1hbmFnZXIucHJvdG90eXBlLnBsYXlEb3duQ2xpY2sgPSBmdW5jdGlvbigpIHtcclxuICAgdGhpcy5kb3duQ2xpY2sucGxheSgpO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBTb3VuZE1hbmFnZXI7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiIsInZhciBSZW5kZXJhYmxlcyA9IGZ1bmN0aW9uKCkge1xyXG5cdGlmKFJlbmRlcmFibGVzLnByb3RvdHlwZS5leGlzdHMpIHtcclxuXHRcdHJldHVybiBSZW5kZXJhYmxlcy5wcm90b3R5cGUuZXhpc3RpbmdSZWZlcmVuY2U7XHJcblx0fVxyXG5cdFxyXG5cdHRoaXMubGlzdCA9IFtdO1xyXG5cdFJlbmRlcmFibGVzLnByb3RvdHlwZS5leGlzdHMgPSB0cnVlO1xyXG5cdFJlbmRlcmFibGVzLnByb3RvdHlwZS5leGlzdGluZ1JlZmVyZW5jZSA9IHRoaXM7XHJcbn07XHJcblxyXG5SZW5kZXJhYmxlcy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBSZW5kZXJhYmxlcztcclxuLy9UaGVzZSB2YXIncyBoZWxwIGNyZWF0ZSB0aGUgc2luZ2xldG9uIGZ1bmN0aW9uYWxpdHlcclxuUmVuZGVyYWJsZXMucHJvdG90eXBlLmV4aXN0cyA9IGZhbHNlO1xyXG5SZW5kZXJhYmxlcy5wcm90b3R5cGUuZXhpc3RpbmdSZWZlcmVuY2UgPSBudWxsO1xyXG5cclxuUmVuZGVyYWJsZXMucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uKHN1YnNjcmliZXIpIHtcclxuXHR0aGlzLmxpc3QucHVzaChzdWJzY3JpYmVyKTtcclxufTtcclxuXHJcblJlbmRlcmFibGVzLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uKHVuc3Vic2NyaWJlcikge1xyXG5cdGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLmxpc3QubGVuZ3RoOyBpKyspIHtcclxuXHRcdGlmKHRoaXMubGlzdFtpXSA9PT0gdW5zdWJzY3JpYmVyKSB7XHJcblx0XHRcdHRoaXMubGlzdFtpXSA9IGZhbHNlO1xyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuXHJcblJlbmRlcmFibGVzLnByb3RvdHlwZS5yZW5kZXJBbGwgPSBmdW5jdGlvbigpIHtcclxuXHRmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5saXN0Lmxlbmd0aDsgaSsrKSB7XHJcblx0XHRpZih0aGlzLmxpc3RbaV0gPT09IGZhbHNlKSB7XHJcblx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5saXN0W2ldLnJlbmRlcigpO1xyXG5cdH1cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gUmVuZGVyYWJsZXM7IiwiLy8gamF2YXNjcmlwdC1hc3RhciAwLjQuMFxyXG4vLyBodHRwOi8vZ2l0aHViLmNvbS9iZ3JpbnMvamF2YXNjcmlwdC1hc3RhclxyXG4vLyBGcmVlbHkgZGlzdHJpYnV0YWJsZSB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbi8vIEltcGxlbWVudHMgdGhlIGFzdGFyIHNlYXJjaCBhbGdvcml0aG0gaW4gamF2YXNjcmlwdCB1c2luZyBhIEJpbmFyeSBIZWFwLlxyXG4vLyBJbmNsdWRlcyBCaW5hcnkgSGVhcCAod2l0aCBtb2RpZmljYXRpb25zKSBmcm9tIE1hcmlqbiBIYXZlcmJla2UuXHJcbi8vIGh0dHA6Ly9lbG9xdWVudGphdmFzY3JpcHQubmV0L2FwcGVuZGl4Mi5odG1sXHJcblxyXG4oZnVuY3Rpb24oZGVmaW5pdGlvbikge1xyXG4gICAgLyogZ2xvYmFsIG1vZHVsZSwgZGVmaW5lICovXHJcbiAgICBpZih0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlLmV4cG9ydHMgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBkZWZpbml0aW9uKCk7XHJcbiAgICB9IGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XHJcbiAgICAgICAgZGVmaW5lKFtdLCBkZWZpbml0aW9uKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdmFyIGV4cG9ydHMgPSBkZWZpbml0aW9uKCk7XHJcbiAgICAgICAgd2luZG93LmFzdGFyID0gZXhwb3J0cy5hc3RhcjtcclxuICAgICAgICB3aW5kb3cuR3JhcGggPSBleHBvcnRzLkdyYXBoO1xyXG4gICAgfVxyXG59KShmdW5jdGlvbigpIHtcclxuXHJcbmZ1bmN0aW9uIHBhdGhUbyhub2RlKXtcclxuICAgIHZhciBjdXJyID0gbm9kZSxcclxuICAgICAgICBwYXRoID0gW107XHJcbiAgICB3aGlsZShjdXJyLnBhcmVudCkge1xyXG4gICAgICAgIHBhdGgucHVzaChjdXJyKTtcclxuICAgICAgICBjdXJyID0gY3Vyci5wYXJlbnQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcGF0aC5yZXZlcnNlKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldEhlYXAoKSB7XHJcbiAgICByZXR1cm4gbmV3IEJpbmFyeUhlYXAoZnVuY3Rpb24obm9kZSkge1xyXG4gICAgICAgIHJldHVybiBub2RlLmY7XHJcbiAgICB9KTtcclxufVxyXG5cclxudmFyIGFzdGFyID0ge1xyXG4gICAgLyoqXHJcbiAgICAqIFBlcmZvcm0gYW4gQSogU2VhcmNoIG9uIGEgZ3JhcGggZ2l2ZW4gYSBzdGFydCBhbmQgZW5kIG5vZGUuXHJcbiAgICAqIEBwYXJhbSB7R3JhcGh9IGdyYXBoXHJcbiAgICAqIEBwYXJhbSB7R3JpZE5vZGV9IHN0YXJ0XHJcbiAgICAqIEBwYXJhbSB7R3JpZE5vZGV9IGVuZFxyXG4gICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICAqIEBwYXJhbSB7Ym9vbH0gW29wdGlvbnMuY2xvc2VzdF0gU3BlY2lmaWVzIHdoZXRoZXIgdG8gcmV0dXJuIHRoZVxyXG4gICAgICAgICAgICAgICBwYXRoIHRvIHRoZSBjbG9zZXN0IG5vZGUgaWYgdGhlIHRhcmdldCBpcyB1bnJlYWNoYWJsZS5cclxuICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW29wdGlvbnMuaGV1cmlzdGljXSBIZXVyaXN0aWMgZnVuY3Rpb24gKHNlZVxyXG4gICAgKiAgICAgICAgICBhc3Rhci5oZXVyaXN0aWNzKS5cclxuICAgICovXHJcbiAgICBzZWFyY2g6IGZ1bmN0aW9uKGdyYXBoLCBzdGFydCwgZW5kLCBvcHRpb25zKSB7XHJcbiAgICAgICAgZ3JhcGguY2xlYW5EaXJ0eSgpO1xyXG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG4gICAgICAgIHZhciBoZXVyaXN0aWMgPSBvcHRpb25zLmhldXJpc3RpYyB8fCBhc3Rhci5oZXVyaXN0aWNzLm1hbmhhdHRhbixcclxuICAgICAgICAgICAgY2xvc2VzdCA9IG9wdGlvbnMuY2xvc2VzdCB8fCBmYWxzZTtcclxuXHJcbiAgICAgICAgdmFyIG9wZW5IZWFwID0gZ2V0SGVhcCgpLFxyXG4gICAgICAgICAgICBjbG9zZXN0Tm9kZSA9IHN0YXJ0OyAvLyBzZXQgdGhlIHN0YXJ0IG5vZGUgdG8gYmUgdGhlIGNsb3Nlc3QgaWYgcmVxdWlyZWRcclxuXHJcbiAgICAgICAgc3RhcnQuaCA9IGhldXJpc3RpYyhzdGFydCwgZW5kKTtcclxuXHJcbiAgICAgICAgb3BlbkhlYXAucHVzaChzdGFydCk7XHJcblxyXG4gICAgICAgIHdoaWxlKG9wZW5IZWFwLnNpemUoKSA+IDApIHtcclxuXHJcbiAgICAgICAgICAgIC8vIEdyYWIgdGhlIGxvd2VzdCBmKHgpIHRvIHByb2Nlc3MgbmV4dC4gIEhlYXAga2VlcHMgdGhpcyBzb3J0ZWQgZm9yIHVzLlxyXG4gICAgICAgICAgICB2YXIgY3VycmVudE5vZGUgPSBvcGVuSGVhcC5wb3AoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEVuZCBjYXNlIC0tIHJlc3VsdCBoYXMgYmVlbiBmb3VuZCwgcmV0dXJuIHRoZSB0cmFjZWQgcGF0aC5cclxuICAgICAgICAgICAgaWYoY3VycmVudE5vZGUgPT09IGVuZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhdGhUbyhjdXJyZW50Tm9kZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIE5vcm1hbCBjYXNlIC0tIG1vdmUgY3VycmVudE5vZGUgZnJvbSBvcGVuIHRvIGNsb3NlZCwgcHJvY2VzcyBlYWNoIG9mIGl0cyBuZWlnaGJvcnMuXHJcbiAgICAgICAgICAgIGN1cnJlbnROb2RlLmNsb3NlZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAvLyBGaW5kIGFsbCBuZWlnaGJvcnMgZm9yIHRoZSBjdXJyZW50IG5vZGUuXHJcbiAgICAgICAgICAgIHZhciBuZWlnaGJvcnMgPSBncmFwaC5uZWlnaGJvcnMoY3VycmVudE5vZGUpO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlsID0gbmVpZ2hib3JzLmxlbmd0aDsgaSA8IGlsOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIHZhciBuZWlnaGJvciA9IG5laWdoYm9yc1tpXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobmVpZ2hib3IuY2xvc2VkIHx8IG5laWdoYm9yLmlzV2FsbCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTm90IGEgdmFsaWQgbm9kZSB0byBwcm9jZXNzLCBza2lwIHRvIG5leHQgbmVpZ2hib3IuXHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVGhlIGcgc2NvcmUgaXMgdGhlIHNob3J0ZXN0IGRpc3RhbmNlIGZyb20gc3RhcnQgdG8gY3VycmVudCBub2RlLlxyXG4gICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBjaGVjayBpZiB0aGUgcGF0aCB3ZSBoYXZlIGFycml2ZWQgYXQgdGhpcyBuZWlnaGJvciBpcyB0aGUgc2hvcnRlc3Qgb25lIHdlIGhhdmUgc2VlbiB5ZXQuXHJcbiAgICAgICAgICAgICAgICB2YXIgZ1Njb3JlID0gY3VycmVudE5vZGUuZyArIG5laWdoYm9yLmdldENvc3QoY3VycmVudE5vZGUpLFxyXG4gICAgICAgICAgICAgICAgICAgIGJlZW5WaXNpdGVkID0gbmVpZ2hib3IudmlzaXRlZDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIWJlZW5WaXNpdGVkIHx8IGdTY29yZSA8IG5laWdoYm9yLmcpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRm91bmQgYW4gb3B0aW1hbCAoc28gZmFyKSBwYXRoIHRvIHRoaXMgbm9kZS4gIFRha2Ugc2NvcmUgZm9yIG5vZGUgdG8gc2VlIGhvdyBnb29kIGl0IGlzLlxyXG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yLnZpc2l0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yLnBhcmVudCA9IGN1cnJlbnROb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yLmggPSBuZWlnaGJvci5oIHx8IGhldXJpc3RpYyhuZWlnaGJvciwgZW5kKTtcclxuICAgICAgICAgICAgICAgICAgICBuZWlnaGJvci5nID0gZ1Njb3JlO1xyXG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yLmYgPSBuZWlnaGJvci5nICsgbmVpZ2hib3IuaDtcclxuICAgICAgICAgICAgICAgICAgICBncmFwaC5tYXJrRGlydHkobmVpZ2hib3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjbG9zZXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBuZWlnaGJvdXIgaXMgY2xvc2VyIHRoYW4gdGhlIGN1cnJlbnQgY2xvc2VzdE5vZGUgb3IgaWYgaXQncyBlcXVhbGx5IGNsb3NlIGJ1dCBoYXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYSBjaGVhcGVyIHBhdGggdGhhbiB0aGUgY3VycmVudCBjbG9zZXN0IG5vZGUgdGhlbiBpdCBiZWNvbWVzIHRoZSBjbG9zZXN0IG5vZGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5laWdoYm9yLmggPCBjbG9zZXN0Tm9kZS5oIHx8IChuZWlnaGJvci5oID09PSBjbG9zZXN0Tm9kZS5oICYmIG5laWdoYm9yLmcgPCBjbG9zZXN0Tm9kZS5nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VzdE5vZGUgPSBuZWlnaGJvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFiZWVuVmlzaXRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBQdXNoaW5nIHRvIGhlYXAgd2lsbCBwdXQgaXQgaW4gcHJvcGVyIHBsYWNlIGJhc2VkIG9uIHRoZSAnZicgdmFsdWUuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5IZWFwLnB1c2gobmVpZ2hib3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWxyZWFkeSBzZWVuIHRoZSBub2RlLCBidXQgc2luY2UgaXQgaGFzIGJlZW4gcmVzY29yZWQgd2UgbmVlZCB0byByZW9yZGVyIGl0IGluIHRoZSBoZWFwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5IZWFwLnJlc2NvcmVFbGVtZW50KG5laWdoYm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjbG9zZXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXRoVG8oY2xvc2VzdE5vZGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTm8gcmVzdWx0IHdhcyBmb3VuZCAtIGVtcHR5IGFycmF5IHNpZ25pZmllcyBmYWlsdXJlIHRvIGZpbmQgcGF0aC5cclxuICAgICAgICByZXR1cm4gW107XHJcbiAgICB9LFxyXG4gICAgLy8gU2VlIGxpc3Qgb2YgaGV1cmlzdGljczogaHR0cDovL3RoZW9yeS5zdGFuZm9yZC5lZHUvfmFtaXRwL0dhbWVQcm9ncmFtbWluZy9IZXVyaXN0aWNzLmh0bWxcclxuICAgIGhldXJpc3RpY3M6IHtcclxuICAgICAgICBtYW5oYXR0YW46IGZ1bmN0aW9uKHBvczAsIHBvczEpIHtcclxuICAgICAgICAgICAgdmFyIGQxID0gTWF0aC5hYnMocG9zMS54IC0gcG9zMC54KTtcclxuICAgICAgICAgICAgdmFyIGQyID0gTWF0aC5hYnMocG9zMS55IC0gcG9zMC55KTtcclxuICAgICAgICAgICAgcmV0dXJuIGQxICsgZDI7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBkaWFnb25hbDogZnVuY3Rpb24ocG9zMCwgcG9zMSkge1xyXG4gICAgICAgICAgICB2YXIgRCA9IDE7XHJcbiAgICAgICAgICAgIHZhciBEMiA9IE1hdGguc3FydCgyKTtcclxuICAgICAgICAgICAgdmFyIGQxID0gTWF0aC5hYnMocG9zMS54IC0gcG9zMC54KTtcclxuICAgICAgICAgICAgdmFyIGQyID0gTWF0aC5hYnMocG9zMS55IC0gcG9zMC55KTtcclxuICAgICAgICAgICAgcmV0dXJuIChEICogKGQxICsgZDIpKSArICgoRDIgLSAoMiAqIEQpKSAqIE1hdGgubWluKGQxLCBkMikpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBjbGVhbk5vZGU6ZnVuY3Rpb24obm9kZSl7XHJcbiAgICAgICAgbm9kZS5mID0gMDtcclxuICAgICAgICBub2RlLmcgPSAwO1xyXG4gICAgICAgIG5vZGUuaCA9IDA7XHJcbiAgICAgICAgbm9kZS52aXNpdGVkID0gZmFsc2U7XHJcbiAgICAgICAgbm9kZS5jbG9zZWQgPSBmYWxzZTtcclxuICAgICAgICBub2RlLnBhcmVudCA9IG51bGw7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vKipcclxuKiBBIGdyYXBoIG1lbW9yeSBzdHJ1Y3R1cmVcclxuKiBAcGFyYW0ge0FycmF5fSBncmlkSW4gMkQgYXJyYXkgb2YgaW5wdXQgd2VpZ2h0c1xyXG4qIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuKiBAcGFyYW0ge2Jvb2x9IFtvcHRpb25zLmRpYWdvbmFsXSBTcGVjaWZpZXMgd2hldGhlciBkaWFnb25hbCBtb3ZlcyBhcmUgYWxsb3dlZFxyXG4qL1xyXG5mdW5jdGlvbiBHcmFwaChncmlkSW4sIG9wdGlvbnMpIHtcclxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG4gICAgdGhpcy5ub2RlcyA9IFtdO1xyXG4gICAgdGhpcy5kaWFnb25hbCA9ICEhb3B0aW9ucy5kaWFnb25hbDtcclxuICAgIHRoaXMuZ3JpZCA9IFtdO1xyXG4gICAgZm9yICh2YXIgeCA9IDA7IHggPCBncmlkSW4ubGVuZ3RoOyB4KyspIHtcclxuICAgICAgICB0aGlzLmdyaWRbeF0gPSBbXTtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgeSA9IDAsIHJvdyA9IGdyaWRJblt4XTsgeSA8IHJvdy5sZW5ndGg7IHkrKykge1xyXG4gICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBHcmlkTm9kZSh4LCB5LCByb3dbeV0pO1xyXG4gICAgICAgICAgICB0aGlzLmdyaWRbeF1beV0gPSBub2RlO1xyXG4gICAgICAgICAgICB0aGlzLm5vZGVzLnB1c2gobm9kZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5pbml0KCk7XHJcbn1cclxuXHJcbkdyYXBoLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICB0aGlzLmRpcnR5Tm9kZXMgPSBbXTtcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ub2Rlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGFzdGFyLmNsZWFuTm9kZSh0aGlzLm5vZGVzW2ldKTtcclxuICAgIH1cclxufTtcclxuXHJcbkdyYXBoLnByb3RvdHlwZS5jbGVhbkRpcnR5ID0gZnVuY3Rpb24oKSB7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZGlydHlOb2Rlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGFzdGFyLmNsZWFuTm9kZSh0aGlzLmRpcnR5Tm9kZXNbaV0pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5kaXJ0eU5vZGVzID0gW107XHJcbn07XHJcblxyXG5HcmFwaC5wcm90b3R5cGUubWFya0RpcnR5ID0gZnVuY3Rpb24obm9kZSkge1xyXG4gICAgdGhpcy5kaXJ0eU5vZGVzLnB1c2gobm9kZSk7XHJcbn07XHJcblxyXG5HcmFwaC5wcm90b3R5cGUubmVpZ2hib3JzID0gZnVuY3Rpb24obm9kZSkge1xyXG4gICAgdmFyIHJldCA9IFtdLFxyXG4gICAgICAgIHggPSBub2RlLngsXHJcbiAgICAgICAgeSA9IG5vZGUueSxcclxuICAgICAgICBncmlkID0gdGhpcy5ncmlkO1xyXG5cclxuICAgIC8vIFdlc3RcclxuICAgIGlmKGdyaWRbeC0xXSAmJiBncmlkW3gtMV1beV0pIHtcclxuICAgICAgICByZXQucHVzaChncmlkW3gtMV1beV0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEVhc3RcclxuICAgIGlmKGdyaWRbeCsxXSAmJiBncmlkW3grMV1beV0pIHtcclxuICAgICAgICByZXQucHVzaChncmlkW3grMV1beV0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNvdXRoXHJcbiAgICBpZihncmlkW3hdICYmIGdyaWRbeF1beS0xXSkge1xyXG4gICAgICAgIHJldC5wdXNoKGdyaWRbeF1beS0xXSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTm9ydGhcclxuICAgIGlmKGdyaWRbeF0gJiYgZ3JpZFt4XVt5KzFdKSB7XHJcbiAgICAgICAgcmV0LnB1c2goZ3JpZFt4XVt5KzFdKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5kaWFnb25hbCkge1xyXG4gICAgICAgIC8vIFNvdXRod2VzdFxyXG4gICAgICAgIGlmKGdyaWRbeC0xXSAmJiBncmlkW3gtMV1beS0xXSkge1xyXG4gICAgICAgICAgICByZXQucHVzaChncmlkW3gtMV1beS0xXSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTb3V0aGVhc3RcclxuICAgICAgICBpZihncmlkW3grMV0gJiYgZ3JpZFt4KzFdW3ktMV0pIHtcclxuICAgICAgICAgICAgcmV0LnB1c2goZ3JpZFt4KzFdW3ktMV0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTm9ydGh3ZXN0XHJcbiAgICAgICAgaWYoZ3JpZFt4LTFdICYmIGdyaWRbeC0xXVt5KzFdKSB7XHJcbiAgICAgICAgICAgIHJldC5wdXNoKGdyaWRbeC0xXVt5KzFdKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIE5vcnRoZWFzdFxyXG4gICAgICAgIGlmKGdyaWRbeCsxXSAmJiBncmlkW3grMV1beSsxXSkge1xyXG4gICAgICAgICAgICByZXQucHVzaChncmlkW3grMV1beSsxXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZXQ7XHJcbn07XHJcblxyXG5HcmFwaC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcclxuICAgIHZhciBncmFwaFN0cmluZyA9IFtdLFxyXG4gICAgICAgIG5vZGVzID0gdGhpcy5ncmlkLCAvLyB3aGVuIHVzaW5nIGdyaWRcclxuICAgICAgICByb3dEZWJ1Zywgcm93LCB5LCBsO1xyXG4gICAgZm9yICh2YXIgeCA9IDAsIGxlbiA9IG5vZGVzLmxlbmd0aDsgeCA8IGxlbjsgeCsrKSB7XHJcbiAgICAgICAgcm93RGVidWcgPSBbXTtcclxuICAgICAgICByb3cgPSBub2Rlc1t4XTtcclxuICAgICAgICBmb3IgKHkgPSAwLCBsID0gcm93Lmxlbmd0aDsgeSA8IGw7IHkrKykge1xyXG4gICAgICAgICAgICByb3dEZWJ1Zy5wdXNoKHJvd1t5XS53ZWlnaHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBncmFwaFN0cmluZy5wdXNoKHJvd0RlYnVnLmpvaW4oJyAnKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZ3JhcGhTdHJpbmcuam9pbignXFxuJyk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBHcmlkTm9kZSh4LCB5LCB3ZWlnaHQpIHtcclxuICAgIHRoaXMueCA9IHg7XHJcbiAgICB0aGlzLnkgPSB5O1xyXG4gICAgdGhpcy53ZWlnaHQgPSB3ZWlnaHQ7XHJcbn1cclxuXHJcbkdyaWROb2RlLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuICdbJyArIHRoaXMueCArICcgJyArIHRoaXMueSArICddJztcclxufTtcclxuXHJcbkdyaWROb2RlLnByb3RvdHlwZS5nZXRDb3N0ID0gZnVuY3Rpb24oZnJvbU5laWdoYm9yKSB7XHJcbiAgICAvLyBUYWtlIGRpYWdvbmFsIHdlaWdodCBpbnRvIGNvbnNpZGVyYXRpb24uXHJcbiAgICBpZiAoZnJvbU5laWdoYm9yICYmIGZyb21OZWlnaGJvci54ICE9PSB0aGlzLnggJiYgZnJvbU5laWdoYm9yLnkgIT09IHRoaXMueSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLndlaWdodCAqIDEuNDE0MjE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy53ZWlnaHQ7XHJcbn07XHJcblxyXG5HcmlkTm9kZS5wcm90b3R5cGUuaXNXYWxsID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy53ZWlnaHQgPT09IDA7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBCaW5hcnlIZWFwKHNjb3JlRnVuY3Rpb24pe1xyXG4gICAgdGhpcy5jb250ZW50ID0gW107XHJcbiAgICB0aGlzLnNjb3JlRnVuY3Rpb24gPSBzY29yZUZ1bmN0aW9uO1xyXG59XHJcblxyXG5CaW5hcnlIZWFwLnByb3RvdHlwZSA9IHtcclxuICAgIHB1c2g6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcclxuICAgICAgICAvLyBBZGQgdGhlIG5ldyBlbGVtZW50IHRvIHRoZSBlbmQgb2YgdGhlIGFycmF5LlxyXG4gICAgICAgIHRoaXMuY29udGVudC5wdXNoKGVsZW1lbnQpO1xyXG5cclxuICAgICAgICAvLyBBbGxvdyBpdCB0byBzaW5rIGRvd24uXHJcbiAgICAgICAgdGhpcy5zaW5rRG93bih0aGlzLmNvbnRlbnQubGVuZ3RoIC0gMSk7XHJcbiAgICB9LFxyXG4gICAgcG9wOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBTdG9yZSB0aGUgZmlyc3QgZWxlbWVudCBzbyB3ZSBjYW4gcmV0dXJuIGl0IGxhdGVyLlxyXG4gICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmNvbnRlbnRbMF07XHJcbiAgICAgICAgLy8gR2V0IHRoZSBlbGVtZW50IGF0IHRoZSBlbmQgb2YgdGhlIGFycmF5LlxyXG4gICAgICAgIHZhciBlbmQgPSB0aGlzLmNvbnRlbnQucG9wKCk7XHJcbiAgICAgICAgLy8gSWYgdGhlcmUgYXJlIGFueSBlbGVtZW50cyBsZWZ0LCBwdXQgdGhlIGVuZCBlbGVtZW50IGF0IHRoZVxyXG4gICAgICAgIC8vIHN0YXJ0LCBhbmQgbGV0IGl0IGJ1YmJsZSB1cC5cclxuICAgICAgICBpZiAodGhpcy5jb250ZW50Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50WzBdID0gZW5kO1xyXG4gICAgICAgICAgICB0aGlzLmJ1YmJsZVVwKDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfSxcclxuICAgIHJlbW92ZTogZnVuY3Rpb24obm9kZSkge1xyXG4gICAgICAgIHZhciBpID0gdGhpcy5jb250ZW50LmluZGV4T2Yobm9kZSk7XHJcblxyXG4gICAgICAgIC8vIFdoZW4gaXQgaXMgZm91bmQsIHRoZSBwcm9jZXNzIHNlZW4gaW4gJ3BvcCcgaXMgcmVwZWF0ZWRcclxuICAgICAgICAvLyB0byBmaWxsIHVwIHRoZSBob2xlLlxyXG4gICAgICAgIHZhciBlbmQgPSB0aGlzLmNvbnRlbnQucG9wKCk7XHJcblxyXG4gICAgICAgIGlmIChpICE9PSB0aGlzLmNvbnRlbnQubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRbaV0gPSBlbmQ7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5zY29yZUZ1bmN0aW9uKGVuZCkgPCB0aGlzLnNjb3JlRnVuY3Rpb24obm9kZSkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2lua0Rvd24oaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJ1YmJsZVVwKGkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHNpemU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbnRlbnQubGVuZ3RoO1xyXG4gICAgfSxcclxuICAgIHJlc2NvcmVFbGVtZW50OiBmdW5jdGlvbihub2RlKSB7XHJcbiAgICAgICAgdGhpcy5zaW5rRG93bih0aGlzLmNvbnRlbnQuaW5kZXhPZihub2RlKSk7XHJcbiAgICB9LFxyXG4gICAgc2lua0Rvd246IGZ1bmN0aW9uKG4pIHtcclxuICAgICAgICAvLyBGZXRjaCB0aGUgZWxlbWVudCB0aGF0IGhhcyB0byBiZSBzdW5rLlxyXG4gICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5jb250ZW50W25dO1xyXG5cclxuICAgICAgICAvLyBXaGVuIGF0IDAsIGFuIGVsZW1lbnQgY2FuIG5vdCBzaW5rIGFueSBmdXJ0aGVyLlxyXG4gICAgICAgIHdoaWxlIChuID4gMCkge1xyXG5cclxuICAgICAgICAgICAgLy8gQ29tcHV0ZSB0aGUgcGFyZW50IGVsZW1lbnQncyBpbmRleCwgYW5kIGZldGNoIGl0LlxyXG4gICAgICAgICAgICB2YXIgcGFyZW50TiA9ICgobiArIDEpID4+IDEpIC0gMSwgcGFyZW50ID0gdGhpcy5jb250ZW50W3BhcmVudE5dOyAvLyBqc2hpbnQgaWdub3JlOmxpbmVcclxuICAgICAgICAgICAgLy8gU3dhcCB0aGUgZWxlbWVudHMgaWYgdGhlIHBhcmVudCBpcyBncmVhdGVyLlxyXG4gICAgICAgICAgICBpZiAodGhpcy5zY29yZUZ1bmN0aW9uKGVsZW1lbnQpIDwgdGhpcy5zY29yZUZ1bmN0aW9uKHBhcmVudCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGVudFtwYXJlbnROXSA9IGVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnRbbl0gPSBwYXJlbnQ7XHJcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgJ24nIHRvIGNvbnRpbnVlIGF0IHRoZSBuZXcgcG9zaXRpb24uXHJcbiAgICAgICAgICAgICAgICBuID0gcGFyZW50TjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBGb3VuZCBhIHBhcmVudCB0aGF0IGlzIGxlc3MsIG5vIG5lZWQgdG8gc2luayBhbnkgZnVydGhlci5cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBidWJibGVVcDogZnVuY3Rpb24obikge1xyXG4gICAgICAgIC8vIExvb2sgdXAgdGhlIHRhcmdldCBlbGVtZW50IGFuZCBpdHMgc2NvcmUuXHJcbiAgICAgICAgdmFyIGxlbmd0aCA9IHRoaXMuY29udGVudC5sZW5ndGgsXHJcbiAgICAgICAgICAgIGVsZW1lbnQgPSB0aGlzLmNvbnRlbnRbbl0sXHJcbiAgICAgICAgICAgIGVsZW1TY29yZSA9IHRoaXMuc2NvcmVGdW5jdGlvbihlbGVtZW50KTtcclxuXHJcbiAgICAgICAgd2hpbGUodHJ1ZSkge1xyXG4gICAgICAgICAgICAvLyBDb21wdXRlIHRoZSBpbmRpY2VzIG9mIHRoZSBjaGlsZCBlbGVtZW50cy5cclxuICAgICAgICAgICAgdmFyIGNoaWxkMk4gPSAobiArIDEpIDw8IDEsIGNoaWxkMU4gPSBjaGlsZDJOIC0gMTsgLy8ganNoaW50IGlnbm9yZTpsaW5lXHJcbiAgICAgICAgICAgIC8vIFRoaXMgaXMgdXNlZCB0byBzdG9yZSB0aGUgbmV3IHBvc2l0aW9uIG9mIHRoZSBlbGVtZW50LCBpZiBhbnkuXHJcbiAgICAgICAgICAgIHZhciBzd2FwID0gbnVsbCxcclxuICAgICAgICAgICAgICAgIGNoaWxkMVNjb3JlO1xyXG4gICAgICAgICAgICAvLyBJZiB0aGUgZmlyc3QgY2hpbGQgZXhpc3RzIChpcyBpbnNpZGUgdGhlIGFycmF5KS4uLlxyXG4gICAgICAgICAgICBpZiAoY2hpbGQxTiA8IGxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgLy8gTG9vayBpdCB1cCBhbmQgY29tcHV0ZSBpdHMgc2NvcmUuXHJcbiAgICAgICAgICAgICAgICB2YXIgY2hpbGQxID0gdGhpcy5jb250ZW50W2NoaWxkMU5dO1xyXG4gICAgICAgICAgICAgICAgY2hpbGQxU2NvcmUgPSB0aGlzLnNjb3JlRnVuY3Rpb24oY2hpbGQxKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgc2NvcmUgaXMgbGVzcyB0aGFuIG91ciBlbGVtZW50J3MsIHdlIG5lZWQgdG8gc3dhcC5cclxuICAgICAgICAgICAgICAgIGlmIChjaGlsZDFTY29yZSA8IGVsZW1TY29yZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dhcCA9IGNoaWxkMU47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIERvIHRoZSBzYW1lIGNoZWNrcyBmb3IgdGhlIG90aGVyIGNoaWxkLlxyXG4gICAgICAgICAgICBpZiAoY2hpbGQyTiA8IGxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkMiA9IHRoaXMuY29udGVudFtjaGlsZDJOXSxcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZDJTY29yZSA9IHRoaXMuc2NvcmVGdW5jdGlvbihjaGlsZDIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkMlNjb3JlIDwgKHN3YXAgPT09IG51bGwgPyBlbGVtU2NvcmUgOiBjaGlsZDFTY29yZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2FwID0gY2hpbGQyTjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSWYgdGhlIGVsZW1lbnQgbmVlZHMgdG8gYmUgbW92ZWQsIHN3YXAgaXQsIGFuZCBjb250aW51ZS5cclxuICAgICAgICAgICAgaWYgKHN3YXAgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGVudFtuXSA9IHRoaXMuY29udGVudFtzd2FwXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGVudFtzd2FwXSA9IGVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICBuID0gc3dhcDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBPdGhlcndpc2UsIHdlIGFyZSBkb25lLlxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxucmV0dXJuIHtcclxuICAgIGFzdGFyOiBhc3RhcixcclxuICAgIEdyYXBoOiBHcmFwaFxyXG59O1xyXG5cclxufSk7XHJcbiIsInZhciBCb290ID0gZnVuY3Rpb24gKCkge307XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEJvb3Q7XHJcblxyXG5Cb290LnByb3RvdHlwZSA9IHtcclxuXHJcbiAgcHJlbG9hZDogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5sb2FkLmltYWdlKCdwcmVsb2FkZXInLCAnYXNzZXRzL2ltYWdlcy9wcmVsb2FkZXIuZ2lmJyk7XHJcbiAgfSxcclxuXHJcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmdhbWUuaW5wdXQubWF4UG9pbnRlcnMgPSAxO1xyXG5cclxuICAgIGlmICh0aGlzLmdhbWUuZGV2aWNlLmRlc2t0b3ApIHtcclxuICAgICAgLy90aGlzLmdhbWUuc3RhZ2Uuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZTtcclxuICAgICAgdGhpcy5nYW1lLnNjYWxlLnNjYWxlTW9kZSA9IFBoYXNlci5TY2FsZU1hbmFnZXIuUkVTSVpFO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5nYW1lLnNjYWxlLnNjYWxlTW9kZSA9IFBoYXNlci5TY2FsZU1hbmFnZXIuU0hPV19BTEw7XHJcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5taW5XaWR0aCA9ICA0ODA7XHJcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5taW5IZWlnaHQgPSAyNjA7XHJcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5tYXhXaWR0aCA9IDY0MDtcclxuICAgICAgdGhpcy5nYW1lLnNjYWxlLm1heEhlaWdodCA9IDQ4MDtcclxuICAgICAgdGhpcy5nYW1lLnNjYWxlLmZvcmNlTGFuZHNjYXBlID0gdHJ1ZTtcclxuICAgICAgdGhpcy5nYW1lLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XHJcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5zZXRTY3JlZW5TaXplKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnUHJlbG9hZGVyJyk7XHJcbiAgfVxyXG59O1xyXG4iLCIvKlxyXG5NYWluIHRlc3RpbmcgZW52aXJvbm1lbnQuXHJcbiovXHJcblxyXG52YXIgUmVuZGVyYWJsZXMgPSByZXF1aXJlKCcuLi9mdW5jdGlvbkFjY2Vzcy9SZW5kZXJhYmxlcycpO1xyXG52YXIgVUlCdWlsZGVyID0gcmVxdWlyZSgnLi4vdWkvVUlCdWlsZGVyJyk7XHJcbnZhciBNb2R1bGVCdWlsZGVyID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvTW9kdWxlQnVpbGRlcicpO1xyXG52YXIgQ3ViZUdyb3VwID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvY3ViZV9ncm91cCcpO1xyXG52YXIgSGFja2FibGUgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9IYWNrYWJsZScpO1xyXG52YXIgRW1pdHRlciA9IHJlcXVpcmUoJy4uL2VmZmVjdHMvRW1pdHRlcicpO1xyXG52YXIgTW91c2UgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9tb3VzZScpO1xyXG52YXIgQnVsbGV0ID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvQnVsbGV0Jyk7XHJcbnZhciBTb3VuZE1hbmFnZXIgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9zb3VuZF9tYW5hZ2VyJyk7XHJcbnZhciBTaG9wID0gcmVxdWlyZSgnLi4vdWkvc2hvcCcpO1xyXG52YXIgSGVscGVyID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvaGVscGVyJyk7XHJcbnZhciBDaGVhdGluZyA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL2NoZWF0aW5nJyk7XHJcblxyXG52YXIgcGxheWVyU3RhcnRYID0gMTIwMCwgcGxheWVyU3RhcnRZID0gMTIwMDtcclxudmFyIGJnLCBiZzI7XHJcbnZhciBudW1Sb2lkcztcclxudmFyIG1heFJvaWRzID0gMTAwO1xyXG52YXIgbmV3TW9kdWxlU3BlZWQgPSAxMDAwO1xyXG52YXIgYXN0ZXJvaWRzLCBhc3Rlcm9pZExpc3Q7XHJcbnZhciBsZWZ0S2V5LCByaWdodEtleTtcclxudmFyIHdhcm5pbmc7XHJcbnZhciB0aW1lcjtcclxuXHJcbnZhciBHYW1lID0gZnVuY3Rpb24gKCkgeyB9O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBHYW1lO1xyXG5cclxuR2FtZS5wcm90b3R5cGUgPSB7XHJcblx0XHJcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XHJcblx0dGhpcy5nYW1lLndvcmxkLnNldEJvdW5kcygwLCAwLCA4MDAwLCA0MDAwKTtcclxuXHRcclxuXHRudW1Sb2lkcyA9IDA7XHJcblx0Ly9DcmVhdGUgdGhlIHR3byBiYWNrZ3JvdW5kIGltYWdlc1xyXG4gICBiZyA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKDAsIDAsICdlYXJ0aE5pZ2h0Jyk7XHJcblx0YmcyID0gdGhpcy5nYW1lLmFkZC5zcHJpdGUoLTgwMDAsIDAsICdlYXJ0aE5pZ2h0Jyk7XHJcblx0XHJcblx0Ly9TZXQgdXAgcGh5c2ljc1xyXG5cdHRoaXMuZ2FtZS5waHlzaWNzLnN0YXJ0U3lzdGVtKFBoYXNlci5QaHlzaWNzLlAySlMpO1xyXG5cdHRoaXMuZ2FtZS5waHlzaWNzLnAyLnNldEltcGFjdEV2ZW50cyh0cnVlKTtcclxuXHQvL2FkZCBjb2xsaXNpb24gZ3JvdXBcclxuXHR0aGlzLmNvbGxpc2lvbkdyb3VwID0gdGhpcy5nYW1lLnBoeXNpY3MucDIuY3JlYXRlQ29sbGlzaW9uR3JvdXAoKTtcclxuXHRcclxuICAgdGhpcy5zaW1wbGlmeSA9IHRydWU7IC8vIHByZXZlbnRzIHRoaW5ncyB0aGF0IGdldCBpbiB0aGUgd2F5IG9mIGRlYnVnZ2luZ1xyXG5cdFxyXG5cdHRoaXMubW91c2UgPSBuZXcgTW91c2UodGhpcy5nYW1lLCB0aGlzLmlucHV0KTtcclxuICAgXHJcblx0dGhpcy51cGRhdGVEZXBlbmRlbnRzID0gW107XHJcblxyXG5cdC8vY3JlYXRlIFJlbmRlcmFibGVzIGNsYXNzXHJcblx0dGhpcy5yZW5kZXJhYmxlcyA9IG5ldyBSZW5kZXJhYmxlcygpO1xyXG5cdC8vY3JlYXRlIHRoZSBVSUJ1aWxkZXJcclxuXHR0aGlzLnVpQnVpbGRlciA9IG5ldyBVSUJ1aWxkZXIodGhpcywgdGhpcy5yZW5kZXJhYmxlcyk7ICAgXHJcblx0Ly9jcmVhdGUgTW9kdWxlQnVpbGRlciBhbmQgc3RvcmUgaXQgaW4gdGhpcyBnYW1lIHN0YXRlIG9iamVjdFxyXG5cdHRoaXMubW9kdWxlQnVpbGRlciA9IG5ldyBNb2R1bGVCdWlsZGVyKHRoaXMpO1xyXG5cdC8vY3JlYXRlIGFuZCBzdG9yZSB0aGUgY29yZSBtb2R1bGVcclxuXHR0aGlzLmNvcmVNb2R1bGUgPSB0aGlzLm1vZHVsZUJ1aWxkZXIuYnVpbGQoJ2NvcmUnLCBwbGF5ZXJTdGFydFgsIHBsYXllclN0YXJ0WSwgdHJ1ZSk7XHJcblx0dGhpcy5nYW1lLmNhbWVyYS54ID0gcGxheWVyU3RhcnRYO1xyXG5cdHRoaXMuZ2FtZS5jYW1lcmEueSA9IHBsYXllclN0YXJ0WTtcclxuXHR0aGlzLmN1YmVXaWR0aCA9IHRoaXMuY29yZU1vZHVsZS5jdWJlLndpZHRoO1xyXG5cdHRoaXMuY3ViZUJ1ZmZlciA9IDI7XHJcblx0dGhpcy50ZXN0VmFyID0gNztcclxuXHR2YXIgcGxheWVyR3JvdXAgPSBuZXcgQ3ViZUdyb3VwKHRoaXMsIHRoaXMuY29yZU1vZHVsZS5jdWJlKTtcclxuXHR0aGlzLnVwZGF0ZURlcGVuZGVudHMucHVzaChwbGF5ZXJHcm91cCk7XHJcblx0dGhpcy5wbGF5ZXIgPSBwbGF5ZXJHcm91cDtcclxuXHR0aGlzLnBsYXllci5pc1BsYXllciA9IHRydWU7XHJcbiAgIFxyXG5cdHRoaXMubW91c2UgPSBuZXcgTW91c2UodGhpcy5nYW1lLCB0aGlzLmlucHV0LCBwbGF5ZXJHcm91cCk7XHJcblx0dGhpcy5wbGF5ZXIuaXNQbGF5ZXIgPSB0cnVlO1xyXG5cdFxyXG5cdC8vQ3JlYXRlIHRoZSBlbWl0dGVyIGZvciB0aGUgYmluYXJ5IHBhcnRpY2xlIGVmZmVjdHNcclxuXHR0aGlzLkJpbmFyeUVtaXR0ZXIgPSBuZXcgRW1pdHRlcih0aGlzKTtcclxuXHRcclxuXHQvL3Rlc3QgaGFja2FibGUgb2JqZWN0XHJcblx0Ly8gdGhpcy50ZXN0SGFjayA9IG5ldyBIYWNrYWJsZSh0aGlzLCAxNjAwLCAxMjAwLCAnaGFja2FibGUxJywgNDAwKTtcclxuXHRcclxuXHRhc3Rlcm9pZHMgPSB0aGlzLmdhbWUuYWRkLmdyb3VwKCk7XHJcblx0YXN0ZXJvaWRzLmVuYWJsZUJvZHkgPSB0cnVlO1xyXG5cdGFzdGVyb2lkcy5waHlzaWNzQm9keVR5cGUgPSBQaGFzZXIuUGh5c2ljcy5QMkpTO1xyXG5cdGFzdGVyb2lkTGlzdCA9IG5ldyBQaGFzZXIuQXJyYXlTZXQoKTtcclxuXHRpZiAoIXRoaXMuc2ltcGxpZnkpIHsgdGhpcy5nZW5lcmF0ZUFzdGVyb2lkcygpOyB9XHJcblx0XHJcblx0dGltZXIgPSB0aGlzLmdhbWUudGltZS5jcmVhdGUoZmFsc2UpO1xyXG5cdHdhcm5pbmcgPSB0aGlzLmdhbWUuYWRkLmltYWdlKHRoaXMuZ2FtZS5jYW1lcmEueCwgdGhpcy5nYW1lLmNhbWVyYS55LCAnd2FybmluZycpO1xyXG5cdHdhcm5pbmcua2lsbCgpO1xyXG5cdFxyXG5cdGxlZnRLZXkgPSB0aGlzLmdhbWUuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5LZXlib2FyZC5BKTtcclxuXHRyaWdodEtleSA9IHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLktleWJvYXJkLkQpO1xyXG5cdFxyXG5cdHRoaXMucGF1c2VUZXh0ID0gdGhpcy5nYW1lLmFkZC50ZXh0KC0xMDAwLCAtMTAwMCwgJ1ByZXNzIFxcJ0VzY1xcJyBUbyBVbnBhdXNlJyk7XHJcblx0dGhpcy5wYXVzZVRleHQuZm9udCA9ICdSb2JvdG8nO1xyXG4gICAgdGhpcy5wYXVzZVRleHQuZm9udFNpemUgPSA2NDtcclxuICAgIHRoaXMucGF1c2VUZXh0LmZpbGwgPSAnI2ZmZmZmZic7XHJcblx0dGhpcy5wYXVzZUtleSA9IHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5hZGRLZXkoMjcpO1xyXG5cdHRoaXMucGF1c2VLZXkub25Eb3duLmFkZCh0aGlzLnBhdXNlTWVudSwgdGhpcyk7XHJcblxyXG4gICB0aGlzLmxldmVsRGF0YSA9IEpTT04ucGFyc2UodGhpcy5nYW1lLmNhY2hlLmdldFRleHQoJ2xldmVsX29uZScpKTtcclxuICAgdGhpcy5sb2FkRGF0YSgpO1xyXG5cclxuICAgdGhpcy5qdWljeSA9IHRoaXMuZ2FtZS5wbHVnaW5zLmFkZChuZXcgUGhhc2VyLlBsdWdpbi5KdWljeSh0aGlzKSk7XHJcbiAgIHRoaXMuZ2FtZS5jYW1lcmEuZm9sbG93KHRoaXMuY29yZU1vZHVsZS5jdWJlKTtcclxuXHRcclxuXHR0aGlzLm1haW5Tb25nID0gdGhpcy5nYW1lLmFkZC5hdWRpbygnbWFpblNvbmcnLCAxLCB0cnVlKTtcclxuXHRpZiAoIXRoaXMuc2ltcGxpZnkpIHsgdGhpcy5tYWluU29uZy5wbGF5KCcnLDAsMSx0cnVlLHRydWUpOyB9XHJcbiAgIFxyXG4gICB0aGlzLnNvdW5kTWFuYWdlciA9IG5ldyBTb3VuZE1hbmFnZXIodGhpcyk7XHJcbiAgIHRoaXMuc2hvcCA9IG5ldyBTaG9wKHRoaXMpO1xyXG4gICB0aGlzLnVwZGF0ZURlcGVuZGVudHMucHVzaCh0aGlzLnNob3ApO1xyXG4gICB0aGlzLmhlbHBlciA9IG5ldyBIZWxwZXIodGhpcyk7XHJcbiAgIHRoaXMudXBkYXRlRGVwZW5kZW50cy5wdXNoKHRoaXMuaGVscGVyKTtcclxuICAgdGhpcy5jaGVhdGluZyA9IG5ldyBDaGVhdGluZyh0aGlzKTtcclxuICB9LFxyXG4gIFxyXG4gIHJlc3RhcnRMZXZlbDogZnVuY3Rpb24oKSB7XHJcblx0dGhpcy5tYWluU29uZy5zdG9wKCk7XHJcblx0dGhpcy5nYW1lLnN0YXRlLnN0YXJ0KHBsYXllclN0YXRlLmN1cnJlbnRMZXZlbCk7XHJcbiAgfSxcclxuICBcclxuXHRwYXVzZU1lbnU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHJcblx0XHRpZih0aGlzLmdhbWUucGF1c2VkID09PSBmYWxzZSkge1xyXG5cdFx0XHR0aGlzLnBhdXNlVGV4dC54ID0gdGhpcy5nYW1lLmNhbWVyYS54ICsgKHRoaXMuZ2FtZS5jYW1lcmEud2lkdGggLyAyKSAtICh0aGlzLnBhdXNlVGV4dC53aWR0aCAvIDIpO1xyXG5cdFx0XHR0aGlzLnBhdXNlVGV4dC55ID0gdGhpcy5nYW1lLmNhbWVyYS55ICsgKHRoaXMuZ2FtZS5jYW1lcmEuaGVpZ2h0IC8gMikgLSAodGhpcy5wYXVzZVRleHQuaGVpZ2h0IC8gMik7XHJcblx0XHRcdHRoaXMuZ2FtZS5wYXVzZWQgPSB0cnVlO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuZ2FtZS5wYXVzZWQgPSBmYWxzZTtcclxuXHRcdFx0dGhpcy5wYXVzZVRleHQueCA9IC0xMDAwO1xyXG5cdFx0XHR0aGlzLnBhdXNlVGV4dC55ID0gLTEwMDA7XHJcblx0XHR9XHJcblx0fSxcclxuICBcclxuICBsb2FkRGF0YTogZnVuY3Rpb24oKSB7XHJcbiAgICAgIHZhciBteUxldmVsID0gdGhpcy5sZXZlbERhdGFbJ2xldmVsX29uZSddO1xyXG4gICAgICBmb3IgKHZhciBrZXkgaW4gbXlMZXZlbCkge1xyXG4gICAgICAgICBpZiAobXlMZXZlbC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gbXlMZXZlbFtrZXldO1xyXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5oYXNPd25Qcm9wZXJ0eSgnYmx1ZXByaW50JykpIHsgLy8gZW5lbXkgdHlwZVxyXG4gICAgICAgICAgICAgICB2YXIgZW5lbXlYID0gZWxlbWVudFsneF9wb3MnXTtcclxuICAgICAgICAgICAgICAgdmFyIGVuZW15WSA9IGVsZW1lbnRbJ3lfcG9zJ107XHJcbiAgICAgICAgICAgICAgIHZhciBlbmVteUdyb3VwID0gbmV3IEN1YmVHcm91cCh0aGlzLCB1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICAgICB0aGlzLnVwZGF0ZURlcGVuZGVudHMucHVzaChlbmVteUdyb3VwKTtcclxuICAgICAgICAgICAgICAgdmFyIGJsdWVwcmludCA9IGVsZW1lbnRbJ2JsdWVwcmludCddO1xyXG4gICAgICAgICAgICAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBibHVlcHJpbnQubGVuZ3RoOyByb3crKykge1xyXG4gICAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCBibHVlcHJpbnRbcm93XS5sZW5ndGg7IGNvbCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlID0gYmx1ZXByaW50W3Jvd11bY29sXTtcclxuICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgIT09ICdub25lJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3TW9kdWxlID0gdGhpcy5tb2R1bGVCdWlsZGVyLmJ1aWxkKHR5cGUsIGVuZW15WCArIHJvdyAqICh0aGlzLmN1YmVXaWR0aCArIHRoaXMuY3ViZUJ1ZmZlciksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15WSAtIGNvbCAqICh0aGlzLmN1YmVXaWR0aCArIHRoaXMuY3ViZUJ1ZmZlciksIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3TW9kdWxlLmN1YmUudGFnID0gJ2VuZW15X21vZHVsZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludCA9IG5ldyBQaGFzZXIuUG9pbnQocm93LCBjb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmVteUdyb3VwLmFkZChuZXdNb2R1bGUuY3ViZSwgcG9pbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICB2YXIgYWlUeXBlID0gZWxlbWVudFsndHlwZSddO1xyXG4gICAgICAgICAgICAgICBlbmVteUdyb3VwLmdpdmVBSShhaVR5cGUsIHRoaXMucGxheWVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICB9XHJcbiAgICAgIH1cclxuICB9LFxyXG5cclxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcclxuXHRpZihsZWZ0S2V5LmlzRG93bikge1xyXG5cdFx0aWYodGhpcy5jb3JlTW9kdWxlLmN1YmUuYm9keS5hbmd1bGFyVmVsb2NpdHkgPiAtOSkgeyBcclxuXHRcdFx0dGhpcy5jb3JlTW9kdWxlLmN1YmUuYm9keS5hbmd1bGFyRm9yY2UgKz0gLTcuNSAqIE1hdGgucG93KHRoaXMucGxheWVyLm51bUN1YmVzLCAxLjY1KTtcclxuXHRcdH1cclxuXHR9XHJcblx0aWYocmlnaHRLZXkuaXNEb3duKSB7XHJcblx0XHRpZih0aGlzLmNvcmVNb2R1bGUuY3ViZS5ib2R5LmFuZ3VsYXJWZWxvY2l0eSA8IDkpIHtcclxuXHRcdFx0dGhpcy5jb3JlTW9kdWxlLmN1YmUuYm9keS5hbmd1bGFyRm9yY2UgKz0gNy41ICogTWF0aC5wb3codGhpcy5wbGF5ZXIubnVtQ3ViZXMsIDEuNjUpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHR0aGlzLm1vdXNlLnVwZGF0ZSgpO1xyXG5cdHRoaXMuc2Nyb2xsQkcoKTtcclxuIFxyXG5cdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy51cGRhdGVEZXBlbmRlbnRzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRpZiAodGhpcy51cGRhdGVEZXBlbmRlbnRzW2ldLnVwZGF0ZSkge1xyXG5cdFx0XHR0aGlzLnVwZGF0ZURlcGVuZGVudHNbaV0udXBkYXRlKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdC8vV2FybmluZyBDb2RlXHJcblx0aWYodGhpcy5jb3JlTW9kdWxlLmN1YmUueCArIChNYXRoLm1heCh0aGlzLnBsYXllci5jdWJlc1dpZHRoKCksIHRoaXMucGxheWVyLmN1YmVzSGVpZ2h0KCkpIC8gMiAqIDY0KSA+IDgwMDAgfHxcclxuXHR0aGlzLmNvcmVNb2R1bGUuY3ViZS54IC0gKE1hdGgubWF4KHRoaXMucGxheWVyLmN1YmVzV2lkdGgoKSwgdGhpcy5wbGF5ZXIuY3ViZXNIZWlnaHQoKSkgLyAyICogNjQpIDwgMCB8fFxyXG5cdHRoaXMuY29yZU1vZHVsZS5jdWJlLnkgKyAoTWF0aC5tYXgodGhpcy5wbGF5ZXIuY3ViZXNXaWR0aCgpLCB0aGlzLnBsYXllci5jdWJlc0hlaWdodCgpKSAvIDIgKiA2NCkgPiA0MDAwIHx8XHJcblx0dGhpcy5jb3JlTW9kdWxlLmN1YmUueSAtIChNYXRoLm1heCh0aGlzLnBsYXllci5jdWJlc1dpZHRoKCksIHRoaXMucGxheWVyLmN1YmVzSGVpZ2h0KCkpIC8gMiAqIDY0KSA8IDApIHtcclxuXHRcdGlmKHRpbWVyLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHR3YXJuaW5nLnJldml2ZSgpO1xyXG5cdFx0XHR0aW1lci5sb29wKFBoYXNlci5UaW1lci5TRUNPTkQgKiA1LCB0aGlzLnJlc2V0UGxheWVyLCB0aGlzKTtcclxuXHRcdFx0dGltZXIuc3RhcnQoKTtcclxuXHRcdH1cclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHRpZih3YXJuaW5nLmFsaXZlID09PSB0cnVlKSB7XHJcblx0XHRcdHdhcm5pbmcua2lsbCgpO1xyXG5cdFx0fVxyXG5cdFx0aWYodGltZXIubGVuZ3RoID4gMCkge1xyXG5cdFx0XHR0aW1lci5zdG9wKHRydWUpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHR3YXJuaW5nLnggPSB0aGlzLmdhbWUuY2FtZXJhLng7XHJcblx0d2FybmluZy55ID0gdGhpcy5nYW1lLmNhbWVyYS55O1xyXG4gIH0sXHJcbiAgXHJcbiAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XHJcblx0dGhpcy5tb3VzZS5yZW5kZXIoKTtcclxuXHR0aGlzLnJlbmRlcmFibGVzLnJlbmRlckFsbCgpO1xyXG4gIH0sXHJcbiAgXHJcblx0c2Nyb2xsQkc6IGZ1bmN0aW9uKCkge1xyXG5cdFx0YmcueCArPSAwLjEyNTtcclxuXHRcdGlmKGJnLnggPj0gODAwMCkge1xyXG5cdFx0XHRiZy54ID0gMDtcclxuXHRcdH1cclxuXHRcdGJnMi54ICs9IDAuMTI1O1xyXG5cdFx0aWYoYmcyLnggPj0gODAwMCkge1xyXG5cdFx0XHRiZzIueCA9IDA7XHJcblx0XHR9XHJcblx0fSxcclxuXHRcclxuXHRnZW5lcmF0ZUFzdGVyb2lkczogZnVuY3Rpb24oKSB7XHJcblx0XHRmb3IoO251bVJvaWRzIDwgbWF4Um9pZHM7IG51bVJvaWRzKyspIHtcclxuXHRcdFx0dmFyIHJhbmRYID0gdGhpcy5nYW1lLnJuZC5pbnRlZ2VySW5SYW5nZSgwLCB0aGlzLmdhbWUud29ybGQud2lkdGgpO1xyXG5cdFx0XHR2YXIgcmFuZFkgPSB0aGlzLmdhbWUucm5kLmludGVnZXJJblJhbmdlKDAsIHRoaXMuZ2FtZS53b3JsZC5oZWlnaHQpO1xyXG5cdFx0XHRcclxuXHRcdFx0d2hpbGUocmFuZFggPCB0aGlzLmNvcmVNb2R1bGUuY3ViZS54IC0gKHRoaXMucGxheWVyLmN1YmVzV2lkdGgoKSAvIDIgKyAxMDApICYmIHJhbmRYID4gdGhpcy5jb3JlTW9kdWxlLmN1YmUueCArICh0aGlzLnBsYXllci5jdWJlc1dpZHRoKCkgLyAyICsgMTAwKSAmJlxyXG5cdFx0XHRyYW5kWSA8IHRoaXMuY29yZU1vZHVsZS5jdWJlLnkgLSAodGhpcy5wbGF5ZXIuY3ViZXNIZWlnaHQoKSAvIDIgKyAxMDApICYmIHJhbmRZID4gdGhpcy5jb3JlTW9kdWxlLmN1YmUueSArICh0aGlzLnBsYXllci5jdWJlc0hlaWdodCgpIC8gMiArIDEwMCkpIHtcclxuXHRcdFx0XHRyYW5kWCA9IHRoaXMuZ2FtZS5ybmQuaW50ZWdlckluUmFuZ2UoMCwgdGhpcy5nYW1lLndvcmxkLndpZHRoKTtcclxuXHRcdFx0XHRyYW5kWSA9IHRoaXMuZ2FtZS5ybmQuaW50ZWdlckluUmFuZ2UoMCwgdGhpcy5nYW1lLndvcmxkLmhlaWdodCk7XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHRcdHZhciBhc3Rlcm9pZCA9IGFzdGVyb2lkcy5jcmVhdGUocmFuZFgsIHJhbmRZLCAnYXN0ZXJvaWQnKTtcclxuXHRcdFx0XHJcblx0XHRcdGFzdGVyb2lkLmJvZHkuY2xlYXJTaGFwZXMoKTsgXHJcblx0XHRcdGFzdGVyb2lkLmJvZHkubG9hZFBvbHlnb24oJ2FzdGVyb2lkUG9seWdvbicsICdhc3Rlcm9pZCcpOyAvL0NoYW5nZSB0aGUgY29sbGlzaW9uIGRldGVjdGlvbiBmcm9tIGFuIEFBQkIgdG8gYSBwb2x5Z29uXHJcblx0XHRcdGFzdGVyb2lkLmJvZHkuZGFtcGluZyA9IHRoaXMuZ2FtZS5ybmQucmVhbEluUmFuZ2UoMCwgMC4zKSAqIHRoaXMuZ2FtZS5ybmQuaW50ZWdlckluUmFuZ2UoMCwgMSkgKiB0aGlzLmdhbWUucm5kLmludGVnZXJJblJhbmdlKDAsIDEpO1xyXG5cdFx0XHRhc3Rlcm9pZC5ib2R5LnJvdGF0aW9uID0gdGhpcy5nYW1lLnJuZC5yZWFsSW5SYW5nZSgwLCAyICogTWF0aC5QSSk7XHJcblx0XHRcdGFzdGVyb2lkLmJvZHkuZm9yY2UueCA9IHRoaXMuZ2FtZS5ybmQuaW50ZWdlckluUmFuZ2UoLTEwLCAxMCkgKiA3NTA7XHJcblx0XHRcdGFzdGVyb2lkLmJvZHkuZm9yY2UueSA9IHRoaXMuZ2FtZS5ybmQuaW50ZWdlckluUmFuZ2UoLTEwLCAxMCkgKiA3NTA7XHJcblx0XHRcdGFzdGVyb2lkLmJvZHkuc2V0Q29sbGlzaW9uR3JvdXAodGhpcy5jb2xsaXNpb25Hcm91cCk7XHJcblx0XHRcdGFzdGVyb2lkLmJvZHkuY29sbGlkZXModGhpcy5jb2xsaXNpb25Hcm91cCk7XHJcblx0XHRcdGFzdGVyb2lkLmJvZHkuY29sbGlkZVdvcmxkQm91bmRzID0gZmFsc2U7XHJcblx0XHRcdGFzdGVyb2lkLmF1dG9DdWxsID0gdHJ1ZTtcclxuXHRcdFx0YXN0ZXJvaWQuY2hlY2tXb3JsZEJvdW5kcyA9IHRydWU7XHJcblx0XHRcdGFzdGVyb2lkLmV2ZW50cy5vbk91dE9mQm91bmRzLmFkZCh0aGlzLnJlc2V0QXN0ZXJvaWQsIHtyb2lkOiBhc3Rlcm9pZCwgY29yZU1vZHVsZTogdGhpcy5jb3JlTW9kdWxlLCBwbGF5ZXI6IHRoaXMucGxheWVyLCBnYW1lOiB0aGlzLmdhbWV9KTtcclxuXHRcdFx0YXN0ZXJvaWRMaXN0LmFkZChhc3Rlcm9pZCk7XHJcblx0XHR9XHJcblx0fSxcclxuXHRcclxuXHRyZXNldEFzdGVyb2lkOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciByYW5kWCA9IHRoaXMuZ2FtZS5ybmQuaW50ZWdlckluUmFuZ2UoMCwgdGhpcy5nYW1lLndvcmxkLndpZHRoKTtcclxuXHRcdHZhciByYW5kWSA9IHRoaXMuZ2FtZS5ybmQuaW50ZWdlckluUmFuZ2UoMCwgdGhpcy5nYW1lLndvcmxkLmhlaWdodCk7XHJcblx0XHRcdFxyXG5cdFx0d2hpbGUocmFuZFggPCB0aGlzLmNvcmVNb2R1bGUuY3ViZS54IC0gKHRoaXMucGxheWVyLmN1YmVzV2lkdGgoKSAvIDIgKyAxMDApICYmIHJhbmRYID4gdGhpcy5jb3JlTW9kdWxlLmN1YmUueCArICh0aGlzLnBsYXllci5jdWJlc1dpZHRoKCkgLyAyICsgMTAwKSAmJlxyXG5cdFx0XHRyYW5kWSA8IHRoaXMuY29yZU1vZHVsZS5jdWJlLnkgLSAodGhpcy5wbGF5ZXIuY3ViZXNIZWlnaHQoKSAvIDIgKyAxMDApICYmIHJhbmRZID4gdGhpcy5jb3JlTW9kdWxlLmN1YmUueSArICh0aGlzLnBsYXllci5jdWJlc0hlaWdodCgpIC8gMiArIDEwMCkpIHtcclxuXHRcdFx0XHRyYW5kWCA9IHRoaXMuZ2FtZS5ybmQuaW50ZWdlckluUmFuZ2UoMCwgdGhpcy5nYW1lLndvcmxkLndpZHRoKTtcclxuXHRcdFx0XHRyYW5kWSA9IHRoaXMuZ2FtZS5ybmQuaW50ZWdlckluUmFuZ2UoMCwgdGhpcy5nYW1lLndvcmxkLmhlaWdodCk7XHJcblx0XHR9XHJcblx0XHR0aGlzLnJvaWQueCA9IHJhbmRYO1xyXG5cdFx0dGhpcy5yb2lkLnkgPSByYW5kWTtcclxuXHRcdHRoaXMucm9pZC5ib2R5LnJvdGF0aW9uID0gdGhpcy5nYW1lLnJuZC5yZWFsSW5SYW5nZSgwLCAyICogTWF0aC5QSSk7XHJcblx0XHR0aGlzLnJvaWQuYm9keS5mb3JjZS54ID0gdGhpcy5nYW1lLnJuZC5pbnRlZ2VySW5SYW5nZSgtMTAsIDEwKSAqIDc1MDtcclxuXHRcdHRoaXMucm9pZC5ib2R5LmZvcmNlLnkgPSB0aGlzLmdhbWUucm5kLmludGVnZXJJblJhbmdlKC0xMCwgMTApICogNzUwO1xyXG5cdH0sXHJcblx0XHJcblx0cmVzZXRQbGF5ZXI6IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYodGhpcy5jb3JlTW9kdWxlLmN1YmUueCArIChNYXRoLm1heCh0aGlzLnBsYXllci5jdWJlc1dpZHRoKCksIHRoaXMucGxheWVyLmN1YmVzSGVpZ2h0KCkpIC8gMiAqIDY0KSA+IDgwMDApIHtcclxuXHRcdFx0dGhpcy5jb3JlTW9kdWxlLmN1YmUuYm9keS5tb3ZlTGVmdCh0aGlzLnBsYXllci5udW1DdWJlcyAqIDc1MCk7XHJcblx0XHR9XHJcblx0XHRpZih0aGlzLmNvcmVNb2R1bGUuY3ViZS54IC0gKE1hdGgubWF4KHRoaXMucGxheWVyLmN1YmVzV2lkdGgoKSwgdGhpcy5wbGF5ZXIuY3ViZXNIZWlnaHQoKSkgLyAyICogNjQpIDwgMCkge1xyXG5cdFx0XHR0aGlzLmNvcmVNb2R1bGUuY3ViZS5ib2R5Lm1vdmVSaWdodCh0aGlzLnBsYXllci5udW1DdWJlcyAqIDc1MCk7XHJcblx0XHR9XHJcblx0XHRpZih0aGlzLmNvcmVNb2R1bGUuY3ViZS55ICsgKE1hdGgubWF4KHRoaXMucGxheWVyLmN1YmVzV2lkdGgoKSwgdGhpcy5wbGF5ZXIuY3ViZXNIZWlnaHQoKSkgLyAyICogNjQpID4gNDAwMCkge1xyXG5cdFx0XHR0aGlzLmNvcmVNb2R1bGUuY3ViZS5ib2R5Lm1vdmVVcCh0aGlzLnBsYXllci5udW1DdWJlcyAqIDc1MCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmKHRoaXMuY29yZU1vZHVsZS5jdWJlLnkgLSAoTWF0aC5tYXgodGhpcy5wbGF5ZXIuY3ViZXNXaWR0aCgpLCB0aGlzLnBsYXllci5jdWJlc0hlaWdodCgpKSAvIDIgKiA2NCkgPCAwKSB7XHJcblx0XHRcdHRoaXMuY29yZU1vZHVsZS5jdWJlLmJvZHkubW92ZURvd24odGhpcy5wbGF5ZXIubnVtQ3ViZXMgKiA3NTApO1xyXG5cdFx0fVxyXG5cdH0sXHJcbn07XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiIsInZhciBNZW51ID0gZnVuY3Rpb24gKCkge1xyXG4gIHRoaXMudGV4dCA9IG51bGw7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IE1lbnU7XHJcblxyXG52YXIgbWVudVNvbmc7XHJcblxyXG5NZW51LnByb3RvdHlwZSA9IHtcclxuXHRcclxuICBwb3M6IFstMjUsIDI1LCA3NV0sXHJcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgeCA9IHRoaXMuZ2FtZS53aWR0aCAvIDI7XHJcbiAgICB2YXIgeSA9IHRoaXMuZ2FtZS5oZWlnaHQgLyAyO1xyXG5cdHRoaXMuZGlmZiA9IDc2ODtcclxuXHR0aGlzLmNyZWRpdHNTcGVlZCA9IDE2O1xyXG5cdHRoaXMuY3JlZGl0c09wZW5pbmcgPSBmYWxzZTtcclxuXHR0aGlzLmNyZWRpdHNDbG9zaW5nID0gZmFsc2U7XHJcblx0dGhpcy5iZyA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKC00NTAwLCAtNTAwLCAnZWFydGhOaWdodCcpO1xyXG5cdHRoaXMuYmcyID0gdGhpcy5nYW1lLmFkZC5zcHJpdGUoLTEyNTAwLCAtNTAwLCAnZWFydGhOaWdodCcpO1xyXG5cdFxyXG5cdG1lbnVTb25nID0gdGhpcy5nYW1lLmFkZC5hdWRpbygnbWVudVNvbmcnKTtcclxuXHRtZW51U29uZy5wbGF5KCcnLDAsMSx0cnVlLHRydWUpO1xyXG4gICAgXHJcbiAgICB0aGlzLnRpdGxlQnV0dG9uID0gdGhpcy5hZGQuaW1hZ2UodGhpcy53b3JsZC5jZW50ZXJYLCB0aGlzLndvcmxkLmNlbnRlclkgKyAzMiwgJ3RpdGxlJyk7XHJcbiAgICB0aGlzLnRpdGxlQnV0dG9uLmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XHJcbiAgICBcclxuICAgIHRoaXMuc2VsZWN0QnV0dG9uID0gdGhpcy5hZGRCdXR0b24oMCwgJ3N0YXJ0R2FtZUJ1dHRvbicsIHRoaXMuY2hhbmdlVG9HYW1lLCB0aGlzKTtcclxuICBcdHRoaXMuc2VsZWN0QnV0dG9uLmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XHJcbiAgXHRcclxuICBcdHRoaXMubWFudWFsQnV0dG9uID0gdGhpcy5hZGRCdXR0b24oMSwgJ21pc3Npb25TZWxlY3RCdXR0b24nLCB0aGlzLmNoYW5nZVRvTWVudSwgdGhpcyk7XHJcbiAgXHR0aGlzLm1hbnVhbEJ1dHRvbi5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xyXG4gIFx0XHJcbiAgXHR0aGlzLmNyZWRpdHNCdXR0b24gPSB0aGlzLmFkZEJ1dHRvbigyLCAnY3JlZGl0c0J1dHRvbicsIHRoaXMuZG9DcmVkaXRzLCB7Z2FtZTogdGhpcywgYnV0dG9uOiAnY3JlZGl0c0J1dHRvbid9KTtcclxuICBcdHRoaXMuY3JlZGl0c0J1dHRvbi5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xyXG5cdFxyXG5cdHRoaXMuY3JlZGl0cyA9IHRoaXMuYWRkLmltYWdlKHRoaXMud29ybGQuY2VudGVyWCAtIDM2MCwgdGhpcy53b3JsZC5jZW50ZXJZIC0gMjU2ICsgdGhpcy5kaWZmLCAnY3JlZGl0cycpO1xyXG5cdHRoaXMuY3JlZGl0cy5raWxsKCk7XHJcblx0dGhpcy5jcmVkaXRzQ2xvc2VCdXR0b24gPSB0aGlzLmFkZEJ1dHRvbigxMCwgJ2Nsb3NlQnV0dG9uJywgdGhpcy5kb0NyZWRpdHMsIHtnYW1lOiB0aGlzLCBidXR0b246ICdjbG9zZUNyZWRpdHNCdXR0b24nfSk7XHJcblx0dGhpcy5jcmVkaXRzQ2xvc2VCdXR0b24ueCA9IHRoaXMuY3JlZGl0cy54ICsgdGhpcy5jcmVkaXRzLndpZHRoIC0gMzI7XHJcblx0dGhpcy5jcmVkaXRzQ2xvc2VCdXR0b24ueSA9IHRoaXMuY3JlZGl0cy55O1xyXG4gIH0sXHJcblxyXG4gIGFkZEJ1dHRvbjogZnVuY3Rpb24oYnV0dG9uLCBpbWcsIGZ1bmMsIGNvbnRleHQpe1xyXG4gICAgcmV0dXJuIHRoaXMuYWRkLmJ1dHRvbih0aGlzLndvcmxkLmNlbnRlclgsIHRoaXMud29ybGQuY2VudGVyWSArIChidXR0b24pICogOTAsIGltZywgZnVuYywgY29udGV4dCwgMSwgMCwgMik7XHJcbiAgfSxcclxuICBcclxuICBkcmF3OiBmdW5jdGlvbigpe1xyXG4gIH0sXHJcbiAgXHJcbiAgY2hhbmdlVG9HYW1lOiBmdW5jdGlvbigpe1xyXG5cdGlmKCF0aGlzLmNyZWRpdHMuYWxpdmUpIHtcclxuXHRcdG1lbnVTb25nLnN0b3AoKTtcclxuXHRcdHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnR2FtZScpO1xyXG5cdH1cclxuICB9LCAgXHJcbiAgXHJcbiAgY2hhbmdlVG9NZW51OiBmdW5jdGlvbigpe1xyXG5cdGlmKCF0aGlzLmNyZWRpdHMuYWxpdmUpIHtcclxuXHRcdG1lbnVTb25nLnN0b3AoKTtcclxuXHRcdHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnTWVudScpO1xyXG5cdH1cclxuICB9LFxyXG4gIFxyXG4gIGRvQ3JlZGl0czogZnVuY3Rpb24oKSB7XHJcblx0aWYoIXRoaXMuZ2FtZS5jcmVkaXRzLmFsaXZlICYmICF0aGlzLmdhbWUuY3JlZGl0c09wZW5pbmcgJiYgIXRoaXMuZ2FtZS5jcmVkaXRzQ2xvc2luZyAmJiB0aGlzLmJ1dHRvbiA9PT0gJ2NyZWRpdHNCdXR0b24nKSB7XHJcblx0ICB0aGlzLmdhbWUuY3JlZGl0cy5yZXZpdmUoKTtcclxuXHQgIHRoaXMuZ2FtZS5kaWZmID0gNzY4O1xyXG5cdCAgdGhpcy5nYW1lLmNyZWRpdHNPcGVuaW5nID0gdHJ1ZTtcclxuICAgfVxyXG4gICBlbHNlIGlmKHRoaXMuZ2FtZS5jcmVkaXRzLmFsaXZlICYmICF0aGlzLmdhbWUuY3JlZGl0c0Nsb3NpbmcgJiYgIXRoaXMuZ2FtZS5jcmVkaXRzT3BlbmluZyAmJiB0aGlzLmJ1dHRvbiA9PT0gJ2Nsb3NlQ3JlZGl0c0J1dHRvbicpIHtcclxuXHQgIHRoaXMuZ2FtZS5jcmVkaXRzQ2xvc2luZyA9IHRydWU7XHJcbiAgIH1cclxuICB9LFxyXG4gIC8qXHJcbiAgY2hhbmdlU3RhdGU6IGZ1bmN0aW9uKHN0YXRlKXtcclxuICBcdHN3aXRjaChzdGF0ZSl7XHJcbiAgXHRcdGNhc2UgJ2dhbWUnOlxyXG4gIFx0XHRcdHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnR2FtZScpO1xyXG4gIFx0XHRcdGJyZWFrO1xyXG4gIFx0XHRjYXNlICdtZW51JzpcclxuICBcdFx0XHR0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ01lbnUnKTtcclxuICBcdFx0XHRicmVhaztcclxuICBcdFx0ZGVmYXVsdDpcclxuICBcdFx0XHRicmVhaztcclxuICBcdH1cclxuICB9LFxyXG4gICovXHJcblx0dXBkYXRlOiBmdW5jdGlvbiAoKSB7XHJcblx0XHR0aGlzLmJnLnggKz0gMC4xMjU7XHJcblx0XHRpZih0aGlzLmJnLnggPj0gMCkge1xyXG5cdFx0XHR0aGlzLmJnLnggPSAtODAwMDtcclxuXHRcdH1cclxuXHRcdHRoaXMuYmcyLnggKz0gMC4xMjU7XHJcblx0XHRpZih0aGlzLmJnMi54ID49IDApIHtcclxuXHRcdFx0dGhpcy5iZzIueCA9IC04MDAwO1xyXG5cdFx0fVxyXG5cdFx0aWYodGhpcy5jcmVkaXRzT3BlbmluZyA9PT0gdHJ1ZSkge1x0XHJcblx0XHQgIHRoaXMuZGlmZiAtPSB0aGlzLmNyZWRpdHNTcGVlZDtcclxuXHRcdFx0aWYodGhpcy5kaWZmIDw9IDApIHtcclxuXHRcdFx0XHR0aGlzLmNyZWRpdHNPcGVuaW5nID0gZmFsc2U7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGVsc2UgaWYodGhpcy5jcmVkaXRzQ2xvc2luZyA9PT0gdHJ1ZSkge1xyXG5cdFx0ICB0aGlzLmRpZmYgKz0gdGhpcy5jcmVkaXRzU3BlZWQ7XHJcblx0XHRcdGlmKHRoaXMuZGlmZiA+PSA3NjgpIHtcclxuXHRcdFx0XHR0aGlzLmNyZWRpdHMua2lsbCgpO1xyXG5cdFx0XHRcdHRoaXMuY3JlZGl0c0Nsb3NpbmcgPSBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0dGhpcy5jcmVkaXRzLnkgPSB0aGlzLndvcmxkLmNlbnRlclkgLSAyNTYgKyB0aGlzLmRpZmY7XHJcblx0XHR0aGlzLmNyZWRpdHNDbG9zZUJ1dHRvbi54ID0gdGhpcy5jcmVkaXRzLnggKyB0aGlzLmNyZWRpdHMud2lkdGggLSAzMjtcclxuXHRcdHRoaXMuY3JlZGl0c0Nsb3NlQnV0dG9uLnkgPSB0aGlzLmNyZWRpdHMueTtcclxuXHR9LFxyXG5cclxufTtcclxuIiwidmFyIFByZWxvYWRlciA9IGZ1bmN0aW9uIChnYW1lKSB7XHJcbiAgZ2FtZSA9IG51bGw7XHJcbiAgdGhpcy5hc3NldCA9IG51bGw7XHJcbiAgdGhpcy5yZWFkeSA9IGZhbHNlO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBQcmVsb2FkZXI7XHJcblxyXG5QcmVsb2FkZXIucHJvdG90eXBlID0ge1xyXG5cclxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmFzc2V0ID0gdGhpcy5hZGQuc3ByaXRlKDY0MCwgMzYwLCAncHJlbG9hZGVyJyk7XHJcbiAgICB0aGlzLmFzc2V0LmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XHJcblxyXG4gICAgdGhpcy5sb2FkLm9uTG9hZENvbXBsZXRlLmFkZE9uY2UodGhpcy5vbkxvYWRDb21wbGV0ZSwgdGhpcyk7XHJcbiAgICB0aGlzLmxvYWQuc2V0UHJlbG9hZFNwcml0ZSh0aGlzLmFzc2V0KTtcclxuXHRcclxuXHQvL0xvYWQgU3ByaXRlc2hlZXRzXHJcblx0dGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdjb3JlJywgJ2Fzc2V0cy9pbWFnZXMvY29yZVNoZWV0LnBuZycsIDY0LCA2NCk7IFxyXG5cdHRoaXMubG9hZC5zcHJpdGVzaGVldCgndGhydXN0ZXInLCAnYXNzZXRzL2ltYWdlcy90aHJ1c3RlclNoZWV0LnBuZycsIDY0LCA2NCk7XHJcblx0dGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdndW4nLCAnYXNzZXRzL2ltYWdlcy9ndW5TaGVldC5wbmcnLCA2NCwgNjQpO1xyXG5cdHRoaXMubG9hZC5zcHJpdGVzaGVldCgnaGFja2VyJywgJ2Fzc2V0cy9pbWFnZXMvaGFja1NoZWV0LnBuZycsIDY0LCA2NCk7XHJcblx0dGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdzaGllbGRCdXR0b24nLCAnYXNzZXRzL2ltYWdlcy9zaGllbGRCdXR0b25TaGVldC5wbmcnLCAyNTYsIDgyKTtcclxuXHR0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ3NvbGFyUGFuZWxCdXR0b24nLCAnYXNzZXRzL2ltYWdlcy9zb2xhclBhbmVsQnV0dG9uU2hlZXQucG5nJywgMjU2LCA4Mik7XHJcblx0dGhpcy5sb2FkLnNwcml0ZXNoZWV0KCd0aHJ1c3RlckJ1dHRvbicsICdhc3NldHMvaW1hZ2VzL3RocnVzdGVyQnV0dG9uU2hlZXQucG5nJywgMjU2LCA4Mik7XHJcblx0dGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdndW5CdXR0b24nLCAnYXNzZXRzL2ltYWdlcy9ndW5CdXR0b25TaGVldC5wbmcnLCAyNTYsIDgyKTtcclxuXHR0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ2hhY2tCdXR0b24nLCAnYXNzZXRzL2ltYWdlcy9oYWNrQnV0dG9uU2hlZXQucG5nJywgMjU2LCA4Mik7XHJcblx0dGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdoYWNrYWJsZScsICdhc3NldHMvaW1hZ2VzL2hhY2thYmxlU2hlZXQucG5nJywgNjQsIDY0KTtcclxuXHR0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ3Nob3BCdXR0b24nLCAnYXNzZXRzL2ltYWdlcy9zaG9wQnV0dG9uU2hlZXQucG5nJywgMzIsIDMyKTtcclxuXHR0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ2Nsb3NlQnV0dG9uJywgJ2Fzc2V0cy9pbWFnZXMvY2xvc2VCdXR0b25TaGVldC5wbmcnLCAzMiwgMzIpO1xyXG5cdFxyXG5cdC8vTG9hZCBJbWFnZXNcclxuXHR0aGlzLmxvYWQuaW1hZ2UoJ2VhcnRoTmlnaHQnLCAnYXNzZXRzL2ltYWdlcy9iZ19lYXJ0aE5pZ2h0U21hbGwuanBnJyk7XHJcblx0dGhpcy5sb2FkLmltYWdlKCdjcmVkaXRzJywgJ2Fzc2V0cy9pbWFnZXMvY3JlZGl0cy5wbmcnKTtcclxuXHR0aGlzLmxvYWQuaW1hZ2UoJ2J1bGxldCcsICdhc3NldHMvaW1hZ2VzL2J1bGxldC5wbmcnKTtcclxuXHR0aGlzLmxvYWQuaW1hZ2UoJ3NoaWVsZCcsICdhc3NldHMvaW1hZ2VzL3NoaWVsZC5wbmcnKTtcclxuXHR0aGlzLmxvYWQuaW1hZ2UoJ3NvbGFyUGFuZWwnLCAnYXNzZXRzL2ltYWdlcy9zb2xhclBhbmVsLnBuZycpO1xyXG5cdHRoaXMubG9hZC5pbWFnZSgnYXN0ZXJvaWQnLCAnYXNzZXRzL2ltYWdlcy9hc3Rlcm9pZC5wbmcnKTtcclxuXHR0aGlzLmxvYWQuaW1hZ2UoJ3Nob3BQYW5lbCcsICdhc3NldHMvaW1hZ2VzL3Nob3BCYWNrUGFuZWwucG5nJyk7XHJcblx0dGhpcy5sb2FkLmltYWdlKCd3YXJuaW5nJywgJ2Fzc2V0cy9pbWFnZXMvd2FybmluZy5wbmcnKTtcclxuXHR0aGlzLmxvYWQuaW1hZ2UoJ2JlJywgJ2Fzc2V0cy9pbWFnZXMvYmUucG5nJyk7XHJcbiAgICBcclxuXHQvL0xvYWQgRm9udHNcclxuXHR0aGlzLmxvYWQuc2NyaXB0KCd3ZWJmb250JywgJy8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvd2ViZm9udC8xLjQuNy93ZWJmb250LmpzJyk7XHJcblx0XHJcblx0Ly9Mb2FkIEpTT04gRmlsZXNcclxuXHR0aGlzLmxvYWQuYXRsYXNKU09OSGFzaCgnY29ubmVjdGlvbnMnLCAnYXNzZXRzL2ltYWdlcy9jb25uZWN0aW9ucy5wbmcnLCAnYXNzZXRzL2pzb24vY29ubmVjdGlvbnMuanNvbicpO1xyXG5cdHRoaXMubG9hZC5hdGxhc0pTT05IYXNoKCdjb25uZWN0aW9ucycsICdhc3NldHMvaW1hZ2VzL2Nvbm5lY3Rpb25zLnBuZycsICdhc3NldHMvanNvbi9jb25uZWN0aW9ucy5qc29uJyk7XHJcblx0dGhpcy5sb2FkLmF0bGFzSlNPTkhhc2goJ2hlbHBCdXR0b24nLCAnYXNzZXRzL2ltYWdlcy9oZWxwQnV0dG9uU2hlZXQucG5nJywgJ2Fzc2V0cy9qc29uL2hlbHBfYnV0dG9uLmpzb24nKTtcclxuXHR0aGlzLmxvYWQuYXRsYXNKU09OSGFzaCgnYXJyb3dCdXR0b24nLCAnYXNzZXRzL2ltYWdlcy9hcnJvd0J1dHRvblNoZWV0LnBuZycsICdhc3NldHMvanNvbi9hcnJvd19idXR0b24uanNvbicpO1xyXG5cdHRoaXMubG9hZC5waHlzaWNzKCdtb2R1bGVfcGh5c2ljcycsICdhc3NldHMvanNvbi9tb2R1bGVfcGh5c2ljcy5qc29uJyk7XHJcblx0dGhpcy5sb2FkLnBoeXNpY3MoJ2FzdGVyb2lkUG9seWdvbicsICdhc3NldHMvanNvbi9hc3Rlcm9pZFBvbHlnb24uanNvbicpO1xyXG5cdHRoaXMubG9hZC50ZXh0KCdsZXZlbF9vbmUnLCAnYXNzZXRzL2pzb24vbGV2ZWxfb25lLmpzb24nKTtcclxuXHR0aGlzLmxvYWQudGV4dCgndHV0b3JpYWxfdGV4dCcsICdhc3NldHMvanNvbi90dXRvcmlhbF90ZXh0Lmpzb24nKTtcclxuXHRcclxuXHQvL0xvYWQgU291bmQgRWZmZWN0c1xyXG5cdHRoaXMubG9hZC5hdWRpbygnZG93bkNsaWNrJywgJ2Fzc2V0cy9zb3VuZC9kb3duQ2xpY2sub2dnJyk7XHJcblx0dGhpcy5sb2FkLmF1ZGlvKCdob3ZlckNsaWNrJywgJ2Fzc2V0cy9zb3VuZC9ob3ZlckNsaWNrLm9nZycpO1xyXG5cdHRoaXMubG9hZC5hdWRpbygnZXJyb3InLCAnYXNzZXRzL3NvdW5kL2Vycm9yLm9nZycpO1xyXG5cdHRoaXMubG9hZC5hdWRpbygnY2FzaFJlZ2lzdGVyJywgJ2Fzc2V0cy9zb3VuZC9jYXNoUmVnaXN0ZXIub2dnJyk7XHJcblx0dGhpcy5sb2FkLmF1ZGlvKCdndW4nLCAnYXNzZXRzL3NvdW5kL2d1bi5vZ2cnKTtcclxuXHR0aGlzLmxvYWQuYXVkaW8oJ2hhY2tpbmcnLCAnYXNzZXRzL3NvdW5kL2hhY2tpbmcub2dnJyk7XHJcblx0dGhpcy5sb2FkLmF1ZGlvKCdtb2R1bGVJbXBhY3QnLCAnYXNzZXRzL3NvdW5kL21vZHVsZUltcGFjdC5vZ2cnKTtcclxuXHR0aGlzLmxvYWQuYXVkaW8oJ21vZHVsZUNvbm5lY3QnLCAnYXNzZXRzL3NvdW5kL21vZHVsZUNvbm5lY3Qub2dnJyk7XHJcblx0dGhpcy5sb2FkLmF1ZGlvKCdtb2R1bGVQb3dlcicsICdhc3NldHMvc291bmQvbW9kdWxlUG93ZXIub2dnJyk7XHJcblx0dGhpcy5sb2FkLmF1ZGlvKCd0aHJ1c3Rlckxvb3AnLCAnYXNzZXRzL3NvdW5kL3RocnVzdGVyTG9vcC5vZ2cnKTtcclxuXHRcclxuXHR0aGlzLmxvYWQudGV4dCgndHV0b3JpYWxfdGV4dCcsICdhc3NldHMvanNvbi90dXRvcmlhbF90ZXh0Lmpzb24nKTtcclxuXHQvLyB0aGlzLmxvYWQuc2NyaXB0KCd3ZWJmb250JywgJy8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvd2ViZm9udC8xLjQuNy93ZWJmb250LmpzJyk7XHJcblx0dGhpcy5sb2FkLmF0bGFzSlNPTkhhc2goJ2hlbHBCdXR0b24nLCAnYXNzZXRzL2ltYWdlcy9oZWxwQnV0dG9uU2hlZXQucG5nJywgJ2Fzc2V0cy9qc29uL2hlbHBfYnV0dG9uLmpzb24nKTtcclxuXHR0aGlzLmxvYWQuYXRsYXNKU09OSGFzaCgnYXJyb3dCdXR0b24nLCAnYXNzZXRzL2ltYWdlcy9hcnJvd0J1dHRvblNoZWV0LnBuZycsICdhc3NldHMvanNvbi9hcnJvd19idXR0b24uanNvbicpO1xyXG5cdC8vbWVudSBidXR0b25zXHJcblx0dGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdzdGFydEdhbWVCdXR0b24nLCAnYXNzZXRzL2ltYWdlcy9zdGFydEdhbWVCdXR0b25TaGVldC5wbmcnLCAyNTYsIDgyKTtcclxuXHR0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ21pc3Npb25TZWxlY3RCdXR0b24nLCAnYXNzZXRzL2ltYWdlcy9taXNzaW9uU2VsZWN0QnV0dG9uU2hlZXQucG5nJywgMjU2LCA4Mik7XHJcblx0dGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdjcmVkaXRzQnV0dG9uJywgJ2Fzc2V0cy9pbWFnZXMvY3JlZGl0c0J1dHRvblNoZWV0LnBuZycsIDI1NiwgODIpO1xyXG5cdHRoaXMubG9hZC5pbWFnZSgndGl0bGUnLCAnYXNzZXRzL2ltYWdlcy90aXRsZS5wbmcnKTtcclxuXHJcblx0XHJcblx0XHJcblx0Ly9Mb2FkIE11c2ljXHJcblx0dGhpcy5sb2FkLmF1ZGlvKCdtZW51U29uZycsICdhc3NldHMvc291bmQvWWV0IEFub3RoZXIub2dnJyk7XHJcblx0dGhpcy5sb2FkLmF1ZGlvKCdtYWluU29uZycsICdhc3NldHMvc291bmQvVG9wIChkb3duKSBOaWdodC5vZ2cnKTtcclxuXHJcbiAgfSxcclxuXHJcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmFzc2V0LmNyb3BFbmFibGVkID0gZmFsc2U7XHJcbiAgfSxcclxuXHJcbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAoISF0aGlzLnJlYWR5KSB7XHJcbiAgICAgIC8vIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnTWVudScpO1xyXG4gICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQocGxheWVyU3RhdGUuY3VycmVudExldmVsKTsgLy8ganNoaW50IGlnbm9yZTpsaW5lXHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgb25Mb2FkQ29tcGxldGU6IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMucmVhZHkgPSB0cnVlO1xyXG4gIH1cclxufTtcclxuIiwidmFyIFNwbGFzaCA9IGZ1bmN0aW9uICgpIHtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gU3BsYXNoO1xyXG5cclxuU3BsYXNoLnByb3RvdHlwZSA9IHtcclxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcclxuICB9XHJcbn07IiwiLy9OT1RFOiBET04nVCBVU0UgdGhpcyBjb2RlIHRvIGNyZWF0ZSBhIFByb2dyZXNzQmFyLiBJbnN0ZWFkLCB1c2UgdGhlIFVJQnVpbGRlciBvYmplY3QgYW5kIGNhbGwgYnVpbGRQcm9ncmVzc0JhclxyXG5cclxudmFyIFByb2dyZXNzQmFyID0gZnVuY3Rpb24oc2V0VHlwZSwgc2V0TWF4VmFsdWUsIHNldEdyYXBoaWNzLCBzZXRSZW5kZXJhYmxlcykge1xyXG5cdHRoaXMudHlwZSA9IHNldFR5cGU7IC8vVHdvIHR5cGVzLCBcImdyb3dpbmdcIiAoc3RhcnRzIGF0IDAsIHRyaWdnZXJzIGV2ZW50IHdoZW4gZnVsbCkgXHJcblx0XHRcdFx0XHRcdCAvL2FuZCBcInNocmlua2luZ1wiIChzdGFydHMgZnVsbCwgdHJpZ2dlcnMgYXQgMClcclxuXHR0aGlzLmJnQm9yZGVyU2l6ZSA9IDI7XHRcdFx0Ly9kZWZhdWx0IHNpemUgb2YgYmFja2dyb3VuZCBib3JkZXJcclxuXHR0aGlzLmJnQm9yZGVyQ29sb3IgPSAweEFBQUFBQTtcdC8vZGVmYXVsdCBjb2xvciBvZiBiYWNrZ3JvdW5kIGJvcmRlclxyXG5cdHRoaXMuYmdDb2xvciA9IDB4ODg4ODg4O1x0XHQvL2RlZmF1bHQgY29sb3Igb2YgYmFja2dyb3VuZFxyXG5cdHRoaXMucGFkZGluZ0hvcml6ID0gNTtcdFx0XHQvL2RlZmF1bHQgc3VtIG9mIHBhZGRpbmcgb24gbGVmdCBhbmQgcmlnaHQgc2lkZSBpbm5lciB2YWx1ZSBiYXJcclxuXHR0aGlzLnBhZGRpbmdWZXJ0ID0gNTtcdFx0XHQvL2RlZmF1bHQgc3VtIChpLmUuIGhhbGYgb24gZWFjaCBzaWRlKSBvZiB2ZXJ0aWNhbCBwYWRkaW5nIG9mIGlubmVyIHZhbHVlIGJhclxyXG5cdHRoaXMudmFsdWVCb3JkZXJTaXplID0gMTtcdFx0Ly9kZWZhdWx0IHNpemUgb2YgdmFsdWUgYm9yZGVyXHJcblx0dGhpcy52YWx1ZUJvcmRlckNvbG9yID0gMHg4ODg4RkY7IC8vZGVmYXVsdCBjb2xvciBvZiB2YWx1ZSBib3JkZXJcclxuXHR0aGlzLnZhbHVlQ29sb3IgPSAweDAwMDA5OTtcdFx0Ly9kZWZhdWx0IGNvbG9yIG9mIGlubmVyIHZhbHVlIGJhclxyXG5cdHRoaXMueCA9IG51bGw7XHJcblx0dGhpcy55ID0gbnVsbDtcclxuXHR0aGlzLndpZHRoID0gbnVsbDtcclxuXHR0aGlzLmhlaWdodCA9IG51bGw7XHJcblx0dGhpcy5tYXhWYWx1ZSA9IHNldE1heFZhbHVlO1xyXG5cdHRoaXMuZ3JhcGhpY3MgPSBzZXRHcmFwaGljczsgLy9zdG9yZSBncmFwaGljcyBjbGFzcyAodXNlZCB0byBkcmF3IGJhcilcclxuXHR0aGlzLnJlbmRlcmFibGVzID0gc2V0UmVuZGVyYWJsZXM7XHJcblx0XHJcblx0dGhpcy5vbkV2ZW50ID0gZnVuY3Rpb24oKSB7fTsgLy9vdmVyd3JpdGUgdGhpcyBmdW5jdGlvbiB0byBtYWtlIHdoYXRldmVyIHlvdSB3YW50IGhhcHBlbiB3aGVuIHByb2dyZXNzQmFyIHJlYWNoZXMgbGltaXRcclxuXHRcclxuXHQvL3N3aXRjaCh0aGlzLnR5cGUpIHtcclxuXHQvL2Nhc2UgJ2dyb3dpbmcnIDogXHJcblx0aWYoc2V0VHlwZSA9PT0gJ2dyb3dpbmcnKSB7XHJcblx0XHR0aGlzLnZhbHVlID0gMDtcclxuXHRcdC8vdHJ5VHJpZ2dlciBpcyBjYWxsZWQgYXV0b21hdGljYWxseSB3aGVuIHlvdSBhZGQvc3VidHJhY3QgdmFsdWUsIGFuZCB3aWxsIHRyaWdnZXIgdGhlIG9uRXZlbnQoKSBmdW5jdGlvblxyXG5cdFx0dGhpcy50cnlUcmlnZ2VyID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdGlmKHRoaXMudmFsdWUgPj0gdGhpcy5tYXhWYWx1ZSkge1xyXG5cdFx0XHRcdHRoaXMub25FdmVudCgpO1xyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cdFx0Ly9icmVhaztcclxuXHR9XHJcblx0ZWxzZSBpZihzZXRUeXBlID09PSAnc2hyaW5raW5nJykge1xyXG5cdC8vY2FzZSAnc2hyaW5raW5nJyA6XHJcblx0XHR0aGlzLnZhbHVlID0gdGhpcy5tYXhWYWx1ZTtcclxuXHRcdHRoaXMudHJ5VHJpZ2dlciA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRpZih0aGlzLnZhbHVlIDw9IDApIHtcclxuXHRcdFx0XHR0aGlzLm9uRXZlbnQoKTtcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHR9XHJcbn07XHJcblxyXG5Qcm9ncmVzc0Jhci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBQcm9ncmVzc0JhcjtcclxuXHJcblByb2dyZXNzQmFyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XHJcblx0dGhpcy5ncmFwaGljcy5jbGVhcigpO1xyXG5cdHRoaXMucmVuZGVyYWJsZXMudW5zdWJzY3JpYmUodGhpcyk7XHJcbn07XHJcblxyXG4vL1RvIHN1YnRyYWN0IHZhbHVlLCBqdXN0IHVzZSBuZWdhdGl2ZSBudW1iZXJzIGFzIGFyZ3VtZW50IGkuZS4gZm9vLmFkZFZhbHVlKC01KTtcclxuUHJvZ3Jlc3NCYXIucHJvdG90eXBlLmFkZFZhbHVlID0gZnVuY3Rpb24gKGFkZFRoaXMpIHtcclxuXHR0aGlzLnZhbHVlICs9IGFkZFRoaXM7XHJcblx0aWYodGhpcy52YWx1ZSA+IHRoaXMubWF4VmFsdWUpIHtcclxuXHRcdHRoaXMudmFsdWUgPSB0aGlzLm1heFZhbHVlO1xyXG5cdH1cclxuXHRpZih0aGlzLnZhbHVlIDwgMCkge1xyXG5cdFx0dGhpcy52YWx1ZSA9IDA7XHJcblx0fVxyXG5cdHRoaXMudHJ5VHJpZ2dlcigpO1xyXG59O1xyXG5cclxuLy9TZXRzIHRoZSBsb2NhdGlvbiB3aGVyZSBwcm9ncmVzcyBiYXIgaXMgcmVuZGVyZWRcclxuUHJvZ3Jlc3NCYXIucHJvdG90eXBlLnNldExvY2F0aW9uID0gZnVuY3Rpb24oc2V0WCwgc2V0WSkge1xyXG5cdHRoaXMueCA9IHNldFg7XHJcblx0dGhpcy55ID0gc2V0WTtcclxufTtcclxuXHJcbi8vU2V0cyB0aGUgc2l6ZSBvZiB0aGUgcHJvZ3Jlc3MgYmFyXHJcblByb2dyZXNzQmFyLnByb3RvdHlwZS5zZXRTaXplID0gZnVuY3Rpb24oc2V0V2lkdGgsIHNldEhlaWdodCkge1xyXG5cdHRoaXMud2lkdGggPSBzZXRXaWR0aDtcclxuXHR0aGlzLmhlaWdodCA9IHNldEhlaWdodDtcclxufTtcclxuXHJcblByb2dyZXNzQmFyLnByb3RvdHlwZS5zZXRTdHlsZSA9IGZ1bmN0aW9uKGJnQm9yZGVyU2l6ZSwgYmdCb3JkZXJDb2xvciwgYmdDb2xvciwgcGFkZGluZ0hvcml6LCBwYWRkaW5nVmVydCwgdmFsdWVCb3JkZXJTaXplLCB2YWx1ZUJvcmRlckNvbG9yLCB2YWx1ZUNvbG9yKSB7XHJcblx0dGhpcy5iZ0JvcmRlclNpemUgPSBiZ0JvcmRlclNpemU7XHJcblx0dGhpcy5iZ0JvcmRlckNvbG9yID0gYmdCb3JkZXJDb2xvcjtcclxuXHR0aGlzLmJnQ29sb3IgPSBiZ0NvbG9yO1xyXG5cdHRoaXMucGFkZGluZ0hvcml6ID0gcGFkZGluZ0hvcml6O1xyXG5cdHRoaXMucGFkZGluZ1ZlcnQgPSBwYWRkaW5nVmVydDtcclxuXHR0aGlzLnZhbHVlQm9yZGVyU2l6ZSA9IHZhbHVlQm9yZGVyU2l6ZTtcclxuXHR0aGlzLnZhbHVlQm9yZGVyQ29sb3IgPSB2YWx1ZUJvcmRlckNvbG9yO1xyXG5cdHRoaXMudmFsdWVDb2xvciA9IHZhbHVlQ29sb3I7XHJcbn07XHJcblxyXG4vL3VwZGF0ZSBmb3IgcHJvZ3Jlc3MgYmFyLCBjYWxsZWQganVzdCBiZWZvcmUgZHJhd2luZyBwcm9ncmVzcyBiYXJcclxuLy9PdmVyd3JpdGUgdGhpcyBmdW5jdGlvbiBpZiBkZXNpcmVkXHJcblByb2dyZXNzQmFyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHt9O1xyXG5cclxuLy9SZW5kZXJzIHByb2dyZXNzQmFyXHJcblByb2dyZXNzQmFyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcclxuXHR0aGlzLnVwZGF0ZSgpO1xyXG5cdHRoaXMuZ3JhcGhpY3MuY2xlYXIoKTtcclxuXHQvL0RyYXcgYmFja2dyb3VuZCBvZiBiYXJcclxuXHR0aGlzLmdyYXBoaWNzLmxpbmVTdHlsZSh0aGlzLmJnQm9yZGVyU2l6ZSwgdGhpcy5iZ0JvcmRlckNvbG9yLCAxKTsgLy9zZXRzIGJvcmRlciBjb2xvciBhbmQgc2l6ZVxyXG5cdHRoaXMuZ3JhcGhpY3MuYmVnaW5GaWxsKHRoaXMuYmdDb2xvcik7IC8vc2V0cyBjb2xvciBvZiBiYWNrZ3JvdW5kIGZpbGxcclxuXHR0aGlzLmdyYXBoaWNzLmRyYXdSZWN0KHRoaXMueC10aGlzLndpZHRoLzIsIHRoaXMueS10aGlzLmhlaWdodC8yLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XHJcblx0dGhpcy5ncmFwaGljcy5lbmRGaWxsKCk7XHJcblx0Ly9EcmF3IHZhbHVlIG9mIGJhclxyXG5cdHZhciBwZXJjZW50YWdlID0gdGhpcy52YWx1ZSAvIHRoaXMubWF4VmFsdWU7XHJcblx0dmFyIGJhcldpZHRoID0gdGhpcy53aWR0aCAtIHRoaXMucGFkZGluZ0hvcml6O1xyXG5cdHZhciBiYXJIZWlnaHQgPSB0aGlzLmhlaWdodCAtIHRoaXMucGFkZGluZ1ZlcnQ7XHJcblx0dGhpcy5ncmFwaGljcy5saW5lU3R5bGUodGhpcy52YWx1ZUJvcmRlclNpemUsIHRoaXMudmFsdWVCb3JkZXJDb2xvciwgMSk7XHJcblx0dGhpcy5ncmFwaGljcy5iZWdpbkZpbGwodGhpcy52YWx1ZUNvbG9yKTtcclxuXHR0aGlzLmdyYXBoaWNzLmRyYXdSZWN0KHRoaXMueC0oYmFyV2lkdGgvMiksIHRoaXMueS0oYmFySGVpZ2h0LzIpLCBiYXJXaWR0aCpwZXJjZW50YWdlLCBiYXJIZWlnaHQpO1xyXG5cdHRoaXMuZ3JhcGhpY3MuZW5kRmlsbCgpO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBQcm9ncmVzc0JhcjsiLCJ2YXIgUHJvZ3Jlc3NCYXIgPSByZXF1aXJlKCcuL1Byb2dyZXNzQmFyJyk7XHJcbnZhciBCYW5uZXIgPSByZXF1aXJlKCcuL2Jhbm5lcicpO1xyXG5cclxudmFyIFVJQnVpbGRlciA9IGZ1bmN0aW9uKHNldEdhbWVTdGF0ZSwgc2V0UmVuZGVyYWJsZXMpIHtcclxuXHQvL0Vuc3VyZSB0aGF0IGNhbm5vdCBjcmVhdGUgbXVsdGlwbGUgaW5zdGFuY2VzIG9mIHRoaXMgY2xhc3NcclxuXHRpZihVSUJ1aWxkZXIucHJvdG90eXBlLmV4aXN0cykge1xyXG5cdFx0cmV0dXJuIFVJQnVpbGRlci5wcm90b3R5cGUuZXhpc3RpbmdSZWZlcmVuY2U7XHJcblx0fVxyXG5cdFxyXG5cdHRoaXMuZ2FtZVN0YXRlID0gc2V0R2FtZVN0YXRlO1xyXG5cdHRoaXMucmVuZGVyYWJsZXMgPSBzZXRSZW5kZXJhYmxlcztcclxuXHQvL0NyZWF0ZSBhbmQgc3RvcmUgYSBncmFwaGljcyBvYmplY3QgKHVzZWQgZm9yIHN0dWZmIGxpa2UgZHJhd2luZyByZWN0YW5nbGVzKVxyXG5cdFVJQnVpbGRlci5wcm90b3R5cGUuZXhpc3RzID0gdHJ1ZTtcclxuXHRVSUJ1aWxkZXIucHJvdG90eXBlLmV4aXN0aW5nUmVmZXJlbmNlID0gdGhpcztcclxufTtcclxuXHJcblVJQnVpbGRlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBVSUJ1aWxkZXI7XHJcbi8vVGhlc2UgdmFyJ3MgaGVscCBjcmVhdGUgdGhlIHNpbmdsZXRvbiBmdW5jdGlvbmFsaXR5XHJcblVJQnVpbGRlci5wcm90b3R5cGUuZXhpc3RzID0gZmFsc2U7XHJcblVJQnVpbGRlci5wcm90b3R5cGUuZXhpc3RpbmdSZWZlcmVuY2UgPSBudWxsO1xyXG5cclxuLy9Vc2UgdGhpcyBmdW5jdGlvbiB0byBjcmVhdGUgYSBwcm9ncmVzcyBiYXJcclxuLy9Vc2FnZTogdHlwZTogY2FuIGJlIFwiZ3Jvd2luZ1wiIG9yIFwic2hyaW5raW5nXCIsIHRoaXMgd2lsbCBlZmZlY3QgaWYgYmFyIHN0YXJ0cyBhdCAwIGFuZCBnb2VzIHVwIG9yIHZpcyB2ZXJzYVxyXG4vL1x0XHQgbWF4VmFsdWU6IHNldHMgdGhlIG1heCB2YWx1ZSBvZiB0aGUgcHJvZ3Jlc3MgYmFyLCBpLmUuIHVzaW5nIDEwMCBjcmVhdGVzIGEgYmFyIGZyb20gMCB0byAxMDBcclxuLy9cdFx0IHgseTogc2V0cyBsb2NhdGlvblxyXG4vL1x0XHQgRE9OJ1QgRk9SR0VUIHRvIG92ZXJ3cml0ZSB0aGUgb25FdmVudCgpIGZ1bmN0aW9uIGZvciB0aGUgcHJvZ3Jlc3MgYmFyIGFmdGVyIGNyZWF0aW5nIGl0XHJcbi8vXHRcdFx0LW9uRXZlbnQoKSBpcyBhdXRvbWF0aWNhbGx5IGNhbGxlZCB3aGVuIGJhciBmaWxscy9zaHJpbmtzIHBhc3QgbGltaXQgKGRlcGVuZGluZyBvbiBiYXIgdHlwZSlcclxuVUlCdWlsZGVyLnByb3RvdHlwZS5idWlsZFByb2dyZXNzQmFyID0gZnVuY3Rpb24odHlwZSwgeCwgeSwgd2lkdGgsIGhlaWdodCwgbWF4VmFsdWUpIHtcclxuXHQvL2NyZWF0ZSBhbmQgZm9ybWF0IG5ldyBwcm9nIGJhclxyXG5cdHZhciBncmFwaGljcyA9IHRoaXMuZ2FtZVN0YXRlLmdhbWUuYWRkLmdyYXBoaWNzKDAsMCk7XHJcblx0dmFyIG5ld1Byb2dCYXIgPSBuZXcgUHJvZ3Jlc3NCYXIodHlwZSwgbWF4VmFsdWUsIGdyYXBoaWNzLCB0aGlzLnJlbmRlcmFibGVzKTtcclxuXHRuZXdQcm9nQmFyLnNldExvY2F0aW9uKHgseSk7XHJcblx0bmV3UHJvZ0Jhci5zZXRTaXplKHdpZHRoLCBoZWlnaHQpO1xyXG5cdC8vc3Vic2NyaWJlIHRvICdyZW5kZXJhYmxlcycgc28gdGhhdCByZW5kZXIoKSBpcyBjYWxsZWQgYXV0b21hdGljYWxseVxyXG5cdHRoaXMucmVuZGVyYWJsZXMuc3Vic2NyaWJlKG5ld1Byb2dCYXIpO1xyXG5cdHJldHVybiBuZXdQcm9nQmFyO1xyXG59O1xyXG5cclxuVUlCdWlsZGVyLnByb3RvdHlwZS5idWlsZEJhbm5lciA9IGZ1bmN0aW9uKHhSYXRpbywgeVJhdGlvLCB0ZXh0cykge1xyXG4gICB2YXIgZ3JhcGhpY3MgPSB0aGlzLmdhbWVTdGF0ZS5nYW1lLmFkZC5ncmFwaGljcygwLCAwKTtcclxuICAgdmFyIG5ld0Jhbm5lciA9IG5ldyBCYW5uZXIodGhpcy5nYW1lU3RhdGUsIHhSYXRpbywgeVJhdGlvLCB0ZXh0cywgZ3JhcGhpY3MsIHRoaXMucmVuZGVyYWJsZXMpO1xyXG4gICB0aGlzLnJlbmRlcmFibGVzLnN1YnNjcmliZShuZXdCYW5uZXIpO1xyXG4gICByZXR1cm4gbmV3QmFubmVyO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBVSUJ1aWxkZXI7IiwidmFyIFV0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMnKTtcclxuXHJcbi8vTk9URTogRE9OJ1QgVVNFIHRoaXMgY29kZSB0byBjcmVhdGUgYSBCYW5uZXIuIEluc3RlYWQsIHVzZSB0aGUgVUlCdWlsZGVyIG9iamVjdCBhbmQgY2FsbCBidWlsZEJhbm5lclxyXG52YXIgQmFubmVyID0gZnVuY3Rpb24oc3RhdGUsIHhSYXRpbywgeVJhdGlvLCB0ZXh0SlNPTiwgZ3JhcGhpY3MsIHJlbmRlcmFibGVzKSB7XHJcbiAgIHRoaXMuYmdCb3JkZXJTaXplID0gNjtcdFx0XHQvL2RlZmF1bHQgc2l6ZSBvZiBiYWNrZ3JvdW5kIGJvcmRlclxyXG5cdHRoaXMuYmdCb3JkZXJDb2xvciA9IDB4ZmZmZmZmO1x0Ly9kZWZhdWx0IGNvbG9yIG9mIGJhY2tncm91bmQgYm9yZGVyXHJcblx0dGhpcy5iZ0NvbG9yID0gMHg0YTRhNGE7XHRcdC8vZGVmYXVsdCBjb2xvciBvZiBiYWNrZ3JvdW5kXHJcbiAgIHRoaXMuc2hhZG93T2Zmc2V0WCA9IDM7XHJcbiAgIHRoaXMuc2hhZG93T2Zmc2V0WSA9IDM7XHJcbiAgIHRoaXMuc2hhZG93Q29sb3IgPSAncmdiYSgwLDAsMCwwLjkpJztcclxuICAgdGhpcy5zaGFkb3dCbHVyID0gNTtcclxuICAgdGhpcy5ub3JtYWxUZXh0ID0gJyNmZmZmZmYnO1xyXG4gICB0aGlzLmhpZ2hsaWdodFRleHQgPSAnIzAwZmYwMCc7XHJcbiAgIHRoaXMudGV4dFdyYXBQYWRkaW5nID0gMTA7XHJcbiAgIHRoaXMub2ZmU2NyZWVuUGFkZGluZyA9IC0yMDA7XHJcbiAgIHRoaXMudGV4dEpTT04gPSB0ZXh0SlNPTjtcclxuICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xyXG4gICB0aGlzLmdhbWUgPSBzdGF0ZS5nYW1lO1xyXG4gICB0aGlzLmNhbSA9IHRoaXMuZ2FtZS5jYW1lcmE7XHJcbiAgIHRoaXMuc20gPSB0aGlzLnN0YXRlLnNvdW5kTWFuYWdlcjtcclxuICAgdGhpcy54UmF0aW8gPSB4UmF0aW87XHJcbiAgIHRoaXMueVJhdGlvID0geVJhdGlvO1xyXG4gICB0aGlzLmdyYXBoaWNzID0gZ3JhcGhpY3M7XHJcbiAgIHRoaXMucmVuZGVyYWJsZXMgPSByZW5kZXJhYmxlcztcclxuICAgdGhpcy53aWR0aCA9IDQwMDtcclxuICAgdGhpcy5oZWlnaHQgPSAyMDA7XHJcbiAgIHRoaXMuaW5kZXggPSAwO1xyXG4gICB0aGlzLnggPSAwO1xyXG4gICB0aGlzLmhpZGVCdWZmZXIgPSAtNTA7XHJcbiAgIHRoaXMuaGlkZUhlaWdodCA9IC10aGlzLmhlaWdodCAtIHRoaXMuaGlkZUJ1ZmZlcjtcclxuICAgdGhpcy55ID0gdGhpcy5jYW0ueSAtIHRoaXMuY2FtLmhlaWdodCAvIDIgLSB0aGlzLmhpZGVIZWlnaHQ7XHJcbiAgIHRoaXMuc2xpZGVZID0gdGhpcy5oaWRlSGVpZ2h0O1xyXG4gICB0aGlzLmdvYWxZID0gdGhpcy55O1xyXG4gICB0aGlzLnNsaWRlUmF0ZSA9IDAuMjtcclxuICAgdGhpcy52aXNpYmxlID0gZmFsc2U7XHJcbiAgIC8vIGFkZCBidXR0b25zXHJcbiAgIHRoaXMucmlnaHRCdXR0b24gPSB0aGlzLmdhbWUuYWRkLmJ1dHRvbigwLCAwLCAnYXJyb3dCdXR0b24nLCB0aGlzLm5leHRJbmRleCwgdGhpcywgMSwgMCwgMik7XHJcblx0dGhpcy5yaWdodEJ1dHRvbi5vbklucHV0T3Zlci5hZGQodGhpcy5zbS5wbGF5SG92ZXJDbGljaywgdGhpcy5zbSk7XHJcblx0dGhpcy5yaWdodEJ1dHRvbi5vbklucHV0RG93bi5hZGQodGhpcy5zbS5wbGF5RG93bkNsaWNrLCB0aGlzLnNtKTtcclxuICAgdGhpcy5sZWZ0QnV0dG9uID0gdGhpcy5nYW1lLmFkZC5idXR0b24oMCwgMCwgJ2Fycm93QnV0dG9uJywgdGhpcy5wcmV2SW5kZXgsIHRoaXMsIDEsIDAsIDIpO1xyXG5cdHRoaXMubGVmdEJ1dHRvbi5vbklucHV0T3Zlci5hZGQodGhpcy5zbS5wbGF5SG92ZXJDbGljaywgdGhpcy5zbSk7XHJcblx0dGhpcy5sZWZ0QnV0dG9uLm9uSW5wdXREb3duLmFkZCh0aGlzLnNtLnBsYXlEb3duQ2xpY2ssIHRoaXMuc20pO1xyXG4gICB0aGlzLmxlZnRCdXR0b24uc2NhbGUueCA9IC0xO1xyXG4gICB0aGlzLmdyb3VwID0gbmV3IFBoYXNlci5Hcm91cCh0aGlzLmdhbWUpO1xyXG4gICB0aGlzLmdyb3VwLmFkZCh0aGlzLmdyYXBoaWNzKTtcclxuICAgdGhpcy5ncm91cC5hZGQodGhpcy5yaWdodEJ1dHRvbik7XHJcbiAgIHRoaXMuZ3JvdXAuYWRkKHRoaXMubGVmdEJ1dHRvbik7XHJcbiAgIHRoaXMuYWRkVGV4dHMoKTtcclxuICAgdGhpcy5nYW1lLndvcmxkLmJyaW5nVG9Ub3AodGhpcy5ncm91cCk7XHJcbiAgIHRoaXMuZGVidWcgPSBmYWxzZTtcclxufTtcclxuXHJcbkJhbm5lci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBCYW5uZXI7XHJcblxyXG5CYW5uZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcclxuXHR0aGlzLmdyYXBoaWNzLmNsZWFyKCk7XHJcblx0dGhpcy5yZW5kZXJhYmxlcy51bnN1YnNjcmliZSh0aGlzKTtcclxufTtcclxuXHJcbkJhbm5lci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgIC8vIFRPRE86IGFkZCBsYXllciBncm91cHMgdG8gb3RoZXIgdGhpbmdzXHJcbiAgIHRoaXMuZ2FtZS53b3JsZC5icmluZ1RvVG9wKHRoaXMuZ3JvdXApO1xyXG4gICAvLyBteSBwb3NcclxuICAgdGhpcy54ID0gdGhpcy5jYW0ueCArIHRoaXMuY2FtLndpZHRoICogdGhpcy54UmF0aW87XHJcbiAgIGlmICh0aGlzLnZpc2libGUpIHtcclxuICAgICAgdGhpcy5nb2FsWSA9IHRoaXMuY2FtLmhlaWdodCAvIDI7XHJcbiAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZ29hbFkgPSB0aGlzLmhpZGVIZWlnaHQ7XHJcbiAgIH1cclxuICAgdGhpcy5zbGlkZVkgPSBVdGlscy5sZXJwKHRoaXMuc2xpZGVZLCB0aGlzLmdvYWxZLCB0aGlzLnNsaWRlUmF0ZSk7XHJcbiAgIGlmICh0aGlzLmRlYnVnKSB7IGNvbnNvbGUubG9nKCd0aGlzLmNhbS55OicsIHRoaXMuY2FtLnksICd0aGlzLnNsaWRlWTonLCB0aGlzLnNsaWRlWSwgJ3RoaXMueTonLCB0aGlzLnkpOyB9XHJcbiAgIHRoaXMueSA9IHRoaXMuY2FtLnkgKyB0aGlzLnNsaWRlWTtcclxuICAgLy8gdGV4dCBwb3NcclxuICAgdmFyIGN1clRleHQgPSB0aGlzLnRleHRPYmpzW3RoaXMuaW5kZXhdO1xyXG4gICBjdXJUZXh0LnggPSB0aGlzLng7XHJcbiAgIGN1clRleHQueSA9IHRoaXMueTtcclxuICAgLy8gYnV0dG9uIHBvc1xyXG4gICB0aGlzLnJpZ2h0QnV0dG9uLnggPSB0aGlzLnggKyB0aGlzLndpZHRoIC8gMiArIHRoaXMucmlnaHRCdXR0b24ud2lkdGggLyAyO1xyXG4gICB0aGlzLnJpZ2h0QnV0dG9uLnkgPSB0aGlzLnkgLSB0aGlzLnJpZ2h0QnV0dG9uLmhlaWdodCAvIDI7XHJcbiAgIHRoaXMubGVmdEJ1dHRvbi54ID0gdGhpcy54IC0gdGhpcy53aWR0aCAvIDIgKyB0aGlzLmxlZnRCdXR0b24ud2lkdGggLyAyO1xyXG4gICB0aGlzLmxlZnRCdXR0b24ueSA9IHRoaXMueSAtIHRoaXMubGVmdEJ1dHRvbi5oZWlnaHQgLyAyO1xyXG59O1xyXG5cclxuQmFubmVyLnByb3RvdHlwZS5hZGRUZXh0cyA9IGZ1bmN0aW9uKCkge1xyXG4gICBpZiAoIXRoaXMudGV4dE9icykge1xyXG4gICAgICB0aGlzLnRleHRPYmpzID0gW107XHJcbiAgIH1cclxuICAgdmFyIHRleHREZWZzID0gSlNPTi5wYXJzZSh0aGlzLmdhbWUuY2FjaGUuZ2V0VGV4dCh0aGlzLnRleHRKU09OKSk7XHJcbiAgIHZhciB0ZXh0QXJyYXkgPSB0ZXh0RGVmc1sndGV4dCddO1xyXG4gICB2YXIgdGV4dENvbG9ycyA9IHRleHREZWZzWydjb2xvcnMnXTtcclxuICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZXh0QXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgdmFyIHRleHQgPSB0ZXh0QXJyYXlbaV07XHJcbiAgICAgIHZhciBuZXdUZXh0ID0gdGhpcy5nYW1lLmFkZC50ZXh0KHRoaXMub2ZmU2NyZWVuUGFkZGluZywgdGhpcy5vZmZTY3JlZW5QYWRkaW5nLCB0ZXh0KTtcclxuICAgICAgbmV3VGV4dC5mb250ID0gJ1JvYm90byc7XHJcbiAgICAgIG5ld1RleHQuZm9udFNpemUgPSAyNDtcclxuICAgICAgbmV3VGV4dC5hbGlnbiA9ICdjZW50ZXInO1xyXG4gICAgICBuZXdUZXh0LmZpbGwgPSB0aGlzLm5vcm1hbFRleHQ7XHJcbiAgICAgIG5ld1RleHQud29yZFdyYXAgPSB0cnVlO1xyXG4gICAgICBuZXdUZXh0LndvcmRXcmFwV2lkdGggPSB0aGlzLndpZHRoIC0gdGhpcy50ZXh0V3JhcFBhZGRpbmc7XHJcbiAgICAgIG5ld1RleHQuYW5jaG9yLnNldCgwLjUpO1xyXG4gICAgICBuZXdUZXh0LnNldFNoYWRvdyh0aGlzLnNoYWRvd09mZnNldFgsIHRoaXMuc2hhZG93T2Zmc2V0WSwgdGhpcy5zaGFkb3dDb2xvciwgdGhpcy5zaGFkb3dCbHVyKTtcclxuICAgICAgdmFyIG5ld0NvbG9ycyA9IHRleHRDb2xvcnNbaV07XHJcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbmV3Q29sb3JzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgIG5ld1RleHQuYWRkQ29sb3IodGhpcy5oaWdobGlnaHRUZXh0LCBuZXdDb2xvcnNbal0pO1xyXG4gICAgICAgICBqKys7XHJcbiAgICAgICAgIG5ld1RleHQuYWRkQ29sb3IodGhpcy5ub3JtYWxUZXh0LCBuZXdDb2xvcnNbal0pO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMudGV4dE9ianMucHVzaChuZXdUZXh0KTtcclxuICAgICAgdGhpcy5ncm91cC5hZGQobmV3VGV4dCk7XHJcbiAgIH1cclxufTtcclxuXHJcbkJhbm5lci5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XHJcblx0dGhpcy51cGRhdGUoKTtcclxuXHR0aGlzLmdyYXBoaWNzLmNsZWFyKCk7XHJcblx0Ly9EcmF3IGJhY2tncm91bmRcclxuXHR0aGlzLmdyYXBoaWNzLmxpbmVTdHlsZSh0aGlzLmJnQm9yZGVyU2l6ZSwgdGhpcy5iZ0JvcmRlckNvbG9yLCAxKTsgLy9zZXRzIGJvcmRlciBjb2xvciBhbmQgc2l6ZVxyXG5cdHRoaXMuZ3JhcGhpY3MuYmVnaW5GaWxsKHRoaXMuYmdDb2xvcik7IC8vc2V0cyBjb2xvciBvZiBiYWNrZ3JvdW5kIGZpbGxcclxuXHR0aGlzLmdyYXBoaWNzLmRyYXdSZWN0KHRoaXMueC10aGlzLndpZHRoLzIsIHRoaXMueS10aGlzLmhlaWdodC8yLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XHJcblx0dGhpcy5ncmFwaGljcy5lbmRGaWxsKCk7XHJcbn07XHJcblxyXG5CYW5uZXIucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpIHtcclxuICAgLy8gdGhpcy5nb2FsWSA9IHRoaXMuY2FtLnkgKyB0aGlzLmNhbS5oZWlnaHQgKiB0aGlzLnlSYXRpbztcclxuICAgdGhpcy52aXNpYmxlID0gdHJ1ZTtcclxufTtcclxuXHJcbkJhbm5lci5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAvLyB0aGlzLmdvYWxZID0gdGhpcy5oaWRlSGVpZ2h0O1xyXG4gICB0aGlzLnZpc2libGUgPSBmYWxzZTtcclxufTtcclxuXHJcbkJhbm5lci5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24oKSB7XHJcbiAgaWYgKHRoaXMudmlzaWJsZSkge1xyXG4gICAgIHRoaXMuaGlkZSgpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICAgdGhpcy5zaG93KCk7XHJcbiAgfSAgXHJcbn07XHJcblxyXG5CYW5uZXIucHJvdG90eXBlLmhpZGVDdXJUZXh0ID0gZnVuY3Rpb24oKSB7XHJcbiAgdGhpcy50ZXh0T2Jqc1t0aGlzLmluZGV4XS54ID0gdGhpcy50ZXh0T2Jqc1t0aGlzLmluZGV4XS55ID0gMDsgXHJcbn07XHJcblxyXG5CYW5uZXIucHJvdG90eXBlLm5leHRJbmRleCA9IGZ1bmN0aW9uKCkge1xyXG4gICB0aGlzLmhpZGVDdXJUZXh0KCk7XHJcbiAgIHRoaXMuaW5kZXgrKztcclxuICAgaWYgKHRoaXMuaW5kZXggPj0gdGhpcy50ZXh0T2Jqcy5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5pbmRleCA9IDA7XHJcbiAgIH1cclxufTtcclxuXHJcbkJhbm5lci5wcm90b3R5cGUucHJldkluZGV4ID0gZnVuY3Rpb24oKSB7XHJcbiAgIHRoaXMuaGlkZUN1clRleHQoKTtcclxuICAgdGhpcy5pbmRleC0tO1xyXG4gICBpZiAodGhpcy5pbmRleCA8IDApIHtcclxuICAgICAgdGhpcy5pbmRleCA9IHRoaXMudGV4dE9ianMubGVuZ3RoIC0gMTtcclxuICAgfVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBCYW5uZXI7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIiwidmFyIFNob3AgPSBmdW5jdGlvbihzdGF0ZSkge1xyXG4gICAvLyBpbml0aWFsIHZhcmlhYmxlc1xyXG5cdHRoaXMuc3RhdGUgPSBzdGF0ZTtcclxuICAgdGhpcy5nYW1lID0gdGhpcy5zdGF0ZS5nYW1lO1xyXG4gICB0aGlzLmNhbSA9IHRoaXMuZ2FtZS5jYW1lcmE7XHJcbiAgIHRoaXMuc20gPSB0aGlzLnN0YXRlLnNvdW5kTWFuYWdlcjtcclxuICAgdGhpcy5tb3VzZSA9IHRoaXMuc3RhdGUubW91c2U7XHJcbiAgIHRoaXMubW9uZXkgPSA1MDA7XHJcbiAgIHRoaXMuc2hvcFNwZWVkID0gMTtcclxuICAgdGhpcy5kaWZmID0gMDtcclxuICAgdGhpcy5uZXdNb2R1bGVTcGVlZCA9IDE1MDA7XHJcbiAgIC8vIGNyZWF0ZSBidXR0b25cclxuICAgdGhpcy5zaG9wQnV0dG9uID0gdGhpcy5nYW1lLmFkZC5idXR0b24odGhpcy5nYW1lLmNhbWVyYS54ICsgdGhpcy5nYW1lLmNhbWVyYS53aWR0aCAtIDQ4LCAxNiwgJ3Nob3BCdXR0b24nLCB0aGlzLnVzZVNob3BCdXR0b24sIHRoaXMsIDEsIDAsIDIpO1xyXG5cdHRoaXMuc2hvcEJ1dHRvbi5vbklucHV0T3Zlci5hZGQodGhpcy5zbS5wbGF5SG92ZXJDbGljaywgdGhpcy5zbSk7XHJcblx0dGhpcy5zaG9wQnV0dG9uLm9uSW5wdXREb3duLmFkZCh0aGlzLnNtLnBsYXlEb3duQ2xpY2ssIHRoaXMuc20pO1xyXG4gICAvLyBjcmVhdGUgdGV4dFxyXG4gICB0aGlzLm1vbmV5VGV4dCA9IHRoaXMuZ2FtZS5hZGQudGV4dCh0aGlzLnNob3BCdXR0b24ueCAtIDgsIHRoaXMuc2hvcEJ1dHRvbi55ICsgNDgsIHRoaXMubW9uZXkpO1xyXG4gICB0aGlzLm1vbmV5VGV4dC5mb250ID0gJ1ZUMzIzJztcclxuICAgdGhpcy5tb25leVRleHQuZm9udFNpemUgPSAyNDtcclxuICAgdGhpcy5tb25leVRleHQuZmlsbCA9ICcjZmZmZmZmJztcclxuICAgdGhpcy5tb25leVRleHQudGV4dCA9IHRoaXMubW9uZXk7XHJcblx0dGhpcy5iZSA9IHRoaXMuZ2FtZS5hZGQuaW1hZ2UodGhpcy5tb25leVRleHQueCArIHRoaXMubW9uZXlUZXh0LndpZHRoICsgOCwgdGhpcy5tb25leVRleHQueSwgJ2JlJyk7XHJcbiAgIC8vIGNyZWF0ZSBzb3VuZHNcclxuICAgdGhpcy5jYXNoUmVnaXN0ZXIgPSB0aGlzLmdhbWUuYWRkLmF1ZGlvKCdjYXNoUmVnaXN0ZXInKTtcclxuICAgdGhpcy5jYXNoUmVnaXN0ZXIuYWxsb3dNdWx0aXBsZSA9IHRydWU7XHJcbiAgIHRoaXMuZXJyb3IgPSB0aGlzLmdhbWUuYWRkLmF1ZGlvKCdlcnJvcicpO1xyXG4gICAvLyBhZGQgY29udHJvbHNcclxuICAgdGhpcy5hZGRNb25leUtleSA9IHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLktleWJvYXJkLkspO1xyXG5cdHRoaXMuYWRkTW9uZXlLZXkub25Eb3duLmFkZCh0aGlzLmRlYnVnQWRkTW9uZXksIHRoaXMpO1xyXG4gICAvLyBjcmVhdGUgYnV0dG9uc1xyXG5cdHRoaXMuc2hvcFBhbmVsID0gdGhpcy5nYW1lLmFkZC5pbWFnZSh0aGlzLmNhbS54ICsgdGhpcy5jYW0ud2lkdGggKyAyNTYgKyAxNiwgdGhpcy5jYW0ueSArIDE2LCAnc2hvcFBhbmVsJyk7XHJcblx0dGhpcy5zaG9wUGFuZWwua2lsbCgpO1xyXG5cdHRoaXMuc2hpZWxkQnV0dG9uID0gdGhpcy5nYW1lLmFkZC5idXR0b24odGhpcy5jYW0ueCArIHRoaXMuY2FtLndpZHRoIC0gdGhpcy5kaWZmLCB0aGlzLmNhbS55ICsgNTIgKyAoODggKiAxKSwgJ3NoaWVsZEJ1dHRvbicsIHRoaXMucHVyY2hhc2VNb2R1bGUsIHtzdGF0ZTogdGhpcywga2V5OiAnc2hpZWxkJ30sIDEsIDAsIDIpO1xyXG5cdHRoaXMuZm9ybWF0QnV0dG9uKHRoaXMuc2hpZWxkQnV0dG9uKTtcclxuXHR0aGlzLnNvbGFyUGFuZWxCdXR0b24gPSB0aGlzLmdhbWUuYWRkLmJ1dHRvbih0aGlzLmNhbS54ICsgdGhpcy5jYW0ud2lkdGggLSB0aGlzLmRpZmYsIHRoaXMuY2FtLnkgKyA1MiArICg4OCAqIDIpLCAnc29sYXJQYW5lbEJ1dHRvbicsIHRoaXMucHVyY2hhc2VNb2R1bGUsIHtzdGF0ZTogdGhpcywga2V5OiAnc29sYXJQYW5lbCd9LCAxLCAwLCAyKTtcclxuXHR0aGlzLmZvcm1hdEJ1dHRvbih0aGlzLnNvbGFyUGFuZWxCdXR0b24pO1xyXG5cdHRoaXMudGhydXN0ZXJCdXR0b24gPSB0aGlzLmdhbWUuYWRkLmJ1dHRvbih0aGlzLmNhbS54ICsgdGhpcy5jYW0ud2lkdGggLSB0aGlzLmRpZmYsIHRoaXMuY2FtLnkgKyA1MiArICg4OCAqIDMpLCAndGhydXN0ZXJCdXR0b24nLCB0aGlzLnB1cmNoYXNlTW9kdWxlLCB7c3RhdGU6IHRoaXMsIGtleTogJ3RocnVzdGVyJ30sIDEsIDAsIDIpO1xyXG5cdHRoaXMuZm9ybWF0QnV0dG9uKHRoaXMudGhydXN0ZXJCdXR0b24pO1xyXG5cdHRoaXMuZ3VuQnV0dG9uID0gdGhpcy5nYW1lLmFkZC5idXR0b24odGhpcy5jYW0ueCArIHRoaXMuY2FtLndpZHRoIC0gdGhpcy5kaWZmLCB0aGlzLmNhbS55ICsgNTIgKyAoODggKiA0KSwgJ2d1bkJ1dHRvbicsIHRoaXMucHVyY2hhc2VNb2R1bGUsIHtzdGF0ZTogdGhpcywga2V5OiAnZ3VuJ30sIDEsIDAsIDIpO1xyXG5cdHRoaXMuZm9ybWF0QnV0dG9uKHRoaXMuZ3VuQnV0dG9uKTtcclxuXHR0aGlzLmhhY2tCdXR0b24gPSB0aGlzLmdhbWUuYWRkLmJ1dHRvbih0aGlzLmNhbS54ICsgdGhpcy5jYW0ud2lkdGggLSB0aGlzLmRpZmYsIHRoaXMuY2FtLnkgKyA1MiArICg4OCAqIDUpLCAnaGFja0J1dHRvbicsIHRoaXMucHVyY2hhc2VNb2R1bGUsIHtzdGF0ZTogdGhpcywga2V5OiAnaGFja2VyJ30sIDEsIDAsIDIpO1xyXG5cdHRoaXMuZm9ybWF0QnV0dG9uKHRoaXMuaGFja0J1dHRvbik7XHJcblx0dGhpcy5zaG9wQnV0dG9uID0gdGhpcy5nYW1lLmFkZC5idXR0b24odGhpcy5jYW0ueCArIHRoaXMuY2FtLndpZHRoIC0gNDgsIDE2LCAnc2hvcEJ1dHRvbicsIHRoaXMudXNlU2hvcEJ1dHRvbiwgdGhpcywgMSwgMCwgMik7XHJcblx0dGhpcy5zaG9wQnV0dG9uLm9uSW5wdXRPdmVyLmFkZCh0aGlzLnNtLnBsYXlIb3ZlckNsaWNrLCB0aGlzLnNtKTtcclxuXHR0aGlzLnNob3BCdXR0b24ub25JbnB1dERvd24uYWRkKHRoaXMuc20ucGxheURvd25DbGljaywgdGhpcy5zbSk7XHJcbn07XHJcblxyXG5TaG9wLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFNob3A7XHJcblxyXG5TaG9wLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcclxuICAgLy8gZmluZCBkaWZmXHJcblx0aWYodGhpcy5zaG9wTWVudU9wZW5pbmcgPT09IHRydWUpIHtcdFxyXG4gICAgICB0aGlzLmRpZmYgKz0gdGhpcy5zaG9wU3BlZWQgKiB0aGlzLmdhbWUudGltZS5lbGFwc2VkO1xyXG5cdFx0aWYodGhpcy5kaWZmID49IDI3Nikge1xyXG5cdFx0XHR0aGlzLnNob3BNZW51T3BlbmluZyA9IGZhbHNlO1xyXG5cdFx0XHR0aGlzLmFkZFNob3BCdXR0b25zKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGVsc2UgaWYodGhpcy5zaG9wTWVudUNsb3NpbmcgPT09IHRydWUpIHtcclxuICAgICAgdGhpcy5kaWZmIC09IHRoaXMuc2hvcFNwZWVkICogdGhpcy5nYW1lLnRpbWUuZWxhcHNlZDtcclxuXHRcdGlmKHRoaXMuZGlmZiA8PSAwKSB7XHJcblx0XHRcdHRoaXMuc2hvcFBhbmVsLmtpbGwoKTtcclxuXHRcdFx0dGhpcy5zaG9wTWVudUNsb3NpbmcgPSBmYWxzZTtcclxuXHRcdH1cclxuXHR9XHJcbiAgIC8vIHVwZGF0ZSBvcGVuaW5nIGJ1dHRvbiBwb3NpdGlvblxyXG4gICB0aGlzLnNob3BCdXR0b24ueCA9IHRoaXMuY2FtLnggKyB0aGlzLmNhbS53aWR0aCAtIDQ4IC0gdGhpcy5kaWZmO1xyXG5cdHRoaXMuc2hvcEJ1dHRvbi55ID0gdGhpcy5jYW0ueSArIDE2O1xyXG4gICAvLyB1cGRhdGUgdGV4dCBwb3NpdGlvblxyXG4gICB0aGlzLm1vbmV5VGV4dC54ID0gdGhpcy5zaG9wQnV0dG9uLnggLSAxNjtcclxuXHR0aGlzLm1vbmV5VGV4dC55ID0gdGhpcy5zaG9wQnV0dG9uLnkgKyA0ODtcclxuXHR0aGlzLmJlLnggPSB0aGlzLm1vbmV5VGV4dC54ICsgdGhpcy5tb25leVRleHQud2lkdGggKyA4O1xyXG5cdHRoaXMuYmUueSA9IHRoaXMubW9uZXlUZXh0Lnk7XHJcbiAgIC8vIHVwZGF0ZSBwdXJjaGFzaW5nIGJ1dHRvbiBwb3NpdGlvblxyXG4gICB0aGlzLnNob3BQYW5lbC54ID0gdGhpcy5jYW0ueCArIHRoaXMuY2FtLndpZHRoICsgMTYgLSB0aGlzLmRpZmY7XHJcblx0dGhpcy5zaG9wUGFuZWwueSA9IHRoaXMuY2FtLnkgKyAxNjtcclxuXHR0aGlzLnNoaWVsZEJ1dHRvbi54ID0gdGhpcy5jYW0ueCArIHRoaXMuY2FtLndpZHRoICsgMTYgLSB0aGlzLmRpZmY7XHJcblx0dGhpcy5zaGllbGRCdXR0b24ueSA9IHRoaXMuY2FtLnkgKyA3MCArICg4NiAqIDApO1xyXG5cdHRoaXMuc29sYXJQYW5lbEJ1dHRvbi54ID0gdGhpcy5jYW0ueCArIHRoaXMuY2FtLndpZHRoICsgMTYgLSB0aGlzLmRpZmY7XHJcblx0dGhpcy5zb2xhclBhbmVsQnV0dG9uLnkgPSB0aGlzLmNhbS55ICsgNzAgKyAoODYgKiAxKTtcclxuXHR0aGlzLnRocnVzdGVyQnV0dG9uLnggPSB0aGlzLmNhbS54ICsgdGhpcy5jYW0ud2lkdGggKyAxNiAtIHRoaXMuZGlmZjtcclxuXHR0aGlzLnRocnVzdGVyQnV0dG9uLnkgPSB0aGlzLmNhbS55ICsgNzAgKyAoODYgKiAyKTtcclxuXHR0aGlzLmd1bkJ1dHRvbi54ID0gdGhpcy5jYW0ueCArIHRoaXMuY2FtLndpZHRoICsgMTYgLSB0aGlzLmRpZmY7XHJcblx0dGhpcy5ndW5CdXR0b24ueSA9IHRoaXMuY2FtLnkgKyA3MCArICg4NiAqIDMpO1xyXG5cdHRoaXMuaGFja0J1dHRvbi54ID0gdGhpcy5jYW0ueCArIHRoaXMuY2FtLndpZHRoICsgMTYgLSB0aGlzLmRpZmY7XHJcblx0dGhpcy5oYWNrQnV0dG9uLnkgPSB0aGlzLmNhbS55ICsgNzAgKyAoODYgKiA0KTtcclxufTtcclxuXHJcblNob3AucHJvdG90eXBlLnB1cmNoYXNlTW9kdWxlID0gZnVuY3Rpb24oKSB7XHJcbiAgIHZhciByYW5kWSA9IHRoaXMuc3RhdGUuZ2FtZS5ybmQuaW50ZWdlckluUmFuZ2UoMTAwLCB0aGlzLnN0YXRlLmNhbS5oZWlnaHQgLSAxMDApO1xyXG4gICBpZih0aGlzLmtleSA9PT0gJ3NoaWVsZCcgJiYgdGhpcy5zdGF0ZS5tb3VzZS54ID4gdGhpcy5zdGF0ZS5zaGllbGRCdXR0b24ueCAmJiB0aGlzLnN0YXRlLm1vdXNlLnggPCB0aGlzLnN0YXRlLnNoaWVsZEJ1dHRvbi54ICsgMjU2ICYmIHRoaXMuc3RhdGUubW91c2UueSA+IHRoaXMuc3RhdGUuc2hpZWxkQnV0dG9uLnkgJiYgdGhpcy5zdGF0ZS5tb3VzZS55IDwgdGhpcy5zdGF0ZS5zaGllbGRCdXR0b24ueSArIDgyKSB7XHJcbiAgICAgIGlmKHRoaXMuc3RhdGUubW9uZXkgPj0gNDUpIHtcclxuICAgICAgICAgdGhpcy5zdGF0ZS5hZGRNb2R1bGUodGhpcy5zdGF0ZS5jYW0ueCArIHRoaXMuc3RhdGUuY2FtLndpZHRoICsgODAsIHRoaXMuc3RhdGUuY2FtLnkgKyByYW5kWSwgdGhpcy5rZXkpO1xyXG4gICAgICAgICB0aGlzLnN0YXRlLm1vbmV5IC09IDQ1O1xyXG4gICAgICAgICB0aGlzLnN0YXRlLmNhc2hSZWdpc3Rlci5wbGF5KCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgIHRoaXMuc3RhdGUuZXJyb3IucGxheSgpO1xyXG4gICAgICB9XHJcbiAgIH1cclxuICAgZWxzZSBpZih0aGlzLmtleSA9PT0gJ3NvbGFyUGFuZWwnICYmIHRoaXMuc3RhdGUubW91c2UueCA+IHRoaXMuc3RhdGUuc29sYXJQYW5lbEJ1dHRvbi54ICYmIHRoaXMuc3RhdGUubW91c2UueCA8IHRoaXMuc3RhdGUuc29sYXJQYW5lbEJ1dHRvbi54ICsgMjU2ICYmIHRoaXMuc3RhdGUubW91c2UueSA+IHRoaXMuc3RhdGUuc29sYXJQYW5lbEJ1dHRvbi55ICYmIHRoaXMuc3RhdGUubW91c2UueSA8IHRoaXMuc3RhdGUuc29sYXJQYW5lbEJ1dHRvbi55ICsgODIpIHtcclxuICAgICAgaWYodGhpcy5zdGF0ZS5tb25leSA+PSAxMDUpIHtcclxuICAgICAgICAgdGhpcy5zdGF0ZS5hZGRNb2R1bGUodGhpcy5zdGF0ZS5jYW0ueCArIHRoaXMuc3RhdGUuY2FtLndpZHRoICsgODAsIHRoaXMuc3RhdGUuY2FtLnkgKyByYW5kWSwgdGhpcy5rZXkpO1xyXG4gICAgICAgICB0aGlzLnN0YXRlLm1vbmV5IC09IDEwNTtcclxuICAgICAgICAgdGhpcy5zdGF0ZS5jYXNoUmVnaXN0ZXIucGxheSgpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgICB0aGlzLnN0YXRlLmVycm9yLnBsYXkoKTtcclxuICAgICAgfVxyXG4gICB9XHJcbiAgIGVsc2UgaWYodGhpcy5rZXkgPT09ICd0aHJ1c3RlcicgJiYgdGhpcy5zdGF0ZS5tb3VzZS54ID4gdGhpcy5zdGF0ZS50aHJ1c3RlckJ1dHRvbi54ICYmIHRoaXMuc3RhdGUubW91c2UueCA8IHRoaXMuc3RhdGUudGhydXN0ZXJCdXR0b24ueCArIDI1NiAmJiB0aGlzLnN0YXRlLm1vdXNlLnkgPiB0aGlzLnN0YXRlLnRocnVzdGVyQnV0dG9uLnkgJiYgdGhpcy5zdGF0ZS5tb3VzZS55IDwgdGhpcy5zdGF0ZS50aHJ1c3RlckJ1dHRvbi55ICsgODIpIHtcclxuICAgICAgaWYodGhpcy5zdGF0ZS5tb25leSA+PSA5MCkge1xyXG4gICAgICAgICB0aGlzLnN0YXRlLmFkZE1vZHVsZSh0aGlzLnN0YXRlLmNhbS54ICsgdGhpcy5zdGF0ZS5jYW0ud2lkdGggKyA4MCwgdGhpcy5zdGF0ZS5jYW0ueSArIHJhbmRZLCB0aGlzLmtleSk7XHJcbiAgICAgICAgIHRoaXMuc3RhdGUubW9uZXkgLT0gOTA7XHJcbiAgICAgICAgIHRoaXMuc3RhdGUuY2FzaFJlZ2lzdGVyLnBsYXkoKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICAgdGhpcy5zdGF0ZS5lcnJvci5wbGF5KCk7XHJcbiAgICAgIH1cclxuICAgfVxyXG4gICBlbHNlIGlmKHRoaXMua2V5ID09PSAnZ3VuJyAmJiB0aGlzLnN0YXRlLm1vdXNlLnggPiB0aGlzLnN0YXRlLmd1bkJ1dHRvbi54ICYmIHRoaXMuc3RhdGUubW91c2UueCA8IHRoaXMuc3RhdGUuZ3VuQnV0dG9uLnggKyAyNTYgJiYgdGhpcy5zdGF0ZS5tb3VzZS55ID4gdGhpcy5zdGF0ZS5ndW5CdXR0b24ueSAmJiB0aGlzLnN0YXRlLm1vdXNlLnkgPCB0aGlzLnN0YXRlLmd1bkJ1dHRvbi55ICsgODIpIHtcclxuICAgICAgaWYodGhpcy5zdGF0ZS5tb25leSA+PSAxMjApIHtcclxuICAgICAgICAgdGhpcy5zdGF0ZS5hZGRNb2R1bGUodGhpcy5zdGF0ZS5jYW0ueCArIHRoaXMuc3RhdGUuY2FtLndpZHRoICsgODAsIHRoaXMuc3RhdGUuY2FtLnkgKyByYW5kWSwgdGhpcy5rZXkpO1xyXG4gICAgICAgICB0aGlzLnN0YXRlLm1vbmV5IC09IDEyMDtcclxuICAgICAgICAgdGhpcy5zdGF0ZS5jYXNoUmVnaXN0ZXIucGxheSgpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgICB0aGlzLnN0YXRlLmVycm9yLnBsYXkoKTtcclxuICAgICAgfVxyXG4gICB9XHJcbiAgIGVsc2UgaWYodGhpcy5rZXkgPT09ICdoYWNrZXInICYmIHRoaXMuc3RhdGUubW91c2UueCA+IHRoaXMuc3RhdGUuaGFja0J1dHRvbi54ICYmIHRoaXMuc3RhdGUubW91c2UueCA8IHRoaXMuc3RhdGUuaGFja0J1dHRvbi54ICsgMjU2ICYmIHRoaXMuc3RhdGUubW91c2UueSA+IHRoaXMuc3RhdGUuaGFja0J1dHRvbi55ICYmIHRoaXMuc3RhdGUubW91c2UueSA8IHRoaXMuc3RhdGUuaGFja0J1dHRvbi55ICsgODIpIHtcclxuICAgICAgaWYodGhpcy5zdGF0ZS5tb25leSA+PSAyMDApIHtcclxuICAgICAgICAgdGhpcy5zdGF0ZS5hZGRNb2R1bGUodGhpcy5zdGF0ZS5jYW0ueCArIHRoaXMuc3RhdGUuY2FtLndpZHRoICsgODAsIHRoaXMuc3RhdGUuY2FtLnkgKyByYW5kWSwgdGhpcy5rZXkpO1xyXG4gICAgICAgICB0aGlzLnN0YXRlLm1vbmV5IC09IDIwMDtcclxuICAgICAgICAgdGhpcy5zdGF0ZS5jYXNoUmVnaXN0ZXIucGxheSgpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgICB0aGlzLnN0YXRlLmVycm9yLnBsYXkoKTtcclxuICAgICAgfVxyXG4gICB9XHJcbiAgIHRoaXMuc3RhdGUubW9uZXlUZXh0LnRleHQgPSB0aGlzLnN0YXRlLm1vbmV5OyBcclxufTtcclxuXHJcblNob3AucHJvdG90eXBlLmFkZE1vZHVsZSA9IGZ1bmN0aW9uICh4LCB5LCBrZXkpIHtcclxuICAgdmFyIG5ld01vZHVsZSA9IHRoaXMuc3RhdGUubW9kdWxlQnVpbGRlci5idWlsZChrZXksIHgsIHksIHRydWUpO1xyXG4gICBuZXdNb2R1bGUuY3ViZS5ib2R5Lm1vdmVMZWZ0KHRoaXMubmV3TW9kdWxlU3BlZWQpO1xyXG59O1xyXG5cclxuU2hvcC5wcm90b3R5cGUuYWRkU2hvcEJ1dHRvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgdGhpcy5zaGllbGRCdXR0b24ucmV2aXZlKCk7XHJcbiAgIHRoaXMuc29sYXJQYW5lbEJ1dHRvbi5yZXZpdmUoKTtcclxuICAgdGhpcy50aHJ1c3RlckJ1dHRvbi5yZXZpdmUoKTtcclxuICAgdGhpcy5ndW5CdXR0b24ucmV2aXZlKCk7XHJcbiAgIHRoaXMuaGFja0J1dHRvbi5yZXZpdmUoKTsgXHJcbn07XHJcblxyXG5TaG9wLnByb3RvdHlwZS5mb3JtYXRCdXR0b24gPSBmdW5jdGlvbihidXR0b24pIHtcclxuICAgYnV0dG9uLm9uSW5wdXRPdmVyLmFkZCh0aGlzLnNtLnBsYXlIb3ZlckNsaWNrLCB0aGlzLnNtKTtcclxuICAgYnV0dG9uLm9uSW5wdXREb3duLmFkZCh0aGlzLnNtLnBsYXlEb3duQ2xpY2ssIHRoaXMuc20pO1xyXG4gICBidXR0b24ua2lsbCgpO1xyXG59O1xyXG5cclxuU2hvcC5wcm90b3R5cGUuYWRkTW9uZXkgPSBmdW5jdGlvbihhbXQpIHtcclxuICAgdGhpcy5tb25leSArPSBhbXQ7XHJcbiAgIHRoaXMubW9uZXlUZXh0LnRleHQgPSB0aGlzLm1vbmV5O1xyXG4gICB0aGlzLmNhc2hSZWdpc3Rlci5wbGF5KCk7XHJcbn07XHJcblxyXG5TaG9wLnByb3RvdHlwZS5kZWJ1Z0FkZE1vbmV5ID0gZnVuY3Rpb24oKSB7XHJcbiAgdGhpcy5hZGRNb25leSgxMDAwKTsgXHJcbn07XHJcblxyXG5TaG9wLnByb3RvdHlwZS51c2VTaG9wQnV0dG9uID0gZnVuY3Rpb24oKSB7XHJcbiAgIGlmKCF0aGlzLnNob3BQYW5lbC5hbGl2ZSAmJiAhdGhpcy5zaG9wTWVudU9wZW5pbmcgJiYgIXRoaXMuc2hvcE1lbnVDbG9zaW5nKSB7XHJcbiAgICAgIHRoaXMuc2hvcFBhbmVsLnJldml2ZSgpO1xyXG4gICAgICB0aGlzLmRpZmYgPSAwO1xyXG4gICAgICB0aGlzLnNob3BNZW51T3BlbmluZyA9IHRydWU7XHJcbiAgIH1cclxuICAgZWxzZSBpZih0aGlzLnNob3BQYW5lbC5hbGl2ZSYmICF0aGlzLnNob3BNZW51Q2xvc2luZyAmJiAhdGhpcy5zaG9wTWVudU9wZW5pbmcpIHtcclxuICAgICAgdGhpcy5zaG9wTWVudUNsb3NpbmcgPSB0cnVlO1xyXG4gICB9XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFNob3A7XHJcblxyXG5cclxuXHJcblxyXG5cclxuLy8gLy9TaG9wIE1vdmVtZW50IENvZGVcclxuXHQvLyBpZihzaG9wTWVudU9wZW5pbmcgPT09IHRydWUpIHtcdFxyXG5cdFx0Ly8gLy8gZGlmZiArPSA0O1xyXG4gICAgICAvLyBkaWZmICs9IHRoaXMuc2hvcFNwZWVkICogdGhpcy5nYW1lLnRpbWUuZWxhcHNlZDtcclxuXHRcdC8vIGlmKGRpZmYgPj0gMjc2KSB7XHJcblx0XHRcdC8vIHNob3BNZW51T3BlbmluZyA9IGZhbHNlO1xyXG5cdFx0XHQvLyB0aGlzLmFkZFNob3BCdXR0b25zKCk7XHJcblx0XHQvLyB9XHJcblx0Ly8gfVxyXG5cdC8vIGVsc2UgaWYoc2hvcE1lbnVDbG9zaW5nID09PSB0cnVlKSB7XHJcblx0XHQvLyAvLyBkaWZmIC09IDQ7XHJcbiAgICAgIC8vIGRpZmYgLT0gdGhpcy5zaG9wU3BlZWQgKiB0aGlzLmdhbWUudGltZS5lbGFwc2VkO1xyXG5cdFx0Ly8gaWYoZGlmZiA8PSAwKSB7XHJcblx0XHRcdC8vIHNob3BQYW5lbC5raWxsKCk7XHJcblx0XHRcdC8vIHNob3BNZW51Q2xvc2luZyA9IGZhbHNlO1xyXG5cdFx0Ly8gfVxyXG5cdC8vIH1cclxuXHJcblxyXG5cclxuIiwiLypcclxuQ29sbGVjdGlvbiBvZiB1dGlsaXR5IGZ1bmN0aW9ucy5cclxuKi9cclxuXHJcbnZhciBVdGlscyA9IHtcclxuICAgIGNvbnRhaW5zT2JqZWN0OiBmdW5jdGlvbihvYmosIGxpc3QpIHtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAobGlzdFtpXSA9PT0gb2JqKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSxcclxuICAgIGRpc3RhbmNlOiBmdW5jdGlvbih4MSwgeTEsIHgyLCB5Mikge1xyXG4gICAgICAgcmV0dXJuIE1hdGguc3FydChNYXRoLnBvdyh4MSAtIHgyLCAyKSArIE1hdGgucG93KHkxIC0geTIsIDIpKTtcclxuICAgIH0sXHJcbiAgICBsZXJwOiBmdW5jdGlvbihhLCBiLCB0KSB7XHJcbiAgICAgICBpZiAodCA8IDAgfHwgdCA+IDEpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdiYWQgcmFuZ2UgZm9yIFV0aWxzLmxlcnAoKSwgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEnKTtcclxuICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgfVxyXG4gICAgICAgcmV0dXJuIGEgKyB0ICogKGIgLSBhKTtcclxuICAgIH1cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gVXRpbHM7Il19
